function submitAjax(t){$.ajax({url:$(t).attr("action"),type:$(t).attr("method")}).done(function(t){t=JSON.parse(t),t.success?($(".ajax-success").removeClass("hidden"),$(".ajax-success .message").text(t.message)):($(".ajax-error").removeClass("hidden"),$(".ajax-error .message").text(t.message))})}function highlightCorrect(){var t=$(".correct-answer").toArray();t.forEach(function(t){var e=$(t)[0].value,n=$(t).next().children("li")[e-1];$(n).addClass("correct")})}function pad2(t){return(10>t?"0":"")+t}function getTotalTime(t,e,n,i){var o=60*(e-t)+(i-n);return console.log(o),o}function validateCC(t){if(""==t.find("#cc").val())return!0;var e="Are you sure you want to CC the following: \r\n",n=t.find("#cc").val().replace(" ","").split(",");return n.forEach(function(t){var n=$("#userlist").find('[data-initials="'+t+'"]');e+=" "+n.data("name")+"("+t+")\r\n"}),window.confirm(e)}+function(t){"use strict";var e='[data-dismiss="alert"]',n=function(n){t(n).on("click",e,this.close)};n.prototype.close=function(e){function n(){a.trigger("closed.bs.alert").remove()}var i=t(this),o=i.attr("data-target");o||(o=i.attr("href"),o=o&&o.replace(/.*(?=#[^\s]*$)/,""));var a=t(o);e&&e.preventDefault(),a.length||(a=i.hasClass("alert")?i:i.parent()),a.trigger(e=t.Event("close.bs.alert")),e.isDefaultPrevented()||(a.removeClass("in"),t.support.transition&&a.hasClass("fade")?a.one(t.support.transition.end,n).emulateTransitionEnd(150):n())};var i=t.fn.alert;t.fn.alert=function(e){return this.each(function(){var i=t(this),o=i.data("bs.alert");o||i.data("bs.alert",o=new n(this)),"string"==typeof e&&o[e].call(i)})},t.fn.alert.Constructor=n,t.fn.alert.noConflict=function(){return t.fn.alert=i,this},t(document).on("click.bs.alert.data-api",e,n.prototype.close)}(jQuery),+function(t){"use strict";var e=function(n,i){this.$element=t(n),this.options=t.extend({},e.DEFAULTS,i),this.isLoading=!1};e.DEFAULTS={loadingText:"loading..."},e.prototype.setState=function(e){var n="disabled",i=this.$element,o=i.is("input")?"val":"html",a=i.data();e+="Text",a.resetText||i.data("resetText",i[o]()),i[o](a[e]||this.options[e]),setTimeout(t.proxy(function(){"loadingText"==e?(this.isLoading=!0,i.addClass(n).attr(n,n)):this.isLoading&&(this.isLoading=!1,i.removeClass(n).removeAttr(n))},this),0)},e.prototype.toggle=function(){var t=!0,e=this.$element.closest('[data-toggle="buttons"]');if(e.length){var n=this.$element.find("input");"radio"==n.prop("type")&&(n.prop("checked")&&this.$element.hasClass("active")?t=!1:e.find(".active").removeClass("active")),t&&n.prop("checked",!this.$element.hasClass("active")).trigger("change")}t&&this.$element.toggleClass("active")};var n=t.fn.button;t.fn.button=function(n){return this.each(function(){var i=t(this),o=i.data("bs.button"),a="object"==typeof n&&n;o||i.data("bs.button",o=new e(this,a)),"toggle"==n?o.toggle():n&&o.setState(n)})},t.fn.button.Constructor=e,t.fn.button.noConflict=function(){return t.fn.button=n,this},t(document).on("click.bs.button.data-api","[data-toggle^=button]",function(e){var n=t(e.target);n.hasClass("btn")||(n=n.closest(".btn")),n.button("toggle"),e.preventDefault()})}(jQuery),+function(t){"use strict";var e=function(e,n){this.$element=t(e),this.$indicators=this.$element.find(".carousel-indicators"),this.options=n,this.paused=this.sliding=this.interval=this.$active=this.$items=null,"hover"==this.options.pause&&this.$element.on("mouseenter",t.proxy(this.pause,this)).on("mouseleave",t.proxy(this.cycle,this))};e.DEFAULTS={interval:5e3,pause:"hover",wrap:!0},e.prototype.cycle=function(e){return e||(this.paused=!1),this.interval&&clearInterval(this.interval),this.options.interval&&!this.paused&&(this.interval=setInterval(t.proxy(this.next,this),this.options.interval)),this},e.prototype.getActiveIndex=function(){return this.$active=this.$element.find(".item.active"),this.$items=this.$active.parent().children(),this.$items.index(this.$active)},e.prototype.to=function(e){var n=this,i=this.getActiveIndex();return e>this.$items.length-1||0>e?void 0:this.sliding?this.$element.one("slid.bs.carousel",function(){n.to(e)}):i==e?this.pause().cycle():this.slide(e>i?"next":"prev",t(this.$items[e]))},e.prototype.pause=function(e){return e||(this.paused=!0),this.$element.find(".next, .prev").length&&t.support.transition&&(this.$element.trigger(t.support.transition.end),this.cycle(!0)),this.interval=clearInterval(this.interval),this},e.prototype.next=function(){return this.sliding?void 0:this.slide("next")},e.prototype.prev=function(){return this.sliding?void 0:this.slide("prev")},e.prototype.slide=function(e,n){var i=this.$element.find(".item.active"),o=n||i[e](),a=this.interval,r="next"==e?"left":"right",s="next"==e?"first":"last",l=this;if(!o.length){if(!this.options.wrap)return;o=this.$element.find(".item")[s]()}if(o.hasClass("active"))return this.sliding=!1;var c=t.Event("slide.bs.carousel",{relatedTarget:o[0],direction:r});return this.$element.trigger(c),c.isDefaultPrevented()?void 0:(this.sliding=!0,a&&this.pause(),this.$indicators.length&&(this.$indicators.find(".active").removeClass("active"),this.$element.one("slid.bs.carousel",function(){var e=t(l.$indicators.children()[l.getActiveIndex()]);e&&e.addClass("active")})),t.support.transition&&this.$element.hasClass("slide")?(o.addClass(e),o[0].offsetWidth,i.addClass(r),o.addClass(r),i.one(t.support.transition.end,function(){o.removeClass([e,r].join(" ")).addClass("active"),i.removeClass(["active",r].join(" ")),l.sliding=!1,setTimeout(function(){l.$element.trigger("slid.bs.carousel")},0)}).emulateTransitionEnd(1e3*i.css("transition-duration").slice(0,-1))):(i.removeClass("active"),o.addClass("active"),this.sliding=!1,this.$element.trigger("slid.bs.carousel")),a&&this.cycle(),this)};var n=t.fn.carousel;t.fn.carousel=function(n){return this.each(function(){var i=t(this),o=i.data("bs.carousel"),a=t.extend({},e.DEFAULTS,i.data(),"object"==typeof n&&n),r="string"==typeof n?n:a.slide;o||i.data("bs.carousel",o=new e(this,a)),"number"==typeof n?o.to(n):r?o[r]():a.interval&&o.pause().cycle()})},t.fn.carousel.Constructor=e,t.fn.carousel.noConflict=function(){return t.fn.carousel=n,this},t(document).on("click.bs.carousel.data-api","[data-slide], [data-slide-to]",function(e){var n,i=t(this),o=t(i.attr("data-target")||(n=i.attr("href"))&&n.replace(/.*(?=#[^\s]+$)/,"")),a=t.extend({},o.data(),i.data()),r=i.attr("data-slide-to");r&&(a.interval=!1),o.carousel(a),(r=i.attr("data-slide-to"))&&o.data("bs.carousel").to(r),e.preventDefault()}),t(window).on("load",function(){t('[data-ride="carousel"]').each(function(){var e=t(this);e.carousel(e.data())})})}(jQuery),+function(t){"use strict";function e(e){t(i).remove(),t(o).each(function(){var i=n(t(this)),o={relatedTarget:this};i.hasClass("open")&&(i.trigger(e=t.Event("hide.bs.dropdown",o)),e.isDefaultPrevented()||i.removeClass("open").trigger("hidden.bs.dropdown",o))})}function n(e){var n=e.attr("data-target");n||(n=e.attr("href"),n=n&&/#[A-Za-z]/.test(n)&&n.replace(/.*(?=#[^\s]*$)/,""));var i=n&&t(n);return i&&i.length?i:e.parent()}var i=".dropdown-backdrop",o="[data-toggle=dropdown]",a=function(e){t(e).on("click.bs.dropdown",this.toggle)};a.prototype.toggle=function(i){var o=t(this);if(!o.is(".disabled, :disabled")){var a=n(o),r=a.hasClass("open");if(e(),!r){"ontouchstart"in document.documentElement&&!a.closest(".navbar-nav").length&&t('<div class="dropdown-backdrop"/>').insertAfter(t(this)).on("click",e);var s={relatedTarget:this};if(a.trigger(i=t.Event("show.bs.dropdown",s)),i.isDefaultPrevented())return;a.toggleClass("open").trigger("shown.bs.dropdown",s),o.focus()}return!1}},a.prototype.keydown=function(e){if(/(38|40|27)/.test(e.keyCode)){var i=t(this);if(e.preventDefault(),e.stopPropagation(),!i.is(".disabled, :disabled")){var a=n(i),r=a.hasClass("open");if(!r||r&&27==e.keyCode)return 27==e.which&&a.find(o).focus(),i.click();var s=" li:not(.divider):visible a",l=a.find("[role=menu]"+s+", [role=listbox]"+s);if(l.length){var c=l.index(l.filter(":focus"));38==e.keyCode&&c>0&&c--,40==e.keyCode&&c<l.length-1&&c++,~c||(c=0),l.eq(c).focus()}}}};var r=t.fn.dropdown;t.fn.dropdown=function(e){return this.each(function(){var n=t(this),i=n.data("bs.dropdown");i||n.data("bs.dropdown",i=new a(this)),"string"==typeof e&&i[e].call(n)})},t.fn.dropdown.Constructor=a,t.fn.dropdown.noConflict=function(){return t.fn.dropdown=r,this},t(document).on("click.bs.dropdown.data-api",e).on("click.bs.dropdown.data-api",".dropdown form",function(t){t.stopPropagation()}).on("click.bs.dropdown.data-api",o,a.prototype.toggle).on("keydown.bs.dropdown.data-api",o+", [role=menu], [role=listbox]",a.prototype.keydown)}(jQuery),+function(t){"use strict";var e=function(e,n){this.options=n,this.$element=t(e),this.$backdrop=this.isShown=null,this.options.remote&&this.$element.find(".modal-content").load(this.options.remote,t.proxy(function(){this.$element.trigger("loaded.bs.modal")},this))};e.DEFAULTS={backdrop:!0,keyboard:!0,show:!0},e.prototype.toggle=function(t){return this[this.isShown?"hide":"show"](t)},e.prototype.show=function(e){var n=this,i=t.Event("show.bs.modal",{relatedTarget:e});this.$element.trigger(i),this.isShown||i.isDefaultPrevented()||(this.isShown=!0,this.escape(),this.$element.on("click.dismiss.bs.modal",'[data-dismiss="modal"]',t.proxy(this.hide,this)),this.backdrop(function(){var i=t.support.transition&&n.$element.hasClass("fade");n.$element.parent().length||n.$element.appendTo(document.body),n.$element.show().scrollTop(0),i&&n.$element[0].offsetWidth,n.$element.addClass("in").attr("aria-hidden",!1),n.enforceFocus();var o=t.Event("shown.bs.modal",{relatedTarget:e});i?n.$element.find(".modal-dialog").one(t.support.transition.end,function(){n.$element.focus().trigger(o)}).emulateTransitionEnd(300):n.$element.focus().trigger(o)}))},e.prototype.hide=function(e){e&&e.preventDefault(),e=t.Event("hide.bs.modal"),this.$element.trigger(e),this.isShown&&!e.isDefaultPrevented()&&(this.isShown=!1,this.escape(),t(document).off("focusin.bs.modal"),this.$element.removeClass("in").attr("aria-hidden",!0).off("click.dismiss.bs.modal"),t.support.transition&&this.$element.hasClass("fade")?this.$element.one(t.support.transition.end,t.proxy(this.hideModal,this)).emulateTransitionEnd(300):this.hideModal())},e.prototype.enforceFocus=function(){t(document).off("focusin.bs.modal").on("focusin.bs.modal",t.proxy(function(t){this.$element[0]===t.target||this.$element.has(t.target).length||this.$element.focus()},this))},e.prototype.escape=function(){this.isShown&&this.options.keyboard?this.$element.on("keyup.dismiss.bs.modal",t.proxy(function(t){27==t.which&&this.hide()},this)):this.isShown||this.$element.off("keyup.dismiss.bs.modal")},e.prototype.hideModal=function(){var t=this;this.$element.hide(),this.backdrop(function(){t.removeBackdrop(),t.$element.trigger("hidden.bs.modal")})},e.prototype.removeBackdrop=function(){this.$backdrop&&this.$backdrop.remove(),this.$backdrop=null},e.prototype.backdrop=function(e){var n=this.$element.hasClass("fade")?"fade":"";if(this.isShown&&this.options.backdrop){var i=t.support.transition&&n;if(this.$backdrop=t('<div class="modal-backdrop '+n+'" />').appendTo(document.body),this.$element.on("click.dismiss.bs.modal",t.proxy(function(t){t.target===t.currentTarget&&("static"==this.options.backdrop?this.$element[0].focus.call(this.$element[0]):this.hide.call(this))},this)),i&&this.$backdrop[0].offsetWidth,this.$backdrop.addClass("in"),!e)return;i?this.$backdrop.one(t.support.transition.end,e).emulateTransitionEnd(150):e()}else!this.isShown&&this.$backdrop?(this.$backdrop.removeClass("in"),t.support.transition&&this.$element.hasClass("fade")?this.$backdrop.one(t.support.transition.end,e).emulateTransitionEnd(150):e()):e&&e()};var n=t.fn.modal;t.fn.modal=function(n,i){return this.each(function(){var o=t(this),a=o.data("bs.modal"),r=t.extend({},e.DEFAULTS,o.data(),"object"==typeof n&&n);a||o.data("bs.modal",a=new e(this,r)),"string"==typeof n?a[n](i):r.show&&a.show(i)})},t.fn.modal.Constructor=e,t.fn.modal.noConflict=function(){return t.fn.modal=n,this},t(document).on("click.bs.modal.data-api",'[data-toggle="modal"]',function(e){var n=t(this),i=n.attr("href"),o=t(n.attr("data-target")||i&&i.replace(/.*(?=#[^\s]+$)/,"")),a=o.data("bs.modal")?"toggle":t.extend({remote:!/#/.test(i)&&i},o.data(),n.data());n.is("a")&&e.preventDefault(),o.modal(a,this).one("hide",function(){n.is(":visible")&&n.focus()})}),t(document).on("show.bs.modal",".modal",function(){t(document.body).addClass("modal-open")}).on("hidden.bs.modal",".modal",function(){t(document.body).removeClass("modal-open")})}(jQuery),+function(t){"use strict";var e=function(t,e){this.type=this.options=this.enabled=this.timeout=this.hoverState=this.$element=null,this.init("tooltip",t,e)};e.DEFAULTS={animation:!0,placement:"top",selector:!1,template:'<div class="tooltip"><div class="tooltip-arrow"></div><div class="tooltip-inner"></div></div>',trigger:"hover focus",title:"",delay:0,html:!1,container:!1},e.prototype.init=function(e,n,i){this.enabled=!0,this.type=e,this.$element=t(n),this.options=this.getOptions(i);for(var o=this.options.trigger.split(" "),a=o.length;a--;){var r=o[a];if("click"==r)this.$element.on("click."+this.type,this.options.selector,t.proxy(this.toggle,this));else if("manual"!=r){var s="hover"==r?"mouseenter":"focusin",l="hover"==r?"mouseleave":"focusout";this.$element.on(s+"."+this.type,this.options.selector,t.proxy(this.enter,this)),this.$element.on(l+"."+this.type,this.options.selector,t.proxy(this.leave,this))}}this.options.selector?this._options=t.extend({},this.options,{trigger:"manual",selector:""}):this.fixTitle()},e.prototype.getDefaults=function(){return e.DEFAULTS},e.prototype.getOptions=function(e){return e=t.extend({},this.getDefaults(),this.$element.data(),e),e.delay&&"number"==typeof e.delay&&(e.delay={show:e.delay,hide:e.delay}),e},e.prototype.getDelegateOptions=function(){var e={},n=this.getDefaults();return this._options&&t.each(this._options,function(t,i){n[t]!=i&&(e[t]=i)}),e},e.prototype.enter=function(e){var n=e instanceof this.constructor?e:t(e.currentTarget)[this.type](this.getDelegateOptions()).data("bs."+this.type);return clearTimeout(n.timeout),n.hoverState="in",n.options.delay&&n.options.delay.show?void(n.timeout=setTimeout(function(){"in"==n.hoverState&&n.show()},n.options.delay.show)):n.show()},e.prototype.leave=function(e){var n=e instanceof this.constructor?e:t(e.currentTarget)[this.type](this.getDelegateOptions()).data("bs."+this.type);return clearTimeout(n.timeout),n.hoverState="out",n.options.delay&&n.options.delay.hide?void(n.timeout=setTimeout(function(){"out"==n.hoverState&&n.hide()},n.options.delay.hide)):n.hide()},e.prototype.show=function(){var e=t.Event("show.bs."+this.type);if(this.hasContent()&&this.enabled){if(this.$element.trigger(e),e.isDefaultPrevented())return;var n=this,i=this.tip();this.setContent(),this.options.animation&&i.addClass("fade");var o="function"==typeof this.options.placement?this.options.placement.call(this,i[0],this.$element[0]):this.options.placement,a=/\s?auto?\s?/i,r=a.test(o);r&&(o=o.replace(a,"")||"top"),i.detach().css({top:0,left:0,display:"block"}).addClass(o),this.options.container?i.appendTo(this.options.container):i.insertAfter(this.$element);var s=this.getPosition(),l=i[0].offsetWidth,c=i[0].offsetHeight;if(r){var d=this.$element.parent(),h=o,u=document.documentElement.scrollTop||document.body.scrollTop,p="body"==this.options.container?window.innerWidth:d.outerWidth(),f="body"==this.options.container?window.innerHeight:d.outerHeight(),g="body"==this.options.container?0:d.offset().left;o="bottom"==o&&s.top+s.height+c-u>f?"top":"top"==o&&s.top-u-c<0?"bottom":"right"==o&&s.right+l>p?"left":"left"==o&&s.left-l<g?"right":o,i.removeClass(h).addClass(o)}var m=this.getCalculatedOffset(o,s,l,c);this.applyPlacement(m,o),this.hoverState=null;var v=function(){n.$element.trigger("shown.bs."+n.type)};t.support.transition&&this.$tip.hasClass("fade")?i.one(t.support.transition.end,v).emulateTransitionEnd(150):v()}},e.prototype.applyPlacement=function(e,n){var i,o=this.tip(),a=o[0].offsetWidth,r=o[0].offsetHeight,s=parseInt(o.css("margin-top"),10),l=parseInt(o.css("margin-left"),10);isNaN(s)&&(s=0),isNaN(l)&&(l=0),e.top=e.top+s,e.left=e.left+l,t.offset.setOffset(o[0],t.extend({using:function(t){o.css({top:Math.round(t.top),left:Math.round(t.left)})}},e),0),o.addClass("in");var c=o[0].offsetWidth,d=o[0].offsetHeight;if("top"==n&&d!=r&&(i=!0,e.top=e.top+r-d),/bottom|top/.test(n)){var h=0;e.left<0&&(h=-2*e.left,e.left=0,o.offset(e),c=o[0].offsetWidth,d=o[0].offsetHeight),this.replaceArrow(h-a+c,c,"left")}else this.replaceArrow(d-r,d,"top");i&&o.offset(e)},e.prototype.replaceArrow=function(t,e,n){this.arrow().css(n,t?50*(1-t/e)+"%":"")},e.prototype.setContent=function(){var t=this.tip(),e=this.getTitle();t.find(".tooltip-inner")[this.options.html?"html":"text"](e),t.removeClass("fade in top bottom left right")},e.prototype.hide=function(){function e(){"in"!=n.hoverState&&i.detach(),n.$element.trigger("hidden.bs."+n.type)}var n=this,i=this.tip(),o=t.Event("hide.bs."+this.type);return this.$element.trigger(o),o.isDefaultPrevented()?void 0:(i.removeClass("in"),t.support.transition&&this.$tip.hasClass("fade")?i.one(t.support.transition.end,e).emulateTransitionEnd(150):e(),this.hoverState=null,this)},e.prototype.fixTitle=function(){var t=this.$element;(t.attr("title")||"string"!=typeof t.attr("data-original-title"))&&t.attr("data-original-title",t.attr("title")||"").attr("title","")},e.prototype.hasContent=function(){return this.getTitle()},e.prototype.getPosition=function(){var e=this.$element[0];return t.extend({},"function"==typeof e.getBoundingClientRect?e.getBoundingClientRect():{width:e.offsetWidth,height:e.offsetHeight},this.$element.offset())},e.prototype.getCalculatedOffset=function(t,e,n,i){return"bottom"==t?{top:e.top+e.height,left:e.left+e.width/2-n/2}:"top"==t?{top:e.top-i,left:e.left+e.width/2-n/2}:"left"==t?{top:e.top+e.height/2-i/2,left:e.left-n}:{top:e.top+e.height/2-i/2,left:e.left+e.width}},e.prototype.getTitle=function(){var t,e=this.$element,n=this.options;return t=e.attr("data-original-title")||("function"==typeof n.title?n.title.call(e[0]):n.title)},e.prototype.tip=function(){return this.$tip=this.$tip||t(this.options.template)},e.prototype.arrow=function(){return this.$arrow=this.$arrow||this.tip().find(".tooltip-arrow")},e.prototype.validate=function(){this.$element[0].parentNode||(this.hide(),this.$element=null,this.options=null)},e.prototype.enable=function(){this.enabled=!0},e.prototype.disable=function(){this.enabled=!1},e.prototype.toggleEnabled=function(){this.enabled=!this.enabled},e.prototype.toggle=function(e){var n=e?t(e.currentTarget)[this.type](this.getDelegateOptions()).data("bs."+this.type):this;n.tip().hasClass("in")?n.leave(n):n.enter(n)},e.prototype.destroy=function(){clearTimeout(this.timeout),this.hide().$element.off("."+this.type).removeData("bs."+this.type)};var n=t.fn.tooltip;t.fn.tooltip=function(n){return this.each(function(){var i=t(this),o=i.data("bs.tooltip"),a="object"==typeof n&&n;(o||"destroy"!=n)&&(o||i.data("bs.tooltip",o=new e(this,a)),"string"==typeof n&&o[n]())})},t.fn.tooltip.Constructor=e,t.fn.tooltip.noConflict=function(){return t.fn.tooltip=n,this}}(jQuery),+function(t){"use strict";var e=function(t,e){this.init("popover",t,e)};if(!t.fn.tooltip)throw new Error("Popover requires tooltip.js");e.DEFAULTS=t.extend({},t.fn.tooltip.Constructor.DEFAULTS,{placement:"right",trigger:"click",content:"",template:'<div class="popover"><div class="arrow"></div><h3 class="popover-title"></h3><div class="popover-content"></div></div>'}),e.prototype=t.extend({},t.fn.tooltip.Constructor.prototype),e.prototype.constructor=e,e.prototype.getDefaults=function(){return e.DEFAULTS},e.prototype.setContent=function(){var t=this.tip(),e=this.getTitle(),n=this.getContent();t.find(".popover-title")[this.options.html?"html":"text"](e),t.find(".popover-content")[this.options.html?"string"==typeof n?"html":"append":"text"](n),t.removeClass("fade top bottom left right in"),t.find(".popover-title").html()||t.find(".popover-title").hide()},e.prototype.hasContent=function(){return this.getTitle()||this.getContent()},e.prototype.getContent=function(){var t=this.$element,e=this.options;return t.attr("data-content")||("function"==typeof e.content?e.content.call(t[0]):e.content)},e.prototype.arrow=function(){return this.$arrow=this.$arrow||this.tip().find(".arrow")},e.prototype.tip=function(){return this.$tip||(this.$tip=t(this.options.template)),this.$tip};var n=t.fn.popover;t.fn.popover=function(n){return this.each(function(){var i=t(this),o=i.data("bs.popover"),a="object"==typeof n&&n;(o||"destroy"!=n)&&(o||i.data("bs.popover",o=new e(this,a)),"string"==typeof n&&o[n]())})},t.fn.popover.Constructor=e,t.fn.popover.noConflict=function(){return t.fn.popover=n,this}}(jQuery),+function(t){"use strict";var e=function(e){this.element=t(e)};e.prototype.show=function(){var e=this.element,n=e.closest("ul:not(.dropdown-menu)"),i=e.data("target");if(i||(i=e.attr("href"),i=i&&i.replace(/.*(?=#[^\s]*$)/,"")),!e.parent("li").hasClass("active")){var o=n.find(".active:last a")[0],a=t.Event("show.bs.tab",{relatedTarget:o});if(e.trigger(a),!a.isDefaultPrevented()){var r=t(i);this.activate(e.parent("li"),n),this.activate(r,r.parent(),function(){e.trigger({type:"shown.bs.tab",relatedTarget:o})})}}},e.prototype.activate=function(e,n,i){function o(){a.removeClass("active").find("> .dropdown-menu > .active").removeClass("active"),e.addClass("active"),r?(e[0].offsetWidth,e.addClass("in")):e.removeClass("fade"),e.parent(".dropdown-menu")&&e.closest("li.dropdown").addClass("active"),i&&i()}var a=n.find("> .active"),r=i&&t.support.transition&&a.hasClass("fade");r?a.one(t.support.transition.end,o).emulateTransitionEnd(150):o(),a.removeClass("in")};var n=t.fn.tab;t.fn.tab=function(n){return this.each(function(){var i=t(this),o=i.data("bs.tab");o||i.data("bs.tab",o=new e(this)),"string"==typeof n&&o[n]()})},t.fn.tab.Constructor=e,t.fn.tab.noConflict=function(){return t.fn.tab=n,this},t(document).on("click.bs.tab.data-api",'[data-toggle="tab"], [data-toggle="pill"]',function(e){e.preventDefault(),t(this).tab("show")})}(jQuery),+function(t){"use strict";var e=function(n,i){this.options=t.extend({},e.DEFAULTS,i),this.$window=t(window).on("scroll.bs.affix.data-api",t.proxy(this.checkPosition,this)).on("click.bs.affix.data-api",t.proxy(this.checkPositionWithEventLoop,this)),this.$element=t(n),this.affixed=this.unpin=this.pinnedOffset=null,this.checkPosition()};e.RESET="affix affix-top affix-bottom",e.DEFAULTS={offset:0},e.prototype.getPinnedOffset=function(){if(this.pinnedOffset)return this.pinnedOffset;this.$element.removeClass(e.RESET).addClass("affix");var t=this.$window.scrollTop(),n=this.$element.offset();return this.pinnedOffset=n.top-t},e.prototype.checkPositionWithEventLoop=function(){setTimeout(t.proxy(this.checkPosition,this),1)},e.prototype.checkPosition=function(){if(this.$element.is(":visible")){var n=t(document).height(),i=this.$window.scrollTop(),o=this.$element.offset(),a=this.options.offset,r=a.top,s=a.bottom;"top"==this.affixed&&(o.top+=i),"object"!=typeof a&&(s=r=a),"function"==typeof r&&(r=a.top(this.$element)),"function"==typeof s&&(s=a.bottom(this.$element));var l=null!=this.unpin&&i+this.unpin<=o.top?!1:null!=s&&o.top+this.$element.height()>=n-s?"bottom":null!=r&&r>=i?"top":!1;if(this.affixed!==l){this.unpin&&this.$element.css("top","");var c="affix"+(l?"-"+l:""),d=t.Event(c+".bs.affix");this.$element.trigger(d),d.isDefaultPrevented()||(this.affixed=l,this.unpin="bottom"==l?this.getPinnedOffset():null,this.$element.removeClass(e.RESET).addClass(c).trigger(t.Event(c.replace("affix","affixed"))),"bottom"==l&&this.$element.offset({top:n-s-this.$element.height()}))}}};var n=t.fn.affix;t.fn.affix=function(n){return this.each(function(){var i=t(this),o=i.data("bs.affix"),a="object"==typeof n&&n;o||i.data("bs.affix",o=new e(this,a)),"string"==typeof n&&o[n]()})},t.fn.affix.Constructor=e,t.fn.affix.noConflict=function(){return t.fn.affix=n,this},t(window).on("load",function(){t('[data-spy="affix"]').each(function(){var e=t(this),n=e.data();n.offset=n.offset||{},n.offsetBottom&&(n.offset.bottom=n.offsetBottom),n.offsetTop&&(n.offset.top=n.offsetTop),e.affix(n)})})}(jQuery),+function(t){"use strict";var e=function(n,i){this.$element=t(n),this.options=t.extend({},e.DEFAULTS,i),this.transitioning=null,this.options.parent&&(this.$parent=t(this.options.parent)),this.options.toggle&&this.toggle()};e.DEFAULTS={toggle:!0},e.prototype.dimension=function(){var t=this.$element.hasClass("width");return t?"width":"height"},e.prototype.show=function(){if(!this.transitioning&&!this.$element.hasClass("in")){var e=t.Event("show.bs.collapse");if(this.$element.trigger(e),!e.isDefaultPrevented()){var n=this.$parent&&this.$parent.find("> .panel > .in");if(n&&n.length){var i=n.data("bs.collapse");if(i&&i.transitioning)return;n.collapse("hide"),i||n.data("bs.collapse",null)}var o=this.dimension();this.$element.removeClass("collapse").addClass("collapsing")[o](0),this.transitioning=1;var a=function(){this.$element.removeClass("collapsing").addClass("collapse in")[o]("auto"),this.transitioning=0,this.$element.trigger("shown.bs.collapse")};if(!t.support.transition)return a.call(this);var r=t.camelCase(["scroll",o].join("-"));this.$element.one(t.support.transition.end,t.proxy(a,this)).emulateTransitionEnd(350)[o](this.$element[0][r])}}},e.prototype.hide=function(){if(!this.transitioning&&this.$element.hasClass("in")){var e=t.Event("hide.bs.collapse");if(this.$element.trigger(e),!e.isDefaultPrevented()){var n=this.dimension();this.$element[n](this.$element[n]())[0].offsetHeight,this.$element.addClass("collapsing").removeClass("collapse").removeClass("in"),this.transitioning=1;var i=function(){this.transitioning=0,this.$element.trigger("hidden.bs.collapse").removeClass("collapsing").addClass("collapse")};return t.support.transition?void this.$element[n](0).one(t.support.transition.end,t.proxy(i,this)).emulateTransitionEnd(350):i.call(this)}}},e.prototype.toggle=function(){this[this.$element.hasClass("in")?"hide":"show"]()};var n=t.fn.collapse;t.fn.collapse=function(n){return this.each(function(){var i=t(this),o=i.data("bs.collapse"),a=t.extend({},e.DEFAULTS,i.data(),"object"==typeof n&&n);!o&&a.toggle&&"show"==n&&(n=!n),o||i.data("bs.collapse",o=new e(this,a)),"string"==typeof n&&o[n]()})},t.fn.collapse.Constructor=e,t.fn.collapse.noConflict=function(){return t.fn.collapse=n,this},t(document).on("click.bs.collapse.data-api","[data-toggle=collapse]",function(e){var n,i=t(this),o=i.attr("data-target")||e.preventDefault()||(n=i.attr("href"))&&n.replace(/.*(?=#[^\s]+$)/,""),a=t(o),r=a.data("bs.collapse"),s=r?"toggle":i.data(),l=i.attr("data-parent"),c=l&&t(l);r&&r.transitioning||(c&&c.find('[data-toggle=collapse][data-parent="'+l+'"]').not(i).addClass("collapsed"),i[a.hasClass("in")?"addClass":"removeClass"]("collapsed")),a.collapse(s)})}(jQuery),+function(t){"use strict";function e(n,i){var o,a=t.proxy(this.process,this);this.$element=t(t(n).is("body")?window:n),this.$body=t("body"),this.$scrollElement=this.$element.on("scroll.bs.scroll-spy.data-api",a),this.options=t.extend({},e.DEFAULTS,i),this.selector=(this.options.target||(o=t(n).attr("href"))&&o.replace(/.*(?=#[^\s]+$)/,"")||"")+" .nav li > a",this.offsets=t([]),this.targets=t([]),this.activeTarget=null,this.refresh(),this.process()}e.DEFAULTS={offset:10},e.prototype.refresh=function(){var e=this.$element[0]==window?"offset":"position";this.offsets=t([]),this.targets=t([]);{var n=this;this.$body.find(this.selector).map(function(){var i=t(this),o=i.data("target")||i.attr("href"),a=/^#./.test(o)&&t(o);return a&&a.length&&a.is(":visible")&&[[a[e]().top+(!t.isWindow(n.$scrollElement.get(0))&&n.$scrollElement.scrollTop()),o]]||null}).sort(function(t,e){return t[0]-e[0]}).each(function(){n.offsets.push(this[0]),n.targets.push(this[1])})}},e.prototype.process=function(){var t,e=this.$scrollElement.scrollTop()+this.options.offset,n=this.$scrollElement[0].scrollHeight||this.$body[0].scrollHeight,i=n-this.$scrollElement.height(),o=this.offsets,a=this.targets,r=this.activeTarget;if(e>=i)return r!=(t=a.last()[0])&&this.activate(t);if(r&&e<=o[0])return r!=(t=a[0])&&this.activate(t);for(t=o.length;t--;)r!=a[t]&&e>=o[t]&&(!o[t+1]||e<=o[t+1])&&this.activate(a[t])},e.prototype.activate=function(e){this.activeTarget=e,t(this.selector).parentsUntil(this.options.target,".active").removeClass("active");var n=this.selector+'[data-target="'+e+'"],'+this.selector+'[href="'+e+'"]',i=t(n).parents("li").addClass("active");i.parent(".dropdown-menu").length&&(i=i.closest("li.dropdown").addClass("active")),i.trigger("activate.bs.scrollspy")};var n=t.fn.scrollspy;t.fn.scrollspy=function(n){return this.each(function(){var i=t(this),o=i.data("bs.scrollspy"),a="object"==typeof n&&n;o||i.data("bs.scrollspy",o=new e(this,a)),"string"==typeof n&&o[n]()})},t.fn.scrollspy.Constructor=e,t.fn.scrollspy.noConflict=function(){return t.fn.scrollspy=n,this},t(window).on("load",function(){t('[data-spy="scroll"]').each(function(){var e=t(this);e.scrollspy(e.data())})})}(jQuery),+function(t){"use strict";function e(){var t=document.createElement("bootstrap"),e={WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",OTransition:"oTransitionEnd otransitionend",transition:"transitionend"};for(var n in e)if(void 0!==t.style[n])return{end:e[n]};return!1}t.fn.emulateTransitionEnd=function(e){var n=!1,i=this;t(this).one(t.support.transition.end,function(){n=!0});var o=function(){n||t(i).trigger(t.support.transition.end)};return setTimeout(o,e),this},t(function(){t.support.transition=e()})}(jQuery),function(t){"use strict";var e={i18n:{ru:{months:["Январь","Февраль","Март","Апрель","Май","Июнь","Июль","Август","Сентябрь","Октябрь","Ноябрь","Декабрь"],dayOfWeek:["Вск","Пн","Вт","Ср","Чт","Пт","Сб"]},en:{months:["January","February","March","April","May","June","July","August","September","October","November","December"],dayOfWeek:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"]},de:{months:["Januar","Februar","März","April","Mai","Juni","Juli","August","September","Oktober","November","Dezember"],dayOfWeek:["So","Mo","Di","Mi","Do","Fr","Sa"]},nl:{months:["januari","februari","maart","april","mei","juni","juli","augustus","september","oktober","november","december"],dayOfWeek:["zo","ma","di","wo","do","vr","za"]},tr:{months:["Ocak","Şubat","Mart","Nisan","Mayıs","Haziran","Temmuz","Ağustos","Eylül","Ekim","Kasım","Aralık"],dayOfWeek:["Paz","Pts","Sal","Çar","Per","Cum","Cts"]},fr:{months:["Janvier","Février","Mars","Avril","Mai","Juin","Juillet","Août","Septembre","Octobre","Novembre","Décembre"],dayOfWeek:["Dim","Lun","Mar","Mer","Jeu","Ven","Sam"]},es:{months:["Enero","Febrero","Marzo","Abril","Mayo","Junio","Julio","Agosto","Septiembre","Octubre","Noviembre","Diciembre"],dayOfWeek:["Dom","Lun","Mar","Mié","Jue","Vie","Sáb"]},th:{months:["มกราคม","กุมภาพันธ์","มีนาคม","เมษายน","พฤษภาคม","มิถุนายน","กรกฎาคม","สิงหาคม","กันยายน","ตุลาคม","พฤศจิกายน","ธันวาคม"],dayOfWeek:["อา.","จ.","อ.","พ.","พฤ.","ศ.","ส."]},pl:{months:["styczeń","luty","marzec","kwiecień","maj","czerwiec","lipiec","sierpień","wrzesień","październik","listopad","grudzień"],dayOfWeek:["nd","pn","wt","śr","cz","pt","sb"]},pt:{months:["Janeiro","Fevereiro","Março","Abril","Maio","Junho","Julho","Agosto","Setembro","Outubro","Novembro","Dezembro"],dayOfWeek:["Dom","Seg","Ter","Qua","Qui","Sex","Sab"]},ch:{months:["一月","二月","三月","四月","五月","六月","七月","八月","九月","十月","十一月","十二月"],dayOfWeek:["日","一","二","三","四","五","六"]},se:{months:["Januari","Februari","Mars","April","Maj","Juni","Juli","Augusti","September","Oktober","November","December"],dayOfWeek:["Sön","Mån","Tis","Ons","Tor","Fre","Lör"]},kr:{months:["1월","2월","3월","4월","5월","6월","7월","8월","9월","10월","11월","12월"],dayOfWeek:["일","월","화","수","목","금","토"]},it:{months:["Gennaio","Febbraio","Marzo","Aprile","Maggio","Giugno","Luglio","Agosto","Settembre","Ottobre","Novembre","Dicembre"],dayOfWeek:["Dom","Lun","Mar","Mer","Gio","Ven","Sab"]}},value:"",lang:"en",format:"Y/m/d H:i",formatTime:"H:i",formatDate:"Y/m/d",step:60,closeOnDateSelect:0,closeOnWithoutClick:!0,timepicker:!0,datepicker:!0,minDate:!1,maxDate:!1,minTime:!1,maxTime:!1,allowTimes:[],opened:!1,initTime:!0,inline:!1,onSelectDate:function(){},onSelectTime:function(){},onChangeMonth:function(){},onChangeDateTime:function(){},onShow:function(){},onClose:function(){},onGenerate:function(){},withoutCopyright:!0,inverseButton:!1,hours12:!1,next:"xdsoft_next",prev:"xdsoft_prev",dayOfWeekStart:0,timeHeightInTimePicker:25,timepickerScrollbar:!0,todayButton:!0,defaultSelect:!0,scrollMonth:!0,scrollTime:!0,scrollInput:!0,mask:!1,validateOnBlur:!0,allowBlank:!1,yearStart:1950,yearEnd:2050,style:"",id:"",roundTime:"round",className:"",weekends:[],yearOffset:0};
Array.prototype.indexOf||(Array.prototype.indexOf=function(t,e){for(var n=e||0,i=this.length;i>n;n++)if(this[n]===t)return n;return-1}),t.fn.xdsoftScroller=function(e){return this.each(function(){var n=t(this);if(!t(this).hasClass("xdsoft_scroller_box")){var i=function(t){var e={x:0,y:0};if("touchstart"==t.type||"touchmove"==t.type||"touchend"==t.type||"touchcancel"==t.type){var n=t.originalEvent.touches[0]||t.originalEvent.changedTouches[0];e.x=n.pageX,e.y=n.pageY}else("mousedown"==t.type||"mouseup"==t.type||"mousemove"==t.type||"mouseover"==t.type||"mouseout"==t.type||"mouseenter"==t.type||"mouseleave"==t.type)&&(e.x=t.pageX,e.y=t.pageY);return e},o=0,a=n.children().eq(0),r=n[0].clientHeight,s=a[0].offsetHeight,l=t('<div class="xdsoft_scrollbar"></div>'),c=t('<div class="xdsoft_scroller"></div>'),d=100,h=!1;l.append(c),n.addClass("xdsoft_scroller_box").append(l),c.on("mousedown.xdsoft_scroller",function(i){r||n.trigger("resize_scroll.xdsoft_scroller",[e]);var a=i.pageY,s=parseInt(c.css("margin-top")),h=l[0].offsetHeight;t(document.body).addClass("xdsoft_noselect"),t([document.body,window]).on("mouseup.xdsoft_scroller",function u(){t([document.body,window]).off("mouseup.xdsoft_scroller",u).off("mousemove.xdsoft_scroller",o).removeClass("xdsoft_noselect")}),t(document.body).on("mousemove.xdsoft_scroller",o=function(t){var e=t.pageY-a+s;0>e&&(e=0),e+c[0].offsetHeight>h&&(e=h-c[0].offsetHeight),n.trigger("scroll_element.xdsoft_scroller",[d?e/d:0])})}),n.on("scroll_element.xdsoft_scroller",function(t,e){r||n.trigger("resize_scroll.xdsoft_scroller",[e,!0]),e=e>1?1:0>e||isNaN(e)?0:e,c.css("margin-top",d*e),a.css("marginTop",-parseInt((s-r)*e))}).on("resize_scroll.xdsoft_scroller",function(t,e,i){r=n[0].clientHeight,s=a[0].offsetHeight;var o=r/s,h=o*l[0].offsetHeight;o>1?c.hide():(c.show(),c.css("height",parseInt(h>10?h:10)),d=l[0].offsetHeight-c[0].offsetHeight,i!==!0&&n.trigger("scroll_element.xdsoft_scroller",[e?e:Math.abs(parseInt(a.css("marginTop")))/(s-r)]))}),n.mousewheel&&n.mousewheel(function(t,e){var i=Math.abs(parseInt(a.css("marginTop")));return n.trigger("scroll_element.xdsoft_scroller",[(i-20*e)/(s-r)]),t.stopPropagation(),!1}),n.on("touchstart",function(t){h=i(t)}),n.on("touchmove",function(t){if(h){var e=i(t),o=Math.abs(parseInt(a.css("marginTop")));n.trigger("scroll_element.xdsoft_scroller",[(o-(e.y-h.y))/(s-r)]),t.stopPropagation(),t.preventDefault()}}),n.on("touchend touchcancel",function(){h=!1})}n.trigger("resize_scroll.xdsoft_scroller",[e])})},t.fn.datetimepicker=function(n){var i=48,o=57,a=96,r=105,s=17,l=46,c=13,d=27,h=8,u=37,p=38,f=39,g=40,m=9,v=116,b=65,y=67,w=86,C=90,x=89,_=!1,T=t.isPlainObject(n)||!n?t.extend(!0,{},e,n):t.extend({},e),S=function(e){var n=t("<div "+(T.id?'id="'+T.id+'"':"")+" "+(T.style?'style="'+T.style+'"':"")+' class="xdsoft_datetimepicker xdsoft_noselect '+T.className+'"></div>'),S=t('<div class="xdsoft_copyright"><a target="_blank" href="http://xdsoft.net/jqplugins/datetimepicker/">xdsoft.net</a></div>'),k=t('<div class="xdsoft_datepicker active"></div>'),E=t('<div class="xdsoft_mounthpicker"><button type="button" class="xdsoft_prev"></button><button type="button" class="xdsoft_today_button"></button><div class="xdsoft_label xdsoft_month"><span></span></div><div class="xdsoft_label xdsoft_year"><span></span></div><button type="button" class="xdsoft_next"></button></div>'),R=t('<div class="xdsoft_calendar"></div>'),N=t('<div class="xdsoft_timepicker active"><button type="button" class="xdsoft_prev"></button><div class="xdsoft_time_box"></div><button type="button" class="xdsoft_next"></button></div>'),D=N.find(".xdsoft_time_box").eq(0),A=t('<div class="xdsoft_time_variant"></div>'),O=t('<div class="xdsoft_scrollbar"></div>'),I=(t('<div class="xdsoft_scroller"></div>'),t('<div class="xdsoft_select xdsoft_monthselect"><div></div></div>')),P=t('<div class="xdsoft_select xdsoft_yearselect"><div></div></div>');E.find(".xdsoft_month span").after(I),E.find(".xdsoft_year span").after(P),E.find(".xdsoft_month,.xdsoft_year").on("mousedown.xdsoft",function(e){E.find(".xdsoft_select").hide();var n=t(this).find(".xdsoft_select").eq(0),i=0,o=0;L.currentTime&&(i=L.currentTime[t(this).hasClass("xdsoft_month")?"getMonth":"getFullYear"]()),n.show();for(var a=n.find("div.xdsoft_option"),r=0;r<a.length&&a.eq(r).data("value")!=i;r++)o+=a[0].offsetHeight;return n.xdsoftScroller(o/(n.children()[0].offsetHeight-n[0].clientHeight)),e.stopPropagation(),!1}),E.find(".xdsoft_select").xdsoftScroller().on("mousedown.xdsoft",function(t){t.stopPropagation(),t.preventDefault()}).on("mousedown.xdsoft",".xdsoft_option",function(){L&&L.currentTime&&L.currentTime[t(this).parent().parent().hasClass("xdsoft_monthselect")?"setMonth":"setFullYear"](t(this).data("value")),t(this).parent().parent().hide(),n.trigger("xchange.xdsoft"),T.onChangeMonth&&T.onChangeMonth.call&&T.onChangeMonth.call(n,L.currentTime,n.data("input"))}),n.setOptions=function(S){T=t.extend(!0,{},T,S),!T.open&&!T.opened||T.inline||e.trigger("open.xdsoft"),T.inline&&(n.addClass("xdsoft_inline"),e.after(n).hide(),n.trigger("afterOpen.xdsoft")),T.inverseButton&&(T.next="xdsoft_prev",T.prev="xdsoft_next"),T.datepicker?k.addClass("active"):k.removeClass("active"),T.timepicker?N.addClass("active"):N.removeClass("active"),T.value&&(e&&e.val&&e.val(T.value),L.setCurrentTime(T.value)),T.dayOfWeekStart=isNaN(T.dayOfWeekStart)||parseInt(T.dayOfWeekStart)<0||parseInt(T.dayOfWeekStart)>6?0:parseInt(T.dayOfWeekStart),T.timepickerScrollbar||O.hide();var R,D=[];if(T.minDate&&(D=/^-(.*)$/.exec(T.minDate))&&(D=Date.parseDate(D[1],T.formatDate))&&(R=D.getTime()+-1*D.getTimezoneOffset()*6e4,T.minDate=new Date(L.now().getTime()-R).dateFormat(T.formatDate)),T.maxDate&&(D=/^\+(.*)$/.exec(T.maxDate))&&(D=Date.parseDate(D[1],T.formatDate))&&(R=D.getTime()+-1*D.getTimezoneOffset()*6e4,T.maxDate=new Date(L.now().getTime()+R).dateFormat(T.formatDate)),E.find(".xdsoft_today_button").css("visibility",T.todayButton?"visible":"hidden"),T.mask){var A=function(t){try{if(document.selection&&document.selection.createRange){var e=document.selection.createRange();return e.getBookmark().charCodeAt(2)-2}if(t.setSelectionRange)return t.selectionStart}catch(n){return 0}},I=function(t,e){var t="string"==typeof t||t instanceof String?document.getElementById(t):t;if(!t)return!1;if(t.createTextRange){var n=t.createTextRange();return n.collapse(!0),n.moveEnd(e),n.moveStart(e),n.select(),!0}return t.setSelectionRange?(t.setSelectionRange(e,e),!0):!1},P=function(t,e){var n=t.replace(/([\[\]\/\{\}\(\)\-\.\+]{1})/g,"\\$1").replace(/_/g,"{digit+}").replace(/([0-9]{1})/g,"{digit$1}").replace(/\{digit([0-9]{1})\}/g,"[0-$1_]{1}").replace(/\{digit[\+]\}/g,"[0-9_]{1}");return RegExp(n).test(e)};switch(e.off("keydown.xdsoft"),!0){case T.mask===!0:T.mask=T.format.replace(/Y/g,"9999").replace(/F/g,"9999").replace(/m/g,"19").replace(/d/g,"39").replace(/H/g,"29").replace(/i/g,"59").replace(/s/g,"59");case"string"==t.type(T.mask):P(T.mask,e.val())||e.val(T.mask.replace(/[0-9]/g,"_")),e.on("keydown.xdsoft",function(n){var S=this.value,k=n.which;switch(!0){case k>=i&&o>=k||k>=a&&r>=k||k==h||k==l:var E=A(this),R=k!=h&&k!=l?String.fromCharCode(k>=a&&r>=k?k-i:k):"_";for(k!=h&&k!=l||!E||(E--,R="_");/[^0-9_]/.test(T.mask.substr(E,1))&&E<T.mask.length&&E>0;)E+=k==h||k==l?-1:1;if(S=S.substr(0,E)+R+S.substr(E+1),""==t.trim(S))S=T.mask.replace(/[0-9]/g,"_");else if(E==T.mask.length)break;for(E+=k==h||k==l?0:1;/[^0-9_]/.test(T.mask.substr(E,1))&&E<T.mask.length&&E>0;)E+=k==h||k==l?-1:1;P(T.mask,S)?(this.value=S,I(this,E)):""==t.trim(S)?this.value=T.mask.replace(/[0-9]/g,"_"):e.trigger("error_input.xdsoft");break;case!!~[b,y,w,C,x].indexOf(k)&&_:case!!~[d,p,g,u,f,v,s,m,c].indexOf(k):return!0}return n.preventDefault(),!1})}}T.validateOnBlur&&e.off("blur.xdsoft").on("blur.xdsoft",function(){T.allowBlank&&!t.trim(t(this).val()).length?(t(this).val(null),n.data("xdsoft_datetime").empty()):Date.parseDate(t(this).val(),T.format)?n.data("xdsoft_datetime").setCurrentTime(t(this).val()):(t(this).val(L.now().dateFormat(T.format)),n.data("xdsoft_datetime").setCurrentTime(t(this).val())),n.trigger("changedatetime.xdsoft")}),T.dayOfWeekStartPrev=0==T.dayOfWeekStart?6:T.dayOfWeekStart-1,n.trigger("xchange.xdsoft")},n.data("options",T).on("mousedown.xdsoft",function(t){return t.stopPropagation(),t.preventDefault(),P.hide(),I.hide(),!1});var M=N.find(".xdsoft_time_box");M.append(A),M.xdsoftScroller(),n.on("afterOpen.xdsoft",function(){M.xdsoftScroller()}),n.append(k).append(N),T.withoutCopyright!==!0&&n.append(S),k.append(E).append(R),t("body").append(n);var L=new function(){var t=this;t.now=function(){var t=new Date;return T.yearOffset&&t.setFullYear(t.getFullYear()+T.yearOffset),t},t.currentTime=this.now(),t.isValidDate=function(t){return"[object Date]"!==Object.prototype.toString.call(t)?!1:!isNaN(t.getTime())},t.setCurrentTime=function(e){t.currentTime="string"==typeof e?t.strtodatetime(e):t.isValidDate(e)?e:t.now(),n.trigger("xchange.xdsoft")},t.empty=function(){t.currentTime=null},t.getCurrentTime=function(){return t.currentTime},t.nextMonth=function(){var e=t.currentTime.getMonth()+1;return 12==e&&(t.currentTime.setFullYear(t.currentTime.getFullYear()+1),e=0),t.currentTime.setDate(Math.min(Date.daysInMonth[e],t.currentTime.getDate())),t.currentTime.setMonth(e),T.onChangeMonth&&T.onChangeMonth.call&&T.onChangeMonth.call(n,L.currentTime,n.data("input")),n.trigger("xchange.xdsoft"),e},t.prevMonth=function(){var e=t.currentTime.getMonth()-1;return-1==e&&(t.currentTime.setFullYear(t.currentTime.getFullYear()-1),e=11),t.currentTime.setDate(Math.min(Date.daysInMonth[e],t.currentTime.getDate())),t.currentTime.setMonth(e),T.onChangeMonth&&T.onChangeMonth.call&&T.onChangeMonth.call(n,L.currentTime,n.data("input")),n.trigger("xchange.xdsoft"),e},t.strtodatetime=function(e){var n=e?Date.parseDate(e,T.format):t.now();return t.isValidDate(n)||(n=t.now()),n},t.strtodate=function(e){var n=e?Date.parseDate(e,T.formatDate):t.now();return t.isValidDate(n)||(n=t.now()),n},t.strtotime=function(e){var n=e?Date.parseDate(e,T.formatTime):t.now();return t.isValidDate(n)||(n=t.now()),n},t.str=function(){return t.currentTime.dateFormat(T.format)}};E.find(".xdsoft_today_button").on("mousedown.xdsoft",function(){n.data("changed",!0),L.setCurrentTime(0),n.trigger("afterOpen.xdsoft")}).on("dblclick.xdsoft",function(){e.val(L.str()),n.trigger("close.xdsoft")}),E.find(".xdsoft_prev,.xdsoft_next").on("mousedown.xdsoft",function(){var e=t(this),n=0,i=!1;!function o(t){L.currentTime.getMonth();e.hasClass(T.next)?L.nextMonth():e.hasClass(T.prev)&&L.prevMonth(),!i&&(n=setTimeout(o,t?t:100))}(500),t([document.body,window]).on("mouseup.xdsoft",function a(){clearTimeout(n),i=!0,t([document.body,window]).off("mouseup.xdsoft",a)})}),N.find(".xdsoft_prev,.xdsoft_next").on("mousedown.xdsoft",function(){var e=t(this),n=0,i=!1,o=110;!function a(t){var r=D[0].clientHeight,s=A[0].offsetHeight,l=Math.abs(parseInt(A.css("marginTop")));e.hasClass(T.next)&&s-r-T.timeHeightInTimePicker>=l?A.css("marginTop","-"+(l+T.timeHeightInTimePicker)+"px"):e.hasClass(T.prev)&&l-T.timeHeightInTimePicker>=0&&A.css("marginTop","-"+(l-T.timeHeightInTimePicker)+"px"),D.trigger("scroll_element.xdsoft_scroller",[Math.abs(parseInt(A.css("marginTop"))/(s-r))]),o=o>10?10:o-10,!i&&(n=setTimeout(a,t?t:o))}(500),t([document.body,window]).on("mouseup.xdsoft",function r(){clearTimeout(n),i=!0,t([document.body,window]).off("mouseup.xdsoft",r)})}),n.on("xchange.xdsoft",function(e){for(var i="",o=new Date(L.currentTime.getFullYear(),L.currentTime.getMonth(),1,12,0,0),a=0,r=L.now();o.getDay()!=T.dayOfWeekStart;)o.setDate(o.getDate()-1);i+="<table><thead><tr>";for(var s=0;7>s;s++)i+="<th>"+T.i18n[T.lang].dayOfWeek[s+T.dayOfWeekStart>6?0:s+T.dayOfWeekStart]+"</th>";i+="</tr></thead>",i+="<tbody><tr>";var l=!1,c=!1;T.maxDate!==!1&&(l=L.strtodate(T.maxDate),l=new Date(l.getFullYear(),l.getMonth(),l.getDate(),23,59,59,999)),T.minDate!==!1&&(c=L.strtodate(T.minDate),c=new Date(c.getFullYear(),c.getMonth(),c.getDate()));for(var d,h,u,p=[];a<L.currentTime.getDaysInMonth()||o.getDay()!=T.dayOfWeekStart||L.currentTime.getMonth()==o.getMonth();)p=[],a++,d=o.getDate(),h=o.getFullYear(),u=o.getMonth(),p.push("xdsoft_date"),(l!==!1&&o>l||c!==!1&&c>o)&&p.push("xdsoft_disabled"),L.currentTime.getMonth()!=u&&p.push("xdsoft_other_month"),(T.defaultSelect||n.data("changed"))&&L.currentTime.dateFormat("d.m.Y")==o.dateFormat("d.m.Y")&&p.push("xdsoft_current"),r.dateFormat("d.m.Y")==o.dateFormat("d.m.Y")&&p.push("xdsoft_today"),(0==o.getDay()||6==o.getDay()||~T.weekends.indexOf(o.dateFormat("d.m.Y")))&&p.push("xdsoft_weekend"),i+='<td data-date="'+d+'" data-month="'+u+'" data-year="'+h+'" class="xdsoft_date xdsoft_day_of_week'+o.getDay()+" "+p.join(" ")+'"><div>'+d+"</div></td>",o.getDay()==T.dayOfWeekStartPrev&&(i+="</tr>"),o.setDate(d+1);i+="</tbody></table>",R.html(i),E.find(".xdsoft_label span").eq(0).text(T.i18n[T.lang].months[L.currentTime.getMonth()]),E.find(".xdsoft_label span").eq(1).text(L.currentTime.getFullYear());var f="",g="",u="",m=function(t,e){var i=L.now();i.setHours(t),t=parseInt(i.getHours()),i.setMinutes(e),e=parseInt(i.getMinutes()),p=[],(T.maxTime!==!1&&L.strtotime(T.maxTime).getTime()<i.getTime()||T.minTime!==!1&&L.strtotime(T.minTime).getTime()>i.getTime())&&p.push("xdsoft_disabled"),(T.initTime||T.defaultSelect||n.data("changed"))&&parseInt(L.currentTime.getHours())==parseInt(t)&&(T.step>59||Math[T.roundTime](L.currentTime.getMinutes()/T.step)*T.step==parseInt(e))&&(T.defaultSelect||n.data("changed")?p.push("xdsoft_current"):T.initTime&&p.push("xdsoft_init_time")),parseInt(r.getHours())==parseInt(t)&&parseInt(r.getMinutes())==parseInt(e)&&p.push("xdsoft_today"),f+='<div class="xdsoft_time '+p.join(" ")+'" data-hour="'+t+'" data-minute="'+e+'">'+i.dateFormat(T.formatTime)+"</div>"};if(T.allowTimes&&t.isArray(T.allowTimes)&&T.allowTimes.length)for(var a=0;a<T.allowTimes.length;a++)g=L.strtotime(T.allowTimes[a]).getHours(),u=L.strtotime(T.allowTimes[a]).getMinutes(),m(g,u);else for(var a=0,s=0;a<(T.hours12?12:24);a++)for(s=0;60>s;s+=T.step)g=(10>a?"0":"")+a,u=(10>s?"0":"")+s,m(g,u);A.html(f);var v="",a=0;for(a=parseInt(T.yearStart,10)+T.yearOffset;a<=parseInt(T.yearEnd,10)+T.yearOffset;a++)v+='<div class="xdsoft_option '+(L.currentTime.getFullYear()==a?"xdsoft_current":"")+'" data-value="'+a+'">'+a+"</div>";for(P.children().eq(0).html(v),a=0,v="";11>=a;a++)v+='<div class="xdsoft_option '+(L.currentTime.getMonth()==a?"xdsoft_current":"")+'" data-value="'+a+'">'+T.i18n[T.lang].months[a]+"</div>";I.children().eq(0).html(v),t(this).trigger("generate.xdsoft"),e.stopPropagation()}).on("afterOpen.xdsoft",function(){if(T.timepicker){var t;if(A.find(".xdsoft_current").length?t=".xdsoft_current":A.find(".xdsoft_init_time").length&&(t=".xdsoft_init_time"),t){var e=D[0].clientHeight,n=A[0].offsetHeight,i=A.find(t).index()*T.timeHeightInTimePicker+1;i>n-e&&(i=n-e),A.css("marginTop","-"+parseInt(i)+"px"),D.trigger("scroll_element.xdsoft_scroller",[parseInt(i)/(n-e)])}}});var $=0;R.on("click.xdsoft","td",function(){$++;var i=t(this),o=L.currentTime;return i.hasClass("xdsoft_disabled")?!1:(o.setFullYear(i.data("year")),o.setMonth(i.data("month")),o.setDate(i.data("date")),n.trigger("select.xdsoft",[o]),e.val(L.str()),($>1||T.closeOnDateSelect===!0||0===T.closeOnDateSelect&&!T.timepicker)&&!T.inline&&n.trigger("close.xdsoft"),T.onSelectDate&&T.onSelectDate.call&&T.onSelectDate.call(n,L.currentTime,n.data("input")),n.data("changed",!0),n.trigger("xchange.xdsoft"),n.trigger("changedatetime.xdsoft"),void setTimeout(function(){$=0},200))}),A.on("click.xdsoft","div",function(){var e=t(this),i=L.currentTime;return e.hasClass("xdsoft_disabled")?!1:(i.setHours(e.data("hour")),i.setMinutes(e.data("minute")),n.trigger("select.xdsoft",[i]),n.data("input").val(L.str()),!T.inline&&n.trigger("close.xdsoft"),T.onSelectTime&&T.onSelectTime.call&&T.onSelectTime.call(n,L.currentTime,n.data("input")),n.data("changed",!0),n.trigger("xchange.xdsoft"),void n.trigger("changedatetime.xdsoft"))}),n.mousewheel&&k.mousewheel(function(t,e){return T.scrollMonth?(0>e?L.nextMonth():L.prevMonth(),!1):!0}),n.mousewheel&&D.unmousewheel().mousewheel(function(t,e){if(!T.scrollTime)return!0;var n=D[0].clientHeight,i=A[0].offsetHeight,o=Math.abs(parseInt(A.css("marginTop"))),a=!0;return 0>e&&i-n-T.timeHeightInTimePicker>=o?(A.css("marginTop","-"+(o+T.timeHeightInTimePicker)+"px"),a=!1):e>0&&o-T.timeHeightInTimePicker>=0&&(A.css("marginTop","-"+(o-T.timeHeightInTimePicker)+"px"),a=!1),D.trigger("scroll_element.xdsoft_scroller",[Math.abs(parseInt(A.css("marginTop"))/(i-n))]),t.stopPropagation(),a}),n.on("changedatetime.xdsoft",function(){if(T.onChangeDateTime&&T.onChangeDateTime.call){var t=n.data("input");T.onChangeDateTime.call(n,L.currentTime,t),t.trigger("change")}}).on("generate.xdsoft",function(){T.onGenerate&&T.onGenerate.call&&T.onGenerate.call(n,L.currentTime,n.data("input"))});var B=0;e.mousewheel&&e.mousewheel(function(t,i,o,a){return T.scrollInput?!T.datepicker&&T.timepicker?(B=A.find(".xdsoft_current").length?A.find(".xdsoft_current").eq(0).index():0,B+i>=0&&B+i<A.children().length&&(B+=i),A.children().eq(B).length&&A.children().eq(B).trigger("mousedown"),!1):T.datepicker&&!T.timepicker?(k.trigger(t,[i,o,a]),e.val&&e.val(L.str()),n.trigger("changedatetime.xdsoft"),!1):void 0:!0});var F=function(){var e=n.data("input").offset(),i=e.top+n.data("input")[0].offsetHeight-1,o=e.left;i+n[0].offsetHeight>t(window).height()+t(window).scrollTop()&&(i=e.top-n[0].offsetHeight+1),0>i&&(i=0),o+n[0].offsetWidth>t(window).width()&&(o=e.left-n[0].offsetWidth+n.data("input")[0].offsetWidth),n.css({left:o,top:i})};n.on("open.xdsoft",function(){var e=!0;T.onShow&&T.onShow.call&&(e=T.onShow.call(n,L.currentTime,n.data("input"))),e!==!1&&(n.show(),n.trigger("afterOpen.xdsoft"),F(),t(window).off("resize.xdsoft",F).on("resize.xdsoft",F),T.closeOnWithoutClick&&t([document.body,window]).on("mousedown.xdsoft",function i(){n.trigger("close.xdsoft"),t([document.body,window]).off("mousedown.xdsoft",i)}))}).on("close.xdsoft",function(t){var e=!0;T.onClose&&T.onClose.call&&(e=T.onClose.call(n,L.currentTime,n.data("input"))),e===!1||T.opened||T.inline||n.hide(),t.stopPropagation()}).data("input",e);var H=0;n.data("xdsoft_datetime",L),n.setOptions(T);var j=T.value?T.value:e&&e.val&&e.val()?e.val():"";j&&L.isValidDate(j=Date.parseDate(j,T.format))?n.data("changed",!0):j="",L.setCurrentTime(j?j:0),n.trigger("afterOpen.xdsoft"),e.data("xdsoft_datetimepicker",n).on("open.xdsoft focusin.xdsoft mousedown.xdsoft",function(){e.is(":disabled")||e.is(":hidden")||!e.is(":visible")||(clearTimeout(H),H=setTimeout(function(){e.is(":disabled")||e.is(":hidden")||!e.is(":visible")||(L.setCurrentTime(e&&e.val&&e.val()?e.val():0),n.trigger("open.xdsoft"))},100))}).on("keydown.xdsoft",function(e){var i=(this.value,e.which);switch(!0){case!!~[c].indexOf(i):var o=t("input:visible,textarea:visible");return n.trigger("close.xdsoft"),o.eq(o.index(this)+1).focus(),!1;case!!~[m].indexOf(i):return n.trigger("close.xdsoft"),!0}})},k=function(e){var n=e.data("xdsoft_datetimepicker");n&&(n.data("xdsoft_datetime",null),n.remove(),e.data("xdsoft_datetimepicker",null).off("open.xdsoft focusin.xdsoft focusout.xdsoft mousedown.xdsoft blur.xdsoft keydown.xdsoft"),t(window).off("resize.xdsoft"),t([window,document.body]).off("mousedown.xdsoft"),e.unmousewheel&&e.unmousewheel())};return t(document).off("keydown.xdsoftctrl keyup.xdsoftctrl").on("keydown.xdsoftctrl",function(t){t.keyCode==s&&(_=!0)}).on("keyup.xdsoftctrl",function(t){t.keyCode==s&&(_=!1)}),this.each(function(){var e;if(e=t(this).data("xdsoft_datetimepicker")){if("string"===t.type(n))switch(n){case"show":t(this).select().focus(),e.trigger("open.xdsoft");break;case"hide":e.trigger("close.xdsoft");break;case"destroy":k(t(this));break;case"reset":this.value=this.defaultValue,this.value&&e.data("xdsoft_datetime").isValidDate(Date.parseDate(this.value,T.format))||e.data("changed",!1),e.data("xdsoft_datetime").setCurrentTime(this.value)}else e.setOptions(n);return 0}"string"!==t.type(n)&&S(t(this))})}}(jQuery),Date.parseFunctions={count:0},Date.parseRegexes=[],Date.formatFunctions={count:0},Date.prototype.dateFormat=function(t){null==Date.formatFunctions[t]&&Date.createNewFormat(t);var e=Date.formatFunctions[t];return this[e]()},Date.createNewFormat=function(format){var funcName="format"+Date.formatFunctions.count++;Date.formatFunctions[format]=funcName;for(var code="Date.prototype."+funcName+" = function() {return ",special=!1,ch="",i=0;i<format.length;++i)ch=format.charAt(i),special||"\\"!=ch?special?(special=!1,code+="'"+String.escape(ch)+"' + "):code+=Date.getFormatCode(ch):special=!0;eval(code.substring(0,code.length-3)+";}")},Date.getFormatCode=function(t){switch(t){case"d":return"String.leftPad(this.getDate(), 2, '0') + ";case"D":return"Date.dayNames[this.getDay()].substring(0, 3) + ";case"j":return"this.getDate() + ";case"l":return"Date.dayNames[this.getDay()] + ";case"S":return"this.getSuffix() + ";case"w":return"this.getDay() + ";case"z":return"this.getDayOfYear() + ";case"W":return"this.getWeekOfYear() + ";case"F":return"Date.monthNames[this.getMonth()] + ";case"m":return"String.leftPad(this.getMonth() + 1, 2, '0') + ";case"M":return"Date.monthNames[this.getMonth()].substring(0, 3) + ";case"n":return"(this.getMonth() + 1) + ";case"t":return"this.getDaysInMonth() + ";case"L":return"(this.isLeapYear() ? 1 : 0) + ";case"Y":return"this.getFullYear() + ";case"y":return"('' + this.getFullYear()).substring(2, 4) + ";case"a":return"(this.getHours() < 12 ? 'am' : 'pm') + ";case"A":return"(this.getHours() < 12 ? 'AM' : 'PM') + ";case"g":return"((this.getHours() %12) ? this.getHours() % 12 : 12) + ";case"G":return"this.getHours() + ";case"h":return"String.leftPad((this.getHours() %12) ? this.getHours() % 12 : 12, 2, '0') + ";case"H":return"String.leftPad(this.getHours(), 2, '0') + ";case"i":return"String.leftPad(this.getMinutes(), 2, '0') + ";case"s":return"String.leftPad(this.getSeconds(), 2, '0') + ";case"O":return"this.getGMTOffset() + ";case"T":return"this.getTimezone() + ";case"Z":return"(this.getTimezoneOffset() * -60) + ";default:return"'"+String.escape(t)+"' + "}},Date.parseDate=function(t,e){null==Date.parseFunctions[e]&&Date.createParser(e);var n=Date.parseFunctions[e];return Date[n](t)},Date.createParser=function(format){var funcName="parse"+Date.parseFunctions.count++,regexNum=Date.parseRegexes.length,currentGroup=1;Date.parseFunctions[format]=funcName;for(var code="Date."+funcName+" = function(input) {\nvar y = -1, m = -1, d = -1, h = -1, i = -1, s = -1;\nvar d = new Date();\ny = d.getFullYear();\nm = d.getMonth();\nd = d.getDate();\nvar results = input.match(Date.parseRegexes["+regexNum+"]);\nif (results && results.length > 0) {",regex="",special=!1,ch="",i=0;i<format.length;++i)ch=format.charAt(i),special||"\\"!=ch?special?(special=!1,regex+=String.escape(ch)):(obj=Date.formatCodeToRegex(ch,currentGroup),currentGroup+=obj.g,regex+=obj.s,obj.g&&obj.c&&(code+=obj.c)):special=!0;code+="if (y > 0 && m >= 0 && d > 0 && h >= 0 && i >= 0 && s >= 0)\n{return new Date(y, m, d, h, i, s);}\nelse if (y > 0 && m >= 0 && d > 0 && h >= 0 && i >= 0)\n{return new Date(y, m, d, h, i);}\nelse if (y > 0 && m >= 0 && d > 0 && h >= 0)\n{return new Date(y, m, d, h);}\nelse if (y > 0 && m >= 0 && d > 0)\n{return new Date(y, m, d);}\nelse if (y > 0 && m >= 0)\n{return new Date(y, m);}\nelse if (y > 0)\n{return new Date(y);}\n}return null;}",Date.parseRegexes[regexNum]=new RegExp("^"+regex+"$"),eval(code)},Date.formatCodeToRegex=function(t,e){switch(t){case"D":return{g:0,c:null,s:"(?:Sun|Mon|Tue|Wed|Thu|Fri|Sat)"};case"j":case"d":return{g:1,c:"d = parseInt(results["+e+"], 10);\n",s:"(\\d{1,2})"};case"l":return{g:0,c:null,s:"(?:"+Date.dayNames.join("|")+")"};case"S":return{g:0,c:null,s:"(?:st|nd|rd|th)"};case"w":return{g:0,c:null,s:"\\d"};case"z":return{g:0,c:null,s:"(?:\\d{1,3})"};case"W":return{g:0,c:null,s:"(?:\\d{2})"};case"F":return{g:1,c:"m = parseInt(Date.monthNumbers[results["+e+"].substring(0, 3)], 10);\n",s:"("+Date.monthNames.join("|")+")"};case"M":return{g:1,c:"m = parseInt(Date.monthNumbers[results["+e+"]], 10);\n",s:"(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)"};case"n":case"m":return{g:1,c:"m = parseInt(results["+e+"], 10) - 1;\n",s:"(\\d{1,2})"};case"t":return{g:0,c:null,s:"\\d{1,2}"};case"L":return{g:0,c:null,s:"(?:1|0)"};case"Y":return{g:1,c:"y = parseInt(results["+e+"], 10);\n",s:"(\\d{4})"};case"y":return{g:1,c:"var ty = parseInt(results["+e+"], 10);\ny = ty > Date.y2kYear ? 1900 + ty : 2000 + ty;\n",s:"(\\d{1,2})"};case"a":return{g:1,c:"if (results["+e+"] == 'am') {\nif (h == 12) { h = 0; }\n} else { if (h < 12) { h += 12; }}",s:"(am|pm)"};case"A":return{g:1,c:"if (results["+e+"] == 'AM') {\nif (h == 12) { h = 0; }\n} else { if (h < 12) { h += 12; }}",s:"(AM|PM)"};case"g":case"G":case"h":case"H":return{g:1,c:"h = parseInt(results["+e+"], 10);\n",s:"(\\d{1,2})"};case"i":return{g:1,c:"i = parseInt(results["+e+"], 10);\n",s:"(\\d{2})"};case"s":return{g:1,c:"s = parseInt(results["+e+"], 10);\n",s:"(\\d{2})"};case"O":return{g:0,c:null,s:"[+-]\\d{4}"};case"T":return{g:0,c:null,s:"[A-Z]{3}"};case"Z":return{g:0,c:null,s:"[+-]\\d{1,5}"};default:return{g:0,c:null,s:String.escape(t)}}},Date.prototype.getTimezone=function(){return this.toString().replace(/^.*? ([A-Z]{3}) [0-9]{4}.*$/,"$1").replace(/^.*?\(([A-Z])[a-z]+ ([A-Z])[a-z]+ ([A-Z])[a-z]+\)$/,"$1$2$3")},Date.prototype.getGMTOffset=function(){return(this.getTimezoneOffset()>0?"-":"+")+String.leftPad(Math.floor(Math.abs(this.getTimezoneOffset())/60),2,"0")+String.leftPad(Math.abs(this.getTimezoneOffset())%60,2,"0")},Date.prototype.getDayOfYear=function(){var t=0;Date.daysInMonth[1]=this.isLeapYear()?29:28;for(var e=0;e<this.getMonth();++e)t+=Date.daysInMonth[e];return t+this.getDate()-1},Date.prototype.getWeekOfYear=function(){var t=this.getDayOfYear()+(4-this.getDay()),e=new Date(this.getFullYear(),0,1),n=7-e.getDay()+4;return document.write(n),String.leftPad((t-n)/7+1,2,"0")},Date.prototype.isLeapYear=function(){var t=this.getFullYear();return 0==(3&t)&&(t%100||t%400==0&&t)},Date.prototype.getFirstDayOfMonth=function(){var t=(this.getDay()-(this.getDate()-1))%7;return 0>t?t+7:t},Date.prototype.getLastDayOfMonth=function(){var t=(this.getDay()+(Date.daysInMonth[this.getMonth()]-this.getDate()))%7;return 0>t?t+7:t},Date.prototype.getDaysInMonth=function(){return Date.daysInMonth[1]=this.isLeapYear()?29:28,Date.daysInMonth[this.getMonth()]},Date.prototype.getSuffix=function(){switch(this.getDate()){case 1:case 21:case 31:return"st";case 2:case 22:return"nd";case 3:case 23:return"rd";default:return"th"}},String.escape=function(t){return t.replace(/('|\\)/g,"\\$1")},String.leftPad=function(t,e,n){var i=new String(t);for(null==n&&(n=" ");i.length<e;)i=n+i;return i},Date.daysInMonth=[31,28,31,30,31,30,31,31,30,31,30,31],Date.monthNames=["January","February","March","April","May","June","July","August","September","October","November","December"],Date.dayNames=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],Date.y2kYear=50,Date.monthNumbers={Jan:0,Feb:1,Mar:2,Apr:3,May:4,Jun:5,Jul:6,Aug:7,Sep:8,Oct:9,Nov:10,Dec:11},Date.patterns={ISO8601LongPattern:"Y-m-d H:i:s",ISO8601ShortPattern:"Y-m-d",ShortDatePattern:"n/j/Y",LongDatePattern:"l, F d, Y",FullDateTimePattern:"l, F d, Y g:i:s A",MonthDayPattern:"F d",ShortTimePattern:"g:i A",LongTimePattern:"g:i:s A",SortableDateTimePattern:"Y-m-d\\TH:i:s",UniversalSortableDateTimePattern:"Y-m-d H:i:sO",YearMonthPattern:"F, Y"},function(t){"function"==typeof define&&define.amd?define(["jquery"],t):"object"==typeof exports?module.exports=t:t(jQuery)}(function(t){function e(e){var o,a=e||window.event,r=[].slice.call(arguments,1),s=0,l=0,c=0,d=0,h=0;return e=t.event.fix(a),e.type="mousewheel",a.wheelDelta&&(s=a.wheelDelta),a.detail&&(s=-1*a.detail),a.deltaY&&(c=-1*a.deltaY,s=c),a.deltaX&&(l=a.deltaX,s=-1*l),void 0!==a.wheelDeltaY&&(c=a.wheelDeltaY),void 0!==a.wheelDeltaX&&(l=-1*a.wheelDeltaX),d=Math.abs(s),(!n||n>d)&&(n=d),h=Math.max(Math.abs(c),Math.abs(l)),(!i||i>h)&&(i=h),o=s>0?"floor":"ceil",s=Math[o](s/n),l=Math[o](l/i),c=Math[o](c/i),r.unshift(e,s,l,c),(t.event.dispatch||t.event.handle).apply(this,r)}var n,i,o=["wheel","mousewheel","DOMMouseScroll","MozMousePixelScroll"],a="onwheel"in document||document.documentMode>=9?["wheel"]:["mousewheel","DomMouseScroll","MozMousePixelScroll"];if(t.event.fixHooks)for(var r=o.length;r;)t.event.fixHooks[o[--r]]=t.event.mouseHooks;t.event.special.mousewheel={setup:function(){if(this.addEventListener)for(var t=a.length;t;)this.addEventListener(a[--t],e,!1);else this.onmousewheel=e},teardown:function(){if(this.removeEventListener)for(var t=a.length;t;)this.removeEventListener(a[--t],e,!1);else this.onmousewheel=null}},t.fn.extend({mousewheel:function(t){return t?this.bind("mousewheel",t):this.trigger("mousewheel")},unmousewheel:function(t){return this.unbind("mousewheel",t)}})});var rwindow,rdocument;if("undefined"==typeof RELANG)var RELANG={};var RLANG={html:"HTML",video:"Insert Video",image:"Insert Image",table:"Table",link:"Link",link_insert:"Insert link",unlink:"Unlink",formatting:"Formatting",paragraph:"Paragraph",quote:"Quote",code:"Code",header1:"Header 1",header2:"Header 2",header3:"Header 3",header4:"Header 4",bold:"Bold",italic:"Italic",fontcolor:"Font Color",backcolor:"Back Color",unorderedlist:"Unordered List",orderedlist:"Ordered List",outdent:"Outdent",indent:"Indent",cancel:"Cancel",insert:"Insert",save:"Save",_delete:"Delete",insert_table:"Insert Table",insert_row_above:"Add Row Above",insert_row_below:"Add Row Below",insert_column_left:"Add Column Left",insert_column_right:"Add Column Right",delete_column:"Delete Column",delete_row:"Delete Row",delete_table:"Delete Table",rows:"Rows",columns:"Columns",add_head:"Add Head",delete_head:"Delete Head",title:"Title",image_position:"Position",none:"None",left:"Left",right:"Right",image_web_link:"Image Web Link",text:"Text",mailto:"Email",web:"URL",video_html_code:"Video Embed Code",file:"Insert File",upload:"Upload",download:"Download",choose:"Choose",or_choose:"Or choose",drop_file_here:"Drop file here",align_left:"Align text to the left",align_center:"Center text",align_right:"Align text to the right",align_justify:"Justify text",horizontalrule:"Insert Horizontal Rule",deleted:"Deleted",anchor:"Anchor",link_new_tab:"Open link in new tab",underline:"Underline",alignment:"Alignment"};!function(t){jQuery.fn.redactor=function(n){return this.each(function(){var i=t(this),o=i.data("redactor");o||i.data("redactor",o=new e(this,n))})};var e=function(e,n){this.$el=t(e),"undefined"!=typeof n&&"undefined"!=typeof n.lang&&"en"!==n.lang&&"undefined"!=typeof RELANG[n.lang]&&(RLANG=RELANG[n.lang]),this.opts=t.extend({iframe:!1,css:!1,lang:"en",direction:"ltr",callback:!1,keyupCallback:!1,keydownCallback:!1,execCommandCallback:!1,plugins:!1,cleanup:!0,focus:!1,tabindex:!1,autoresize:!0,minHeight:!1,fixed:!1,fixedTop:0,fixedBox:!1,source:!0,shortcuts:!0,mobile:!0,air:!1,wym:!1,convertLinks:!0,convertDivs:!0,protocol:"http://",autosave:!1,autosaveCallback:!1,interval:60,imageGetJson:!1,imageUpload:!1,imageUploadCallback:!1,imageUploadErrorCallback:!1,fileUpload:!1,fileUploadCallback:!1,fileUploadErrorCallback:!1,uploadCrossDomain:!1,uploadFields:!1,observeImages:!0,overlay:!0,allowedTags:["form","input","button","select","option","datalist","output","textarea","fieldset","legend","section","header","hgroup","aside","footer","article","details","nav","progress","time","canvas","code","span","div","label","a","br","p","b","i","del","strike","u","img","video","source","track","audio","iframe","object","embed","param","blockquote","mark","cite","small","ul","ol","li","hr","dl","dt","dd","sup","sub","big","pre","code","figure","figcaption","strong","em","table","tr","td","th","tbody","thead","tfoot","h1","h2","h3","h4","h5","h6"],toolbarExternal:!1,buttonsCustom:{},buttonsAdd:[],buttons:["html","|","formatting","|","bold","italic","deleted","|","unorderedlist","orderedlist","outdent","indent","|","image","video","file","table","link","|","fontcolor","backcolor","|","alignment","|","horizontalrule"],airButtons:["formatting","|","bold","italic","deleted","|","unorderedlist","orderedlist","outdent","indent","|","fontcolor","backcolor"],formattingTags:["p","blockquote","pre","h1","h2","h3","h4"],activeButtons:["deleted","italic","bold","underline","unorderedlist","orderedlist"],activeButtonsStates:{b:"bold",strong:"bold",i:"italic",em:"italic",del:"deleted",strike:"deleted",ul:"unorderedlist",ol:"orderedlist",u:"underline"},colors:["#ffffff","#000000","#eeece1","#1f497d","#4f81bd","#c0504d","#9bbb59","#8064a2","#4bacc6","#f79646","#ffff00","#f2f2f2","#7f7f7f","#ddd9c3","#c6d9f0","#dbe5f1","#f2dcdb","#ebf1dd","#e5e0ec","#dbeef3","#fdeada","#fff2ca","#d8d8d8","#595959","#c4bd97","#8db3e2","#b8cce4","#e5b9b7","#d7e3bc","#ccc1d9","#b7dde8","#fbd5b5","#ffe694","#bfbfbf","#3f3f3f","#938953","#548dd4","#95b3d7","#d99694","#c3d69b","#b2a2c7","#b7dde8","#fac08f","#f2c314","#a5a5a5","#262626","#494429","#17365d","#366092","#953734","#76923c","#5f497a","#92cddc","#e36c09","#c09100","#7f7f7f","#0c0c0c","#1d1b10","#0f243e","#244061","#632423","#4f6128","#3f3151","#31859b","#974806","#7f6000"],emptyHtml:"<p><br /></p>",buffer:!1,visual:!0,modal_file:String()+'<div id="redactor_modal_content"><form id="redactorUploadFileForm" method="post" action="" enctype="multipart/form-data"><label>Name (optional)</label><input type="text" id="redactor_filename" class="redactor_input" /><div style="margin-top: 7px;"><input type="file" id="redactor_file" name="file" /></div></form><br></div>',modal_image_edit:String()+'<div id="redactor_modal_content"><label>'+RLANG.title+'</label><input id="redactor_file_alt" class="redactor_input" /><label>'+RLANG.link+'</label><input id="redactor_file_link" class="redactor_input" /><label>'+RLANG.image_position+'</label><select id="redactor_form_image_align"><option value="none">'+RLANG.none+'</option><option value="left">'+RLANG.left+'</option><option value="right">'+RLANG.right+'</option></select></div><div id="redactor_modal_footer"><a href="javascript:void(null);" id="redactor_image_delete_btn" class="redactor_modal_btn">'+RLANG._delete+'</a>&nbsp;&nbsp;&nbsp;<a href="javascript:void(null);" class="redactor_modal_btn redactor_btn_modal_close">'+RLANG.cancel+'</a><input type="button" name="save" class="redactor_modal_btn" id="redactorSaveBtn" value="'+RLANG.save+'" /></div>',modal_image:String()+'<div id="redactor_modal_content"><div id="redactor_tabs"><a href="javascript:void(null);" class="redactor_tabs_act">'+RLANG.upload+'</a><a href="javascript:void(null);">'+RLANG.choose+'</a><a href="javascript:void(null);">'+RLANG.link+'</a></div><form id="redactorInsertImageForm" method="post" action="" enctype="multipart/form-data"><div id="redactor_tab1" class="redactor_tab"><input type="file" id="redactor_file" name="file" /></div><div id="redactor_tab2" class="redactor_tab" style="display: none;"><div id="redactor_image_box"></div></div></form><div id="redactor_tab3" class="redactor_tab" style="display: none;"><label>'+RLANG.image_web_link+'</label><input type="text" name="redactor_file_link" id="redactor_file_link" class="redactor_input"  /></div></div><div id="redactor_modal_footer"><a href="javascript:void(null);" class="redactor_modal_btn redactor_btn_modal_close">'+RLANG.cancel+'</a><input type="button" name="upload" class="redactor_modal_btn" id="redactor_upload_btn" value="'+RLANG.insert+'" /></div>',modal_link:String()+'<div id="redactor_modal_content"><form id="redactorInsertLinkForm" method="post" action=""><div id="redactor_tabs"><a href="javascript:void(null);" class="redactor_tabs_act">URL</a><a href="javascript:void(null);">Email</a><a href="javascript:void(null);">'+RLANG.anchor+'</a></div><input type="hidden" id="redactor_tab_selected" value="1" /><div class="redactor_tab" id="redactor_tab1"><label>URL</label><input type="text" id="redactor_link_url" class="redactor_input"  /><label>'+RLANG.text+'</label><input type="text" class="redactor_input redactor_link_text" id="redactor_link_url_text" /><label><input type="checkbox" id="redactor_link_blank"> '+RLANG.link_new_tab+'</label></div><div class="redactor_tab" id="redactor_tab2" style="display: none;"><label>Email</label><input type="text" id="redactor_link_mailto" class="redactor_input" /><label>'+RLANG.text+'</label><input type="text" class="redactor_input redactor_link_text" id="redactor_link_mailto_text" /></div><div class="redactor_tab" id="redactor_tab3" style="display: none;"><label>'+RLANG.anchor+'</label><input type="text" class="redactor_input" id="redactor_link_anchor"  /><label>'+RLANG.text+'</label><input type="text" class="redactor_input redactor_link_text" id="redactor_link_anchor_text" /></div></form></div><div id="redactor_modal_footer"><a href="javascript:void(null);" class="redactor_modal_btn redactor_btn_modal_close">'+RLANG.cancel+'</a><input type="button" class="redactor_modal_btn" id="redactor_insert_link_btn" value="'+RLANG.insert+'" /></div>',modal_table:String()+'<div id="redactor_modal_content"><label>'+RLANG.rows+'</label><input type="text" size="5" value="2" id="redactor_table_rows" /><label>'+RLANG.columns+'</label><input type="text" size="5" value="3" id="redactor_table_columns" /></div><div id="redactor_modal_footer"><a href="javascript:void(null);" class="redactor_modal_btn redactor_btn_modal_close">'+RLANG.cancel+'</a><input type="button" name="upload" class="redactor_modal_btn" id="redactor_insert_table_btn" value="'+RLANG.insert+'" /></div>',modal_video:String()+'<div id="redactor_modal_content"><form id="redactorInsertVideoForm"><label>'+RLANG.video_html_code+'</label><textarea id="redactor_insert_video_area" style="width: 99%; height: 160px;"></textarea></form></div><div id="redactor_modal_footer"><a href="javascript:void(null);" class="redactor_modal_btn redactor_btn_modal_close">'+RLANG.cancel+'</a><input type="button" class="redactor_modal_btn" id="redactor_insert_video_btn" value="'+RLANG.insert+'" /></div>',toolbar:{html:{title:RLANG.html,func:"toggle"},formatting:{title:RLANG.formatting,func:"show",dropdown:{p:{title:RLANG.paragraph,exec:"formatblock"},blockquote:{title:RLANG.quote,exec:"formatblock",className:"redactor_format_blockquote"},pre:{title:RLANG.code,exec:"formatblock",className:"redactor_format_pre"},h1:{title:RLANG.header1,exec:"formatblock",className:"redactor_format_h1"},h2:{title:RLANG.header2,exec:"formatblock",className:"redactor_format_h2"},h3:{title:RLANG.header3,exec:"formatblock",className:"redactor_format_h3"},h4:{title:RLANG.header4,exec:"formatblock",className:"redactor_format_h4"}}},bold:{title:RLANG.bold,exec:"bold"},italic:{title:RLANG.italic,exec:"italic"},deleted:{title:RLANG.deleted,exec:"strikethrough"},underline:{title:RLANG.underline,exec:"underline"},unorderedlist:{title:"&bull; "+RLANG.unorderedlist,exec:"insertunorderedlist"},orderedlist:{title:"1. "+RLANG.orderedlist,exec:"insertorderedlist"},outdent:{title:"< "+RLANG.outdent,exec:"outdent"},indent:{title:"> "+RLANG.indent,exec:"indent"},image:{title:RLANG.image,func:"showImage"},video:{title:RLANG.video,func:"showVideo"},file:{title:RLANG.file,func:"showFile"},table:{title:RLANG.table,func:"show",dropdown:{insert_table:{title:RLANG.insert_table,func:"showTable"},separator_drop1:{name:"separator"},insert_row_above:{title:RLANG.insert_row_above,func:"insertRowAbove"},insert_row_below:{title:RLANG.insert_row_below,func:"insertRowBelow"},insert_column_left:{title:RLANG.insert_column_left,func:"insertColumnLeft"},insert_column_right:{title:RLANG.insert_column_right,func:"insertColumnRight"},separator_drop2:{name:"separator"},add_head:{title:RLANG.add_head,func:"addHead"},delete_head:{title:RLANG.delete_head,func:"deleteHead"},separator_drop3:{name:"separator"},delete_column:{title:RLANG.delete_column,func:"deleteColumn"},delete_row:{title:RLANG.delete_row,func:"deleteRow"},delete_table:{title:RLANG.delete_table,func:"deleteTable"}}},link:{title:RLANG.link,func:"show",dropdown:{link:{title:RLANG.link_insert,func:"showLink"},unlink:{title:RLANG.unlink,exec:"unlink"}}},fontcolor:{title:RLANG.fontcolor,func:"show"},backcolor:{title:RLANG.backcolor,func:"show"},alignment:{title:RLANG.alignment,func:"show",dropdown:{alignleft:{title:RLANG.align_left,exec:"JustifyLeft"},aligncenter:{title:RLANG.align_center,exec:"JustifyCenter"},alignright:{title:RLANG.align_right,exec:"JustifyRight"},justify:{title:RLANG.align_justify,exec:"JustifyFull"}}},alignleft:{exec:"JustifyLeft",title:RLANG.align_left},aligncenter:{exec:"JustifyCenter",title:RLANG.align_center},alignright:{exec:"JustifyRight",title:RLANG.align_right},justify:{exec:"JustifyFull",title:RLANG.align_justify},horizontalrule:{exec:"inserthorizontalrule",title:RLANG.horizontalrule}}},n,this.$el.data()),this.dropdowns=[],this.init()
};e.prototype={init:function(){function e(){if(this.enableAir(),this.buildToolbar(),"object"==typeof this.opts.plugins&&t.each(this.opts.plugins,t.proxy(function(e,n){"undefined"!=typeof RedactorPlugins[n]&&(t.extend(this,RedactorPlugins[n]),"undefined"!=typeof RedactorPlugins[n].init&&this.init())},this)),this.opts.activeButtons!==!1&&this.opts.toolbar!==!1){var e=t.proxy(function(){this.observeFormatting()},this);this.$editor.click(e).keyup(e)}var n=!1;if(this.browser("webkit")&&-1===navigator.userAgent.indexOf("Chrome")){var i=this.browser("version").split(".");i[0]<536&&(n=!0)}if(this.isMobile(!0)===!1&&n===!1&&this.$editor.bind("paste",t.proxy(function(){if(this.opts.cleanup===!1)return!0;this.pasteRunning=!0,this.setBuffer(),this.saveScroll=this.opts.autoresize===!0?this.document.body.scrollTop:this.$editor.scrollTop();var e=this.extractContent();setTimeout(t.proxy(function(){var t=this.extractContent();this.$editor.append(e),this.restoreSelection();var n=this.getFragmentHtml(t);this.pasteCleanUp(n),this.pasteRunning=!1},this),1)},this)),this.keyup(),this.keydown(),this.opts.autosave!==!1&&this.autoSave(),setTimeout(t.proxy(function(){this.observeImages(),this.observeTables()},this),1),this.browser("mozilla")){this.$editor.click(t.proxy(function(){this.saveSelection()},this));try{this.document.execCommand("enableObjectResizing",!1,!1),this.document.execCommand("enableInlineTableEditing",!1,!1)}catch(o){}}this.opts.focus&&setTimeout(t.proxy(function(){this.$editor.focus()},this),1),this.opts.fixed&&(this.observeScroll(),t(document).scroll(t.proxy(this.observeScroll,this))),"function"==typeof this.opts.callback&&this.opts.callback(this),this.opts.toolbar!==!1&&this.$toolbar.find("a").attr("tabindex","-1")}if(this.height=this.$el.css("height"),this.width=this.$el.css("width"),rdocument=this.document=document,rwindow=this.window=window,this.opts.mobile===!1&&this.isMobile())return this.build(!0),!1;if(this.opts.iframe&&(this.opts.autoresize=!1),this.opts.air)this.opts.buttons=this.opts.airButtons;else if(this.opts.toolbar!==!1){if(this.opts.source===!1){var n=this.opts.buttons.indexOf("html"),i=this.opts.buttons[n+1];this.opts.buttons.splice(n,1),"undefined"!=typeof i&&"|"===i&&this.opts.buttons.splice(n,1)}t.extend(this.opts.toolbar,this.opts.buttonsCustom),t.each(this.opts.buttonsAdd,t.proxy(function(t,e){this.opts.buttons.push(e)},this))}this.opts.toolbar!==!1&&t.each(this.opts.toolbar.formatting.dropdown,t.proxy(function(e){"-1"==t.inArray(e,this.opts.formattingTags)&&delete this.opts.toolbar.formatting.dropdown[e]},this)),this.build(!1,e)},shortcuts:function(t,e){t.preventDefault(),this.execCommand(e,!1)},keyup:function(){this.$editor.keyup(t.proxy(function(t){var e=t.keyCode||t.which;return this.browser("mozilla")&&!this.pasteRunning&&this.saveSelection(),"function"==typeof this.opts.keyupCallback&&this.opts.keyupCallback(this,t),8===e||46===e?(this.observeImages(),this.formatEmpty(t)):(13!==e||t.shiftKey||t.ctrlKey||t.metaKey||(this.browser("webkit")&&this.formatNewLine(t),this.opts.convertLinks&&this.$editor.linkify()),void this.syncCode())},this))},keydown:function(){this.$editor.keydown(t.proxy(function(e){var n=e.keyCode||e.which,i=this.getParentNode(),o=this.getCurrentNode(),a=!1,r=e.ctrlKey||e.metaKey;if(!i&&!o||"PRE"!==t(i).get(0).tagName&&"PRE"!==t(o).get(0).tagName||(a=!0),"function"==typeof this.opts.keydownCallback&&this.opts.keydownCallback(this,e),r&&this.opts.shortcuts&&(90===n?this.opts.buffer!==!1?(e.preventDefault(),this.getBuffer()):e.shiftKey?this.shortcuts(e,"redo"):this.shortcuts(e,"undo"):77===n?this.shortcuts(e,"removeFormat"):66===n?this.shortcuts(e,"bold"):73===n?this.shortcuts(e,"italic"):74===n?this.shortcuts(e,"insertunorderedlist"):75===n?this.shortcuts(e,"insertorderedlist"):76===n?this.shortcuts(e,"superscript"):72===n&&this.shortcuts(e,"subscript")),r||90===n||(this.opts.buffer=!1),a===!0&&13===n){e.preventDefault();var s=t(o).parent().text();return this.insertNodeAtCaret(this.document.createTextNode("\r\n")),-1==s.search(/\s$/)&&this.insertNodeAtCaret(this.document.createTextNode("\r\n")),this.syncCode(),!1}if(this.opts.shortcuts&&!e.shiftKey&&9===n){if(a!==!1)return e.preventDefault(),this.insertNodeAtCaret(this.document.createTextNode("	")),this.syncCode(),!1;this.shortcuts(e,"indent")}else this.opts.shortcuts&&e.shiftKey&&9===n&&this.shortcuts(e,"outdent");return this.browser("webkit")&&-1===navigator.userAgent.indexOf("Chrome")?this.safariShiftKeyEnter(e,n):void 0},this))},build:function(e,n){function i(){this.$editor=this.$content.contents().find("body").attr("contenteditable",!0).attr("dir",this.opts.direction),rdocument=this.document=this.$editor[0].ownerDocument,rwindow=this.window=this.document.defaultView||window,this.opts.css!==!1&&this.$content.contents().find("head").append('<link rel="stylesheet" href="'+this.opts.css+'" />'),this.$editor.html(r),n&&(n.call(this),n=null)}if(e!==!0){if(this.$box=t('<div class="redactor_box"></div>'),this.opts.air&&(this.air=t('<div class="redactor_air" style="display: none;"></div>')),this.$content=null,this.textareamode=!0,"TEXTAREA"===this.$el.get(0).tagName){if(this.opts.iframe){var o=this;this.$content=t('<iframe style="width: 100%;" frameborder="0"></iframe>').load(function(){i.call(o)})}else this.$content=this.$editor=t("<div></div>");var a=this.$el.get(0).className.split(/\s+/);t.each(a,t.proxy(function(t,e){this.$content.addClass("redactor_"+e)},this))}else this.textareamode=!1,this.$content=this.$editor=this.$el,this.$el=t('<textarea name="'+this.$editor.attr("id")+'"></textarea>').css("height",this.height);this.$editor&&this.$editor.addClass("redactor_editor").attr("contenteditable",!0).attr("dir",this.opts.direction),this.opts.tabindex!==!1&&this.$content.attr("tabindex",this.opts.tabindex),this.opts.minHeight!==!1&&this.$content.css("min-height",this.opts.minHeight+"px"),this.opts.wym===!0&&this.$content.addClass("redactor_editor_wym"),this.opts.autoresize===!1&&this.$content.css("height",this.height),this.$el.hide();var r="";this.textareamode?(r=this.$el.val(),r=this.savePreCode(r),this.$box.insertAfter(this.$el).append(this.$content).append(this.$el)):(r=this.$editor.html(),r=this.savePreCode(r),this.$box.insertAfter(this.$content).append(this.$el).append(this.$editor)),r=this.paragraphy(r),this.$editor&&this.$editor.html(r),this.textareamode===!1&&this.syncCode()}else if("TEXTAREA"!==this.$el.get(0).tagName){var r=this.$el.val(),s=t('<textarea name="'+this.$editor.attr("id")+'"></textarea>').css("height",this.height).val(r);this.$el.hide(),this.$el.after(s)}n&&this.$editor&&n.call(this)},enableAir:function(){return this.opts.air===!1?!1:(this.air.hide(),this.$editor.bind("textselect",t.proxy(function(t){this.showAir(t)},this)),void this.$editor.bind("textunselect",t.proxy(function(){this.air.hide()},this)))},showAir:function(e){t(".redactor_air").hide();var n=this.air.innerWidth(),i=e.clientX;t(this.document).width()<i+n&&(i-=n);var o=e.clientY+t(document).scrollTop()+14;this.opts.iframe===!0&&(o+=this.$box.position().top,i+=this.$box.position().left),this.air.css({left:i+"px",top:o+"px"}).show()},syncCode:function(){this.$el.val(this.$editor.html())},setCode:function(t){t=this.stripTags(t),this.$editor.html(t).focus(),this.syncCode()},getCode:function(){var t="";return t=this.opts.visual?this.$editor.html():this.$el.val(),this.stripTags(t)},insertHtml:function(t){this.$editor.focus(),this.pasteHtmlAtCaret(t),this.observeImages(),this.syncCode()},pasteHtmlAtCaret:function(t){var e,n;if(this.document.getSelection){if(e=this.window.getSelection(),e.getRangeAt&&e.rangeCount){n=e.getRangeAt(0),n.deleteContents();var i=this.document.createElement("div");i.innerHTML=t;for(var o,a,r=this.document.createDocumentFragment();o=i.firstChild;)a=r.appendChild(o);n.insertNode(r),a&&(n=n.cloneRange(),n.setStartAfter(a),n.collapse(!0),e.removeAllRanges(),e.addRange(n))}}else this.document.selection&&"Control"!=this.document.selection.type&&this.document.selection.createRange().pasteHTML(t)},destroy:function(){var e=this.getCode();this.textareamode?(this.$box.after(this.$el),this.$box.remove(),this.$el.height(this.height).val(e).show()):(this.$box.after(this.$editor),this.$box.remove(),this.$editor.removeClass("redactor_editor").removeClass("redactor_editor_wym").attr("contenteditable",!1).html(e).show()),this.opts.toolbarExternal&&t(this.opts.toolbarExternal).empty(),t(".redactor_air").remove();for(var n=0;n<this.dropdowns.length;n++)this.dropdowns[n].remove(),delete this.dropdowns[n];this.opts.autosave!==!1&&clearInterval(this.autosaveInterval)},observeFormatting:function(){var e=this.getCurrentNode();this.inactiveAllButtons(),t.each(this.opts.activeButtonsStates,t.proxy(function(n,i){0!=t(e).closest(n,this.$editor.get()[0]).length&&this.setBtnActive(i)},this));var n=t(e).closest(["p","div","h1","h2","h3","h4","h5","h6","blockquote","td"]);if("undefined"!=typeof n[0]&&"undefined"!=typeof n[0].elem&&0!=t(n[0].elem).size()){var i=t(n[0].elem).css("text-align");switch(i){case"right":this.setBtnActive("alignright");break;case"center":this.setBtnActive("aligncenter");break;case"justify":this.setBtnActive("justify");break;default:this.setBtnActive("alignleft")}}},observeImages:function(){return this.opts.observeImages===!1?!1:void this.$editor.find("img").each(t.proxy(function(e,n){this.browser("msie")&&t(n).attr("unselectable","on"),this.resizeImage(n)},this))},observeTables:function(){this.$editor.find("table").click(t.proxy(this.tableObserver,this))},observeScroll:function(){var e=t(this.document).scrollTop(),n=this.$box.offset().top,i=0;if(e>n){var o="100%";this.opts.fixedBox&&(i=this.$box.offset().left,o=this.$box.innerWidth()),this.fixed=!0,this.$toolbar.css({position:"fixed",width:o,zIndex:1005,top:this.opts.fixedTop+"px",left:i})}else this.fixed=!1,this.$toolbar.css({position:"relative",width:"auto",zIndex:1,top:0,left:i})},setBuffer:function(){this.saveSelection(),this.opts.buffer=this.$editor.html()},getBuffer:function(){return this.opts.buffer===!1?!1:(this.$editor.html(this.opts.buffer),this.browser("msie")||this.restoreSelection(),void(this.opts.buffer=!1))},execCommand:function(e,n){if(0==this.opts.visual)return this.$el.focus(),!1;try{var i;if("inserthtml"===e)this.browser("msie")?(this.$editor.focus(),this.document.selection.createRange().pasteHTML(n)):this.pasteHtmlAtCaret(n),this.observeImages();else if("unlink"===e)i=this.getParentNode(),"A"===t(i).get(0).tagName?t(i).replaceWith(t(i).text()):this.execRun(e,n);else if("JustifyLeft"===e||"JustifyCenter"===e||"JustifyRight"===e||"JustifyFull"===e){i=this.getCurrentNode();var o=t(i).get(0).tagName;if(this.opts.iframe===!1&&0==t(i).parents(".redactor_editor").size())return!1;var a=["P","DIV","H1","H2","H3","H4","H5","H6","BLOCKQUOTE","TD"];if(-1!=t.inArray(o,a)){var r=!1;"JustifyCenter"===e?r="center":"JustifyRight"===e?r="right":"JustifyFull"===e&&(r="justify"),r===!1?t(i).css("text-align",""):t(i).css("text-align",r)}else this.execRun(e,n)}else if("formatblock"===e&&"blockquote"===n)if(i=this.getCurrentNode(),"BLOCKQUOTE"===t(i).get(0).tagName)if(this.browser("msie")){var s=t("<p>"+t(i).html()+"</p>");t(i).replaceWith(s)}else this.execRun(e,"p");else if("P"===t(i).get(0).tagName){var l=t(i).parent();if("BLOCKQUOTE"===t(l).get(0).tagName){var s=t("<p>"+t(i).html()+"</p>");t(l).replaceWith(s),this.setSelection(s[0],0,s[0],0)}else if(this.browser("msie")){var s=t("<blockquote>"+t(i).html()+"</blockquote>");t(i).replaceWith(s)}else this.execRun(e,n)}else this.execRun(e,n);else"formatblock"!==e||"pre"!==n&&"p"!==n?("inserthorizontalrule"===e&&this.browser("msie")&&this.$editor.focus(),"formatblock"===e&&this.browser("mozilla")&&this.$editor.focus(),this.execRun(e,n)):(i=this.getParentNode(),"PRE"===t(i).get(0).tagName?t(i).replaceWith("<p>"+this.encodeEntities(t(i).text())+"</p>"):this.execRun(e,n));"inserthorizontalrule"===e&&this.$editor.find("hr").removeAttr("id"),this.syncCode(),this.oldIE()&&this.$editor.focus(),"function"==typeof this.opts.execCommandCallback&&this.opts.execCommandCallback(this,e),this.opts.air&&this.air.hide()}catch(c){}},execRun:function(t,e){"formatblock"===t&&this.browser("msie")&&(e="<"+e+">"),this.document.execCommand(t,!1,e)},formatNewLine:function(){var e=this.getParentNode();if("DIV"===e.nodeName&&"redactor_editor"===e.className){var n=t(this.getCurrentNode());if("DIV"===n.get(0).tagName&&(""===n.html()||"<br>"===n.html())){var i=t("<p>").append(n.clone().get(0).childNodes);n.replaceWith(i),i.html("<br />"),this.setSelection(i[0],0,i[0],0)}}},safariShiftKeyEnter:function(e,n){return e.shiftKey&&13===n?(e.preventDefault(),this.insertNodeAtCaret(t("<span><br /></span>").get(0)),this.syncCode(),!1):!0},formatEmpty:function(e){var n=t.trim(this.$editor.html());this.browser("mozilla")&&(n=n.replace(/<br>/i,""));var i=n.replace(/<(?:.|\n)*?>/gm,"");if(""===n||""===i){e.preventDefault();var o=t(this.opts.emptyHtml).get(0);return this.$editor.html(o),this.setSelection(o,0,o,0),this.syncCode(),!1}this.syncCode()},paragraphy:function(e){if(e=t.trim(e),""===e||"<p></p>"===e)return this.opts.emptyHtml;this.opts.convertDivs&&(e=e.replace(/<div(.*?)>([\w\W]*?)<\/div>/gi,"<p>$2</p>"));var n=function(t,e,n){return t.replace(new RegExp(e,"g"),n)},i=function(t,i){return n(e,t,i)},o="(table|thead|tfoot|caption|colgroup|tbody|tr|td|th|div|dl|dd|dt|ul|ol|li|pre|select|form|blockquote|address|math|style|script|object|input|param|p|h[1-6])";return e+="\n",i("<br />\\s*<br />","\n\n"),i("(<"+o+"[^>]*>)","\n$1"),i("(</"+o+">)","$1\n\n"),i("\r\n|\r","\n"),i("\n\n+","\n\n"),i("\n?((.|\n)+?)$","<p>$1</p>\n"),i("<p>\\s*?</p>",""),i("<p>(<div[^>]*>\\s*)","$1<p>"),i("<p>([^<]+)\\s*?(</(div|address|form)[^>]*>)","<p>$1</p>$2"),i("<p>\\s*(</?"+o+"[^>]*>)\\s*</p>","$1"),i("<p>(<li.+?)</p>","$1"),i("<p>\\s*(</?"+o+"[^>]*>)","$1"),i("(</?"+o+"[^>]*>)\\s*</p>","$1"),i("(</?"+o+"[^>]*>)\\s*<br />","$1"),i("<br />(\\s*</?(p|li|div|dl|dd|dt|th|pre|td|ul|ol)[^>]*>)","$1"),-1!=e.indexOf("<pre")&&i("(<pre(.|\n)*?>)((.|\n)*?)</pre>",function(t,e,i,o){return n(e,"\\\\(['\"\\\\])","$1")+n(n(n(o,"<p>","\n"),"</p>|<br />",""),"\\\\(['\"\\\\])","$1")+"</pre>"}),i("\n</p>$","</p>")},stripTags:function(e){var n=this.opts.allowedTags,i=/<\/?([a-z][a-z0-9]*)\b[^>]*>/gi;return e.replace(i,function(e,i){return t.inArray(i.toLowerCase(),n)>"-1"?e:""})},savePreCode:function(e){var n=e.match(/<pre(.*?)>([\w\W]*?)<\/pre>/gi);return null!==n&&t.each(n,t.proxy(function(t,n){var i=n.match(/<pre(.*?)>([\w\W]*?)<\/pre>/i);i[2]=this.encodeEntities(i[2]),e=e.replace(n,"<pre"+i[1]+">"+i[2]+"</pre>")},this)),e},encodeEntities:function(t){return t=String(t).replace(/&amp;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,'"'),String(t).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")},cleanupPre:function(t){t=t.replace(/<br>/gi,"\n"),t=t.replace(/<\/p>/gi,"\n"),t=t.replace(/<\/div>/gi,"\n");var e=this.document.createElement("div");return e.innerHTML=t,e.textContent||e.innerText},pasteCleanUp:function(e){var n=this.getParentNode();return"PRE"===t(n).get(0).tagName?(e=this.cleanupPre(e),this.pasteCleanUpInsert(e),!0):(e=e.replace(/<!--[\s\S]*?-->|<\?(?:php)?[\s\S]*?\?>/gi,""),e=e.replace(/(&nbsp;){2,}/gi,"&nbsp;"),e=e.replace(/<b\sid="internal-source-marker(.*?)">([\w\W]*?)<\/b>/gi,"$2"),e=this.stripTags(e),e=e.replace(/<td><\/td>/gi,"[td]"),e=e.replace(/<td>&nbsp;<\/td>/gi,"[td]"),e=e.replace(/<td><br><\/td>/gi,"[td]"),e=e.replace(/<a(.*?)href="(.*?)"(.*?)>([\w\W]*?)<\/a>/gi,'[a href="$2"]$4[/a]'),e=e.replace(/<iframe(.*?)>([\w\W]*?)<\/iframe>/gi,"[iframe$1]$2[/iframe]"),e=e.replace(/<video(.*?)>([\w\W]*?)<\/video>/gi,"[video$1]$2[/video]"),e=e.replace(/<audio(.*?)>([\w\W]*?)<\/audio>/gi,"[audio$1]$2[/audio]"),e=e.replace(/<embed(.*?)>([\w\W]*?)<\/embed>/gi,"[embed$1]$2[/embed]"),e=e.replace(/<object(.*?)>([\w\W]*?)<\/object>/gi,"[object$1]$2[/object]"),e=e.replace(/<param(.*?)>/gi,"[param$1]"),e=e.replace(/<img(.*?)style="(.*?)"(.*?)>/gi,"[img$1$3]"),e=e.replace(/<(\w+)([\w\W]*?)>/gi,"<$1>"),e=e.replace(/<[^\/>][^>]*>(\s*|\t*|\n*|&nbsp;|<br>)<\/[^>]+>/gi,""),e=e.replace(/<[^\/>][^>]*>(\s*|\t*|\n*|&nbsp;|<br>)<\/[^>]+>/gi,""),e=e.replace(/\[td\]/gi,"<td>&nbsp;</td>"),e=e.replace(/\[a href="(.*?)"\]([\w\W]*?)\[\/a\]/gi,'<a href="$1">$2</a>'),e=e.replace(/\[iframe(.*?)\]([\w\W]*?)\[\/iframe\]/gi,"<iframe$1>$2</iframe>"),e=e.replace(/\[video(.*?)\]([\w\W]*?)\[\/video\]/gi,"<video$1>$2</video>"),e=e.replace(/\[audio(.*?)\]([\w\W]*?)\[\/audio\]/gi,"<audio$1>$2</audio>"),e=e.replace(/\[embed(.*?)\]([\w\W]*?)\[\/embed\]/gi,"<embed$1>$2</embed>"),e=e.replace(/\[object(.*?)\]([\w\W]*?)\[\/object\]/gi,"<object$1>$2</object>"),e=e.replace(/\[param(.*?)\]/gi,"<param$1>"),e=e.replace(/\[img(.*?)\]/gi,"<img$1>"),this.opts.convertDivs&&(e=e.replace(/<div(.*?)>([\w\W]*?)<\/div>/gi,"<p>$2</p>")),e=e.replace(/<span>([\w\W]*?)<\/span>/gi,"$1"),e=e.replace(/\n{3,}/gi,"\n"),e=e.replace(/<p><p>/gi,"<p>"),e=e.replace(/<\/p><\/p>/gi,"</p>"),this.browser("mozilla")&&(e=e.replace(/<br>$/gi,"")),void this.pasteCleanUpInsert(e))},pasteCleanUpInsert:function(e){this.execCommand("inserthtml",e),this.opts.autoresize===!0?t(this.document.body).scrollTop(this.saveScroll):this.$editor.scrollTop(this.saveScroll)},formattingRemove:function(e){var n=[],i=e.match(/<pre(.*?)>([\w\W]*?)<\/pre>/gi);return null!==i&&t.each(i,function(t,i){e=e.replace(i,"prebuffer_"+t),n.push(i)}),e=e.replace(/\s{2,}/g," "),e=e.replace(/\n/g," "),e=e.replace(/[\t]*/g,""),e=e.replace(/\n\s*\n/g,"\n"),e=e.replace(/^[\s\n]*/g,""),e=e.replace(/[\s\n]*$/g,""),e=e.replace(/>\s+</g,"><"),n&&(t.each(n,function(t,n){e=e.replace("prebuffer_"+t,n)}),n=[]),e},formattingIndenting:function(t){return t=t.replace(/<li/g,"	<li"),t=t.replace(/<tr/g,"	<tr"),t=t.replace(/<td/g,"		<td"),t=t.replace(/<\/tr>/g,"	</tr>")},formattingEmptyTags:function(t){for(var e=["<pre></pre>","<blockquote>\\s*</blockquote>","<em>\\s*</em>","<ul></ul>","<ol></ol>","<li></li>","<table></table>","<tr></tr>","<span>\\s*<span>","<span>&nbsp;<span>","<b>\\s*</b>","<b>&nbsp;</b>","<p>\\s*</p>","<p>&nbsp;</p>","<p>\\s*<br>\\s*</p>","<div>\\s*</div>","<div>\\s*<br>\\s*</div>"],n=0;n<e.length;++n){var i=e[n];t=t.replace(new RegExp(i,"gi"),"")}return t},formattingAddBefore:function(t){for(var e="\r\n",n=["<p","<form","</ul>","</ol>","<fieldset","<legend","<object","<embed","<select","<option","<input","<textarea","<pre","<blockquote","<ul","<ol","<li","<dl","<dt","<dd","<table","<thead","<tbody","<caption","</caption>","<th","<tr","<td","<figure"],i=0;i<n.length;++i){var o=n[i];t=t.replace(new RegExp(o,"gi"),e+o)}return t},formattingAddAfter:function(t){for(var e="\r\n",n=["</p>","</div>","</h1>","</h2>","</h3>","</h4>","</h5>","</h6>","<br>","<br />","</dl>","</dt>","</dd>","</form>","</blockquote>","</pre>","</legend>","</fieldset>","</object>","</embed>","</textarea>","</select>","</option>","</table>","</thead>","</tbody>","</tr>","</td>","</th>","</figure>"],i=0;i<n.length;++i){var o=n[i];t=t.replace(new RegExp(o,"gi"),o+e)}return t},formatting:function(t){return t=this.formattingRemove(t),t=this.formattingEmptyTags(t),t=this.formattingAddBefore(t),t=this.formattingAddAfter(t),t=this.formattingIndenting(t)},toggle:function(){var t;if(this.opts.visual){var e=this.$editor.innerHeight();this.$editor.hide(),this.$content.hide(),t=this.$editor.html(),this.$el.height(e).val(t).show().focus(),this.setBtnActive("html"),this.opts.visual=!1}else{this.$el.hide();var t=this.$el.val();this.$editor.html(t).show(),this.$content.show(),""===this.$editor.html()&&this.setCode(this.opts.emptyHtml),this.$editor.focus(),this.setBtnInactive("html"),this.opts.visual=!0,this.observeImages(),this.observeTables()}},autoSave:function(){this.autosaveInterval=setInterval(t.proxy(function(){t.ajax({url:this.opts.autosave,type:"post",data:this.$el.attr("name")+"="+escape(encodeURIComponent(this.getCode())),success:t.proxy(function(t){"function"==typeof this.opts.autosaveCallback&&this.opts.autosaveCallback(t,this)},this)})},this),1e3*this.opts.interval)},buildToolbar:function(){return this.opts.toolbar===!1?!1:(this.$toolbar=t("<ul>").addClass("redactor_toolbar"),this.opts.air?(t(this.air).append(this.$toolbar),t("body").append(this.air)):this.opts.toolbarExternal===!1?this.$box.prepend(this.$toolbar):t(this.opts.toolbarExternal).html(this.$toolbar),void t.each(this.opts.buttons,t.proxy(function(e,n){if("|"!==n&&"undefined"!=typeof this.opts.toolbar[n]){var i=this.opts.toolbar[n];if(this.opts.fileUpload===!1&&"file"===n)return!0;this.$toolbar.append(t("<li>").append(this.buildButton(n,i)))}"|"===n&&this.$toolbar.append(t('<li class="redactor_separator"></li>'))},this)))},buildButton:function(e,n){var i=t('<a href="javascript:void(null);" title="'+n.title+'" class="redactor_btn_'+e+'"></a>');if("undefined"==typeof n.func?i.click(t.proxy(function(){-1!=t.inArray(e,this.opts.activeButtons)&&(this.inactiveAllButtons(),this.setBtnActive(e)),this.browser("mozilla")&&this.$editor.focus(),this.execCommand(n.exec,e)},this)):"show"!==n.func&&i.click(t.proxy(function(t){this[n.func](t)},this)),"undefined"!=typeof n.callback&&n.callback!==!1&&i.click(t.proxy(function(t){n.callback(this,t,e)},this)),"backcolor"===e||"fontcolor"===e||"undefined"!=typeof n.dropdown){var o=t('<div class="redactor_dropdown" style="display: none;">');o="backcolor"===e||"fontcolor"===e?this.buildColorPicker(o,e):this.buildDropdown(o,n.dropdown),this.dropdowns.push(o.appendTo(t(document.body))),this.hdlShowDropDown=t.proxy(function(t){this.showDropDown(t,o,e)},this),i.click(this.hdlShowDropDown)}return i},buildDropdown:function(e,n){return t.each(n,t.proxy(function(n,i){"undefined"==typeof i.className&&(i.className="");var o;"undefined"!=typeof i.name&&"separator"===i.name?o=t('<a class="redactor_separator_drop">'):(o=t('<a href="javascript:void(null);" class="'+i.className+'">'+i.title+"</a>"),t(o).click("function"==typeof i.callback?t.proxy(function(t){i.callback(this,t,n)},this):"undefined"==typeof i.func?t.proxy(function(){this.execCommand(i.exec,n)},this):t.proxy(function(t){this[i.func](t)},this))),t(e).append(o)},this)),e},buildColorPicker:function(e,n){var i;i="backcolor"===n?this.browser("msie")?"BackColor":"hilitecolor":"forecolor",t(e).width(210);for(var o=this.opts.colors.length,a=0;o>a;++a){var r=this.opts.colors[a],s=t('<a rel="'+r+'" href="javascript:void(null);" class="redactor_color_link"></a>').css({backgroundColor:r});t(e).append(s);var l=this;t(s).click(function(){l.execCommand(i,t(this).attr("rel")),"forecolor"===i&&l.$editor.find("font").replaceWith(function(){return t('<span style="color: '+t(this).attr("color")+';">'+t(this).html()+"</span>")}),l.browser("msie")&&"BackColor"===i&&l.$editor.find("font").replaceWith(function(){return t('<span style="'+t(this).attr("style")+'">'+t(this).html()+"</span>")})})}var c=t('<a href="javascript:void(null);" class="redactor_color_none"></a>').html(RLANG.none);return c.click("backcolor"===n?t.proxy(this.setBackgroundNone,this):t.proxy(this.setColorNone,this)),t(e).append(c),e},setBackgroundNone:function(){t(this.getParentNode()).css("background-color","transparent"),this.syncCode()},setColorNone:function(){t(this.getParentNode()).attr("color","").css("color",""),this.syncCode()},showDropDown:function(e,n,i){if(this.getBtn(i).hasClass("dropact"))this.hideAllDropDown();else{this.hideAllDropDown(),this.setBtnActive(i),this.getBtn(i).addClass("dropact");var o=this.getBtn(i).offset().left;if(this.opts.air){var a=this.air.offset().top;t(n).css({position:"absolute",left:o+"px",top:a+30+"px"}).show()}else if(this.opts.fixed&&this.fixed)t(n).css({position:"fixed",left:o+"px",top:"30px"}).show();else{var r=this.$toolbar.offset().top+30;t(n).css({position:"absolute",left:o+"px",top:r+"px"}).show()}}var s=t.proxy(function(t){this.hideDropDown(t,n,i)},this);t(document).one("click",s),this.$editor.one("click",s),this.$content.one("click",s),e.stopPropagation()},hideAllDropDown:function(){this.$toolbar.find("a.dropact").removeClass("redactor_act").removeClass("dropact"),t(".redactor_dropdown").hide()},hideDropDown:function(e,n){t(e.target).hasClass("dropact")||(t(n).removeClass("dropact"),this.showedDropDown=!1,this.hideAllDropDown())},getBtn:function(e){return this.opts.toolbar===!1?!1:t(this.$toolbar.find("a.redactor_btn_"+e))},setBtnActive:function(t){this.getBtn(t).addClass("redactor_act")},setBtnInactive:function(t){this.getBtn(t).removeClass("redactor_act")},inactiveAllButtons:function(){t.each(this.opts.activeButtons,t.proxy(function(t,e){this.setBtnInactive(e)},this))},changeBtnIcon:function(t,e){this.getBtn(t).addClass("redactor_btn_"+e)},removeBtnIcon:function(t,e){this.getBtn(t).removeClass("redactor_btn_"+e)},addBtnSeparator:function(){this.$toolbar.append(t('<li class="redactor_separator"></li>'))},addBtnSeparatorAfter:function(e){var n=this.getBtn(e);n.parent().after(t('<li class="redactor_separator"></li>'))},addBtnSeparatorBefore:function(e){var n=this.getBtn(e);n.parent().before(t('<li class="redactor_separator"></li>'))},removeBtnSeparatorAfter:function(t){var e=this.getBtn(t);e.parent().next().remove()},removeBtnSeparatorBefore:function(t){var e=this.getBtn(t);e.parent().prev().remove()},setBtnRight:function(t){return this.opts.toolbar===!1?!1:void this.getBtn(t).parent().addClass("redactor_btn_right")},setBtnLeft:function(t){return this.opts.toolbar===!1?!1:void this.getBtn(t).parent().removeClass("redactor_btn_right")},addBtn:function(e,n,i,o){if(this.opts.toolbar===!1)return!1;var a=this.buildButton(e,{title:n,callback:i,dropdown:o});this.$toolbar.append(t("<li>").append(a))},addBtnFirst:function(e,n,i,o){if(this.opts.toolbar===!1)return!1;var a=this.buildButton(e,{title:n,callback:i,dropdown:o});this.$toolbar.prepend(t("<li>").append(a))},addBtnAfter:function(e,n,i,o,a){if(this.opts.toolbar===!1)return!1;var r=this.buildButton(n,{title:i,callback:o,dropdown:a}),s=this.getBtn(e);s.parent().after(t("<li>").append(r))},addBtnBefore:function(e,n,i,o,a){if(this.opts.toolbar===!1)return!1;var r=this.buildButton(n,{title:i,callback:o,dropdown:a}),s=this.getBtn(e);s.parent().before(t("<li>").append(r))},removeBtn:function(t,e){var n=this.getBtn(t);e===!0&&n.parent().next().remove(),n.parent().removeClass("redactor_btn_right"),n.remove()},getFragmentHtml:function(t){var e=t.cloneNode(!0),n=this.document.createElement("div");return n.appendChild(e),n.innerHTML},extractContent:function(){for(var t,e=this.$editor.get(0),n=this.document.createDocumentFragment();t=e.firstChild;)n.appendChild(t);return n},saveSelection:function(){this.$editor.focus(),this.savedSel=this.getOrigin(),this.savedSelObj=this.getFocus()},restoreSelection:function(){"undefined"!=typeof this.savedSel&&null!==this.savedSel&&null!==this.savedSelObj&&"BODY"!==this.savedSel[0].tagName?this.opts.iframe===!1&&0==t(this.savedSel[0]).closest(".redactor_editor").size()?this.$editor.focus():(this.browser("opera")&&this.$editor.focus(),this.setSelection(this.savedSel[0],this.savedSel[1],this.savedSelObj[0],this.savedSelObj[1]),this.browser("mozilla")&&this.$editor.focus()):this.$editor.focus()},getSelection:function(){var t=this.document;return this.window.getSelection?this.window.getSelection():t.getSelection?t.getSelection():t.selection.createRange()},hasSelection:function(){if(this.oldIE()){var t,e=this.$editor.get(0);return e.focus(),e.document.selection?(t=e.document.selection.createRange(),t&&t.parentElement().document===e.document):!1}var n;return(n=this.getSelection())&&null!=n.focusNode&&null!=n.anchorNode},getOrigin:function(){if(this.oldIE()){var t,e=this.$editor.get(0);return e.focus(),this.hasSelection()?(t=e.document.selection.createRange(),this._getBoundary(e.document,t,!0)):null}var n;return(n=this.getSelection())&&null!=n.anchorNode?[n.anchorNode,n.anchorOffset]:null},getFocus:function(){if(this.oldIE()){var t,e=this.$editor.get(0);return e.focus(),this.hasSelection()?(t=e.document.selection.createRange(),this._getBoundary(e.document,t,!1)):null}var n;return(n=this.getSelection())&&null!=n.focusNode?[n.focusNode,n.focusOffset]:null},setSelection:function(t,e,n,i){if(null==n&&(n=t),null==i&&(i=e),this.oldIE()){var o=this.$editor.get(0),a=o.document.body.createTextRange();return this._moveBoundary(o.document,a,!1,n,i),this._moveBoundary(o.document,a,!0,t,e),a.select()}var s=this.getSelection();if(s)if(s.collapse&&s.extend)s.collapse(t,e),s.extend(n,i);else{r=this.document.createRange(),r.setStart(t,e),r.setEnd(n,i);try{s.removeAllRanges()}catch(l){}s.addRange(r)}},getCurrentNode:function(){return"undefined"!=typeof this.window.getSelection?this.getSelectedNode().parentNode:"undefined"!=typeof this.document.selection?this.getSelection().parentElement():void 0},getParentNode:function(){return t(this.getCurrentNode()).parent()[0]},getSelectedNode:function(){if(this.oldIE())return this.getSelection().parentElement();if("undefined"!=typeof this.window.getSelection){var t=this.window.getSelection();return t.rangeCount>0?this.getSelection().getRangeAt(0).commonAncestorContainer:!1}return"undefined"!=typeof this.document.selection?this.getSelection():void 0},_getBoundary:function(t,e,n){var i,o,a,r,s;for(o=t.createElement("a"),i=e.duplicate(),i.collapse(n),s=i.parentElement();;)if(s.insertBefore(o,o.previousSibling),i.moveToElementText(o),!(i.compareEndPoints(n?"StartToStart":"StartToEnd",e)>0&&null!=o.previousSibling))break;return-1===i.compareEndPoints(n?"StartToStart":"StartToEnd",e)&&o.nextSibling?(i.setEndPoint(n?"EndToStart":"EndToEnd",e),a=o.nextSibling,r=i.text.length):(a=o.parentNode,r=this._getChildIndex(o)),o.parentNode.removeChild(o),[a,r]},_moveBoundary:function(t,e,n,i,o){var a,r,s,l,c;return c=0,a=this._isText(i)?i:i.childNodes[o],r=this._isText(i)?i.parentNode:i,this._isText(i)&&(c=o),l=t.createElement("a"),r.insertBefore(l,a||null),s=t.body.createTextRange(),s.moveToElementText(l),l.parentNode.removeChild(l),e.setEndPoint(n?"StartToStart":"EndToEnd",s),e[n?"moveStart":"moveEnd"]("character",c)},_isText:function(t){return null!=t?3==t.nodeType:!1},_getChildIndex:function(t){for(var e=0;t=t.previousSibling;)e++;return e},insertNodeAfterCaret:function(t){this.saveSelection(),this.insertNodeAtCaret(t),this.restoreSelection()},insertNodeAtCaret:function(t){if(this.window.getSelection){var e=this.getSelection();if(e.rangeCount){var n=e.getRangeAt(0);n.collapse(!1),n.insertNode(t),n=n.cloneRange(),n.selectNodeContents(t),n.collapse(!1),e.removeAllRanges(),e.addRange(n)}}else if(this.document.selection){var i=1===t.nodeType?t.outerHTML:t.data,o="marker_"+(""+Math.random()).slice(2);i+='<span id="'+o+'"></span>';var a=this.getSelection();a.collapse(!1),a.pasteHTML(i);var r=this.document.getElementById(o);a.moveToElementText(r),a.select(),r.parentNode.removeChild(r)}},getSelectedHtml:function(){var t="";if(this.window.getSelection){var e=this.window.getSelection();if(e.rangeCount){for(var n=this.document.createElement("div"),i=0,o=e.rangeCount;o>i;++i)n.appendChild(e.getRangeAt(i).cloneContents());t=n.innerHTML}}else this.document.selection&&"Text"===this.document.selection.type&&(t=this.document.selection.createRange().htmlText);return t},resizeImage:function(e){var n,i,o=!1,a=!1,r=t(e).width()/t(e).height(),s=10,l=10;t(e).off("hover mousedown mouseup click mousemove"),t(e).hover(function(){t(e).css("cursor","nw-resize")},function(){t(e).css("cursor",""),o=!1}),t(e).mousedown(function(s){s.preventDefault(),r=t(e).width()/t(e).height(),o=!0,a=!0,n=Math.round(s.pageX-t(e).eq(0).offset().left),i=Math.round(s.pageY-t(e).eq(0).offset().top)}),t(e).mouseup(t.proxy(function(){o=!1,t(e).css("cursor",""),this.syncCode()},this)),t(e).click(t.proxy(function(t){a&&this.imageEdit(t)},this)),t(e).mousemove(function(c){if(o){a=!1;var d=(Math.round(c.pageX-t(this).eq(0).offset().left)-n,Math.round(c.pageY-t(this).eq(0).offset().top)-i),h=t(e).height(),u=parseInt(h,10)+d,p=u*r;p>s&&t(e).width(p),u>l&&t(e).height(u),n=Math.round(c.pageX-t(this).eq(0).offset().left),i=Math.round(c.pageY-t(this).eq(0).offset().top)
}})},showTable:function(){this.saveSelection(),this.modalInit(RLANG.table,this.opts.modal_table,300,t.proxy(function(){t("#redactor_insert_table_btn").click(t.proxy(this.insertTable,this)),setTimeout(function(){t("#redactor_table_rows").focus()},200)},this))},insertTable:function(){for(var e=t("#redactor_table_rows").val(),n=t("#redactor_table_columns").val(),i=t("<div></div>"),o=Math.floor(99999*Math.random()),a=t('<table id="table'+o+'"><tbody></tbody></table>'),r=0;e>r;r++){for(var s=t("<tr></tr>"),l=0;n>l;l++){var c=t("<td><br></td>");t(s).append(c)}t(a).append(s)}t(i).append(a);var d=t(i).html()+"<p></p>";this.restoreSelection(),this.execCommand("inserthtml",d),this.modalClose(),this.observeTables()},tableObserver:function(e){this.$table=t(e.target).closest("table"),this.$table_tr=this.$table.find("tr"),this.$table_td=this.$table.find("td"),this.$tbody=t(e.target).closest("tbody"),this.$thead=t(this.$table).find("thead"),this.$current_td=t(e.target),this.$current_tr=t(e.target).closest("tr")},deleteTable:function(){t(this.$table).remove(),this.$table=!1,this.syncCode()},deleteRow:function(){t(this.$current_tr).remove(),this.syncCode()},deleteColumn:function(){var e=t(this.$current_td).get(0).cellIndex;t(this.$table).find("tr").each(function(){t(this).find("td").eq(e).remove()}),this.syncCode()},addHead:function(){if(0!==t(this.$table).find("thead").size())this.deleteHead();else{var e=t(this.$table).find("tr").first().clone();e.find("td").html("&nbsp;"),this.$thead=t("<thead></thead>"),this.$thead.append(e),t(this.$table).prepend(this.$thead),this.syncCode()}},deleteHead:function(){t(this.$thead).remove(),this.$thead=!1,this.syncCode()},insertRowAbove:function(){this.insertRow("before")},insertRowBelow:function(){this.insertRow("after")},insertColumnLeft:function(){this.insertColumn("before")},insertColumnRight:function(){this.insertColumn("after")},insertRow:function(e){var n=t(this.$current_tr).clone();n.find("td").html("&nbsp;"),"after"===e?t(this.$current_tr).after(n):t(this.$current_tr).before(n),this.syncCode()},insertColumn:function(e){var n=0;this.$current_tr.find("td").each(t.proxy(function(e,i){t(i)[0]===this.$current_td[0]&&(n=e)},this)),this.$table_tr.each(function(i,o){var a=t(o).find("td").eq(n),r=a.clone();r.html("&nbsp;"),"after"===e?t(a).after(r):t(a).before(r)}),this.syncCode()},showVideo:function(){this.saveSelection(),this.modalInit(RLANG.video,this.opts.modal_video,600,t.proxy(function(){t("#redactor_insert_video_btn").click(t.proxy(this.insertVideo,this)),setTimeout(function(){t("#redactor_insert_video_area").focus()},200)},this))},insertVideo:function(){var e=t("#redactor_insert_video_area").val();e=this.stripTags(e),this.restoreSelection(),this.execCommand("inserthtml",e),this.modalClose()},imageEdit:function(e){var n=t(e.target),i=n.parent(),o=t.proxy(function(){t("#redactor_file_alt").val(n.attr("alt")),t("#redactor_image_edit_src").attr("href",n.attr("src")),t("#redactor_form_image_align").val(n.css("float")),"A"===t(i).get(0).tagName&&t("#redactor_file_link").val(t(i).attr("href")),t("#redactor_image_delete_btn").click(t.proxy(function(){this.imageDelete(n)},this)),t("#redactorSaveBtn").click(t.proxy(function(){this.imageSave(n)},this))},this);this.modalInit(RLANG.image,this.opts.modal_image_edit,380,o)},imageDelete:function(e){t(e).remove(),this.modalClose(),this.syncCode()},imageSave:function(e){var n=t(e).parent();t(e).attr("alt",t("#redactor_file_alt").val());var i=t("#redactor_form_image_align").val();t(e).css("left"===i?{"float":"left",margin:"0 10px 10px 0"}:"right"===i?{"float":"right",margin:"0 0 10px 10px"}:{"float":"none",margin:"0"});var o=t.trim(t("#redactor_file_link").val());""!==o?"A"!==t(n).get(0).tagName?t(e).replaceWith('<a href="'+o+'">'+this.outerHTML(e)+"</a>"):t(n).attr("href",o):"A"===t(n).get(0).tagName&&t(n).replaceWith(this.outerHTML(e)),this.modalClose(),this.observeImages(),this.syncCode()},showImage:function(){this.saveSelection();var e=t.proxy(function(){if(this.opts.imageGetJson!==!1?t.getJSON(this.opts.imageGetJson,t.proxy(function(e){var n={},i=0;t.each(e,t.proxy(function(t,e){"undefined"!=typeof e.folder&&(i++,n[e.folder]=i)},this));var o=!1;if(t.each(e,t.proxy(function(e,i){var a="";"undefined"!=typeof i.title&&(a=i.title);var r=0;t.isEmptyObject(n)||"undefined"==typeof i.folder||(r=n[i.folder],o===!1&&(o=".redactorfolder"+r));var s=t('<img src="'+i.thumb+'" class="redactorfolder redactorfolder'+r+'" rel="'+i.image+'" title="'+a+'" />');t("#redactor_image_box").append(s),t(s).click(t.proxy(this.imageSetThumb,this))},this)),!t.isEmptyObject(n)){t(".redactorfolder").hide(),t(o).show();var a=function(e){t(".redactorfolder").hide(),t(".redactorfolder"+t(e.target).val()).show()},r=t('<select id="redactor_image_box_select">');t.each(n,function(e,n){r.append(t('<option value="'+n+'">'+e+"</option>"))}),t("#redactor_image_box").before(r),r.change(a)}},this)):t("#redactor_tabs a").eq(1).remove(),this.opts.imageUpload!==!1)this.opts.uploadCrossDomain===!1&&this.isMobile()===!1&&0!==t("#redactor_file").size()&&t("#redactor_file").dragupload({url:this.opts.imageUpload,uploadFields:this.opts.uploadFields,success:t.proxy(this.imageUploadCallback,this),error:t.proxy(this.opts.imageUploadErrorCallback,this)}),this.uploadInit("redactor_file",{auto:!0,url:this.opts.imageUpload,success:t.proxy(this.imageUploadCallback,this),error:t.proxy(this.opts.imageUploadErrorCallback,this)});else if(t(".redactor_tab").hide(),this.opts.imageGetJson===!1)t("#redactor_tabs").remove(),t("#redactor_tab3").show();else{var e=t("#redactor_tabs a");e.eq(0).remove(),e.eq(1).addClass("redactor_tabs_act"),t("#redactor_tab2").show()}t("#redactor_upload_btn").click(t.proxy(this.imageUploadCallbackLink,this)),this.opts.imageUpload===!1&&this.opts.imageGetJson===!1&&setTimeout(function(){t("#redactor_file_link").focus()},200)},this);this.modalInit(RLANG.image,this.opts.modal_image,610,e)},imageSetThumb:function(e){this._imageSet('<img src="'+t(e.target).attr("rel")+'" alt="'+t(e.target).attr("title")+'" />',!0)},imageUploadCallbackLink:function(){if(""!==t("#redactor_file_link").val()){var e='<img src="'+t("#redactor_file_link").val()+'" />';this._imageSet(e,!0)}else this.modalClose()},imageUploadCallback:function(t){this._imageSet(t)},_imageSet:function(t,e){if(this.restoreSelection(),t!==!1){var n="";n=e!==!0?'<p><img src="'+t.filelink+'" /></p>':t,this.execCommand("inserthtml",n),e!==!0&&"function"==typeof this.opts.imageUploadCallback&&this.opts.imageUploadCallback(this,t)}this.modalClose(),this.observeImages()},showLink:function(){this.saveSelection();var e=t.proxy(function(){this.insert_link_node=!1;var e=this.getSelection(),n="",i="",o="";if(this.browser("msie")){var a=this.getParentNode();"A"===a.nodeName?(this.insert_link_node=t(a),i=this.insert_link_node.text(),n=this.insert_link_node.attr("href"),o=this.insert_link_node.attr("target")):i=this.oldIE()?e.text:e.toString()}else e&&e.anchorNode&&"A"===e.anchorNode.parentNode.tagName?(n=e.anchorNode.parentNode.href,i=e.anchorNode.parentNode.text,o=e.anchorNode.parentNode.target,""===e.toString()&&(this.insert_link_node=e.anchorNode.parentNode)):i=e.toString();t(".redactor_link_text").val(i);var r=self.location.href.replace(/\/$/i,""),s=n.replace(r,"");0===n.search("mailto:")?(this.setModalTab(2),t("#redactor_tab_selected").val(2),t("#redactor_link_mailto").val(n.replace("mailto:",""))):0===s.search(/^#/gi)?(this.setModalTab(3),t("#redactor_tab_selected").val(3),t("#redactor_link_anchor").val(s.replace(/^#/gi,""))):t("#redactor_link_url").val(s),"_blank"===o&&t("#redactor_link_blank").attr("checked",!0),t("#redactor_insert_link_btn").click(t.proxy(this.insertLink,this)),setTimeout(function(){t("#redactor_link_url").focus()},200)},this);this.modalInit(RLANG.link,this.opts.modal_link,460,e)},insertLink:function(){var e=t("#redactor_tab_selected").val(),n="",i="",o="";if("1"===e){n=t("#redactor_link_url").val(),i=t("#redactor_link_url_text").val(),t("#redactor_link_blank").attr("checked")&&(o=' target="_blank"');var a="/(w+:{0,1}w*@)?(S+)(:[0-9]+)?(/|/([w#!:.?+=&%@!-/]))?/",r=new RegExp("^(http|ftp|https)://"+a,"i"),s=new RegExp("^"+a,"i");-1==n.search(r)&&0==n.search(s)&&this.opts.protocol!==!1&&(n=this.opts.protocol+n)}else"2"===e?(n="mailto:"+t("#redactor_link_mailto").val(),i=t("#redactor_link_mailto_text").val()):"3"===e&&(n="#"+t("#redactor_link_anchor").val(),i=t("#redactor_link_anchor_text").val());this._insertLink('<a href="'+n+'"'+o+">"+i+"</a>",t.trim(i),n,o)},_insertLink:function(e,n,i,o){this.$editor.focus(),this.restoreSelection(),""!==n&&(this.insert_link_node?(t(this.insert_link_node).text(n),t(this.insert_link_node).attr("href",i),""!==o?t(this.insert_link_node).attr("target",o):t(this.insert_link_node).removeAttr("target"),this.syncCode()):this.execCommand("inserthtml",e)),this.modalClose()},showFile:function(){this.saveSelection();var e=t.proxy(function(){var e=this.getSelection(),n="";n=this.oldIE()?e.text:e.toString(),t("#redactor_filename").val(n),this.opts.uploadCrossDomain===!1&&this.isMobile()===!1&&t("#redactor_file").dragupload({url:this.opts.fileUpload,uploadFields:this.opts.uploadFields,success:t.proxy(this.fileUploadCallback,this),error:t.proxy(this.opts.fileUploadErrorCallback,this)}),this.uploadInit("redactor_file",{auto:!0,url:this.opts.fileUpload,success:t.proxy(this.fileUploadCallback,this),error:t.proxy(this.opts.fileUploadErrorCallback,this)})},this);this.modalInit(RLANG.file,this.opts.modal_file,500,e)},fileUploadCallback:function(e){if(this.restoreSelection(),e!==!1){var n=t("#redactor_filename").val();""===n&&(n=e.filename);var i='<a href="'+e.filelink+'">'+n+"</a>";this.browser("webkit")&&this.window.chrome&&(i+="&nbsp;"),this.execCommand("inserthtml",i),"function"==typeof this.opts.fileUploadCallback&&this.opts.fileUploadCallback(this,e)}this.modalClose()},modalInit:function(e,n,i,o){if(0===t("#redactor_modal_overlay").size()&&(this.overlay=t('<div id="redactor_modal_overlay" style="display: none;"></div>'),t("body").prepend(this.overlay)),this.opts.overlay&&(t("#redactor_modal_overlay").show(),t("#redactor_modal_overlay").click(t.proxy(this.modalClose,this))),0===t("#redactor_modal").size()&&(this.modal=t('<div id="redactor_modal" style="display: none;"><div id="redactor_modal_close">&times;</div><div id="redactor_modal_header"></div><div id="redactor_modal_inner"></div></div>'),t("body").append(this.modal)),t("#redactor_modal_close").click(t.proxy(this.modalClose,this)),this.hdlModalClose=t.proxy(function(t){return 27===t.keyCode?(this.modalClose(),!1):void 0},this),t(document).keyup(this.hdlModalClose),this.$editor.keyup(this.hdlModalClose),t("#redactor_modal_inner").empty().append(0==n.indexOf("#")?t(n).html():n),t("#redactor_modal_header").html(e),"undefined"!=typeof t.fn.draggable&&(t("#redactor_modal").draggable({handle:"#redactor_modal_header"}),t("#redactor_modal_header").css("cursor","move")),0!==t("#redactor_tabs").size()){var a=this;t("#redactor_tabs a").each(function(e,n){e++,t(n).click(function(){if(t("#redactor_tabs a").removeClass("redactor_tabs_act"),t(this).addClass("redactor_tabs_act"),t(".redactor_tab").hide(),t("#redactor_tab"+e).show(),t("#redactor_tab_selected").val(e),a.isMobile()===!1){var n=t("#redactor_modal").outerHeight();t("#redactor_modal").css("margin-top","-"+(n+10)/2+"px")}})})}t("#redactor_modal .redactor_btn_modal_close").click(t.proxy(this.modalClose,this)),this.isMobile()===!1?(t("#redactor_modal").css({position:"fixed",top:"-2000px",left:"50%",width:i+"px",marginLeft:"-"+(i+60)/2+"px"}).show(),this.modalSaveBodyOveflow=t(document.body).css("overflow"),t(document.body).css("overflow","hidden")):t("#redactor_modal").css({position:"fixed",width:"100%",height:"100%",top:"0",left:"0",margin:"0",minHeight:"300px"}).show(),"function"==typeof o&&o(),this.isMobile()===!1&&setTimeout(function(){var e=t("#redactor_modal").outerHeight();t("#redactor_modal").css({top:"50%",height:"auto",minHeight:"auto",marginTop:"-"+(e+10)/2+"px"})},20)},modalClose:function(){return t("#redactor_modal_close").unbind("click",this.modalClose),t("#redactor_modal").fadeOut("fast",t.proxy(function(){t("#redactor_modal_inner").html(""),this.opts.overlay&&(t("#redactor_modal_overlay").hide(),t("#redactor_modal_overlay").unbind("click",this.modalClose)),t(document).unbind("keyup",this.hdlModalClose),this.$editor.unbind("keyup",this.hdlModalClose)},this)),this.isMobile()===!1&&t(document.body).css("overflow",this.modalSaveBodyOveflow?this.modalSaveBodyOveflow:"visible"),!1},setModalTab:function(e){t(".redactor_tab").hide();var n=t("#redactor_tabs a");n.removeClass("redactor_tabs_act"),n.eq(e-1).addClass("redactor_tabs_act"),t("#redactor_tab"+e).show()},uploadInit:function(e,n){this.uploadOptions={url:!1,success:!1,error:!1,start:!1,trigger:!1,auto:!1,input:!1},t.extend(this.uploadOptions,n),0!==t("#"+e).size()&&"INPUT"===t("#"+e).get(0).tagName?(this.uploadOptions.input=t("#"+e),this.element=t(t("#"+e).get(0).form)):this.element=t("#"+e),this.element_action=this.element.attr("action"),this.uploadOptions.auto?t(this.uploadOptions.input).change(t.proxy(function(){this.element.submit(function(){return!1}),this.uploadSubmit()},this)):this.uploadOptions.trigger&&t("#"+this.uploadOptions.trigger).click(t.proxy(this.uploadSubmit,this))},uploadSubmit:function(){this.uploadForm(this.element,this.uploadFrame())},uploadFrame:function(){this.id="f"+Math.floor(99999*Math.random());var e=this.document.createElement("div"),n='<iframe style="display:none" id="'+this.id+'" name="'+this.id+'"></iframe>';return e.innerHTML=n,t(e).appendTo("body"),this.uploadOptions.start&&this.uploadOptions.start(),t("#"+this.id).load(t.proxy(this.uploadLoaded,this)),this.id},uploadForm:function(e,n){if(this.uploadOptions.input){var i="redactorUploadForm"+this.id,o="redactorUploadFile"+this.id;this.form=t('<form  action="'+this.uploadOptions.url+'" method="POST" target="'+n+'" name="'+i+'" id="'+i+'" enctype="multipart/form-data"></form>'),this.opts.uploadFields!==!1&&"object"==typeof this.opts.uploadFields&&t.each(this.opts.uploadFields,t.proxy(function(e,n){0===n.toString().indexOf("#")&&(n=t(n).val());var i=t("<input/>",{type:"hidden",name:e,value:n});t(this.form).append(i)},this));var a=this.uploadOptions.input,r=t(a).clone();t(a).attr("id",o),t(a).before(r),t(a).appendTo(this.form),t(this.form).css("position","absolute"),t(this.form).css("top","-2000px"),t(this.form).css("left","-2000px"),t(this.form).appendTo("body"),this.form.submit()}else e.attr("target",n),e.attr("method","POST"),e.attr("enctype","multipart/form-data"),e.attr("action",this.uploadOptions.url),this.element.submit()},uploadLoaded:function(){var e,n=t("#"+this.id)[0];if(e=n.contentDocument?n.contentDocument:n.contentWindow?n.contentWindow.document:window.frames[this.id].document,this.uploadOptions.success)if("undefined"!=typeof e){var i=e.body.innerHTML,o=i.match(/\{(.|\n)*\}/)[0],a=t.parseJSON(o);"undefined"==typeof a.error?this.uploadOptions.success(a):(this.uploadOptions.error(this,a),this.modalClose())}else alert("Upload failed!"),this.modalClose();this.element.attr("action",this.element_action),this.element.attr("target","")},browser:function(t){var e=navigator.userAgent.toLowerCase(),n=/(chrome)[ \/]([\w.]+)/.exec(e)||/(webkit)[ \/]([\w.]+)/.exec(e)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(e)||/(msie) ([\w.]+)/.exec(e)||e.indexOf("compatible")<0&&/(mozilla)(?:.*? rv:([\w.]+)|)/.exec(e)||[];return"version"==t?n[2]:"webkit"==t?"chrome"==n[1]||"webkit"==n[1]:n[1]==t},oldIE:function(){return this.browser("msie")&&parseInt(this.browser("version"),10)<9?!0:!1},outerHTML:function(e){return t("<p>").append(t(e).eq(0).clone()).html()},normalize:function(t){return parseInt(t.replace("px",""),10)},isMobile:function(t){return t===!0&&/(iPhone|iPod|iPad|BlackBerry|Android)/.test(navigator.userAgent)?!0:/(iPhone|iPod|BlackBerry|Android)/.test(navigator.userAgent)?!0:!1}},t.fn.getObject=function(){return this.data("redactor")},t.fn.getEditor=function(){return this.data("redactor").$editor},t.fn.getCode=function(){return t.trim(this.data("redactor").getCode())},t.fn.getText=function(){return this.data("redactor").$editor.text()},t.fn.getSelected=function(){return this.data("redactor").getSelectedHtml()},t.fn.setCode=function(t){this.data("redactor").setCode(t)},t.fn.insertHtml=function(t){this.data("redactor").insertHtml(t)},t.fn.destroyEditor=function(){this.each(function(){"undefined"!=typeof t(this).data("redactor")&&(t(this).data("redactor").destroy(),t(this).removeData("redactor"))})},t.fn.setFocus=function(){this.data("redactor").$editor.focus()},t.fn.execCommand=function(t,e){this.data("redactor").execCommand(t,e)}}(jQuery),function(t){"use strict";function e(e,n){this.opts=t.extend({url:!1,success:!1,error:!1,preview:!1,uploadFields:!1,text:RLANG.drop_file_here,atext:RLANG.or_choose},n),this.$el=t(e)}t.fn.dragupload=function(t){return this.each(function(){var n=new e(this,t);n.init()})},e.prototype={init:function(){if(-1===navigator.userAgent.search("MSIE")){this.droparea=t('<div class="redactor_droparea"></div>'),this.dropareabox=t('<div class="redactor_dropareabox">'+this.opts.text+"</div>"),this.dropalternative=t('<div class="redactor_dropalternative">'+this.opts.atext+"</div>"),this.droparea.append(this.dropareabox),this.$el.before(this.droparea),this.$el.before(this.dropalternative),this.dropareabox.bind("dragover",t.proxy(function(){return this.ondrag()},this)),this.dropareabox.bind("dragleave",t.proxy(function(){return this.ondragleave()},this));var e=t.proxy(function(t){var e=parseInt(t.loaded/t.total*100,10);this.dropareabox.text("Loading "+e+"%")},this),n=jQuery.ajaxSettings.xhr();n.upload&&n.upload.addEventListener("progress",e,!1);var i=function(){return n};this.dropareabox.get(0).ondrop=t.proxy(function(e){e.preventDefault(),this.dropareabox.removeClass("hover").addClass("drop");var n=e.dataTransfer.files[0],o=new FormData;this.opts.uploadFields!==!1&&"object"==typeof this.opts.uploadFields&&t.each(this.opts.uploadFields,t.proxy(function(e,n){0===n.toString().indexOf("#")&&(n=t(n).val()),o.append(e,n)},this)),o.append("file",n),t.ajax({url:this.opts.url,dataType:"html",data:o,xhr:i,cache:!1,contentType:!1,processData:!1,type:"POST",success:t.proxy(function(e){var n=t.parseJSON(e);"undefined"==typeof n.error?this.opts.success(n):(this.opts.error(this,n),this.opts.success(!1))},this)})},this)}},ondrag:function(){return this.dropareabox.addClass("hover"),!1},ondragleave:function(){return this.dropareabox.removeClass("hover"),!1}}}(jQuery),function(t){"use strict";var e="http://",n=/(^|&lt;|\s)(www\..+?\..+?)(\s|&gt;|$)/g,i=/(^|&lt;|\s)(((https?|ftp):\/\/|mailto:).+?)(\s|&gt;|$)/g,o=function(){for(var a=this.childNodes,r=a.length;r--;){var s=a[r];if(3===s.nodeType){var l=s.nodeValue;l&&(l=l.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(n,'$1<a href="'+e+'$2">$2</a>$3').replace(i,'$1<a href="$2">$2</a>$5'),t(s).after(l).remove())}else 1!==s.nodeType||/^(a|button|textarea)$/i.test(s.tagName)||o.call(s)}};t.fn.linkify=function(){this.each(o)}}(jQuery),eval(function(t,e,n,i,o,a){if(o=function(t){return(e>t?"":o(parseInt(t/e)))+((t%=e)>35?String.fromCharCode(t+29):t.toString(36))},!"".replace(/^/,String)){for(;n--;)a[o(n)]=i[n]||o(n);i=[function(t){return a[t]}],o=function(){return"\\w+"},n=1}for(;n--;)i[n]&&(t=t.replace(new RegExp("\\b"+o(n)+"\\b","g"),i[n]));return t}('(5($){$.1.4.7={t:5(0,v){$(2).0("8",c);$(2).0("r",0);$(2).l(\'g\',$.1.4.7.b)},u:5(0){$(2).w(\'g\',$.1.4.7.b)},b:5(1){9 0=$(2).0("r");9 3=$.1.4.7.f(0).h();6(3!=\'\'){$(2).0("8",x);1.j="7";1.3=3;$.1.i.m(2,k)}},f:5(0){9 3=\'\';6(q.e){3=q.e()}o 6(d.e){3=d.e()}o 6(d.p){3=d.p.B().3}A 3}};$.1.4.a={t:5(0,v){$(2).0("n",0);$(2).0("8",c);$(2).l(\'g\',$.1.4.a.b);$(2).l(\'D\',$.1.4.a.s)},u:5(0){$(2).w(\'g\',$.1.4.a.b)},b:5(1){6($(2).0("8")){9 0=$(2).0("n");9 3=$.1.4.7.f(0).h();6(3==\'\'){$(2).0("8",c);1.j="a";$.1.i.m(2,k)}}},s:5(1){6($(2).0("8")){9 0=$(2).0("n");9 3=$.1.4.7.f(0).h();6((1.y=z)&&(3==\'\')){$(2).0("8",c);1.j="a";$.1.i.m(2,k)}}}}})(C);',40,40,"data|event|this|text|special|function|if|textselect|textselected|var|textunselect|handler|false|rdocument|getSelection|getSelectedText|mouseup|toString|handle|type|arguments|bind|apply|rttt|else|selection|rwindow|ttt|handlerKey|setup|teardown|namespaces|unbind|true|keyCode|27|return|createRange|jQuery|keyup".split("|"),0,{})),function(){function t(t){var e,n,i,o,a,r,s,l=new Array,c=0,d=t.rows.length;for(i=0;d>i;){for(var e=t.rows[i],o=0,a=0;o<e.cells.length||a<l.length;)if(l[a])l[a++]--;else if(o>=e.cells.length)a++;else for(n=e.cells[o++],s=Math.max(1,parseInt(n.rowSpan)),r=Math.max(1,parseInt(n.colSpan));r>0&&!l[a];r--)l[a++]=s-1;c=Math.max(a,c),i++}return c}function e(e,i,o,a,r,s){var l,c,d,h,u,p,f,g,m=[],v=[],b=e.rows.length,y=t(e),w=[];if(i>0)for(d=o;o+i>d;d++)e.insertRow(d);for(d=0;b>d;){for(var l=e.rows[d],h=0,u=0;y>u;){if(a>0&&u===r)for(p=0;a>p;p++)w.push(n(l,h++,s.placeHolder));if(m[u])if(0>i&&d===o-i&&v[u]&&1==v[u].rowSpan)for(c=v[u],h>=l.cells.length?l.appendChild(c):l.insertBefore(c,l.cells[h]),h++,g=c.rowSpan=m[u],f=Math.max(1,parseInt(c.colSpan));f>0;--f)m[u++]=g-1;else for(0===--m[u++]&&(v[u]=null);m[u]&&!v[u];)--m[u++];else{h>=l.cells.length&&w.push(n(l,h,s.placeHolder)),c=l.cells[h++],g=Math.max(1,parseInt(c.rowSpan)),g>1&&(v[u]=c,0>i&&d>=o&&o-i>d&&(c.rowSpan=1));var C=u;for(f=Math.max(1,parseInt(c.colSpan));f>0;--f){if(m[u]){c.colSpan-=f;break}m[u++]=g-1}if(0>i&&d>=o&&o-i>d);else if(a>0&&u>r&&r>C)c.colSpan+=a;else if(0>a&&r-a>C&&u>r){var x=Math.max(0,r-C)+Math.max(0,u-(r-a));x?c.colSpan=x:l.deleteCell(--h)}}}if(a>0&&u===r)for(p=0;a>p;p++)w.push(n(l,h++,s.placeHolder));if(d++,i>0&&d===o)for(p=0;y>p;p++)m[p]&&(m[p]+=i),v[p]&&(v[p].rowSpan+=i);else if(0>i&&d===o)for(p=0;p<v.length;p++)v[p]&&(v[p].rowSpan-=Math.min(-i,m[p]))}if(0>i)for(d=o;o-i>d;d++)e.deleteRow(d);return w}function n(t,e,n){var i,o;if(e>0?i=t.cells[e-1]:e<t.cells.length&&(i=t.cells[e+1]),o=t.insertCell(e),i&&"TH"===i.tagName){var a=document.createElement("th");n&&(a.innerHTML=n),pi(o).replaceWith(a)}else n&&(o.innerHTML=n);return o}function o(){this.Diff_Timeout=1,this.Diff_EditCost=4,this.Match_Threshold=.5,this.Match_Distance=1e3,this.Patch_DeleteThreshold=.5,this.Patch_Margin=4,this.Match_MaxBits=32}function a(t,e,n){li[t]=n,ci[t]=e}function r(t,e,n){if("undefined"==typeof li[t])a(t,e,n);else{n=n||e;for(var i in n)li[t][i]=n[i]}}function s(t){ri!==t&&(ri=t,yi.eachInstance(function(){this.localeChange()}))}function l(t,e){if("undefined"!=typeof li[ri]&&"undefined"!=typeof li[ri][t])return li[ri][t];if("undefined"!=typeof li[si]&&"undefined"!=typeof li[si][t])return li[si][t];for(var n in ci)if("undefined"!=typeof li[n][t])return li[n][t];return e?!1:t}function c(t,e){if(!ri){var n=yi.persist("locale");n&&(ri=n)}if(ri||(ri="en"),t=l(t,e===!1),t===!1)return!1;if(e){for(var i in e)t=t.replace("{{"+i+"}}",e[i]);return t}return t}function d(t){if(!t||!t.id){var e;do e="ruid-"+Math.random().toString().replace(".","");while(document.getElementById(e));if(!t)return e;t.id=e}return t.id}function h(t,e){try{if(localStorage){var n;return n=localStorage.raptor?JSON.parse(localStorage.raptor):{},n[t]=e,localStorage.raptor=JSON.stringify(n),!0}}catch(i){}return!1}function u(t,e){try{if(localStorage){var n;return n=localStorage.raptor?JSON.parse(localStorage.raptor):{},n[t]}}catch(i){}return e}function p(t){for(var e in t)this[e]=t[e]}function f(t){var e=!1;for(var n in di)"function"==typeof di[n]?di[n]()&&(e=!0):di[n]&&(e=!0);if(e){var i="There are unsaved changes on this page. Are you sure you wish to navigate away?";return(t||window.event).returnValue=i,i}}function g(t){return t.charAt(0).toUpperCase()+t.slice(1)}function m(t,e){return t.replace(/([A-Z])/g,function(t){return(e||"-")+t.toLowerCase()})}function v(t,e){var n=t.toLowerCase().replace(/[^a-z0-9](.)/gi,function(t,e){return e.toUpperCase()});return e!==!1&&(n=g(n)),n}function b(t){return hi[t]}function y(t,e){return t=t.replace(/tr\(['"]{1}(.*?)['"]{1}\)/g,function(t,e){return e=e.replace(/\\(.?)/g,function(t,e){switch(e){case"\\":return"\\";case"0":return"\x00";case"":return"";default:return e}}),c(e)}),e=pi.extend({},this.options,e||{}),e=w(e),t=t.replace(/\{\{(.*?)\}\}/g,function(t,n){return e[n]})}function w(t,e,n){e=e?e+".":"";var i=5;n||(n=1);var o={};for(var a in t)if("object"==typeof t[a]&&i>n){var r=w(t[a],e+a,++n);for(var s in r)o[s]=r[s]}else o[e+a]=t[a];return o}function C(t){return!isNaN(t-0)&&null!==t}function x(t){return t instanceof Array}function _(t){return t instanceof jQuery}function T(t,e,n){return S(t,e),t=Le(e),n(),rangy.getSelection().removeAllRanges(),t}function S(t,e){if(t){var n=$e(e,t);return n.ranges&&rangy.getSelection().setRanges(n.ranges),n.element}return e}function k(t){t()}function E(t,e){for(i=0;i<e.length;i++)pi.trim(t.attr(e[i]))||t.removeAttr(e[i]),t.find("["+e[i]+"]").filter(function(){return""===pi.trim(pi(this).attr(e[i]))}).removeAttr(e[i])}function R(t,e){var n;do n=!1,t.find(e.join(",")).each(function(){var t=pi(this).html().replace("&nbsp;"," ").trim();""===t&&(pi(this).remove(),n=!0)});while(n);return t}function N(t,e){for(var n=X(t),i=0,o=n.length;o>i;i++){var a=n[i].cloneNode(),r=document.createElement(e);r.appendChild(a),t.insertBefore(r,n[i]),t.removeChild(n[i])}}function D(t,e){for(var n=0;n<e.length;n++)t.find("["+e[n]+"]").removeAttr(e[n])}function A(t,e){t.find(e.join(",")).contents().unwrap()}function O(t){pi(t).find(".rangySelectionBoundary").remove()}function I(t,e){var n,i=pi("<div>").addClass("spacer");"top"===e.position?(n={position:"fixed",top:e.under?pi(e.under).outerHeight():0,left:0,right:0},e.spacer&&(e.under?i.insertAfter(e.under):i.prependTo("body"))):"topLeft"===e.position?(n={position:"fixed",top:e.under?pi(e.under).outerHeight():0,left:0},e.spacer&&(e.under?i.insertAfter(e.under):i.prependTo("body"))):"topRight"===e.position?(n={position:"fixed",top:e.under?pi(e.under).outerHeight():0,right:0},e.spacer&&(e.under?i.insertAfter(e.under):i.prependTo("body"))):"bottom"===e.position?(n={position:"fixed",bottom:0,left:0,right:0},e.spacer&&i.appendTo("body")):"bottomLeft"===e.position?(n={position:"fixed",bottom:0,left:0},e.spacer&&i.appendTo("body")):"bottomRight"===e.position&&(n={position:"fixed",bottom:0,right:0},e.spacer&&i.appendTo("body"));var o=He(t,n);return i.css("height",t.outerHeight()),setTimeout(function(){i.css("height",t.outerHeight())},300),{dockedElement:t,spacer:i,styleState:o}}function P(t){return Ue(t.dockedElement,t.styleState),t.spacer.remove(),t.dockedElement.detach()}function M(t,e,n){var i=e.wrap("<div>").parent(),o=je(i,e,{"float":"none",display:"block",clear:"none",position:"static",margin:0,marginLeft:0,marginRight:0,marginTop:0,marginBottom:0,padding:0,paddingLeft:0,paddingRight:0,paddingTop:0,paddingBottom:0,outline:0,width:"auto",border:"none"}),a=He(t,{position:"static"});return i.prepend(t).addClass(n.wrapperClass?n.wrapperClass:""),{dockedElement:t,dockedTo:e,innerStyleState:o,dockedElementStyleState:a}}function L(t){Ue(t.dockedTo,t.innerStyleState),Ue(t.dockedElement,t.dockedElementStyleState);var e=t.dockedElement.detach();return t.dockedTo.unwrap(),e}function $(t){var e=1;t.siblings().each(function(){var t=pi(this).css("z-index");!isNaN(t)&&t>e&&(e=t+1)}),t.css("z-index",e)}function B(t){return t.clone().wrap("<div/>").parent().html()}function F(t){t=pi(t);var e={top:Math.round(t.offset().top),left:Math.round(t.offset().left),width:Math.round(t.outerWidth()),height:Math.round(t.outerHeight())},n=pi(window).scrollTop(),i=pi(window).height(),o=n+i,a=Math.round(e.height+e.top);return n<e.top&&o>a?e:(n>e.top&&(e.top=n),e.height=a>o?o-e.top:i-(o-a),e)}function H(t){for(var e={},n=window.getComputedStyle(t[0],null),i=0;i<n.length;i++)e[n.item(i)]=n.getPropertyValue(n.item(i));return e}function U(t,e){var n=new jQuery;le();for(var i=0,o=t.length;o>i;i++){var a=pi("<"+e+"/>").html(pi(t[i]).html());t.html(a),n.push(a[0])}return ce(),n}function z(t){return t.is("img")||t.find("img").length?!1:/&nbsp;/.test(t.html())?!1:""===t.text()}function W(t,e){var n=pi(e).offset(),i=pi(e).outerHeight();pi(t).css({top:n.top+i-pi(window).scrollTop()+"px",left:n.left+"px"})}function G(t,e){for(;t.length>0&&t[0]!==e[0]&&(t[0].nodeType===Node.TEXT_NODE||"inline"===t.css("display"));)t=t.parent();return t[0]===e[0]?null:t}function q(){for(var t="ruid-"+(new Date).getTime()+"-"+Math.floor(1e5*Math.random());pi("#"+t).length;)t="ruid-"+(new Date).getTime()+"-"+Math.floor(1e5*Math.random());return t}function V(t,e){for(var n=[],i=t.length-1;i>=0;i--){var o=document.createElement(e);o.innerHTML=t[i].innerHTML,pi.each(t[i].attributes,function(){pi(o).attr(this.name,this.value)}),pi(t[i]).after(o).remove(),n[i]=o}return pi(n)}function Y(t,e){if(t.outerHeight()>e.outerHeight()-20){var n=F(e),i=e.offset();t.css({position:"absolute",top:i.top-t.outerHeight(),left:n.left+(n.width/2-t.outerWidth()/2)})}else{var n=F(e);t.css({position:"absolute",top:n.top+(n.height/2-t.outerHeight()/2),left:n.left+(n.width/2-t.outerWidth()/2)})}}function J(t,e){for(var n="",i=0,o=t.childNodes.length;o>i;i++){var a=t.childNodes.item(i),r=a.nodeType===Node.TEXT_NODE?a.nodeValue:B(pi(a));r&&(n+=r)}return e&&(n=pi("<"+e+">"+n+"</"+e+">"),n.find("p").wrapInner("<"+e+"/>"),n.find("p > *").unwrap(),n=pi("<div/>").html(n).html()),n}function Q(t){for(;t.nodeType===Node.TEXT_NODE;)t=t.parentNode;return t}function X(t){for(var e=[],n=/^\s*$/,i=0,o=t.childNodes.length;o>i;i++)t.childNodes[i].nodeType==Node.TEXT_NODE&&(n.test(t.childNodes[i].nodeValue)||e.push(t.childNodes[i]));return e}function K(t,e){for(var n=t.parentNode;null!=n;){if(n==e)return!0;n=n.parentNode}return!1}function h(t,e){if(localStorage){var n;n=localStorage.raptor?JSON.parse(localStorage.raptor):{},n[t]=e,localStorage.raptor=JSON.stringify(n)}}function u(t){if(localStorage){var e;return e=localStorage.raptor?JSON.parse(localStorage.raptor):{},e[t]}}function Z(t,e){t.selectNodeContents(pi(e).get(0))}function te(t,e){var n=[],i=pi("<div/>").append(e)[0].childNodes;return t.deleteContents(),void 0===i.length||1===i.length?t.insertNode(i[0].cloneNode(!0)):pi.each(i,function(e,i){n.unshift(i.cloneNode(!0)),t.insertNodeAtEnd(n[0])}),n}function ee(t){var e=re(t);return"string"==typeof e&&(e=e.replace(/([ #;&,.+*~\':"!^$[\]()=>|\/@])/g,"\\$1")),Fe(e)}function ne(t){return Q(t.commonAncestorContainer)}function ie(t){if(t.startContainer.data)for(;/\s/.test(t.startContainer.data.substr(t.startOffset,1));)t.setStart(t.startContainer,t.startOffset+1);if(t.endContainer.data)for(;t.endOffset>0&&/\s/.test(t.endContainer.data.substr(t.endOffset-1,1));)t.setEnd(t.endContainer,t.endOffset-1)}function oe(t,e){return rangy.serializeRange(t,!0,e)}function ae(t,e){for(var n=t.split("|"),i=[],o=0,a=n.length;a>o;o++)i[o]=rangy.deserializeRange(n[o],e);return i}function re(t){return J(t.cloneContents())}function se(){var t=rangy.getSelection();return t.rangeCount>0?t.getRangeAt(0):null}function le(t){(!ui||t)&&(ui=rangy.saveSelection())}function ce(){ui&&(rangy.restoreSelection(ui),ui=!1)}function de(){ui&&rangy.removeMarkers(ui),ui=!1}function he(t,e,n){e=e||rangy.getSelection();for(var i,o=0;i=e.getAllRanges()[o++];)t.call(n,i)}function ue(t){rangy.getSelection().setSingleRange(t)}function pe(t,e){var n=[];return he(function(e){n=n.concat(te(e,t))},e,this),n}function fe(t,e){e=e||rangy.getSelection();var n=rangy.createRange();n.selectNodeContents(t),e.setSingleRange(n)}function ge(t){var e=rangy.createRange();e.selectNode(t),rangy.getSelection().setSingleRange(e)}function me(t,e,n){e=e||rangy.getSelection(),e.removeAllRanges(),pi(t).each(function(){var t=rangy.createRange();t.selectNodeContents(this),t.collapse(n),e.addRange(t)})}function ve(t,e){me(t,e,!0)}function be(t){return t=t||rangy.getSelection(),t.toHtml()}function ye(t,e){if(e=e||rangy.getSelection(),!_e())return new jQuery;var n,t=Te();return n=t.commonAncestorContainer.nodeType===Node.TEXT_NODE?t.commonAncestorContainer.parentNode:t.commonAncestorContainer,pi(n)
}function we(t){var e=new jQuery;return he(function(t){e.push(ye(t)[0])},t,this),e}function Ce(){return""===rangy.getSelection().toHtml()}function xe(t,e){e=e||{};var n=rangy.createCssClassApplier(e.classes||"",{normalize:!0,elementTagName:t,elementProperties:e.attributes||{}});he(function(i){if(ee(i)){var o=pi("<"+t+"/>").addClass(e.classes).attr(e.attributes||{}).append(J(i.cloneContents()));te(i,o)}else n.toggleRange(i)},null,this)}function _e(){return 0!==rangy.getSelection().rangeCount}function Te(){return rangy.getSelection().getRangeAt(0)}function Se(t,e,n){he(function(i){var o,a=G(pi(i.startContainer),e),r=G(pi(i.endContainer),e);if(a&&r){a.is(r)?o=a:a&&r&&(o=a.nextUntil(r).andSelf().add(r));for(var s=0,l=o.length;l>s;s++)t(o[s])}else t(U(e,n).get(0))})}function ke(t,e,n,i){var o=!1,a=new jQuery;Se(function(e){if(a.push(e),!o)for(var n=0,i=t.length;i>n;n++)pi(e).hasClass(t[n])||(o=!0)},n,i),pi(a).removeClass(e.join(" ")),o?pi(a).addClass(t.join(" ")):pi(a).removeClass(t.join(" "))}function Ee(t,e){e=e||rangy.getSelection();for(var n=e.getAllRanges(),i=[],o=0,a=n.length;a>o;o++){var r=n[o].cloneRange();n[o].startContainer===t||K(n[o].startContainer,t)||r.setStart(t,0),n[o].endContainer===t||K(n[o].endContainer,t)||r.setEnd(t,t.childNodes.length),i.push(r)}e.setRanges(i)}function Re(t,e){if(t=t||document.body,e=e||rangy.getSelection(),_e()){var n=Te().cloneRange(),i=n.extractContents();""===J(i)&&(Z(n,n.commonAncestorContainer),e.setSingleRange(n),i=n.extractContents()),i=pi("<div/>").append(J(i)).html().replace(/(<\/?.*?>)/gi,function(t){return null!==t.match(/^<(img|object|param|embed|iframe)/)?t:""});for(var o=n.commonAncestorContainer;o&&o.parentNode!==t;)o=o.parentNode;if(o){n.setEndAfter(o);var a=n.extractContents();n.collapseAfter(o),n.insertNode(a),n.collapseAfter(o)}i=pi.parseHTML(i),null!==i&&pi(i.reverse()).each(function(){return pi(this).is("img")?void n.insertNode(pi(this).removeAttr("width height class style").get(0)):void n.insertNode(this)})}}function Ne(t,e,n,i){le();var o="domTools"+Math.ceil(1e7*Math.random());he(function(t){var a=rangy.createCssClassApplier(i,{elementTagName:n});a.isAppliedToRange(t)?a.toggleSelection():rangy.createCssClassApplier(e,{elementTagName:o}).toggleSelection()},null,this),pi(o).each(function(){pi(this).replaceWith(pi("<"+t+"/>").addClass(e).html(pi(this).html()))}),ce()}function De(){var t=window.getSelection(),e=t.getRangeAt(0);if(e&&e.startContainer===e.endContainer&&e.startOffset===e.endOffset){for(var n=e.startOffset,i=e.startOffset;e.startContainer.data[n-1]&&!e.startContainer.data[n-1].match(/\s/);)n--;for(;e.startContainer.data[i]&&!e.startContainer.data[i].match(/\s/);)i++;e.setStart(e.startContainer,n),e.setEnd(e.startContainer,i),t.removeAllRanges(),t.addRange(e)}}function Ae(t,e,n){for(var i=rangy.getSelection().getAllRanges(),o=0,a=i.length;a>o;o++){var r=pi(Q(i[o].startContainer));(n||!r.is(t)&&!r.is(e))&&(r=r.parentsUntil(e,t)),r=n?r.last():r.first(),1!==r.length||r.is(e)||i[o].setStart(r[0],0),r=pi(Q(i[o].endContainer)),(n||!r.is(t)&&!r.is(e))&&(r=r.parentsUntil(e,t)),r=n?r.last():r.first(),1!==r.length||r.is(e)||i[o].setEnd(r[0],r[0].childNodes.length)}rangy.getSelection().setRanges(i)}function Oe(){if(_e()){var t=Te();ie(t),ue(t)}}function Ie(t,e){var n=new jQuery;return he(function(i){for(var o=i.startContainer;o.nodeType===Node.TEXT_NODE;)o=o.parentNode;for(var a=i.endContainer;a.nodeType===Node.TEXT_NODE;)a=a.parentNode;var r=function(){e.is(this)||n.push(this)};do{if(pi(o).filter(t).each(r),e.is(o)||0!==n.length||pi(o).parentsUntil(e,t).each(r),pi(o).find(t).each(r),pi(a).is(o))break;o=pi(o).next()}while(o.length>0&&0===pi(o).prevAll().has(a).length)}),n}function Pe(t,e,n){var i=Ie(e.join(","),n);if(i.length)le(),V(i,t),ce();else{var o=n.get(0);o.innerHTML.trim()?(le(),o.innerHTML="<"+t+">"+o.innerHTML+"</"+t+">",ce()):(o.innerHTML="<"+t+">&nbsp;</"+t+">",fe(o.childNodes[0]))}}function Me(t,e){var n=!0;return he(function(i){var o=pi(i.commonAncestorContainer).find("*");0!==pi(i.commonAncestorContainer).parentsUntil(e,t).length||0!==o.length&&o.length===o.filter(t).length||(n=!1)}),n}function Le(t){var e=se();return{element:t.clone(!0),ranges:e?oe(e,t.get(0)):null}}function $e(t,e){t.replaceWith(e.element);var n=null;try{e.ranges&&(n=ae(e.ranges,e.element.get(0)))}catch(i){}return{element:e.element,ranges:n}}function Be(t,e){allowed=[];for(var n=0;n<e.length;n++)e[n].match(/[a-z][a-z0-9]{0,}/g)&&allowed.push(e[n]);var i=/<\/?([a-z][a-z0-9]*)\b[^>]*\/?>/gi,o=/<!--[\s\S]*?-->|<\?(?:php)?[\s\S]*?\?>/gi;return t.replace(o,"").replace(i,function(t,e){return allowed.indexOf(e.toLowerCase())>-1?t:""})}function Fe(t){return pi(pi.parseHTML(t)).is(":empty")}function He(t,e){var n=t.get(0),i={};for(var o in e)i[o]=n.style[o];for(o in e)t.css(o,e[o]);return i}function je(t,e,n){var i=e.get(0),o={};for(var a in n)o[a]=i.style[a];for(a in n)t.css(a,e.css(a)),e.css(a,n[a]);return o}function Ue(t,e){for(var n in e)t.css(n,e[n]||"")}function ze(t,e,n){n=n||{};for(var i=document.createElement("table");e--;)for(var o=i.insertRow(0),a=0;t>a;a++){var r=o.insertCell(0);n.placeHolder&&(r.innerHTML=n.placeHolder)}return i}function We(t,n,i){return e(t,0,0,1,n,i||{})}function Ge(t,n){e(t,0,0,-1,n)}function qe(t,e,n){var i=new GoogTable(t);return i.insertRow(e,n)}function Ve(t,n){e(t,-1,n,0,0)}function Ye(t){for(var e,n,i,o,a=[],r=t.parentNode.parentNode.parentNode.tBodies[0].rows,s=0;s<r.length;s++){n=r[s].sectionRowIndex,n=s;for(var l=0;l<r[s].cells.length;l++){for(e=l;a[n]&&a[n][e];)e++;for(i=e;i<e+(r[s].cells[l].colSpan||1);++i)for(o=n;o<n+(r[s].cells[l].rowSpan||1);++o)a[o]||(a[o]=[]),a[o][i]=!0;if(t===r[s].cells[l])return{x:e,y:n}}}}function Je(t,e){for(var n=t.tBodies[0].rows,i=0;i<n.length;i++)for(var o=0;o<n[i].cells.length;o++){var a=Ye(n[i].cells[o]);if(a.x===e.x&&a.y===e.y)return n[i].cells[o]}return null}function Qe(t,e,n){for(var i=Math.min(e.x,n.x),o=i,a=Math.min(e.y,n.y),r=Math.max(e.x,n.x),s=Math.max(e.y,n.y),l=[];s>=a;){for(;r>=o;){var c=Je(t,{x:o,y:a});null!==c&&l.push(c),o++}o=i,a++}return l}function Xe(t){for(var e=0,n=t.rows.length;n>e;e++)if(t.rows[e].cells.length>0)return!1;return!0}function Ke(t,e){return pi(t).button(e)}function Ze(t,e){return pi(t).button("option","text",!0),pi(t).button("option","label",e)}function tn(t,e){return pi(t).button("option","icons",{primary:e})}function en(t){return pi(t).button("option","disabled",!1)}function nn(t){return!pi(t).is(".ui-state-disabled")}function on(t){return pi(t).button("option","disabled",!0)}function an(t){return pi(t).addClass("ui-state-highlight")}function rn(t){return pi(t).removeClass("ui-state-highlight")}function sn(t,e){return pi(t).menu(e)}function ln(t,e){e.dialogClass="undefined"!=typeof e.dialogClass?e.dialogClass+" ui-dialog-fixed":"ui-dialog-fixed";var n=pi(t).dialog(e);return n.parent().css({top:(parseInt(n.parent().css("top"))||0)-pi(window).scrollTop()}),n.dialog("option","position","center"),n}function cn(t){return pi(t).dialog("open")}function dn(t){return pi(t).dialog("close")}function hn(t,e){return pi(t).tabs(e)}function un(t){"success"==t.type&&(t.state="confirmation"),pi.pnotify(pi.extend({type:"success",styling:"jqueryui",history:!1},t))}function pn(){if(void 0===fi){fi=!0,gi=/(iPhone|iPod|iPad).*AppleWebKit/i.test(navigator.userAgent),gi&&(pi("html").addClass("raptor-ios"),gi&&pi(document).on("scroll",function(){setInterval(function(){pi("body").css("height","+=1").css("height","-=1")},0)})),vi=/Firefox/i.test(navigator.userAgent),vi&&pi("html").addClass("raptor-ff");var t=function(){var t=-1;return-1!=navigator.appVersion.indexOf("MSIE")&&(t=parseFloat(navigator.appVersion.split("MSIE")[1])),t}();bi=-1!==t,bi&&9>t&&(fi=!1,pi(function(){var t=pi("<div/>").addClass("raptor-unsupported").html('<div class="raptor-unsupported-overlay"></div><div class="raptor-unsupported-content">    It has been detected that you a using a browser that is not supported by Raptor, please    use one of the following browsers:    <ul>        <li><a href="http://www.google.com/chrome">Google Chrome</a></li>        <li><a href="http://www.firefox.com">Mozilla Firefox</a></li>        <li><a href="http://windows.microsoft.com/ie">Internet Explorer</a></li>    </ul>    <div class="raptor-unsupported-input">        <button class="raptor-unsupported-close">Close</button>        <input name="raptor-unsupported-show" type="checkbox" />        <label>Don\'t show this message again</label>    </div><div>').appendTo("body"),e=function(t){var e=1;t.siblings().each(function(){var t=pi(this).css("z-index");!isNaN(t)&&t>e&&(e=t+1)}),t.css("z-index",e)};e(t),t.find(".raptor-unsupported-close").click(function(){t.remove()})})),mi=void 0!==jQuery.hotkeys}return fi}function fn(t){this.name=t}function gn(t,e){this.name=t;for(var n in e)this[n]=e[n]}function mn(t,e){this.raptor=t,this.uiOrder=e}function vn(){fn.call(this,"toolbar"),this.wrapper=null}function bn(){fn.call(this,"hoverPanel"),this.hoverPanel=null,this.visible=!1}function yn(){fn.call(this,"elementHoverPanel"),this.elements="img",this.hoverPanel=null,this.visible=!1,this.target=null,this.enabled=!0}function wn(t){this.text=!1,this.label=null,this.icon=null,this.hotkey=null;for(var e in t)this[e]=t[e]}function Cn(t){this.preview=!0,this.previewing=!1,this.previewTimeout=500,this.previewTimer=null,wn.call(this,t)}function xn(t){this.disable=!1,wn.call(this,t)}function _n(t){Cn.call(this,t)}function Tn(t){wn.call(this,t)}function Sn(t){_n.call(this,t)}function kn(t){this.state=null,wn.call(this,t)}function En(t){kn.call(this,t),xn.call(this,t)}function Rn(t,e){this.menu=t,this.name=t.name,this.raptor=t.raptor,this.options=t.options,wn.call(this,e)}function Nn(t){this.menu=null,this.menuContent="",this.button=null;for(var e in t)this[e]=t[e]}function Dn(t){Nn.call(this,t)}function An(){Dn.call(this,{name:"classMenu"})}function On(){this.options={colors:{white:"#ffffff",black:"#000000",grey:"#999",blue:"#4f81bd",red:"#c0504d",green:"#9bbb59",purple:"#8064a2",orange:"#f79646"}},this.currentColor="automatic",Dn.call(this,{name:"colorMenuBasic"})}function In(t,e){this.options={dockToElement:!1,docked:!1,position:"top",spacer:!0,persist:!0,dockTo:null},this.dockState=!1,this.marker=!1,gn.call(this,t||"dock",e)}function Pn(){this.options={fonts:["arial","palatino","georgia","times","comic-sans","impact","courier"]},Dn.call(this,{name:"fontFamilyMenu"})}function Mn(){this.options={persist:!0},Dn.call(this,{name:"languageMenu"})}function Ln(t){this.raptor=t,this.label=c("linkTypeDocumentLabel")}function $n(t){this.raptor=t,this.label=c("linkTypeEmailLabel")}function Bn(t){this.raptor=t,this.label=c("linkTypeExternalLabel")}function Fn(t){this.raptor=t,this.label=c("linkTypeInternalLabel")}function Hn(t,e){gn.call(this,t||"noBreak",e)}function jn(t,e){gn.call(this,t||"normaliseLineBreaks",e)}function Un(t,e){this.options={allowedTags:["h1","h2","h3","h4","h5","h6","ul","ol","li","blockquote","p","a","span","hr","br","strong","em"],allowedAttributes:["href","title"],allowedEmptyTags:["hr","br"],panels:["formatted-clean","plain-text","formatted-unclean","source"]},gn.call(this,t||"paste",e)}function zn(t,e){this.options={content:c("placeholderPluginDefaultContent"),tag:"p",select:!0},gn.call(this,t||"placeholder",e)}function Wn(t,e){this.options={retain:!1},gn.call(this,t||"saveJson",e),this.size=null}function Gn(t,e){this.method="put",this.options={retain:!1},gn.call(this,t||"saveRest",e)}function qn(){Dn.call(this,{name:"snippetMenu"})}function Vn(t){Tn.call(this,t)}function Yn(){Nn.call(this,{name:"tableCreate"})}function Jn(t,e){gn.call(this,t||"tableSupport",e)}function Qn(){Dn.call(this,{name:"tagMenu"})}function Xn(t){_n.call(this,t)}function Kn(t,e){gn.call(this,t||"toolTip",e)}function Zn(t,e){gn.call(this,t||"unsavedEditWarning",e)}!function(t){function e(e){if("string"==typeof e.data){var n=e.handler,i=e.data.toLowerCase().split(" ");e.handler=function(e){if(this===e.target||!/textarea|select/i.test(e.target.nodeName)&&"text"!==e.target.type){var o="keypress"!==e.type&&t.hotkeys.specialKeys[e.which],a=String.fromCharCode(e.which).toLowerCase(),r="",s={};e.altKey&&"alt"!==o&&(r+="alt+"),e.ctrlKey&&"ctrl"!==o&&(r+="ctrl+"),e.metaKey&&!e.ctrlKey&&"meta"!==o&&(r+="meta+"),e.shiftKey&&"shift"!==o&&(r+="shift+"),o?s[r+o]=!0:(s[r+a]=!0,s[r+t.hotkeys.shiftNums[a]]=!0,"shift+"===r&&(s[t.hotkeys.shiftNums[a]]=!0));for(var l=0,c=i.length;c>l;l++)if(s[i[l]])return n.apply(this,arguments)}}}}t.hotkeys={version:"0.8",specialKeys:{8:"backspace",9:"tab",13:"return",16:"shift",17:"ctrl",18:"alt",19:"pause",20:"capslock",27:"esc",32:"space",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",45:"insert",46:"del",96:"0",97:"1",98:"2",99:"3",100:"4",101:"5",102:"6",103:"7",104:"8",105:"9",106:"*",107:"+",109:"-",110:".",111:"/",112:"f1",113:"f2",114:"f3",115:"f4",116:"f5",117:"f6",118:"f7",119:"f8",120:"f9",121:"f10",122:"f11",123:"f12",144:"numlock",145:"scroll",191:"/",224:"meta"},shiftNums:{"`":"~",1:"!",2:"@",3:"#",4:"$",5:"%",6:"^",7:"&",8:"*",9:"(",0:")","-":"_","=":"+",";":": ","'":'"',",":"<",".":">","/":"?","\\":"|"}},t.each(["keydown","keyup","keypress"],function(){t.event.special[this]={add:e}})}(jQuery),GoogTable=function(t){this.element=t,this.refresh()},GoogTable.prototype.refresh=function(){var t=this.rows=[],e=this.element.tBodies[0];if(e){for(var n=[],i=e.firstChild;i;i=i.nextSibling)"TR"===i.tagName&&n.push(i);for(var o,a=0;o=n[a];a++)for(var r,s=t[a],l=GoogTable.getChildCellElements(o),c=0,d=0;r=l[d];d++){for(;s&&s.columns[c];)c++;for(var h=new GoogTableCell(r,a,c),u=0;u<h.rowSpan;u++){var p=a+u,f=t[p];f||t.push(f=new GoogTableRow(n[p],p));var g=c+h.colSpan;f.columns.length<g&&(f.columns.length=g);for(var m=0;m<h.colSpan;m++){var v=c+m;f.columns[v]=h}}c+=h.colSpan}}},GoogTable.getChildCellElements=function(t){for(var e,n=[],i=0;e=t.childNodes[i];i++)("TD"===e.tagName||"TH"===e.tagName)&&n.push(e);return n},GoogTable.prototype.insertRow=function(t,e){var n,i,t=t||this.rows.length;0==t?(n=this.rows[0],i=!1):(n=this.rows[t-1],i=!0);for(var o,a=document.createElement("tr"),r=0;o=n.columns[r];r+=1){if(i&&o.endRow>t||!i&&o.startRow<t)o.setRowSpan(o.rowSpan+1),o.colSpan>1&&(r+=o.colSpan-1);else{var s=document.createElement("td");s.innerHTML=e.placeHolder,a.appendChild(s)}i?n.element.parentNode.insertBefore(a,n.element.nextSibling):n.element.insertBefore(a)}return this.refresh(),a},GoogTable.prototype.mergeCells=function(t,e,n,i){var o,a=[];if(t==n&&e==i)return!1;for(var r=t;n>=r;r++)for(var s=e;i>=s;s++){if(o=this.rows[r].columns[s],o.startRow<t||o.endRow>n||o.startCol<e||o.endCol>i)return!1;a.push(o)}for(var l=a[0],c=l.element,d=document,r=1;o=a[r];r++){var h=o.element;if(h.parentNode&&h!=c){c.lastChild&&c.lastChild.nodeType===Node.TEXT_NODE&&c.appendChild(d.createElement("br"));for(var u;u=h.firstChild;)c.appendChild(u);h.parentNode.removeChild(h)}}return l.setColSpan(i-e+1),l.setRowSpan(n-t+1),this.refresh(),!0},GoogTable.prototype.splitCell=function(t,e){for(var n=this.rows[t],i=n.columns[e],o=[],a=i.element.innerHTML,r=0;r<i.rowSpan;r++)for(var s=0;s<i.colSpan;s++)if(r>0||s>0){var l=document.createElement("td");this.insertCellElement(l,t+r,e+s),o.push(l)}return i.setColSpan(1),i.setRowSpan(1),o[0].innerHTML=a,i.element.innerHTML="",this.refresh(),o},GoogTable.prototype.insertCellElement=function(t,e,n){for(var i,o=this.rows[e],a=null,r=n;i=o.columns[r];r+=i.colSpan)if(i.startRow==e){a=i.element;break}o.element.insertBefore(t,a)},GoogTableRow=function(t,e){this.index=e,this.element=t,this.columns=[]},GoogTableCell=function(t,e,n){this.element=t,this.colSpan=parseInt(t.colSpan,10)||1,this.rowSpan=parseInt(t.rowSpan,10)||1,this.startRow=e,this.startCol=n,this.updateCoordinates_()},GoogTableCell.prototype.updateCoordinates_=function(){this.endCol=this.startCol+this.colSpan-1,this.endRow=this.startRow+this.rowSpan-1},GoogTableCell.prototype.setColSpan=function(t){t!=this.colSpan&&(t>1?this.element.colSpan=t:(this.element.colSpan=1,this.element.removeAttribute("colSpan")),this.colSpan=t,this.updateCoordinates_())},GoogTableCell.prototype.setRowSpan=function(t){t!=this.rowSpan&&(t>1?this.element.rowSpan=t.toString():(this.element.rowSpan="1",this.element.removeAttribute("rowSpan")),this.rowSpan=t,this.updateCoordinates_())},function(){function t(){this.returnValue=!1}function e(){this.cancelBubble=!0}var n,i,o=0,a=[],r={},s={},l={"<":"lt",">":"gt","&":"amp",'"':"quot","'":"#39"},c=/[<>&\"\']/g,d=window.setTimeout,h={};!function(t){var e,n,i,o=t.split(/,/);for(e=0;e<o.length;e+=2)for(i=o[e+1].split(/ /),n=0;n<i.length;n++)s[i[n]]=o[e]}("application/msword,doc dot,application/pdf,pdf,application/pgp-signature,pgp,application/postscript,ps ai eps,application/rtf,rtf,application/vnd.ms-excel,xls xlb,application/vnd.ms-powerpoint,ppt pps pot,application/zip,zip,application/x-shockwave-flash,swf swfl,application/vnd.openxmlformats-officedocument.wordprocessingml.document,docx,application/vnd.openxmlformats-officedocument.wordprocessingml.template,dotx,application/vnd.openxmlformats-officedocument.spreadsheetml.sheet,xlsx,application/vnd.openxmlformats-officedocument.presentationml.presentation,pptx,application/vnd.openxmlformats-officedocument.presentationml.template,potx,application/vnd.openxmlformats-officedocument.presentationml.slideshow,ppsx,application/x-javascript,js,application/json,json,audio/mpeg,mpga mpega mp2 mp3,audio/x-wav,wav,audio/mp4,m4a,image/bmp,bmp,image/gif,gif,image/jpeg,jpeg jpg jpe,image/photoshop,psd,image/png,png,image/svg+xml,svg svgz,image/tiff,tiff tif,text/plain,asc txt text diff log,text/html,htm html xhtml,text/css,css,text/csv,csv,text/rtf,rtf,video/mpeg,mpeg mpg mpe m2v,video/quicktime,qt mov,video/mp4,mp4,video/x-m4v,m4v,video/x-flv,flv,video/x-ms-wmv,wmv,video/avi,avi,video/webm,webm,video/3gpp,3gp,video/3gpp2,3g2,video/vnd.rn-realvideo,rv,application/vnd.oasis.opendocument.formula-template,otf,application/octet-stream,exe");var u={VERSION:"1.5.7",STOPPED:1,STARTED:2,QUEUED:1,UPLOADING:2,FAILED:4,DONE:5,GENERIC_ERROR:-100,HTTP_ERROR:-200,IO_ERROR:-300,SECURITY_ERROR:-400,INIT_ERROR:-500,FILE_SIZE_ERROR:-600,FILE_EXTENSION_ERROR:-601,IMAGE_FORMAT_ERROR:-700,IMAGE_MEMORY_ERROR:-701,IMAGE_DIMENSIONS_ERROR:-702,mimeTypes:s,ua:function(){var t,e,n,i=navigator,o=i.userAgent,a=i.vendor;return t=/WebKit/.test(o),n=t&&-1!==a.indexOf("Apple"),e=window.opera&&window.opera.buildNumber,{windows:-1!==navigator.platform.indexOf("Win"),android:/Android/.test(o),ie:!t&&!e&&/MSIE/gi.test(o)&&/Explorer/gi.test(i.appName),webkit:t,gecko:!t&&/Gecko/.test(o),safari:n,opera:!!e}}(),typeOf:function(t){return{}.toString.call(t).match(/\s([a-z|A-Z]+)/)[1].toLowerCase()},extend:function(t){return u.each(arguments,function(e,n){n>0&&u.each(e,function(e,n){t[n]=e})}),t},cleanName:function(t){var e,n;for(n=[/[\300-\306]/g,"A",/[\340-\346]/g,"a",/\307/g,"C",/\347/g,"c",/[\310-\313]/g,"E",/[\350-\353]/g,"e",/[\314-\317]/g,"I",/[\354-\357]/g,"i",/\321/g,"N",/\361/g,"n",/[\322-\330]/g,"O",/[\362-\370]/g,"o",/[\331-\334]/g,"U",/[\371-\374]/g,"u"],e=0;e<n.length;e+=2)t=t.replace(n[e],n[e+1]);return t=t.replace(/\s+/g,"_"),t=t.replace(/[^a-z0-9_\-\.]+/gi,"")},addRuntime:function(t,e){return e.name=t,a[t]=e,a.push(e),e},guid:function(){var t,e=(new Date).getTime().toString(32);for(t=0;5>t;t++)e+=Math.floor(65535*Math.random()).toString(32);return(u.guidPrefix||"p")+e+(o++).toString(32)},buildUrl:function(t,e){var n="";return u.each(e,function(t,e){n+=(n?"&":"")+encodeURIComponent(e)+"="+encodeURIComponent(t)}),n&&(t+=(t.indexOf("?")>0?"&":"?")+n),t},each:function(t,e){var i,o,a;if(t)if(i=t.length,i===n){for(o in t)if(t.hasOwnProperty(o)&&e(t[o],o)===!1)return}else for(a=0;i>a;a++)if(e(t[a],a)===!1)return},formatSize:function(t){return t===n||/\D/.test(t)?u.translate("N/A"):t>1073741824?Math.round(t/1073741824,1)+" GB":t>1048576?Math.round(t/1048576,1)+" MB":t>1024?Math.round(t/1024,1)+" KB":t+" b"},getPos:function(t,e){function n(t){var e,n,i=0,o=0;return t&&(n=t.getBoundingClientRect(),e="CSS1Compat"===l.compatMode?l.documentElement:l.body,i=n.left+e.scrollLeft,o=n.top+e.scrollTop),{x:i,y:o}}var i,o,a,r=0,s=0,l=document;if(t=t,e=e||l.body,t&&t.getBoundingClientRect&&u.ua.ie&&(!l.documentMode||l.documentMode<8))return o=n(t),a=n(e),{x:o.x-a.x,y:o.y-a.y};for(i=t;i&&i!=e&&i.nodeType;)r+=i.offsetLeft||0,s+=i.offsetTop||0,i=i.offsetParent;for(i=t.parentNode;i&&i!=e&&i.nodeType;)r-=i.scrollLeft||0,s-=i.scrollTop||0,i=i.parentNode;return{x:r,y:s}},getSize:function(t){return{w:t.offsetWidth||t.clientWidth,h:t.offsetHeight||t.clientHeight}},parseSize:function(t){var e;return"string"==typeof t&&(t=/^([0-9]+)([mgk]?)$/.exec(t.toLowerCase().replace(/[^0-9mkg]/g,"")),e=t[2],t=+t[1],"g"==e&&(t*=1073741824),"m"==e&&(t*=1048576),"k"==e&&(t*=1024)),t},xmlEncode:function(t){return t?(""+t).replace(c,function(t){return l[t]?"&"+l[t]+";":t}):t},toArray:function(t){var e,n=[];for(e=0;e<t.length;e++)n[e]=t[e];return n},inArray:function(t,e){if(e){if(Array.prototype.indexOf)return Array.prototype.indexOf.call(e,t);for(var n=0,i=e.length;i>n;n++)if(e[n]===t)return n}return-1},addI18n:function(t){return u.extend(r,t)},translate:function(t){return r[t]||t},isEmptyObj:function(t){if(t===n)return!0;for(var e in t)return!1;return!0},hasClass:function(t,e){var n;return""==t.className?!1:(n=new RegExp("(^|\\s+)"+e+"(\\s+|$)"),n.test(t.className))},addClass:function(t,e){u.hasClass(t,e)||(t.className=""==t.className?e:t.className.replace(/\s+$/,"")+" "+e)},removeClass:function(t,e){var n=new RegExp("(^|\\s+)"+e+"(\\s+|$)");t.className=t.className.replace(n,function(t,e,n){return" "===e&&" "===n?" ":""})},getStyle:function(t,e){return t.currentStyle?t.currentStyle[e]:window.getComputedStyle?window.getComputedStyle(t,null)[e]:void 0},addEvent:function(o,a,r){var s,l,c;c=arguments[3],a=a.toLowerCase(),i===n&&(i="Plupload_"+u.guid()),o.addEventListener?(s=r,o.addEventListener(a,s,!1)):o.attachEvent&&(s=function(){var n=window.event;n.target||(n.target=n.srcElement),n.preventDefault=t,n.stopPropagation=e,r(n)},o.attachEvent("on"+a,s)),o[i]===n&&(o[i]=u.guid()),h.hasOwnProperty(o[i])||(h[o[i]]={}),l=h[o[i]],l.hasOwnProperty(a)||(l[a]=[]),l[a].push({func:s,orig:r,key:c})},removeEvent:function(t,e){var o,a,r;if("function"==typeof arguments[2]?a=arguments[2]:r=arguments[2],e=e.toLowerCase(),t[i]&&h[t[i]]&&h[t[i]][e]){o=h[t[i]][e];for(var s=o.length-1;s>=0&&(o[s].key!==r&&o[s].orig!==a||(t.removeEventListener?t.removeEventListener(e,o[s].func,!1):t.detachEvent&&t.detachEvent("on"+e,o[s].func),o[s].orig=null,o[s].func=null,o.splice(s,1),a===n));s--);if(o.length||delete h[t[i]][e],u.isEmptyObj(h[t[i]])){delete h[t[i]];try{delete t[i]}catch(l){t[i]=n}}}},removeAllEvents:function(t){var e=arguments[1];t[i]!==n&&t[i]&&u.each(h[t[i]],function(n,i){u.removeEvent(t,i,e)})}};u.Uploader=function(t){function e(){var t,e,n=0;if(this.state==u.STARTED){for(e=0;e<l.length;e++)t||l[e].status!=u.QUEUED?n++:(t=l[e],t.status=u.UPLOADING,this.trigger("BeforeUpload",t)&&this.trigger("UploadFile",t));n==l.length&&(this.stop(),this.trigger("UploadComplete",l))}}function i(){var t,e;for(o.reset(),t=0;t<l.length;t++)e=l[t],e.size!==n?(o.size+=e.size,o.loaded+=e.loaded):o.size=n,e.status==u.DONE?o.uploaded++:e.status==u.FAILED?o.failed++:o.queued++;o.size===n?o.percent=l.length>0?Math.ceil(o.uploaded/l.length*100):0:(o.bytesPerSec=Math.ceil(o.loaded/((+new Date-r||1)/1e3)),o.percent=o.size>0?Math.ceil(o.loaded/o.size*100):0)}var o,r,s={},l=[],c=!1;o=new u.QueueProgress,t=u.extend({chunk_size:0,multipart:!0,multi_selection:!0,file_data_name:"file",filters:[]},t),u.extend(this,{state:u.STOPPED,runtime:"",features:{},files:l,settings:t,total:o,id:u.guid(),init:function(){function o(){var t,e,n,i=c[f++];if(i){if(t=i.getFeatures(),e=p.settings.required_features)for(e=e.split(","),n=0;n<e.length;n++)if(!t[e[n]])return void o();i.init(p,function(e){e&&e.success?(p.features=t,p.runtime=i.name,p.trigger("Init",{runtime:i.name}),p.trigger("PostInit"),p.refresh()):o()})}else p.trigger("Error",{code:u.INIT_ERROR,message:u.translate("Init error.")})}var s,c,h,p=this,f=0;if("function"==typeof t.preinit?t.preinit(p):u.each(t.preinit,function(t,e){p.bind(e,t)}),t.page_url=t.page_url||document.location.pathname.replace(/\/[^\/]+$/g,"/"),/^(\w+:\/\/|\/)/.test(t.url)||(t.url=t.page_url+t.url),t.chunk_size=u.parseSize(t.chunk_size),t.max_file_size=u.parseSize(t.max_file_size),p.bind("FilesAdded",function(e,i){var o,a,r,s=0,c=t.filters;for(c&&c.length&&(r=[],u.each(c,function(t){u.each(t.extensions.split(/,/),function(t){r.push(/^\s*\*\s*$/.test(t)?"\\.*":"\\."+t.replace(new RegExp("["+"/^$.*+?|()[]{}\\".replace(/./g,"\\$&")+"]","g"),"\\$&"))})}),r=new RegExp(r.join("|")+"$","i")),o=0;o<i.length;o++)a=i[o],a.loaded=0,a.percent=0,a.status=u.QUEUED,!r||r.test(a.name)?a.size!==n&&a.size>t.max_file_size?e.trigger("Error",{code:u.FILE_SIZE_ERROR,message:u.translate("File size error."),file:a}):(l.push(a),s++):e.trigger("Error",{code:u.FILE_EXTENSION_ERROR,message:u.translate("File extension error."),file:a});return s?void d(function(){p.trigger("QueueChanged"),p.refresh()},1):!1}),t.unique_names&&p.bind("UploadFile",function(t,e){var n=e.name.match(/\.([^.]+)$/),i="tmp";n&&(i=n[1]),e.target_name=e.id+"."+i}),p.bind("UploadProgress",function(t,e){e.percent=e.size>0?Math.ceil(e.loaded/e.size*100):100,i()}),p.bind("StateChanged",function(t){if(t.state==u.STARTED)r=+new Date;else if(t.state==u.STOPPED)for(s=t.files.length-1;s>=0;s--)t.files[s].status==u.UPLOADING&&(t.files[s].status=u.QUEUED,i())}),p.bind("QueueChanged",i),p.bind("Error",function(t,n){n.file&&(n.file.status=u.FAILED,i(),t.state==u.STARTED&&d(function(){e.call(p)},1))}),p.bind("FileUploaded",function(t,n){n.status=u.DONE,n.loaded=n.size,t.trigger("UploadProgress",n),d(function(){e.call(p)},1)}),t.runtimes)for(c=[],h=t.runtimes.split(/\s?,\s?/),s=0;s<h.length;s++)a[h[s]]&&c.push(a[h[s]]);else c=a;o(),"function"==typeof t.init?t.init(p):u.each(t.init,function(t,e){p.bind(e,t)})},refresh:function(){this.trigger("Refresh")},start:function(){l.length&&this.state!=u.STARTED&&(this.state=u.STARTED,this.trigger("StateChanged"),e.call(this))},stop:function(){this.state!=u.STOPPED&&(this.state=u.STOPPED,this.trigger("CancelUpload"),this.trigger("StateChanged"))},disableBrowse:function(){c=arguments[0]!==n?arguments[0]:!0,this.trigger("DisableBrowse",c)},getFile:function(t){var e;for(e=l.length-1;e>=0;e--)if(l[e].id===t)return l[e]},removeFile:function(t){var e;for(e=l.length-1;e>=0;e--)if(l[e].id===t.id)return this.splice(e,1)[0]},splice:function(t,e){var i;return i=l.splice(t===n?0:t,e===n?l.length:e),this.trigger("FilesRemoved",i),this.trigger("QueueChanged"),i},trigger:function(t){var e,n,i=s[t.toLowerCase()];if(i)for(n=Array.prototype.slice.call(arguments),n[0]=this,e=0;e<i.length;e++)if(i[e].func.apply(i[e].scope,n)===!1)return!1;return!0},hasEventListener:function(t){return!!s[t.toLowerCase()]},bind:function(t,e,n){var i;t=t.toLowerCase(),i=s[t]||[],i.push({func:e,scope:n||this}),s[t]=i},unbind:function(t){t=t.toLowerCase();var e,i=s[t],o=arguments[1];if(i){if(o!==n){for(e=i.length-1;e>=0;e--)if(i[e].func===o){i.splice(e,1);break}}else i=[];i.length||delete s[t]}},unbindAll:function(){var t=this;u.each(s,function(e,n){t.unbind(n)})},destroy:function(){this.stop(),this.trigger("Destroy"),this.unbindAll()}})},u.File=function(t,e,n){var i=this;i.id=t,i.name=e,i.size=n,i.loaded=0,i.percent=0,i.status=0},u.Runtime=function(){this.getFeatures=function(){},this.init=function(){}},u.QueueProgress=function(){var t=this;t.size=0,t.loaded=0,t.uploaded=0,t.failed=0,t.queued=0,t.percent=0,t.bytesPerSec=0,t.reset=function(){t.size=t.loaded=t.uploaded=t.failed=t.queued=t.percent=t.bytesPerSec=0}},u.runtimes={},window.plupload=u}(),function(t,e,n){function i(t){return e.getElementById(t)}n.runtimes.Html4=n.addRuntime("html4",{getFeatures:function(){return{multipart:!0,triggerDialog:n.ua.gecko&&t.FormData||n.ua.webkit}},init:function(o,a){o.bind("Init",function(a){function r(){var t,s,l,c;d=n.guid(),v.push(d),t=e.createElement("form"),t.setAttribute("id","form_"+d),t.setAttribute("method","post"),t.setAttribute("enctype","multipart/form-data"),t.setAttribute("encoding","multipart/form-data"),t.setAttribute("target",a.id+"_iframe"),t.style.position="absolute",s=e.createElement("input"),s.setAttribute("id","input_"+d),s.setAttribute("type","file"),s.setAttribute("accept",y),s.setAttribute("size",1),c=i(a.settings.browse_button),a.features.triggerDialog&&c&&n.addEvent(i(a.settings.browse_button),"click",function(t){s.disabled||s.click(),t.preventDefault()},a.id),n.extend(s.style,{width:"100%",height:"100%",opacity:0,fontSize:"99px",cursor:"pointer"}),n.extend(t.style,{overflow:"hidden"}),l=a.settings.shim_bgcolor,l&&(t.style.background=l),b&&n.extend(s.style,{filter:"alpha(opacity=0)"}),n.addEvent(s,"change",function(e){var l,h=e.target,u=[];h.value&&(i("form_"+d).style.top="-1048575px",l=h.value.replace(/\\/g,"/"),l=l.substring(l.length,l.lastIndexOf("/")+1),u.push(new n.File(d,l)),a.features.triggerDialog?n.removeEvent(c,"click",a.id):n.removeAllEvents(t,a.id),n.removeEvent(s,"change",a.id),r(),u.length&&o.trigger("FilesAdded",u))},a.id),t.appendChild(s),g.appendChild(t),a.refresh()}function s(){var i=e.createElement("div");i.innerHTML='<iframe id="'+a.id+'_iframe" name="'+a.id+'_iframe" src="'+m+':&quot;&quot;" style="display:none"></iframe>',l=i.firstChild,g.appendChild(l),n.addEvent(l,"load",function(e){var i,o,r=e.target;if(c){try{i=r.contentWindow.document||r.contentDocument||t.frames[r.id].document}catch(s){return void a.trigger("Error",{code:n.SECURITY_ERROR,message:n.translate("Security error."),file:c})}o=i.documentElement.innerText||i.documentElement.textContent,o&&(c.status=n.DONE,c.loaded=1025,c.percent=100,a.trigger("UploadProgress",c),a.trigger("FileUploaded",c,{response:o}))}},a.id)}var l,c,d,h,u,p,f,g=e.body,m="javascript",v=[],b=/MSIE/.test(navigator.userAgent),y=[],w=a.settings.filters;t:for(h=0;h<w.length;h++)for(u=w[h].extensions.split(/,/),f=0;f<u.length;f++){if("*"===u[f]){y=[];break t}p=n.mimeTypes[u[f]],p&&-1===n.inArray(p,y)&&y.push(p)}y=y.join(","),a.settings.container&&(g=i(a.settings.container),"static"===n.getStyle(g,"position")&&(g.style.position="relative")),a.bind("UploadFile",function(t,o){var a,r;o.status!=n.DONE&&o.status!=n.FAILED&&t.state!=n.STOPPED&&(a=i("form_"+o.id),r=i("input_"+o.id),r.setAttribute("name",t.settings.file_data_name),a.setAttribute("action",t.settings.url),n.each(n.extend({name:o.target_name||o.name},t.settings.multipart_params),function(t,i){var o=e.createElement("input");n.extend(o,{type:"hidden",name:i,value:t}),a.insertBefore(o,a.firstChild)}),c=o,i("form_"+d).style.top="-1048575px",a.submit())}),a.bind("FileUploaded",function(t){t.refresh()}),a.bind("StateChanged",function(e){e.state==n.STARTED?s():e.state==n.STOPPED&&t.setTimeout(function(){n.removeEvent(l,"load",e.id),l.parentNode&&l.parentNode.removeChild(l)},0),n.each(e.files,function(t){if(t.status===n.DONE||t.status===n.FAILED){var e=i("form_"+t.id);e&&e.parentNode.removeChild(e)}})}),a.bind("Refresh",function(t){var o,a,r,s,l,c,h,u,p;o=i(t.settings.browse_button),o&&(l=n.getPos(o,i(t.settings.container)),c=n.getSize(o),h=i("form_"+d),u=i("input_"+d),n.extend(h.style,{top:l.y+"px",left:l.x+"px",width:c.w+"px",height:c.h+"px"}),t.features.triggerDialog&&("static"===n.getStyle(o,"position")&&n.extend(o.style,{position:"relative"}),p=parseInt(o.style.zIndex,10),isNaN(p)&&(p=0),n.extend(o.style,{zIndex:p}),n.extend(h.style,{zIndex:p-1})),r=t.settings.browse_button_hover,s=t.settings.browse_button_active,a=t.features.triggerDialog?o:h,r&&(n.addEvent(a,"mouseover",function(){n.addClass(o,r)},t.id),n.addEvent(a,"mouseout",function(){n.removeClass(o,r)},t.id)),s&&(n.addEvent(a,"mousedown",function(){n.addClass(o,s)},t.id),n.addEvent(e.body,"mouseup",function(){n.removeClass(o,s)},t.id)))}),o.bind("FilesRemoved",function(t,e){var n,o;for(n=0;n<e.length;n++)o=i("form_"+e[n].id),o&&o.parentNode.removeChild(o)
}),o.bind("DisableBrowse",function(t,n){var i=e.getElementById("input_"+d);i&&(i.disabled=n)}),o.bind("Destroy",function(t){var o,a,r,s={inputContainer:"form_"+d,inputFile:"input_"+d,browseButton:t.settings.browse_button};for(o in s)a=i(s[o]),a&&n.removeAllEvents(a,t.id);n.removeAllEvents(e.body,t.id),n.each(v,function(t){r=i("form_"+t),r&&r.parentNode.removeChild(r)})}),r()}),a({success:!0})}})}(window,document,plupload),function(t,e,n,o){function a(t){var n=t.naturalWidth,i=t.naturalHeight;if(n*i>1048576){var o=e.createElement("canvas");o.width=o.height=1;var a=o.getContext("2d");return a.drawImage(t,-n+1,0),0===a.getImageData(0,0,1,1).data[3]}return!1}function r(t,n,i){var o=e.createElement("canvas");o.width=1,o.height=i;var a=o.getContext("2d");a.drawImage(t,0,0);for(var r=a.getImageData(0,0,1,i).data,s=0,l=i,c=i;c>s;){var d=r[4*(c-1)+3];0===d?l=c:s=c,c=l+s>>1}var h=c/i;return 0===h?1:h}function s(t,n,i){var o=t.naturalWidth,s=t.naturalHeight,l=i.width,c=i.height,d=n.getContext("2d");d.save();var h=a(t);h&&(o/=2,s/=2);var u=1024,p=e.createElement("canvas");p.width=p.height=u;for(var f=p.getContext("2d"),g=r(t,o,s),m=0;s>m;){for(var v=m+u>s?s-m:u,b=0;o>b;){var y=b+u>o?o-b:u;f.clearRect(0,0,u,u),f.drawImage(t,-b,-m);var w=b*l/o<<0,C=Math.ceil(y*l/o),x=m*c/s/g<<0,_=Math.ceil(v*c/s/g);d.drawImage(p,0,0,y,v,w,x,C,_),b+=u}m+=u}d.restore(),p=f=null}function l(e,n){var i;return"FileReader"in t?(i=new FileReader,i.readAsDataURL(e),i.onload=function(){n(i.result)},void 0):n(e.getAsDataURL())}function c(e,n){var i;return"FileReader"in t?(i=new FileReader,i.readAsBinaryString(e),i.onload=function(){n(i.result)},void 0):n(e.getAsBinary())}function d(t,n,i,o){var a,r,c,d=this;l(g[t.id],function(l){a=e.createElement("canvas"),a.style.display="none",e.body.appendChild(a),r=new Image,r.onerror=r.onabort=function(){o({success:!1})},r.onload=function(){var e,h,f,g;if(n.width||(n.width=r.width),n.height||(n.height=r.height),c=Math.min(n.width/r.width,n.height/r.height),1>c)e=Math.round(r.width*c),h=Math.round(r.height*c);else{if(!n.quality||"image/jpeg"!==i)return void o({success:!1});e=r.width,h=r.height}if(a.width=e,a.height=h,s(r,a,{width:e,height:h}),"image/jpeg"===i&&(f=new u(atob(l.substring(l.indexOf("base64,")+7))),f.headers&&f.headers.length&&(g=new p,g.init(f.get("exif")[0])&&(g.setExif("PixelXDimension",e),g.setExif("PixelYDimension",h),f.set("exif",g.getBinary()),d.hasEventListener("ExifData")&&d.trigger("ExifData",t,g.EXIF()),d.hasEventListener("GpsData")&&d.trigger("GpsData",t,g.GPS())))),n.quality&&"image/jpeg"===i)try{l=a.toDataURL(i,n.quality/100)}catch(m){l=a.toDataURL(i)}else l=a.toDataURL(i);l=l.substring(l.indexOf("base64,")+7),l=atob(l),f&&f.headers&&f.headers.length&&(l=f.restore(l),f.purge()),a.parentNode.removeChild(a),o({success:!0,data:l})},r.src=l})}function h(){function t(t,e){var n,o=a?0:-8*(e-1),r=0;for(n=0;e>n;n++)r|=i.charCodeAt(t+n)<<Math.abs(o+8*n);return r}function e(t,e,n){var n=3===arguments.length?n:i.length-e-1;i=i.substr(0,e)+t+i.substr(n+e)}function n(t,n,i){var o,r="",s=a?0:-8*(i-1);for(o=0;i>o;o++)r+=String.fromCharCode(n>>Math.abs(s+8*o)&255);e(r,t,i)}var i,a=!1;return{II:function(t){return t===o?a:void(a=t)},init:function(t){a=!1,i=t},SEGMENT:function(t,n,o){switch(arguments.length){case 1:return i.substr(t,i.length-t-1);case 2:return i.substr(t,n);case 3:e(o,t,n);break;default:return i}},BYTE:function(e){return t(e,1)},SHORT:function(e){return t(e,2)},LONG:function(e,i){return i===o?t(e,4):void n(e,i,4)},SLONG:function(e){var n=t(e,4);return n>2147483647?n-4294967296:n},STRING:function(e,n){var i="";for(n+=e;n>e;e++)i+=String.fromCharCode(t(e,1));return i}}}function u(t){var e,n,i,a={65505:{app:"EXIF",name:"APP1",signature:"Exif\x00"},65506:{app:"ICC",name:"APP2",signature:"ICC_PROFILE\x00"},65517:{app:"IPTC",name:"APP13",signature:"Photoshop 3.0\x00"}},r=[],s=o,l=0;if(e=new h,e.init(t),65496===e.SHORT(0)){for(n=2,i=Math.min(1048576,t.length);i>=n;)if(s=e.SHORT(n),s>=65488&&65495>=s)n+=2;else{if(65498===s||65497===s)break;l=e.SHORT(n+2)+2,a[s]&&e.STRING(n+4,a[s].signature.length)===a[s].signature&&r.push({hex:s,app:a[s].app.toUpperCase(),name:a[s].name.toUpperCase(),start:n,length:l,segment:e.SEGMENT(n,l)}),n+=l}return e.init(null),{headers:r,restore:function(t){e.init(t);var i=new u(t);if(!i.headers)return!1;for(var o=i.headers.length;o>0;o--){var a=i.headers[o-1];e.SEGMENT(a.start,a.length,"")}i.purge(),n=65504==e.SHORT(2)?4+e.SHORT(4):2;for(var o=0,s=r.length;s>o;o++)e.SEGMENT(n,0,r[o].segment),n+=r[o].length;return e.SEGMENT()},get:function(t){for(var e=[],n=0,i=r.length;i>n;n++)r[n].app===t.toUpperCase()&&e.push(r[n].segment);return e},set:function(t,e){var n=[];"string"==typeof e?n.push(e):n=e;for(var i=ii=0,o=r.length;o>i&&(r[i].app===t.toUpperCase()&&(r[i].segment=n[ii],r[i].length=n[ii].length,ii++),!(ii>=n.length));i++);},purge:function(){r=[],e.init(null)}}}}function p(){function t(t,e){var n,i,a,s,d,h,u,p,f=r.SHORT(t),g=[],m={};for(n=0;f>n;n++)if(u=h=t+12*n+2,a=e[r.SHORT(u)],a!==o){switch(s=r.SHORT(u+=2),d=r.LONG(u+=2),u+=4,g=[],s){case 1:case 7:for(d>4&&(u=r.LONG(u)+c.tiffHeader),i=0;d>i;i++)g[i]=r.BYTE(u+i);break;case 2:d>4&&(u=r.LONG(u)+c.tiffHeader),m[a]=r.STRING(u,d-1);continue;case 3:for(d>2&&(u=r.LONG(u)+c.tiffHeader),i=0;d>i;i++)g[i]=r.SHORT(u+2*i);break;case 4:for(d>1&&(u=r.LONG(u)+c.tiffHeader),i=0;d>i;i++)g[i]=r.LONG(u+4*i);break;case 5:for(u=r.LONG(u)+c.tiffHeader,i=0;d>i;i++)g[i]=r.LONG(u+4*i)/r.LONG(u+4*i+4);break;case 9:for(u=r.LONG(u)+c.tiffHeader,i=0;d>i;i++)g[i]=r.SLONG(u+4*i);break;case 10:for(u=r.LONG(u)+c.tiffHeader,i=0;d>i;i++)g[i]=r.SLONG(u+4*i)/r.SLONG(u+4*i+4);break;default:continue}p=1==d?g[0]:g,m[a]=l.hasOwnProperty(a)&&"object"!=typeof p?l[a][p]:p}return m}function e(){var e=o,n=c.tiffHeader;return r.II(18761==r.SHORT(n)),42!==r.SHORT(n+=2)?!1:(c.IFD0=c.tiffHeader+r.LONG(n+=2),e=t(c.IFD0,s.tiff),c.exifIFD="ExifIFDPointer"in e?c.tiffHeader+e.ExifIFDPointer:o,c.gpsIFD="GPSInfoIFDPointer"in e?c.tiffHeader+e.GPSInfoIFDPointer:o,!0)}function a(t,e,n){var o,a,l,d=0;if("string"==typeof e){var h=s[t.toLowerCase()];for(hex in h)if(h[hex]===e){e=hex;break}}for(o=c[t.toLowerCase()+"IFD"],a=r.SHORT(o),i=0;a>i;i++)if(l=o+12*i+2,r.SHORT(l)==e){d=l+8;break}return d?(r.LONG(d,n),!0):!1}var r,s,l,c={};return r=new h,s={tiff:{274:"Orientation",34665:"ExifIFDPointer",34853:"GPSInfoIFDPointer"},exif:{36864:"ExifVersion",40961:"ColorSpace",40962:"PixelXDimension",40963:"PixelYDimension",36867:"DateTimeOriginal",33434:"ExposureTime",33437:"FNumber",34855:"ISOSpeedRatings",37377:"ShutterSpeedValue",37378:"ApertureValue",37383:"MeteringMode",37384:"LightSource",37385:"Flash",41986:"ExposureMode",41987:"WhiteBalance",41990:"SceneCaptureType",41988:"DigitalZoomRatio",41992:"Contrast",41993:"Saturation",41994:"Sharpness"},gps:{0:"GPSVersionID",1:"GPSLatitudeRef",2:"GPSLatitude",3:"GPSLongitudeRef",4:"GPSLongitude"}},l={ColorSpace:{1:"sRGB",0:"Uncalibrated"},MeteringMode:{0:"Unknown",1:"Average",2:"CenterWeightedAverage",3:"Spot",4:"MultiSpot",5:"Pattern",6:"Partial",255:"Other"},LightSource:{1:"Daylight",2:"Fliorescent",3:"Tungsten",4:"Flash",9:"Fine weather",10:"Cloudy weather",11:"Shade",12:"Daylight fluorescent (D 5700 - 7100K)",13:"Day white fluorescent (N 4600 -5400K)",14:"Cool white fluorescent (W 3900 - 4500K)",15:"White fluorescent (WW 3200 - 3700K)",17:"Standard light A",18:"Standard light B",19:"Standard light C",20:"D55",21:"D65",22:"D75",23:"D50",24:"ISO studio tungsten",255:"Other"},Flash:{0:"Flash did not fire.",1:"Flash fired.",5:"Strobe return light not detected.",7:"Strobe return light detected.",9:"Flash fired, compulsory flash mode",13:"Flash fired, compulsory flash mode, return light not detected",15:"Flash fired, compulsory flash mode, return light detected",16:"Flash did not fire, compulsory flash mode",24:"Flash did not fire, auto mode",25:"Flash fired, auto mode",29:"Flash fired, auto mode, return light not detected",31:"Flash fired, auto mode, return light detected",32:"No flash function",65:"Flash fired, red-eye reduction mode",69:"Flash fired, red-eye reduction mode, return light not detected",71:"Flash fired, red-eye reduction mode, return light detected",73:"Flash fired, compulsory flash mode, red-eye reduction mode",77:"Flash fired, compulsory flash mode, red-eye reduction mode, return light not detected",79:"Flash fired, compulsory flash mode, red-eye reduction mode, return light detected",89:"Flash fired, auto mode, red-eye reduction mode",93:"Flash fired, auto mode, return light not detected, red-eye reduction mode",95:"Flash fired, auto mode, return light detected, red-eye reduction mode"},ExposureMode:{0:"Auto exposure",1:"Manual exposure",2:"Auto bracket"},WhiteBalance:{0:"Auto white balance",1:"Manual white balance"},SceneCaptureType:{0:"Standard",1:"Landscape",2:"Portrait",3:"Night scene"},Contrast:{0:"Normal",1:"Soft",2:"Hard"},Saturation:{0:"Normal",1:"Low saturation",2:"High saturation"},Sharpness:{0:"Normal",1:"Soft",2:"Hard"},GPSLatitudeRef:{N:"North latitude",S:"South latitude"},GPSLongitudeRef:{E:"East longitude",W:"West longitude"}},{init:function(t){return c={tiffHeader:10},t!==o&&t.length?(r.init(t),65505===r.SHORT(0)&&"EXIF\x00"===r.STRING(4,5).toUpperCase()?e():!1):!1},EXIF:function(){var e;if(e=t(c.exifIFD,s.exif),e.ExifVersion&&"array"===n.typeOf(e.ExifVersion)){for(var i=0,o="";i<e.ExifVersion.length;i++)o+=String.fromCharCode(e.ExifVersion[i]);e.ExifVersion=o}return e},GPS:function(){var e;return e=t(c.gpsIFD,s.gps),e.GPSVersionID&&(e.GPSVersionID=e.GPSVersionID.join(".")),e},setExif:function(t,e){return"PixelXDimension"!==t&&"PixelYDimension"!==t?!1:a("exif",t,e)},getBinary:function(){return r.SEGMENT()}}}var f,g={};n.runtimes.Html5=n.addRuntime("html5",{getFeatures:function(){var i,o,a,r,s,l;return o=a=s=l=!1,t.XMLHttpRequest&&(i=new XMLHttpRequest,a=!!i.upload,o=!(!i.sendAsBinary&&!i.upload)),o&&(r=!!(i.sendAsBinary||t.Uint8Array&&t.ArrayBuffer),s=!(!File||!File.prototype.getAsDataURL&&!t.FileReader||!r),l=!(!File||!(File.prototype.mozSlice||File.prototype.webkitSlice||File.prototype.slice))),f=n.ua.safari&&n.ua.windows,{html5:o,dragdrop:function(){var t=e.createElement("div");return"draggable"in t||"ondragstart"in t&&"ondrop"in t}(),jpgresize:s,pngresize:s,multipart:s||!!t.FileReader||!!t.FormData,canSendBinary:r,cantSendBlobInFormData:!(!(n.ua.gecko&&t.FormData&&t.FileReader)||FileReader.prototype.readAsArrayBuffer)||n.ua.android,progress:a,chunks:l,multi_selection:!(n.ua.safari&&n.ua.windows),triggerDialog:n.ua.gecko&&t.FormData||n.ua.webkit}},init:function(i,o){function a(t){var e,o,a,r=[],s={};for(o=0;o<t.length;o++)e=t[o],s[e.name]&&n.ua.safari&&n.ua.windows||(s[e.name]=!0,a=n.guid(),g[a]=e,r.push(new n.File(a,e.fileName||e.name,e.fileSize||e.size)));r.length&&i.trigger("FilesAdded",r)}var r,s;return r=this.getFeatures(),r.html5?(i.bind("Init",function(t){var o,r,s,l,c,d,h,u=[],p=t.settings.filters,f=e.body;o=e.createElement("div"),o.id=t.id+"_html5_container",n.extend(o.style,{position:"absolute",background:i.settings.shim_bgcolor||"transparent",width:"100px",height:"100px",overflow:"hidden",zIndex:99999,opacity:i.settings.shim_bgcolor?"":0}),o.className="plupload html5",i.settings.container&&(f=e.getElementById(i.settings.container),"static"===n.getStyle(f,"position")&&(f.style.position="relative")),f.appendChild(o);t:for(s=0;s<p.length;s++)for(c=p[s].extensions.split(/,/),l=0;l<c.length;l++){if("*"===c[l]){u=[];break t}d=n.mimeTypes[c[l]],d&&-1===n.inArray(d,u)&&u.push(d)}if(o.innerHTML='<input id="'+i.id+'_html5"  style="font-size:999px" type="file" accept="'+u.join(",")+'" '+(i.settings.multi_selection&&i.features.multi_selection?'multiple="multiple"':"")+" />",o.scrollTop=100,h=e.getElementById(i.id+"_html5"),t.features.triggerDialog?n.extend(h.style,{position:"absolute",width:"100%",height:"100%"}):n.extend(h.style,{cssFloat:"right",styleFloat:"right"}),h.onchange=function(){a(this.files),this.value=""},r=e.getElementById(t.settings.browse_button)){var g=t.settings.browse_button_hover,m=t.settings.browse_button_active,v=t.features.triggerDialog?r:o;g&&(n.addEvent(v,"mouseover",function(){n.addClass(r,g)},t.id),n.addEvent(v,"mouseout",function(){n.removeClass(r,g)},t.id)),m&&(n.addEvent(v,"mousedown",function(){n.addClass(r,m)},t.id),n.addEvent(e.body,"mouseup",function(){n.removeClass(r,m)},t.id)),t.features.triggerDialog&&n.addEvent(r,"click",function(n){var i=e.getElementById(t.id+"_html5");i&&!i.disabled&&i.click(),n.preventDefault()},t.id)}}),i.bind("PostInit",function(){var t=e.getElementById(i.settings.drop_element);if(t){if(f)return void n.addEvent(t,"dragenter",function(){var o,r,s;o=e.getElementById(i.id+"_drop"),o||(o=e.createElement("input"),o.setAttribute("type","file"),o.setAttribute("id",i.id+"_drop"),o.setAttribute("multiple","multiple"),n.addEvent(o,"change",function(){a(this.files),n.removeEvent(o,"change",i.id),o.parentNode.removeChild(o)},i.id),n.addEvent(o,"dragover",function(t){t.stopPropagation()},i.id),t.appendChild(o)),r=n.getPos(t,e.getElementById(i.settings.container)),s=n.getSize(t),"static"===n.getStyle(t,"position")&&n.extend(t.style,{position:"relative"}),n.extend(o.style,{position:"absolute",display:"block",top:0,left:0,width:s.w+"px",height:s.h+"px",opacity:0})},i.id);n.addEvent(t,"dragover",function(t){t.preventDefault()},i.id),n.addEvent(t,"drop",function(t){var e=t.dataTransfer;e&&e.files&&a(e.files),t.preventDefault()},i.id)}}),i.bind("Refresh",function(t){var o,a,r,s,l;o=e.getElementById(i.settings.browse_button),o&&(a=n.getPos(o,e.getElementById(t.settings.container)),r=n.getSize(o),s=e.getElementById(i.id+"_html5_container"),n.extend(s.style,{top:a.y+"px",left:a.x+"px",width:r.w+"px",height:r.h+"px"}),i.features.triggerDialog&&("static"===n.getStyle(o,"position")&&n.extend(o.style,{position:"relative"}),l=parseInt(n.getStyle(o,"zIndex"),10),isNaN(l)&&(l=0),n.extend(o.style,{zIndex:l}),n.extend(s.style,{zIndex:l-1})))}),i.bind("DisableBrowse",function(t,n){var i=e.getElementById(t.id+"_html5");i&&(i.disabled=n)}),i.bind("CancelUpload",function(){s&&s.abort&&s.abort()}),i.bind("UploadFile",function(e,i){function o(t,e,n){var i;if(!File.prototype.slice)return(i=File.prototype.webkitSlice||File.prototype.mozSlice)?i.call(t,e,n):null;try{return t.slice(),t.slice(e,n)}catch(o){return t.slice(e,n-e)}}function a(a){function l(){function u(t){if(s.sendAsBinary)s.sendAsBinary(t);else if(e.features.canSendBinary){for(var n=new Uint8Array(t.length),i=0;i<t.length;i++)n[i]=255&t.charCodeAt(i);s.send(n.buffer)}}function p(o){var a,h=0,p="----pluploadboundary"+n.guid(),C="--",x="\r\n",_="";if(s=new XMLHttpRequest,s.upload&&(s.upload.onprogress=function(t){i.loaded=Math.min(i.size,d+t.loaded-h),e.trigger("UploadProgress",i)}),s.onreadystatechange=function(){var t,r;if(4==s.readyState&&e.state!==n.STOPPED){try{t=s.status}catch(h){t=0}if(t>=400)e.trigger("Error",{code:n.HTTP_ERROR,message:n.translate("HTTP Error."),file:i,status:t});else{if(g){if(r={chunk:c,chunks:g,response:s.responseText,status:t},e.trigger("ChunkUploaded",i,r),d+=b,r.cancelled)return void(i.status=n.FAILED);i.loaded=Math.min(i.size,(c+1)*v)}else i.loaded=i.size;e.trigger("UploadProgress",i),o=f=a=_=null,!g||++c>=g?(i.status=n.DONE,e.trigger("FileUploaded",i,{response:s.responseText,status:t})):l()}}},e.settings.multipart&&r.multipart){if(m.name=i.target_name||i.name,s.open("post",w,!0),n.each(e.settings.headers,function(t,e){s.setRequestHeader(e,t)}),"string"!=typeof o&&t.FormData)return a=new FormData,n.each(n.extend(m,e.settings.multipart_params),function(t,e){a.append(e,t)}),a.append(e.settings.file_data_name,o),void s.send(a);if("string"==typeof o)return s.setRequestHeader("Content-Type","multipart/form-data; boundary="+p),n.each(n.extend(m,e.settings.multipart_params),function(t,e){_+=C+p+x+'Content-Disposition: form-data; name="'+e+'"'+x+x,_+=unescape(encodeURIComponent(t))+x}),y=n.mimeTypes[i.name.replace(/^.+\.([^.]+)/,"$1").toLowerCase()]||"application/octet-stream",_+=C+p+x+'Content-Disposition: form-data; name="'+e.settings.file_data_name+'"; filename="'+unescape(encodeURIComponent(i.name))+'"'+x+"Content-Type: "+y+x+x+o+x+C+p+C+x,h=_.length-o.length,o=_,void u(o)}w=n.buildUrl(e.settings.url,n.extend(m,e.settings.multipart_params)),s.open("post",w,!0),s.setRequestHeader("Content-Type","application/octet-stream"),n.each(e.settings.headers,function(t,e){s.setRequestHeader(e,t)}),"string"==typeof o?u(o):s.send(o)}var f,g,m,v,b,y,w=e.settings.url;i.status!=n.DONE&&i.status!=n.FAILED&&e.state!=n.STOPPED&&(m={name:i.target_name||i.name},h.chunk_size&&i.size>h.chunk_size&&(r.chunks||"string"==typeof a)?(v=h.chunk_size,g=Math.ceil(i.size/v),b=Math.min(v,i.size-c*v),f="string"==typeof a?a.substring(c*v,c*v+b):o(a,c*v,c*v+b),m.chunk=c,m.chunks=g):(b=i.size,f=a),e.settings.multipart&&r.multipart&&"string"!=typeof f&&t.FileReader&&r.cantSendBlobInFormData&&r.chunks&&e.settings.chunk_size?!function(){var t=new FileReader;t.onload=function(){p(t.result),t=null},t.readAsBinaryString(f)}():p(f))}var c=0,d=0;l()}var l,h=e.settings;l=g[i.id],r.jpgresize&&e.settings.resize&&/\.(png|jpg|jpeg)$/i.test(i.name)?d.call(e,i,e.settings.resize,/\.png$/i.test(i.name)?"image/png":"image/jpeg",function(t){t.success?(i.size=t.data.length,a(t.data)):r.chunks?a(l):c(l,a)}):!r.chunks&&r.jpgresize?c(l,a):a(l)}),i.bind("Destroy",function(t){var i,o,a=e.body,r={inputContainer:t.id+"_html5_container",inputFile:t.id+"_html5",browseButton:t.settings.browse_button,dropElm:t.settings.drop_element};for(i in r)o=e.getElementById(r[i]),o&&n.removeAllEvents(o,t.id);n.removeAllEvents(e.body,t.id),t.settings.container&&(a=e.getElementById(t.settings.container)),a.removeChild(e.getElementById(r.inputContainer))}),void o({success:!0})):void o({success:!1})}})}(window,document,plupload),function(t,e,n,i){function o(t){return n.translate(t)||t}function a(t){t.html('<div class="plupload_wrapper"><div class="ui-widget-content plupload_container"><div class="plupload"><div class="ui-state-default ui-widget-header plupload_header"><div class="plupload_header_content"><div class="plupload_header_title">'+o("Select files")+'</div><div class="plupload_header_text">'+o("Add files to the upload queue and click the start button.")+'</div></div></div><div class="plupload_content"><table class="plupload_filelist"><tr class="ui-widget-header plupload_filelist_header"><td class="plupload_cell plupload_file_name">'+o("Filename")+'</td><td class="plupload_cell plupload_file_status">'+o("Status")+'</td><td class="plupload_cell plupload_file_size">'+o("Size")+'</td><td class="plupload_cell plupload_file_action">&nbsp;</td></tr></table><div class="plupload_scroll"><table class="plupload_filelist_content"></table></div><table class="plupload_filelist"><tr class="ui-widget-header ui-widget-content plupload_filelist_footer"><td class="plupload_cell plupload_file_name"><div class="plupload_buttons"><!-- Visible --><a class="plupload_button plupload_add">'+o("Add Files")+'</a>&nbsp;<a class="plupload_button plupload_start">'+o("Start Upload")+'</a>&nbsp;<a class="plupload_button plupload_stop plupload_hidden">'+o("Stop Upload")+'</a>&nbsp;</div><div class="plupload_started plupload_hidden"><!-- Hidden --><div class="plupload_progress plupload_right"><div class="plupload_progress_container"></div></div><div class="plupload_cell plupload_upload_status"></div><div class="plupload_clearer">&nbsp;</div></div></td><td class="plupload_file_status"><span class="plupload_total_status">0%</span></td><td class="plupload_file_size"><span class="plupload_total_file_size">0 kb</span></td><td class="plupload_file_action"></td></tr></table></div></div></div><input class="plupload_count" value="0" type="hidden"></div>')}var r={};i.widget("ui.plupload",{contents_bak:"",runtime:null,options:{browse_button_hover:"ui-state-hover",browse_button_active:"ui-state-active",dragdrop:!0,multiple_queues:!0,buttons:{browse:!0,start:!0,stop:!0},autostart:!1,sortable:!1,rename:!1,max_file_count:0},FILE_COUNT_ERROR:-9001,_create:function(){var t,e,s=this;t=this.element.attr("id"),t||(t=n.guid(),this.element.attr("id",t)),this.id=t,this.contents_bak=this.element.html(),a(this.element),this.container=i(".plupload_container",this.element).attr("id",t+"_container"),this.filelist=i(".plupload_filelist_content",this.container).attr({id:t+"_filelist",unselectable:"on"}),this.browse_button=i(".plupload_add",this.container).attr("id",t+"_browse"),this.start_button=i(".plupload_start",this.container).attr("id",t+"_start"),this.stop_button=i(".plupload_stop",this.container).attr("id",t+"_stop"),i.ui.button&&(this.browse_button.button({icons:{primary:"ui-icon-circle-plus"}}),this.start_button.button({icons:{primary:"ui-icon-circle-arrow-e"},disabled:!0}),this.stop_button.button({icons:{primary:"ui-icon-circle-close"}})),this.progressbar=i(".plupload_progress_container",this.container),i.ui.progressbar&&this.progressbar.progressbar(),this.counter=i(".plupload_count",this.element).attr({id:t+"_count",name:t+"_count"}),e=this.uploader=r[t]=new n.Uploader(i.extend({container:t,browse_button:t+"_browse"},this.options)),e.bind("Error",function(t,e){e.code===n.INIT_ERROR&&s.destroy()}),e.bind("Init",function(t,n){s.options.buttons.browse||(s.browse_button.button("disable").hide(),t.disableBrowse(!0)),s.options.buttons.start||s.start_button.button("disable").hide(),s.options.buttons.stop||s.stop_button.button("disable").hide(),!s.options.unique_names&&s.options.rename&&s._enableRenaming(),e.features.dragdrop&&s.options.dragdrop&&s._enableDragAndDrop(),s.container.attr("title",o("Using runtime: ")+(s.runtime=n.runtime)),s.start_button.click(function(t){i(this).button("option","disabled")||s.start(),t.preventDefault()}),s.stop_button.click(function(t){s.stop(),t.preventDefault()})}),s.options.max_file_count&&e.bind("FilesAdded",function(t,e){var n=[],i=e.length,a=t.files.length+i-s.options.max_file_count;a>0&&(n=e.splice(i-a,a),t.trigger("Error",{code:s.FILE_COUNT_ERROR,message:o("File count error."),file:n}))}),e.init(),e.bind("FilesAdded",function(t,e){s._trigger("selected",null,{up:t,files:e}),s.options.autostart&&setTimeout(function(){s.start()},10)}),e.bind("FilesRemoved",function(t,e){s._trigger("removed",null,{up:t,files:e})}),e.bind("QueueChanged",function(){s._updateFileList()}),e.bind("StateChanged",function(){s._handleState()}),e.bind("UploadFile",function(t,e){s._handleFileStatus(e)}),e.bind("FileUploaded",function(t,e){s._handleFileStatus(e),s._trigger("uploaded",null,{up:t,file:e})}),e.bind("UploadProgress",function(t,e){i("#"+e.id).find(".plupload_file_status").html(e.percent+"%").end().find(".plupload_file_size").html(n.formatSize(e.size)),s._handleFileStatus(e),s._updateTotalProgress(),s._trigger("progress",null,{up:t,file:e})}),e.bind("UploadComplete",function(t,e){s._trigger("complete",null,{up:t,files:e})}),e.bind("Error",function(t,e){var i,a,r=e.file;if(r){if(i="<strong>"+e.message+"</strong>",a=e.details)i+=" <br /><i>"+e.details+"</i>";else{switch(e.code){case n.FILE_EXTENSION_ERROR:a=o("File: %s").replace("%s",r.name);break;case n.FILE_SIZE_ERROR:a=o("File: %f, size: %s, max file size: %m").replace(/%([fsm])/g,function(t,e){switch(e){case"f":return r.name;case"s":return r.size;case"m":return n.parseSize(s.options.max_file_size)}});break;case s.FILE_COUNT_ERROR:a=o("Upload element accepts only %d file(s) at a time. Extra files were stripped.").replace("%d",s.options.max_file_count);break;case n.IMAGE_FORMAT_ERROR:a=n.translate("Image format either wrong or not supported.");break;case n.IMAGE_MEMORY_ERROR:a=n.translate("Runtime ran out of available memory.");break;case n.IMAGE_DIMENSIONS_ERROR:a=n.translate("Resoultion out of boundaries! <b>%s</b> runtime supports images only up to %wx%hpx.").replace(/%([swh])/g,function(e,n){switch(n){case"s":return t.runtime;case"w":return t.features.maxWidth;case"h":return t.features.maxHeight}});break;case n.HTTP_ERROR:a=o("Upload URL might be wrong or doesn't exist")}i+=" <br /><i>"+a+"</i>"}s.notify("error",i),s._trigger("error",null,{up:t,file:r,error:i})}})},_setOption:function(t,e){var n=this;"buttons"==t&&"object"==typeof e&&(e=i.extend(n.options.buttons,e),e.browse?(n.browse_button.button("enable").show(),up.disableBrowse(!1)):(n.browse_button.button("disable").hide(),up.disableBrowse(!0)),e.start?n.start_button.button("enable").show():n.start_button.button("disable").hide(),e.stop?n.start_button.button("enable").show():n.stop_button.button("disable").hide()),n.uploader.settings[t]=e},start:function(){this.uploader.start(),this._trigger("start",null)},stop:function(){this.uploader.stop(),this._trigger("stop",null)},getFile:function(t){var e;return e="number"==typeof t?this.uploader.files[t]:this.uploader.getFile(t)},removeFile:function(t){var e=this.getFile(t);e&&this.uploader.removeFile(e)},clearQueue:function(){this.uploader.splice()},getUploader:function(){return this.uploader},refresh:function(){this.uploader.refresh()},_handleState:function(){var t=this,e=this.uploader;e.state===n.STARTED?(i(t.start_button).button("disable"),i([]).add(t.stop_button).add(".plupload_started").removeClass("plupload_hidden"),i(".plupload_upload_status",t.element).html(o("Uploaded %d/%d files").replace("%d/%d",e.total.uploaded+"/"+e.files.length)),i(".plupload_header_content",t.element).addClass("plupload_header_content_bw")):(i([]).add(t.stop_button).add(".plupload_started").addClass("plupload_hidden"),t.options.multiple_queues&&(i(t.start_button).button("enable"),i(".plupload_header_content",t.element).removeClass("plupload_header_content_bw")),t._updateFileList())},_handleFileStatus:function(t){var e,o;if(i("#"+t.id).length){switch(t.status){case n.DONE:e="plupload_done",o="ui-icon ui-icon-circle-check";break;case n.FAILED:e="ui-state-error plupload_failed",o="ui-icon ui-icon-alert";break;case n.QUEUED:e="plupload_delete",o="ui-icon ui-icon-circle-minus";break;case n.UPLOADING:e="ui-state-highlight plupload_uploading",o="ui-icon ui-icon-circle-arrow-w";var a=i(".plupload_scroll",this.container),r=a.scrollTop(),s=a.height(),l=i("#"+t.id).position().top+i("#"+t.id).height();l>s&&a.scrollTop(r+l-s)}e+=" ui-state-default plupload_file",i("#"+t.id).attr("class",e).find(".ui-icon").attr("class",o)}},_updateTotalProgress:function(){var t=this.uploader;this.progressbar.progressbar("value",t.total.percent),this.element.find(".plupload_total_status").html(t.total.percent+"%").end().find(".plupload_total_file_size").html(n.formatSize(t.total.size)).end().find(".plupload_upload_status").html(o("Uploaded %d/%d files").replace("%d/%d",t.total.uploaded+"/"+t.files.length))},_updateFileList:function(){var t,e,a=this,r=this.uploader,s=this.filelist,l=0,c=this.id+"_";i.ui.sortable&&this.options.sortable&&i("tbody.ui-sortable",s).sortable("destroy"),s.empty(),i.each(r.files,function(o,d){e="",t=c+l,d.status===n.DONE&&(d.target_name&&(e+='<input type="hidden" name="'+t+'_tmpname" value="'+n.xmlEncode(d.target_name)+'" />'),e+='<input type="hidden" name="'+t+'_name" value="'+n.xmlEncode(d.name)+'" />',e+='<input type="hidden" name="'+t+'_status" value="'+(d.status===n.DONE?"done":"failed")+'" />',l++,a.counter.val(l)),s.append('<tr class="ui-state-default plupload_file" id="'+d.id+'"><td class="plupload_cell plupload_file_name"><span>'+d.name+'</span></td><td class="plupload_cell plupload_file_status">'+d.percent+'%</td><td class="plupload_cell plupload_file_size">'+n.formatSize(d.size)+'</td><td class="plupload_cell plupload_file_action"><div class="ui-icon"></div>'+e+"</td></tr>"),a._handleFileStatus(d),i("#"+d.id+".plupload_delete .ui-icon, #"+d.id+".plupload_done .ui-icon").click(function(t){i("#"+d.id).remove(),r.removeFile(d),t.preventDefault()}),a._trigger("updatelist",null,s)}),i(".ui-button-text",a.browse_button).html(0===r.total.queued?o("Add Files"):o("%d files queued").replace("%d",r.total.queued)),a.start_button.button(r.files.length===r.total.uploaded+r.total.failed?"disable":"enable"),s[0].scrollTop=s[0].scrollHeight,a._updateTotalProgress(),!r.files.length&&r.features.dragdrop&&r.settings.dragdrop?i("#"+t+"_filelist").append('<tr><td class="plupload_droptext">'+o("Drag files here.")+"</td></tr>"):a.options.sortable&&i.ui.sortable&&a._enableSortingList()},_enableRenaming:function(){var t=this;this.filelist.on("click",".plupload_delete .plupload_file_name span",function(e){var n,o,a,r=i(e.target),s="";n=t.uploader.getFile(r.parents("tr")[0].id),a=n.name,o=/^(.+)(\.[^.]+)$/.exec(a),o&&(a=o[1],s=o[2]),r.hide().after('<input class="plupload_file_rename" type="text" />'),r.next().val(a).focus().blur(function(){r.show().next().remove()}).keydown(function(t){var e=i(this);-1!==i.inArray(t.keyCode,[13,27])&&(t.preventDefault(),13===t.keyCode&&(n.name=e.val()+s,r.html(n.name)),e.blur())})})},_enableDragAndDrop:function(){this.filelist.append('<tr><td class="plupload_droptext">'+o("Drag files here.")+"</td></tr>"),this.filelist.parent().attr("id",this.id+"_dropbox"),this.uploader.settings.drop_element=this.options.drop_element=this.id+"_dropbox"},_enableSortingList:function(){var t=this;i("tbody tr",this.filelist).length<2||i("tbody",this.filelist).sortable({containment:"parent",items:".plupload_delete",helper:function(t,e){return e.clone(!0).find("td:not(.plupload_file_name)").remove().end().css("width","100%")},stop:function(){var e=[];i.each(i(this).sortable("toArray"),function(n,i){e[e.length]=t.uploader.getFile(i)}),e.unshift(e.length),e.unshift(0),Array.prototype.splice.apply(t.uploader.files,e)}})},notify:function(t,e){var n=i('<div class="plupload_message"><span class="plupload_message_close ui-icon ui-icon-circle-close" title="'+o("Close")+'"></span><p><span class="ui-icon"></span>'+e+"</p></div>");n.addClass("ui-state-"+("error"===t?"error":"highlight")).find("p .ui-icon").addClass("ui-icon-"+("error"===t?"alert":"info")).end().find(".plupload_message_close").click(function(){n.remove()}).end(),i(".plupload_header_content",this.container).append(n)},destroy:function(){i(".plupload_button",this.element).unbind(),i.ui.button&&i(".plupload_add, .plupload_start, .plupload_stop",this.container).button("destroy"),i.ui.progressbar&&this.progressbar.progressbar("destroy"),i.ui.sortable&&this.options.sortable&&i("tbody",this.filelist).sortable("destroy"),this.uploader.destroy(),this.element.empty().html(this.contents_bak),this.contents_bak="",i.Widget.prototype.destroy.apply(this)}})}(window,document,plupload,jQuery);var ti=-1,ei=1,ni=0;o.Diff,o.prototype.diff_main=function(t,e,n,i){"undefined"==typeof i&&(i=this.Diff_Timeout<=0?Number.MAX_VALUE:(new Date).getTime()+1e3*this.Diff_Timeout);var o=i;if(null==t||null==e)throw new Error("Null input. (diff_main)");if(t==e)return t?[[ni,t]]:[];"undefined"==typeof n&&(n=!0);var a=n,r=this.diff_commonPrefix(t,e),s=t.substring(0,r);t=t.substring(r),e=e.substring(r),r=this.diff_commonSuffix(t,e);var l=t.substring(t.length-r);t=t.substring(0,t.length-r),e=e.substring(0,e.length-r);var c=this.diff_compute_(t,e,a,o);return s&&c.unshift([ni,s]),l&&c.push([ni,l]),this.diff_cleanupMerge(c),c},o.prototype.diff_compute_=function(t,e,n,i){var o;if(!t)return[[ei,e]];if(!e)return[[ti,t]];var a=t.length>e.length?t:e,r=t.length>e.length?e:t,s=a.indexOf(r);if(-1!=s)return o=[[ei,a.substring(0,s)],[ni,r],[ei,a.substring(s+r.length)]],t.length>e.length&&(o[0][0]=o[2][0]=ti),o;if(1==r.length)return[[ti,t],[ei,e]];var l=this.diff_halfMatch_(t,e);if(l){var c=l[0],d=l[1],h=l[2],u=l[3],p=l[4],f=this.diff_main(c,h,n,i),g=this.diff_main(d,u,n,i);return f.concat([[ni,p]],g)}return n&&t.length>100&&e.length>100?this.diff_lineMode_(t,e,i):this.diff_bisect_(t,e,i)},o.prototype.diff_lineMode_=function(t,e,n){var i=this.diff_linesToChars_(t,e);t=i.chars1,e=i.chars2;var o=i.lineArray,a=this.diff_main(t,e,!1,n);this.diff_charsToLines_(a,o),this.diff_cleanupSemantic(a),a.push([ni,""]);for(var r=0,s=0,l=0,c="",d="";r<a.length;){switch(a[r][0]){case ei:l++,d+=a[r][1];break;case ti:s++,c+=a[r][1];break;case ni:if(s>=1&&l>=1){a.splice(r-s-l,s+l),r=r-s-l;
for(var i=this.diff_main(c,d,!1,n),h=i.length-1;h>=0;h--)a.splice(r,0,i[h]);r+=i.length}l=0,s=0,c="",d=""}r++}return a.pop(),a},o.prototype.diff_bisect_=function(t,e,n){for(var i=t.length,o=e.length,a=Math.ceil((i+o)/2),r=a,s=2*a,l=new Array(s),c=new Array(s),d=0;s>d;d++)l[d]=-1,c[d]=-1;l[r+1]=0,c[r+1]=0;for(var h=i-o,u=h%2!=0,p=0,f=0,g=0,m=0,v=0;a>v&&!((new Date).getTime()>n);v++){for(var b=-v+p;v-f>=b;b+=2){var y,w=r+b;y=b==-v||b!=v&&l[w-1]<l[w+1]?l[w+1]:l[w-1]+1;for(var C=y-b;i>y&&o>C&&t.charAt(y)==e.charAt(C);)y++,C++;if(l[w]=y,y>i)f+=2;else if(C>o)p+=2;else if(u){var x=r+h-b;if(x>=0&&s>x&&-1!=c[x]){var _=i-c[x];if(y>=_)return this.diff_bisectSplit_(t,e,y,C,n)}}}for(var T=-v+g;v-m>=T;T+=2){var _,x=r+T;_=T==-v||T!=v&&c[x-1]<c[x+1]?c[x+1]:c[x-1]+1;for(var S=_-T;i>_&&o>S&&t.charAt(i-_-1)==e.charAt(o-S-1);)_++,S++;if(c[x]=_,_>i)m+=2;else if(S>o)g+=2;else if(!u){var w=r+h-T;if(w>=0&&s>w&&-1!=l[w]){var y=l[w],C=r+y-w;if(_=i-_,y>=_)return this.diff_bisectSplit_(t,e,y,C,n)}}}}return[[ti,t],[ei,e]]},o.prototype.diff_bisectSplit_=function(t,e,n,i,o){var a=t.substring(0,n),r=e.substring(0,i),s=t.substring(n),l=e.substring(i),c=this.diff_main(a,r,!1,o),d=this.diff_main(s,l,!1,o);return c.concat(d)},o.prototype.diff_linesToChars_=function(t,e){function n(t){for(var e="",n=0,a=-1,r=i.length;a<t.length-1;){a=t.indexOf("\n",n),-1==a&&(a=t.length-1);var s=t.substring(n,a+1);n=a+1,(o.hasOwnProperty?o.hasOwnProperty(s):void 0!==o[s])?e+=String.fromCharCode(o[s]):(e+=String.fromCharCode(r),o[s]=r,i[r++]=s)}return e}var i=[],o={};i[0]="";var a=n(t),r=n(e);return{chars1:a,chars2:r,lineArray:i}},o.prototype.diff_charsToLines_=function(t,e){for(var n=0;n<t.length;n++){for(var i=t[n][1],o=[],a=0;a<i.length;a++)o[a]=e[i.charCodeAt(a)];t[n][1]=o.join("")}},o.prototype.diff_commonPrefix=function(t,e){if(!t||!e||t.charAt(0)!=e.charAt(0))return 0;for(var n=0,i=Math.min(t.length,e.length),o=i,a=0;o>n;)t.substring(a,o)==e.substring(a,o)?(n=o,a=n):i=o,o=Math.floor((i-n)/2+n);return o},o.prototype.diff_commonSuffix=function(t,e){if(!t||!e||t.charAt(t.length-1)!=e.charAt(e.length-1))return 0;for(var n=0,i=Math.min(t.length,e.length),o=i,a=0;o>n;)t.substring(t.length-o,t.length-a)==e.substring(e.length-o,e.length-a)?(n=o,a=n):i=o,o=Math.floor((i-n)/2+n);return o},o.prototype.diff_commonOverlap_=function(t,e){var n=t.length,i=e.length;if(0==n||0==i)return 0;n>i?t=t.substring(n-i):i>n&&(e=e.substring(0,n));var o=Math.min(n,i);if(t==e)return o;for(var a=0,r=1;;){var s=t.substring(o-r),l=e.indexOf(s);if(-1==l)return a;r+=l,(0==l||t.substring(o-r)==e.substring(0,r))&&(a=r,r++)}},o.prototype.diff_halfMatch_=function(t,e){function n(t,e,n){for(var i,o,a,s,l=t.substring(n,n+Math.floor(t.length/4)),c=-1,d="";-1!=(c=e.indexOf(l,c+1));){var h=r.diff_commonPrefix(t.substring(n),e.substring(c)),u=r.diff_commonSuffix(t.substring(0,n),e.substring(0,c));d.length<u+h&&(d=e.substring(c-u,c)+e.substring(c,c+h),i=t.substring(0,n-u),o=t.substring(n+h),a=e.substring(0,c-u),s=e.substring(c+h))}return 2*d.length>=t.length?[i,o,a,s,d]:null}if(this.Diff_Timeout<=0)return null;var i=t.length>e.length?t:e,o=t.length>e.length?e:t;if(i.length<4||2*o.length<i.length)return null;var a,r=this,s=n(i,o,Math.ceil(i.length/4)),l=n(i,o,Math.ceil(i.length/2));if(!s&&!l)return null;a=l?s&&s[4].length>l[4].length?s:l:s;var c,d,h,u;t.length>e.length?(c=a[0],d=a[1],h=a[2],u=a[3]):(h=a[0],u=a[1],c=a[2],d=a[3]);var p=a[4];return[c,d,h,u,p]},o.prototype.diff_cleanupSemantic=function(t){for(var e=!1,n=[],i=0,o=null,a=0,r=0,s=0,l=0,c=0;a<t.length;)t[a][0]==ni?(n[i++]=a,r=l,s=c,l=0,c=0,o=t[a][1]):(t[a][0]==ei?l+=t[a][1].length:c+=t[a][1].length,o&&o.length<=Math.max(r,s)&&o.length<=Math.max(l,c)&&(t.splice(n[i-1],0,[ti,o]),t[n[i-1]+1][0]=ei,i--,i--,a=i>0?n[i-1]:-1,r=0,s=0,l=0,c=0,o=null,e=!0)),a++;for(e&&this.diff_cleanupMerge(t),this.diff_cleanupSemanticLossless(t),a=1;a<t.length;){if(t[a-1][0]==ti&&t[a][0]==ei){var d=t[a-1][1],h=t[a][1],u=this.diff_commonOverlap_(d,h),p=this.diff_commonOverlap_(h,d);u>=p?(u>=d.length/2||u>=h.length/2)&&(t.splice(a,0,[ni,h.substring(0,u)]),t[a-1][1]=d.substring(0,d.length-u),t[a+1][1]=h.substring(u),a++):(p>=d.length/2||p>=h.length/2)&&(t.splice(a,0,[ni,d.substring(0,p)]),t[a-1][0]=ei,t[a-1][1]=h.substring(0,h.length-p),t[a+1][0]=ti,t[a+1][1]=d.substring(p),a++),a++}a++}},o.prototype.diff_cleanupSemanticLossless=function(t){function e(t,e){if(!t||!e)return 6;var n=t.charAt(t.length-1),i=e.charAt(0),a=n.match(o.nonAlphaNumericRegex_),r=i.match(o.nonAlphaNumericRegex_),s=a&&n.match(o.whitespaceRegex_),l=r&&i.match(o.whitespaceRegex_),c=s&&n.match(o.linebreakRegex_),d=l&&i.match(o.linebreakRegex_),h=c&&t.match(o.blanklineEndRegex_),u=d&&e.match(o.blanklineStartRegex_);return h||u?5:c||d?4:a&&!s&&l?3:s||l?2:a||r?1:0}for(var n=1;n<t.length-1;){if(t[n-1][0]==ni&&t[n+1][0]==ni){var i=t[n-1][1],a=t[n][1],r=t[n+1][1],s=this.diff_commonSuffix(i,a);if(s){var l=a.substring(a.length-s);i=i.substring(0,i.length-s),a=l+a.substring(0,a.length-s),r=l+r}for(var c=i,d=a,h=r,u=e(i,a)+e(a,r);a.charAt(0)===r.charAt(0);){i+=a.charAt(0),a=a.substring(1)+r.charAt(0),r=r.substring(1);var p=e(i,a)+e(a,r);p>=u&&(u=p,c=i,d=a,h=r)}t[n-1][1]!=c&&(c?t[n-1][1]=c:(t.splice(n-1,1),n--),t[n][1]=d,h?t[n+1][1]=h:(t.splice(n+1,1),n--))}n++}},o.nonAlphaNumericRegex_=/[^a-zA-Z0-9]/,o.whitespaceRegex_=/\s/,o.linebreakRegex_=/[\r\n]/,o.blanklineEndRegex_=/\n\r?\n$/,o.blanklineStartRegex_=/^\r?\n\r?\n/,o.prototype.diff_cleanupEfficiency=function(t){for(var e=!1,n=[],i=0,o=null,a=0,r=!1,s=!1,l=!1,c=!1;a<t.length;)t[a][0]==ni?(t[a][1].length<this.Diff_EditCost&&(l||c)?(n[i++]=a,r=l,s=c,o=t[a][1]):(i=0,o=null),l=c=!1):(t[a][0]==ti?c=!0:l=!0,o&&(r&&s&&l&&c||o.length<this.Diff_EditCost/2&&r+s+l+c==3)&&(t.splice(n[i-1],0,[ti,o]),t[n[i-1]+1][0]=ei,i--,o=null,r&&s?(l=c=!0,i=0):(i--,a=i>0?n[i-1]:-1,l=c=!1),e=!0)),a++;e&&this.diff_cleanupMerge(t)},o.prototype.diff_cleanupMerge=function(t){t.push([ni,""]);for(var e,n=0,i=0,o=0,a="",r="";n<t.length;)switch(t[n][0]){case ei:o++,r+=t[n][1],n++;break;case ti:i++,a+=t[n][1],n++;break;case ni:i+o>1?(0!==i&&0!==o&&(e=this.diff_commonPrefix(r,a),0!==e&&(n-i-o>0&&t[n-i-o-1][0]==ni?t[n-i-o-1][1]+=r.substring(0,e):(t.splice(0,0,[ni,r.substring(0,e)]),n++),r=r.substring(e),a=a.substring(e)),e=this.diff_commonSuffix(r,a),0!==e&&(t[n][1]=r.substring(r.length-e)+t[n][1],r=r.substring(0,r.length-e),a=a.substring(0,a.length-e))),0===i?t.splice(n-o,i+o,[ei,r]):0===o?t.splice(n-i,i+o,[ti,a]):t.splice(n-i-o,i+o,[ti,a],[ei,r]),n=n-i-o+(i?1:0)+(o?1:0)+1):0!==n&&t[n-1][0]==ni?(t[n-1][1]+=t[n][1],t.splice(n,1)):n++,o=0,i=0,a="",r=""}""===t[t.length-1][1]&&t.pop();var s=!1;for(n=1;n<t.length-1;)t[n-1][0]==ni&&t[n+1][0]==ni&&(t[n][1].substring(t[n][1].length-t[n-1][1].length)==t[n-1][1]?(t[n][1]=t[n-1][1]+t[n][1].substring(0,t[n][1].length-t[n-1][1].length),t[n+1][1]=t[n-1][1]+t[n+1][1],t.splice(n-1,1),s=!0):t[n][1].substring(0,t[n+1][1].length)==t[n+1][1]&&(t[n-1][1]+=t[n+1][1],t[n][1]=t[n][1].substring(t[n+1][1].length)+t[n+1][1],t.splice(n+1,1),s=!0)),n++;s&&this.diff_cleanupMerge(t)},o.prototype.diff_xIndex=function(t,e){var n,i=0,o=0,a=0,r=0;for(n=0;n<t.length&&(t[n][0]!==ei&&(i+=t[n][1].length),t[n][0]!==ti&&(o+=t[n][1].length),!(i>e));n++)a=i,r=o;return t.length!=n&&t[n][0]===ti?r:r+(e-a)},o.prototype.diff_prettyHtml=function(t){for(var e=[],n=/&/g,i=/</g,o=/>/g,a=/\n/g,r=0;r<t.length;r++){var s=t[r][0],l=t[r][1],c=l.replace(n,"&amp;").replace(i,"&lt;").replace(o,"&gt;").replace(a,"&para;<br>");switch(s){case ei:e[r]='<ins style="background:#e6ffe6;">'+c+"</ins>";break;case ti:e[r]='<del style="background:#ffe6e6;">'+c+"</del>";break;case ni:e[r]="<span>"+c+"</span>"}}return e.join("")},o.prototype.diff_text1=function(t){for(var e=[],n=0;n<t.length;n++)t[n][0]!==ei&&(e[n]=t[n][1]);return e.join("")},o.prototype.diff_text2=function(t){for(var e=[],n=0;n<t.length;n++)t[n][0]!==ti&&(e[n]=t[n][1]);return e.join("")},o.prototype.diff_levenshtein=function(t){for(var e=0,n=0,i=0,o=0;o<t.length;o++){var a=t[o][0],r=t[o][1];switch(a){case ei:n+=r.length;break;case ti:i+=r.length;break;case ni:e+=Math.max(n,i),n=0,i=0}}return e+=Math.max(n,i)},o.prototype.diff_toDelta=function(t){for(var e=[],n=0;n<t.length;n++)switch(t[n][0]){case ei:e[n]="+"+encodeURI(t[n][1]);break;case ti:e[n]="-"+t[n][1].length;break;case ni:e[n]="="+t[n][1].length}return e.join("	").replace(/%20/g," ")},o.prototype.diff_fromDelta=function(t,e){for(var n=[],i=0,o=0,a=e.split(/\t/g),r=0;r<a.length;r++){var s=a[r].substring(1);switch(a[r].charAt(0)){case"+":try{n[i++]=[ei,decodeURI(s)]}catch(l){throw new Error("Illegal escape in diff_fromDelta: "+s)}break;case"-":case"=":var c=parseInt(s,10);if(isNaN(c)||0>c)throw new Error("Invalid number in diff_fromDelta: "+s);var d=t.substring(o,o+=c);n[i++]="="==a[r].charAt(0)?[ni,d]:[ti,d];break;default:if(a[r])throw new Error("Invalid diff operation in diff_fromDelta: "+a[r])}}if(o!=t.length)throw new Error("Delta length ("+o+") does not equal source text length ("+t.length+").");return n},o.prototype.match_main=function(t,e,n){if(null==t||null==e||null==n)throw new Error("Null input. (match_main)");return n=Math.max(0,Math.min(n,t.length)),t==e?0:t.length?t.substring(n,n+e.length)==e?n:this.match_bitap_(t,e,n):-1},o.prototype.match_bitap_=function(t,e,n){function i(t,i){var o=t/e.length,r=Math.abs(n-i);return a.Match_Distance?o+r/a.Match_Distance:r?1:o}if(e.length>this.Match_MaxBits)throw new Error("Pattern too long for this browser.");var o=this.match_alphabet_(e),a=this,r=this.Match_Threshold,s=t.indexOf(e,n);-1!=s&&(r=Math.min(i(0,s),r),s=t.lastIndexOf(e,n+e.length),-1!=s&&(r=Math.min(i(0,s),r)));var l=1<<e.length-1;s=-1;for(var c,d,h,u=e.length+t.length,p=0;p<e.length;p++){for(c=0,d=u;d>c;)i(p,n+d)<=r?c=d:u=d,d=Math.floor((u-c)/2+c);u=d;var f=Math.max(1,n-d+1),g=Math.min(n+d,t.length)+e.length,m=Array(g+2);m[g+1]=(1<<p)-1;for(var v=g;v>=f;v--){var b=o[t.charAt(v-1)];if(m[v]=0===p?(m[v+1]<<1|1)&b:(m[v+1]<<1|1)&b|((h[v+1]|h[v])<<1|1)|h[v+1],m[v]&l){var y=i(p,v-1);if(r>=y){if(r=y,s=v-1,!(s>n))break;f=Math.max(1,2*n-s)}}}if(i(p+1,n)>r)break;h=m}return s},o.prototype.match_alphabet_=function(t){for(var e={},n=0;n<t.length;n++)e[t.charAt(n)]=0;for(var n=0;n<t.length;n++)e[t.charAt(n)]|=1<<t.length-n-1;return e},o.prototype.patch_addContext_=function(t,e){if(0!=e.length){for(var n=e.substring(t.start2,t.start2+t.length1),i=0;e.indexOf(n)!=e.lastIndexOf(n)&&n.length<this.Match_MaxBits-this.Patch_Margin-this.Patch_Margin;)i+=this.Patch_Margin,n=e.substring(t.start2-i,t.start2+t.length1+i);i+=this.Patch_Margin;var o=e.substring(t.start2-i,t.start2);o&&t.diffs.unshift([ni,o]);var a=e.substring(t.start2+t.length1,t.start2+t.length1+i);a&&t.diffs.push([ni,a]),t.start1-=o.length,t.start2-=o.length,t.length1+=o.length+a.length,t.length2+=o.length+a.length}},o.prototype.patch_make=function(t,e,n){var i,a;if("string"==typeof t&&"string"==typeof e&&"undefined"==typeof n)i=t,a=this.diff_main(i,e,!0),a.length>2&&(this.diff_cleanupSemantic(a),this.diff_cleanupEfficiency(a));else if(t&&"object"==typeof t&&"undefined"==typeof e&&"undefined"==typeof n)a=t,i=this.diff_text1(a);else if("string"==typeof t&&e&&"object"==typeof e&&"undefined"==typeof n)i=t,a=e;else{if("string"!=typeof t||"string"!=typeof e||!n||"object"!=typeof n)throw new Error("Unknown call format to patch_make.");i=t,a=n}if(0===a.length)return[];for(var r=[],s=new o.patch_obj,l=0,c=0,d=0,h=i,u=i,p=0;p<a.length;p++){var f=a[p][0],g=a[p][1];switch(l||f===ni||(s.start1=c,s.start2=d),f){case ei:s.diffs[l++]=a[p],s.length2+=g.length,u=u.substring(0,d)+g+u.substring(d);break;case ti:s.length1+=g.length,s.diffs[l++]=a[p],u=u.substring(0,d)+u.substring(d+g.length);break;case ni:g.length<=2*this.Patch_Margin&&l&&a.length!=p+1?(s.diffs[l++]=a[p],s.length1+=g.length,s.length2+=g.length):g.length>=2*this.Patch_Margin&&l&&(this.patch_addContext_(s,h),r.push(s),s=new o.patch_obj,l=0,h=u,c=d)}f!==ei&&(c+=g.length),f!==ti&&(d+=g.length)}return l&&(this.patch_addContext_(s,h),r.push(s)),r},o.prototype.patch_deepCopy=function(t){for(var e=[],n=0;n<t.length;n++){var i=t[n],a=new o.patch_obj;a.diffs=[];for(var r=0;r<i.diffs.length;r++)a.diffs[r]=i.diffs[r].slice();a.start1=i.start1,a.start2=i.start2,a.length1=i.length1,a.length2=i.length2,e[n]=a}return e},o.prototype.patch_apply=function(t,e){if(0==t.length)return[e,[]];t=this.patch_deepCopy(t);var n=this.patch_addPadding(t);e=n+e+n,this.patch_splitMax(t);for(var i=0,o=[],a=0;a<t.length;a++){var r,s=t[a].start2+i,l=this.diff_text1(t[a].diffs),c=-1;if(l.length>this.Match_MaxBits?(r=this.match_main(e,l.substring(0,this.Match_MaxBits),s),-1!=r&&(c=this.match_main(e,l.substring(l.length-this.Match_MaxBits),s+l.length-this.Match_MaxBits),(-1==c||r>=c)&&(r=-1))):r=this.match_main(e,l,s),-1==r)o[a]=!1,i-=t[a].length2-t[a].length1;else{o[a]=!0,i=r-s;var d;if(d=-1==c?e.substring(r,r+l.length):e.substring(r,c+this.Match_MaxBits),l==d)e=e.substring(0,r)+this.diff_text2(t[a].diffs)+e.substring(r+l.length);else{var h=this.diff_main(l,d,!1);if(l.length>this.Match_MaxBits&&this.diff_levenshtein(h)/l.length>this.Patch_DeleteThreshold)o[a]=!1;else{this.diff_cleanupSemanticLossless(h);for(var u,p=0,f=0;f<t[a].diffs.length;f++){var g=t[a].diffs[f];g[0]!==ni&&(u=this.diff_xIndex(h,p)),g[0]===ei?e=e.substring(0,r+u)+g[1]+e.substring(r+u):g[0]===ti&&(e=e.substring(0,r+u)+e.substring(r+this.diff_xIndex(h,p+g[1].length))),g[0]!==ti&&(p+=g[1].length)}}}}}return e=e.substring(n.length,e.length-n.length),[e,o]},o.prototype.patch_addPadding=function(t){for(var e=this.Patch_Margin,n="",i=1;e>=i;i++)n+=String.fromCharCode(i);for(var i=0;i<t.length;i++)t[i].start1+=e,t[i].start2+=e;var o=t[0],a=o.diffs;if(0==a.length||a[0][0]!=ni)a.unshift([ni,n]),o.start1-=e,o.start2-=e,o.length1+=e,o.length2+=e;else if(e>a[0][1].length){var r=e-a[0][1].length;a[0][1]=n.substring(a[0][1].length)+a[0][1],o.start1-=r,o.start2-=r,o.length1+=r,o.length2+=r}if(o=t[t.length-1],a=o.diffs,0==a.length||a[a.length-1][0]!=ni)a.push([ni,n]),o.length1+=e,o.length2+=e;else if(e>a[a.length-1][1].length){var r=e-a[a.length-1][1].length;a[a.length-1][1]+=n.substring(0,r),o.length1+=r,o.length2+=r}return n},o.prototype.patch_splitMax=function(t){for(var e=this.Match_MaxBits,n=0;n<t.length;n++)if(!(t[n].length1<=e)){var i=t[n];t.splice(n--,1);for(var a=i.start1,r=i.start2,s="";0!==i.diffs.length;){var l=new o.patch_obj,c=!0;for(l.start1=a-s.length,l.start2=r-s.length,""!==s&&(l.length1=l.length2=s.length,l.diffs.push([ni,s]));0!==i.diffs.length&&l.length1<e-this.Patch_Margin;){var d=i.diffs[0][0],h=i.diffs[0][1];d===ei?(l.length2+=h.length,r+=h.length,l.diffs.push(i.diffs.shift()),c=!1):d===ti&&1==l.diffs.length&&l.diffs[0][0]==ni&&h.length>2*e?(l.length1+=h.length,a+=h.length,c=!1,l.diffs.push([d,h]),i.diffs.shift()):(h=h.substring(0,e-l.length1-this.Patch_Margin),l.length1+=h.length,a+=h.length,d===ni?(l.length2+=h.length,r+=h.length):c=!1,l.diffs.push([d,h]),h==i.diffs[0][1]?i.diffs.shift():i.diffs[0][1]=i.diffs[0][1].substring(h.length))}s=this.diff_text2(l.diffs),s=s.substring(s.length-this.Patch_Margin);var u=this.diff_text1(i.diffs).substring(0,this.Patch_Margin);""!==u&&(l.length1+=u.length,l.length2+=u.length,0!==l.diffs.length&&l.diffs[l.diffs.length-1][0]===ni?l.diffs[l.diffs.length-1][1]+=u:l.diffs.push([ni,u])),c||t.splice(++n,0,l)}}},o.prototype.patch_toText=function(t){for(var e=[],n=0;n<t.length;n++)e[n]=t[n];return e.join("")},o.prototype.patch_fromText=function(t){var e=[];if(!t)return e;for(var n=t.split("\n"),i=0,a=/^@@ -(\d+),?(\d*) \+(\d+),?(\d*) @@$/;i<n.length;){var r=n[i].match(a);if(!r)throw new Error("Invalid patch string: "+n[i]);var s=new o.patch_obj;for(e.push(s),s.start1=parseInt(r[1],10),""===r[2]?(s.start1--,s.length1=1):"0"==r[2]?s.length1=0:(s.start1--,s.length1=parseInt(r[2],10)),s.start2=parseInt(r[3],10),""===r[4]?(s.start2--,s.length2=1):"0"==r[4]?s.length2=0:(s.start2--,s.length2=parseInt(r[4],10)),i++;i<n.length;){var l=n[i].charAt(0);try{var c=decodeURI(n[i].substring(1))}catch(d){throw new Error("Illegal escape in patch_fromText: "+c)}if("-"==l)s.diffs.push([ti,c]);else if("+"==l)s.diffs.push([ei,c]);else if(" "==l)s.diffs.push([ni,c]);else{if("@"==l)break;if(""!==l)throw new Error('Invalid patch mode "'+l+'" in: '+c)}i++}}return e},o.patch_obj=function(){this.diffs=[],this.start1=null,this.start2=null,this.length1=0,this.length2=0},o.patch_obj.prototype.toString=function(){var t,e;t=0===this.length1?this.start1+",0":1==this.length1?this.start1+1:this.start1+1+","+this.length1,e=0===this.length2?this.start2+",0":1==this.length2?this.start2+1:this.start2+1+","+this.length2;for(var n,i=["@@ -"+t+" +"+e+" @@\n"],o=0;o<this.diffs.length;o++){switch(this.diffs[o][0]){case ei:n="+";break;case ti:n="-";break;case ni:n=" "}i[o+1]=n+encodeURI(this.diffs[o][1])+"\n"}return i.join("").replace(/%20/g," ")},this.diff_match_patch=o,this.DIFF_DELETE=ti,this.DIFF_INSERT=ei,this.DIFF_EQUAL=ni,function(t){var e,n,i,o=t(window),a={jqueryui:{container:"ui-widget ui-widget-content ui-corner-all",notice:"ui-state-highlight",notice_icon:"ui-icon ui-icon-info",info:"",info_icon:"ui-icon ui-icon-info",success:"ui-state-default",success_icon:"ui-icon ui-icon-circle-check",error:"ui-state-error",error_icon:"ui-icon ui-icon-alert",closer:"ui-icon ui-icon-close",pin_up:"ui-icon ui-icon-pin-w",pin_down:"ui-icon ui-icon-pin-s",hi_menu:"ui-state-default ui-corner-bottom",hi_btn:"ui-state-default ui-corner-all",hi_btnhov:"ui-state-hover",hi_hnd:"ui-icon ui-icon-grip-dotted-horizontal"},bootstrap:{container:"alert",notice:"",notice_icon:"icon-exclamation-sign",info:"alert-info",info_icon:"icon-info-sign",success:"alert-success",success_icon:"icon-ok-sign",error:"alert-error",error_icon:"icon-warning-sign",closer:"icon-remove",pin_up:"icon-pause",pin_down:"icon-play",hi_menu:"well",hi_btn:"btn",hi_btnhov:"",hi_hnd:"icon-chevron-down"}},r=function(){i=t("body"),o=t(window),o.bind("resize",function(){n&&clearTimeout(n),n=setTimeout(t.pnotify_position_all,10)})};document.body?r():t(r),t.extend({pnotify_remove_all:function(){var e=o.data("pnotify");e&&e.length&&t.each(e,function(){this.pnotify_remove&&this.pnotify_remove()})},pnotify_position_all:function(){n&&clearTimeout(n),n=null;var e=o.data("pnotify");e&&e.length&&(t.each(e,function(){var t=this.opts.stack;t&&(t.nextpos1=t.firstpos1,t.nextpos2=t.firstpos2,t.addpos2=0,t.animation=!0)}),t.each(e,function(){this.pnotify_position()}))},pnotify:function(r){var s,l;"object"!=typeof r?(l=t.extend({},t.pnotify.defaults),l.text=r):l=t.extend({},t.pnotify.defaults,r);for(var c in l)"string"==typeof c&&c.match(/^pnotify_/)&&(l[c.replace(/^pnotify_/,"")]=l[c]);if(l.before_init&&l.before_init(l)===!1)return null;var d,u=function(e,n){f.css("display","none");var i=document.elementFromPoint(e.clientX,e.clientY);f.css("display","block");var o=t(i),a=o.css("cursor");f.css("cursor","auto"!=a?a:"default"),d&&d.get(0)==i||(d&&(h.call(d.get(0),"mouseleave",e.originalEvent),h.call(d.get(0),"mouseout",e.originalEvent)),h.call(i,"mouseenter",e.originalEvent),h.call(i,"mouseover",e.originalEvent)),h.call(i,n,e.originalEvent),d=o},p=a[l.styling],f=t("<div />",{"class":"ui-pnotify "+l.addclass,css:{display:"none"},mouseenter:function(t){l.nonblock&&t.stopPropagation(),l.mouse_reset&&"out"==s&&(f.stop(!0),s="in",f.css("height","auto").animate({width:l.width,opacity:l.nonblock?l.nonblock_opacity:l.opacity},"fast")),l.nonblock&&f.stop().animate({opacity:l.nonblock_opacity},"fast"),l.hide&&l.mouse_reset&&f.pnotify_cancel_remove(),l.sticker&&!l.nonblock&&f.sticker.trigger("pnotify_icon").css("visibility","visible"),l.closer&&!l.nonblock&&f.closer.css("visibility","visible")},mouseleave:function(e){l.nonblock&&e.stopPropagation(),d=null,f.css("cursor","auto"),l.nonblock&&"out"!=s&&f.stop().animate({opacity:l.opacity},"fast"),l.hide&&l.mouse_reset&&f.pnotify_queue_remove(),l.sticker_hover&&f.sticker.css("visibility","hidden"),l.closer_hover&&f.closer.css("visibility","hidden"),t.pnotify_position_all()},mouseover:function(t){l.nonblock&&t.stopPropagation()},mouseout:function(t){l.nonblock&&t.stopPropagation()},mousemove:function(t){l.nonblock&&(t.stopPropagation(),u(t,"onmousemove"))},mousedown:function(t){l.nonblock&&(t.stopPropagation(),t.preventDefault(),u(t,"onmousedown"))},mouseup:function(t){l.nonblock&&(t.stopPropagation(),t.preventDefault(),u(t,"onmouseup"))},click:function(t){l.nonblock&&(t.stopPropagation(),u(t,"onclick"))},dblclick:function(t){l.nonblock&&(t.stopPropagation(),u(t,"ondblclick"))}});f.opts=l;var g;g=l.state?"ui-state-"+l.state:p[l.type]?p[l.type]:p.notice,f.container=t("<div />",{"class":p.container+" ui-pnotify-container "+g}).appendTo(f),""!=l.cornerclass&&f.container.removeClass("ui-corner-all").addClass(l.cornerclass),l.shadow&&f.container.addClass("ui-pnotify-shadow"),f.pnotify_version="1.2.2",f.pnotify=function(e){var n=l;"string"==typeof e?l.text=e:l=t.extend({},l,e);for(var i in l)"string"==typeof i&&i.match(/^pnotify_/)&&(l[i.replace(/^pnotify_/,"")]=l[i]);return f.opts=l,l.cornerclass!=n.cornerclass&&f.container.removeClass("ui-corner-all").addClass(l.cornerclass),l.shadow!=n.shadow&&(l.shadow?f.container.addClass("ui-pnotify-shadow"):f.container.removeClass("ui-pnotify-shadow")),l.addclass===!1?f.removeClass(n.addclass):l.addclass!==n.addclass&&f.removeClass(n.addclass).addClass(l.addclass),l.title===!1?f.title_container.slideUp("fast"):l.title!==n.title&&(l.title_escape?f.title_container.text(l.title).slideDown(200):f.title_container.html(l.title).slideDown(200)),l.text===!1?f.text_container.slideUp("fast"):l.text!==n.text&&(l.text_escape?f.text_container.text(l.text).slideDown(200):f.text_container.html(l.insert_brs?String(l.text).replace(/\n/g,"<br />"):l.text).slideDown(200)),f.pnotify_history=l.history,f.pnotify_hide=l.hide,l.type!=n.type&&f.container.removeClass(p.error+" "+p.notice+" "+p.success+" "+p.info).addClass("error"==l.type?p.error:"info"==l.type?p.info:"success"==l.type?p.success:p.notice),(l.icon!==n.icon||l.icon===!0&&l.type!=n.type)&&(f.container.find("div.ui-pnotify-icon").remove(),l.icon!==!1&&t("<div />",{"class":"ui-pnotify-icon"}).append(t("<span />",{"class":l.icon===!0?"error"==l.type?p.error_icon:"info"==l.type?p.info_icon:"success"==l.type?p.success_icon:p.notice_icon:l.icon})).prependTo(f.container)),l.width!==n.width&&f.animate({width:l.width}),l.min_height!==n.min_height&&f.container.animate({minHeight:l.min_height}),l.opacity!==n.opacity&&f.fadeTo(l.animate_speed,l.opacity),!l.closer||l.nonblock?f.closer.css("display","none"):f.closer.css("display","block"),!l.sticker||l.nonblock?f.sticker.css("display","none"):f.sticker.css("display","block"),f.sticker.trigger("pnotify_icon"),l.sticker_hover?f.sticker.css("visibility","hidden"):l.nonblock||f.sticker.css("visibility","visible"),l.closer_hover?f.closer.css("visibility","hidden"):l.nonblock||f.closer.css("visibility","visible"),l.hide?n.hide||f.pnotify_queue_remove():f.pnotify_cancel_remove(),f.pnotify_queue_position(),f},f.pnotify_position=function(t){var e=f.opts.stack;if(e){e.nextpos1||(e.nextpos1=e.firstpos1),e.nextpos2||(e.nextpos2=e.firstpos2),e.addpos2||(e.addpos2=0);var n="none"==f.css("display");if(!n||t){var i,a,r,s={};switch(e.dir1){case"down":r="top";break;case"up":r="bottom";break;case"left":r="right";break;case"right":r="left"}i=parseInt(f.css(r)),isNaN(i)&&(i=0),"undefined"!=typeof e.firstpos1||n||(e.firstpos1=i,e.nextpos1=e.firstpos1);var l;switch(e.dir2){case"down":l="top";break;case"up":l="bottom";break;case"left":l="right";break;case"right":l="left"}if(a=parseInt(f.css(l)),isNaN(a)&&(a=0),"undefined"!=typeof e.firstpos2||n||(e.firstpos2=a,e.nextpos2=e.firstpos2),("down"==e.dir1&&e.nextpos1+f.height()>o.height()||"up"==e.dir1&&e.nextpos1+f.height()>o.height()||"left"==e.dir1&&e.nextpos1+f.width()>o.width()||"right"==e.dir1&&e.nextpos1+f.width()>o.width())&&(e.nextpos1=e.firstpos1,e.nextpos2+=e.addpos2+("undefined"==typeof e.spacing2?25:e.spacing2),e.addpos2=0),e.animation&&e.nextpos2<a)switch(e.dir2){case"down":s.top=e.nextpos2+"px";break;case"up":s.bottom=e.nextpos2+"px";break;case"left":s.right=e.nextpos2+"px";break;case"right":s.left=e.nextpos2+"px"}else e.nextpos2&&f.css(l,e.nextpos2+"px");switch(e.dir2){case"down":case"up":f.outerHeight(!0)>e.addpos2&&(e.addpos2=f.height());break;case"left":case"right":f.outerWidth(!0)>e.addpos2&&(e.addpos2=f.width())}if(e.nextpos1)if(e.animation&&(i>e.nextpos1||s.top||s.bottom||s.right||s.left))switch(e.dir1){case"down":s.top=e.nextpos1+"px";break;case"up":s.bottom=e.nextpos1+"px";break;case"left":s.right=e.nextpos1+"px";break;case"right":s.left=e.nextpos1+"px"}else f.css(r,e.nextpos1+"px");switch((s.top||s.bottom||s.right||s.left)&&f.animate(s,{duration:this.opts.position_animate_speed,queue:!1}),e.dir1){case"down":case"up":e.nextpos1+=f.height()+("undefined"==typeof e.spacing1?25:e.spacing1);break;case"left":case"right":e.nextpos1+=f.width()+("undefined"==typeof e.spacing1?25:e.spacing1)}}}},f.pnotify_queue_position=function(e){n&&clearTimeout(n),e||(e=10),n=setTimeout(t.pnotify_position_all,e)},f.pnotify_display=function(){m=o.data("pnotify"),m&&m.length>l.maxonscreen&&t.each(m.slice(0,m.length-l.maxonscreen),function(){this.pnotify_remove&&this.pnotify_remove()}),f.parent().length||f.appendTo(i),l.before_open&&l.before_open(f)===!1||("top"!=l.stack.push&&f.pnotify_position(!0),"fade"==l.animation||"fade"==l.animation.effect_in?f.show().fadeTo(0,0).hide():1!=l.opacity&&f.show().fadeTo(0,l.opacity).hide(),f.animate_in(function(){l.after_open&&l.after_open(f),f.pnotify_queue_position(),l.hide&&f.pnotify_queue_remove()}))},f.pnotify_remove=function(){f.timer&&(window.clearTimeout(f.timer),f.timer=null),l.before_close&&l.before_close(f)===!1||f.animate_out(function(){l.after_close&&l.after_close(f)===!1||(f.pnotify_queue_position(),l.remove&&f.detach())})},f.animate_in=function(t){s="in";var e;e="undefined"!=typeof l.animation.effect_in?l.animation.effect_in:l.animation,"none"==e?(f.show(),t()):"show"==e?f.show(l.animate_speed,t):"fade"==e?f.show().fadeTo(l.animate_speed,l.opacity,t):"slide"==e?f.slideDown(l.animate_speed,t):"function"==typeof e?e("in",t,f):f.show(e,"object"==typeof l.animation.options_in?l.animation.options_in:{},l.animate_speed,t)},f.animate_out=function(t){s="out";var e;e="undefined"!=typeof l.animation.effect_out?l.animation.effect_out:l.animation,"none"==e?(f.hide(),t()):"show"==e?f.hide(l.animate_speed,t):"fade"==e?f.fadeOut(l.animate_speed,t):"slide"==e?f.slideUp(l.animate_speed,t):"function"==typeof e?e("out",t,f):f.hide(e,"object"==typeof l.animation.options_out?l.animation.options_out:{},l.animate_speed,t)},f.pnotify_cancel_remove=function(){f.timer&&window.clearTimeout(f.timer)},f.pnotify_queue_remove=function(){f.pnotify_cancel_remove(),f.timer=window.setTimeout(function(){f.pnotify_remove()},isNaN(l.delay)?0:l.delay)},f.closer=t("<div />",{"class":"ui-pnotify-closer",css:{cursor:"pointer",visibility:l.closer_hover?"hidden":"visible"},click:function(){f.pnotify_remove(),f.sticker.css("visibility","hidden"),f.closer.css("visibility","hidden")}}).append(t("<span />",{"class":p.closer,title:l.labels.close})).appendTo(f.container),(!l.closer||l.nonblock)&&f.closer.css("display","none"),f.sticker=t("<div />",{"class":"ui-pnotify-sticker",css:{cursor:"pointer",visibility:l.sticker_hover?"hidden":"visible"},click:function(){l.hide=!l.hide,l.hide?f.pnotify_queue_remove():f.pnotify_cancel_remove(),t(this).trigger("pnotify_icon")}}).bind("pnotify_icon",function(){t(this).children().removeClass(p.pin_up+" "+p.pin_down).addClass(l.hide?p.pin_up:p.pin_down)}).append(t("<span />",{"class":p.pin_up,title:l.labels.stick})).appendTo(f.container),(!l.sticker||l.nonblock)&&f.sticker.css("display","none"),l.icon!==!1&&t("<div />",{"class":"ui-pnotify-icon"}).append(t("<span />",{"class":l.icon===!0?"error"==l.type?p.error_icon:"info"==l.type?p.info_icon:"success"==l.type?p.success_icon:p.notice_icon:l.icon})).prependTo(f.container),f.title_container=t("<span />",{"class":"ui-pnotify-title"}).appendTo(f.container),l.title===!1?f.title_container.hide():l.title_escape?f.title_container.text(l.title):f.title_container.html(l.title),f.text_container=t("<div />",{"class":"ui-pnotify-text"}).appendTo(f.container),l.text===!1?f.text_container.hide():l.text_escape?f.text_container.text(l.text):f.text_container.html(l.insert_brs?String(l.text).replace(/\n/g,"<br />"):l.text),"string"==typeof l.width&&f.css("width",l.width),"string"==typeof l.min_height&&f.container.css("min-height",l.min_height),f.pnotify_history=l.history,f.pnotify_hide=l.hide;var m=o.data("pnotify");if((null==m||"object"!=typeof m)&&(m=[]),m="top"==l.stack.push?t.merge([f],m):t.merge(m,[f]),o.data("pnotify",m),"top"==l.stack.push&&f.pnotify_queue_position(1),l.after_init&&l.after_init(f),l.history){var v=o.data("pnotify_history");if("undefined"==typeof v){v=t("<div />",{"class":"ui-pnotify-history-container "+p.hi_menu,mouseleave:function(){v.animate({top:"-"+e+"px"},{duration:100,queue:!1})}}).append(t("<div />",{"class":"ui-pnotify-history-header",text:l.labels.redisplay})).append(t("<button />",{"class":"ui-pnotify-history-all "+p.hi_btn,text:l.labels.all,mouseenter:function(){t(this).addClass(p.hi_btnhov)},mouseleave:function(){t(this).removeClass(p.hi_btnhov)},click:function(){return t.each(m,function(){this.pnotify_history&&(this.is(":visible")?this.pnotify_hide&&this.pnotify_queue_remove():this.pnotify_display&&this.pnotify_display())}),!1}})).append(t("<button />",{"class":"ui-pnotify-history-last "+p.hi_btn,text:l.labels.last,mouseenter:function(){t(this).addClass(p.hi_btnhov)},mouseleave:function(){t(this).removeClass(p.hi_btnhov)},click:function(){var t,e=-1;do{if(t=-1==e?m.slice(e):m.slice(e,e+1),!t[0])break;e--}while(!t[0].pnotify_history||t[0].is(":visible"));return t[0]?(t[0].pnotify_display&&t[0].pnotify_display(),!1):!1}})).appendTo(i);var b=t("<span />",{"class":"ui-pnotify-history-pulldown "+p.hi_hnd,mouseenter:function(){v.animate({top:"0"},{duration:100,queue:!1})}}).appendTo(v);e=b.offset().top+2,v.css({top:"-"+e+"px"}),o.data("pnotify_history",v)}}return l.stack.animation=!1,l.auto_display&&f.pnotify_display(),f}});var s=/^on/,l=/^(dbl)?click$|^mouse(move|down|up|over|out|enter|leave)$|^contextmenu$/,c=/^(focus|blur|select|change|reset)$|^key(press|down|up)$/,d=/^(scroll|resize|(un)?load|abort|error)$/,h=function(e,n){var i;if(e=e.toLowerCase(),document.createEvent&&this.dispatchEvent){if(e=e.replace(s,""),e.match(l)?(t(this).offset(),i=document.createEvent("MouseEvents"),i.initMouseEvent(e,n.bubbles,n.cancelable,n.view,n.detail,n.screenX,n.screenY,n.clientX,n.clientY,n.ctrlKey,n.altKey,n.shiftKey,n.metaKey,n.button,n.relatedTarget)):e.match(c)?(i=document.createEvent("UIEvents"),i.initUIEvent(e,n.bubbles,n.cancelable,n.view,n.detail)):e.match(d)&&(i=document.createEvent("HTMLEvents"),i.initEvent(e,n.bubbles,n.cancelable)),!i)return;this.dispatchEvent(i)}else e.match(s)||(e="on"+e),i=document.createEventObject(n),this.fireEvent(e,i)};t.pnotify.defaults={title:!1,title_escape:!1,text:!1,text_escape:!1,styling:"bootstrap",addclass:"",cornerclass:"",nonblock:!1,nonblock_opacity:.2,history:!0,maxonscreen:1/0,auto_display:!0,width:"300px",min_height:"16px",type:"notice",icon:!0,animation:"fade",animate_speed:"slow",position_animate_speed:500,opacity:1,shadow:!0,closer:!0,closer_hover:!0,sticker:!0,sticker_hover:!0,hide:!0,delay:8e3,mouse_reset:!0,remove:!0,insert_brs:!0,stack:{dir1:"down",dir2:"left",push:"bottom",spacing1:25,spacing2:25},labels:{redisplay:"Redisplay",all:"All",last:"Last",close:"Close",stick:"Stick"}}}(jQuery),"document"in self&&!("classList"in document.createElement("_")&&"classList"in document.createElementNS("http://www.w3.org/2000/svg","svg"))&&!function(t){"use strict";if("Element"in t){var e="classList",n="prototype",i=t.Element[n],o=Object,a=String[n].trim||function(){return this.replace(/^\s+|\s+$/g,"")},r=Array[n].indexOf||function(t){for(var e=0,n=this.length;n>e;e++)if(e in this&&this[e]===t)return e;return-1},s=function(t,e){this.name=t,this.code=DOMException[t],this.message=e
},l=function(t,e){if(""===e)throw new s("SYNTAX_ERR","An invalid or illegal string was specified");if(/\s/.test(e))throw new s("INVALID_CHARACTER_ERR","String contains an invalid character");return r.call(t,e)},c=function(t){for(var e=a.call(t.getAttribute("class")),n=e?e.split(/\s+/):[],i=0,o=n.length;o>i;i++)this.push(n[i]);this._updateClassName=function(){t.setAttribute("class",this.toString())}},d=c[n]=[],h=function(){return new c(this)};if(s[n]=Error[n],d.item=function(t){return this[t]||null},d.contains=function(t){return t+="",-1!==l(this,t)},d.add=function(){var t,e=arguments,n=0,i=e.length,o=!1;do t=e[n]+"",-1===l(this,t)&&(this.push(t),o=!0);while(++n<i);o&&this._updateClassName()},d.remove=function(){var t,e=arguments,n=0,i=e.length,o=!1;do{t=e[n]+"";var a=l(this,t);-1!==a&&(this.splice(a,1),o=!0)}while(++n<i);o&&this._updateClassName()},d.toggle=function(t,e){t+="";var n=this.contains(t),i=n?e!==!0&&"remove":e!==!1&&"add";return i&&this[i](t),!n},d.toString=function(){return this.join(" ")},o.defineProperty){var u={get:h,enumerable:!0,configurable:!0};try{o.defineProperty(i,e,u)}catch(p){-2146823252===p.number&&(u.enumerable=!1,o.defineProperty(i,e,u))}}else o[n].__defineGetter__&&i.__defineGetter__(e,h)}}(self);var oi=function(){function t(t,e,n){t.addEventListener?t.addEventListener(e,n,!1):t.attachEvent&&t.attachEvent("on"+e,n)}function e(e){var n=!1,i=function(){n||(n=!0,e())};document.write('<script defer src="//:" id="__onload_ie_pixastic__"></script>');var o=document.getElementById("__onload_ie_pixastic__");o.onreadystatechange=function(){"complete"==o.readyState&&(o.parentNode.removeChild(o),i())},document.addEventListener&&document.addEventListener("DOMContentLoaded",i,!1),t(window,"load",i)}function n(){for(var t=o("pixastic",null,"img"),e=o("pixastic",null,"canvas"),n=t.concat(e),i=0;i<n.length;i++)!function(){for(var t=n[i],e=[],o=t.className.split(" "),a=0;a<o.length;a++){var r=o[a];if("pixastic-"==r.substring(0,9)){var s=r.substring(9);""!=s&&e.push(s)}}if(e.length)if("img"==t.tagName.toLowerCase()){var l=new Image;if(l.src=t.src,l.complete)for(var c=0;c<e.length;c++){var d=oi.applyAction(t,t,e[c],null);d&&(t=d)}else l.onload=function(){for(var n=0;n<e.length;n++){var i=oi.applyAction(t,t,e[n],null);i&&(t=i)}}}else setTimeout(function(){for(var n=0;n<e.length;n++){var i=oi.applyAction(t,t,e[n],null);i&&(t=i)}},1)}()}function o(t,e,n){var o=new Array;null==e&&(e=document),null==n&&(n="*");var a=e.getElementsByTagName(n),r=a.length,s=new RegExp("(^|\\s)"+t+"(\\s|$)");for(i=0,j=0;r>i;i++)s.test(a[i].className)&&(o[j]=a[i],j++);return o}function a(t,e){if(oi.debug)try{switch(e){case"warn":console.warn("Pixastic:",t);break;case"error":console.error("Pixastic:",t);break;default:console.log("Pixastic:",t)}}catch(n){}}"undefined"!=typeof pixastic_parseonload&&pixastic_parseonload&&e(n);var r=function(){var t=document.createElement("canvas"),e=!1;try{e=!("function"!=typeof t.getContext||!t.getContext("2d"))}catch(n){}return function(){return e}}(),s=function(){var t,e=document.createElement("canvas"),n=!1;try{"function"==typeof e.getContext&&(t=e.getContext("2d"))&&(n="function"==typeof t.getImageData)}catch(i){}return function(){return n}}(),l=function(){var t=!1,e=document.createElement("canvas");if(r()&&s()){e.width=e.height=1;var n=e.getContext("2d");n.fillStyle="rgb(255,0,0)",n.fillRect(0,0,1,1);var i=document.createElement("canvas");i.width=i.height=1;var o=i.getContext("2d");o.fillStyle="rgb(0,0,255)",o.fillRect(0,0,1,1),n.globalAlpha=.5,n.drawImage(i,0,0);var a=n.getImageData(0,0,1,1).data;t=255!=a[2]}return function(){return t}}();return{parseOnLoad:!1,debug:!1,applyAction:function(t,e,n,i){i=i||{};var o="canvas"==t.tagName.toLowerCase();if(o&&oi.Client.isIE())return oi.debug&&a("Tried to process a canvas element but browser is IE."),!1;var r,s,l=!1;oi.Client.hasCanvas()&&(l=!!i.resultCanvas,r=i.resultCanvas||document.createElement("canvas"),s=r.getContext("2d"));var c=t.offsetWidth,d=t.offsetHeight;if(o&&(c=t.width,d=t.height),0==c||0==d){if(null!=t.parentNode)return void(oi.debug&&a("Image has 0 width and/or height."));var h=t.style.position,u=t.style.left;t.style.position="absolute",t.style.left="-9999px",document.body.appendChild(t),c=t.offsetWidth,d=t.offsetHeight,document.body.removeChild(t),t.style.position=h,t.style.left=u}if(n.indexOf("(")>-1){var p=n;n=p.substr(0,p.indexOf("("));var f=p.match(/\((.*?)\)/);if(f[1]){f=f[1].split(";");for(var g=0;g<f.length;g++)if(thisArg=f[g].split("="),2==thisArg.length)if("rect"==thisArg[0]){var m=thisArg[1].split(",");i[thisArg[0]]={left:parseInt(m[0],10)||0,top:parseInt(m[1],10)||0,width:parseInt(m[2],10)||0,height:parseInt(m[3],10)||0}}else i[thisArg[0]]=thisArg[1]}}i.rect?(i.rect.left=Math.round(i.rect.left),i.rect.top=Math.round(i.rect.top),i.rect.width=Math.round(i.rect.width),i.rect.height=Math.round(i.rect.height)):i.rect={left:0,top:0,width:c,height:d};var v=!1;if(oi.Actions[n]&&"function"==typeof oi.Actions[n].process&&(v=!0),!v)return oi.debug&&a('Invalid action "'+n+'". Maybe file not included?'),!1;if(!oi.Actions[n].checkSupport())return oi.debug&&a('Action "'+n+'" not supported by this browser.'),!1;oi.Client.hasCanvas()?(r!==t&&(r.width=c,r.height=d),l||(r.style.width=c+"px",r.style.height=d+"px"),s.drawImage(e,0,0,c,d),t.__pixastic_org_image?(r.__pixastic_org_image=t.__pixastic_org_image,r.__pixastic_org_width=t.__pixastic_org_width,r.__pixastic_org_height=t.__pixastic_org_height):(r.__pixastic_org_image=t,r.__pixastic_org_width=c,r.__pixastic_org_height=d)):oi.Client.isIE()&&"undefined"==typeof t.__pixastic_org_style&&(t.__pixastic_org_style=t.style.cssText);var b={image:t,canvas:r,width:c,height:d,useData:!0,options:i},y=oi.Actions[n].process(b);return y?oi.Client.hasCanvas()?(b.useData&&oi.Client.hasCanvasImageData()&&(r.getContext("2d").putImageData(b.canvasData,i.rect.left,i.rect.top),r.getContext("2d").fillRect(0,0,0,0)),i.leaveDOM||(r.title=t.title,r.imgsrc=t.imgsrc,o||(r.alt=t.alt),o||(r.imgsrc=t.src),r.className=t.className,r.style.cssText=t.style.cssText,r.name=t.name,r.tabIndex=t.tabIndex,r.id=t.id,t.parentNode&&t.parentNode.replaceChild&&t.parentNode.replaceChild(r,t)),i.resultCanvas=r,r):t:!1},prepareData:function(t,e){var n=t.canvas.getContext("2d"),i=t.options.rect,o=n.getImageData(i.left,i.top,i.width,i.height),a=o.data;return e||(t.canvasData=o),a},process:function(t,e,n,i){if("img"==t.tagName.toLowerCase()){var o=new Image;if(o.src=t.src,o.complete){var a=oi.applyAction(t,o,e,n);return i&&i(a),a}o.onload=function(){var a=oi.applyAction(t,o,e,n);i&&i(a)}}if("canvas"==t.tagName.toLowerCase()){var a=oi.applyAction(t,t,e,n);return i&&i(a),a}},revert:function(t){if(oi.Client.hasCanvas()){if("canvas"==t.tagName.toLowerCase()&&t.__pixastic_org_image)return t.width=t.__pixastic_org_width,t.height=t.__pixastic_org_height,t.getContext("2d").drawImage(t.__pixastic_org_image,0,0),t.parentNode&&t.parentNode.replaceChild&&t.parentNode.replaceChild(t.__pixastic_org_image,t),t}else oi.Client.isIE()&&"undefined"!=typeof t.__pixastic_org_style&&(t.style.cssText=t.__pixastic_org_style)},Client:{hasCanvas:r,hasCanvasImageData:s,hasGlobalAlpha:l,isIE:function(){return!!document.all&&!!window.attachEvent&&!window.opera}},Actions:{}}}();oi.Actions.blur={process:function(t){if("undefined"==typeof t.options.fixMargin&&(t.options.fixMargin=!0),oi.Client.hasCanvasImageData()){for(var e=oi.prepareData(t),n=oi.prepareData(t,!0),i=[[0,1,0],[1,2,1],[0,1,0]],o=0,a=0;3>a;a++)for(var r=0;3>r;r++)o+=i[a][r];o=1/(2*o);var s=t.options.rect,l=s.width,c=s.height,d=4*l,h=c;do{var u=(h-1)*d,p=1==h?0:h-2,f=h==c?h-1:h,g=p*l*4,m=f*l*4,v=l;do{var b=u+(4*v-4),y=g+4*(1==v?0:v-2),w=m+4*(v==l?v-1:v);e[b]=(2*(n[y]+n[b-4]+n[b+4]+n[w])+4*n[b])*o,e[b+1]=(2*(n[y+1]+n[b-3]+n[b+5]+n[w+1])+4*n[b+1])*o,e[b+2]=(2*(n[y+2]+n[b-2]+n[b+6]+n[w+2])+4*n[b+2])*o}while(--v)}while(--h);return!0}return oi.Client.isIE()?(t.image.style.filter+=" progid:DXImageTransform.Microsoft.Blur(pixelradius=1.5)",t.options.fixMargin&&(t.image.style.marginLeft=(parseInt(t.image.style.marginLeft,10)||0)-2+"px",t.image.style.marginTop=(parseInt(t.image.style.marginTop,10)||0)-2+"px"),!0):void 0},checkSupport:function(){return oi.Client.hasCanvasImageData()||oi.Client.isIE()}},oi.Actions.brightness={process:function(t){var e=parseInt(t.options.brightness,10)||0,n=parseFloat(t.options.contrast)||0,i=!(!t.options.legacy||"false"==t.options.legacy);if(i)e=Math.min(150,Math.max(-150,e));else var o=1+Math.min(150,Math.max(-150,e))/150;if(n=Math.max(0,n+1),oi.Client.hasCanvasImageData()){var a,r,s,l,c=oi.prepareData(t),d=t.options.rect,h=d.width,u=d.height,p=h*u,f=4*p;1!=n?i?(s=n,l=(e-128)*n+128):(s=o*n,l=128*-n+128):i?(s=1,l=e):(s=o,l=0);for(var g,m,v;p--;)c[f]=(g=c[f-=4]*s+l)>255?255:0>g?0:g,c[a]=(m=c[a=f+1]*s+l)>255?255:0>m?0:m,c[r]=(v=c[r=f+2]*s+l)>255?255:0>v?0:v;return!0}},checkSupport:function(){return oi.Client.hasCanvasImageData()}},oi.Actions.coloradjust={process:function(t){var e=parseFloat(t.options.red)||0,n=parseFloat(t.options.green)||0,i=parseFloat(t.options.blue)||0;if(e=Math.round(255*e),n=Math.round(255*n),i=Math.round(255*i),oi.Client.hasCanvasImageData()){for(var o,a,r,s,l,c=oi.prepareData(t),d=t.options.rect,h=d.width*d.height,u=4*h;h--;)u-=4,e&&(c[u]=(r=c[u]+e)<0?0:r>255?255:r),n&&(c[o]=(s=c[o=u+1]+n)<0?0:s>255?255:s),i&&(c[a]=(l=c[a=u+2]+i)<0?0:l>255?255:l);return!0}},checkSupport:function(){return oi.Client.hasCanvasImageData()}},oi.Actions.desaturate={process:function(t){var e=!(!t.options.average||"false"==t.options.average);if(oi.Client.hasCanvasImageData()){var n,i,o=oi.prepareData(t),a=t.options.rect,r=a.width,s=a.height,l=r*s,c=4*l;if(e)for(;l--;)o[c-=4]=o[n=c+1]=o[i=c+2]=(o[c]+o[n]+o[i])/3;else for(;l--;)o[c-=4]=o[n=c+1]=o[i=c+2]=.3*o[c]+.59*o[n]+.11*o[i];return!0}return oi.Client.isIE()?(t.image.style.filter+=" gray",!0):void 0},checkSupport:function(){return oi.Client.hasCanvasImageData()||oi.Client.isIE()}},oi.Actions.glow={process:function(t){var e=parseFloat(t.options.amount)||0,n=parseFloat(t.options.radius)||0;if(e=Math.min(1,Math.max(0,e)),n=Math.min(5,Math.max(0,n)),oi.Client.hasCanvasImageData()){var i=t.options.rect,o=document.createElement("canvas");o.width=t.width,o.height=t.height;var a=o.getContext("2d");a.drawImage(t.canvas,0,0);var r=2,s=Math.round(t.width/r),l=Math.round(t.height/r),c=document.createElement("canvas");c.width=s,c.height=l;for(var d=Math.round(20*n),h=c.getContext("2d"),u=0;d>u;u++){var p=Math.max(1,Math.round(s-u)),f=Math.max(1,Math.round(l-u));h.clearRect(0,0,s,l),h.drawImage(o,0,0,t.width,t.height,0,0,p,f),a.clearRect(0,0,t.width,t.height),a.drawImage(c,0,0,p,f,0,0,t.width,t.height)}for(var g=oi.prepareData(t),m=oi.prepareData({canvas:o,options:t.options}),v=i.width*i.height,b=4*v,y=b+1,w=b+2;v--;)(g[b-=4]+=e*m[b])>255&&(g[b]=255),(g[y-=4]+=e*m[y])>255&&(g[y]=255),(g[w-=4]+=e*m[w])>255&&(g[w]=255);return!0}},checkSupport:function(){return oi.Client.hasCanvasImageData()}},oi.Actions.hsl={process:function(t){var e=parseInt(t.options.hue,10)||0,n=(parseInt(t.options.saturation,10)||0)/100,i=(parseInt(t.options.lightness,10)||0)/100;if(0>n)var o=1+n;else var o=1+2*n;e=e%360/360;var a=6*e,r=255*i,s=1+i,l=1-i;if(oi.Client.hasCanvasImageData()){for(var c=oi.prepareData(t),d=t.options.rect,h=d.width*d.height,u=4*h,p=u+1,f=u+2;h--;){var g=c[u-=4],m=c[p=u+1],v=c[f=u+2];if(0!=e||0!=n){var b=g;m>b&&(b=m),v>b&&(b=v);var y=g;y>m&&(y=m),y>v&&(y=v);var w=b-y,C=(y+b)/510;if(C>0&&w>0){if(.5>=C){var x=w/(b+y)*o;x>1&&(x=1);var _=C*(1+x)}else{var x=w/(510-b-y)*o;x>1&&(x=1);var _=C+x-C*x}if(g==b)if(m==y)var T=5+(b-v)/w+a;else var T=1-(b-m)/w+a;else if(m==b)if(v==y)var T=1+(b-g)/w+a;else var T=3-(b-v)/w+a;else if(g==y)var T=3+(b-m)/w+a;else var T=5-(b-g)/w+a;0>T&&(T+=6),T>=6&&(T-=6);var S=C+C-_,k=T>>0;0==k?(g=255*_,m=255*(S+(_-S)*(T-k)),v=255*S):1==k?(g=255*(_-(_-S)*(T-k)),m=255*_,v=255*S):2==k?(g=255*S,m=255*_,v=255*(S+(_-S)*(T-k))):3==k?(g=255*S,m=255*(_-(_-S)*(T-k)),v=255*_):4==k?(g=255*(S+(_-S)*(T-k)),m=255*S,v=255*_):5==k&&(g=255*_,m=255*S,v=255*(_-(_-S)*(T-k)))}}0>i?(g*=s,m*=s,v*=s):i>0&&(g=g*l+r,m=m*l+r,v=v*l+r),c[u]=0>g?0:g>255?255:g,c[p]=0>m?0:m>255?255:m,c[f]=0>v?0:v>255?255:v}return!0}},checkSupport:function(){return oi.Client.hasCanvasImageData()}},oi.Actions.invert={process:function(t){if(oi.Client.hasCanvasImageData()){for(var e=oi.prepareData(t),n=!!t.options.invertAlpha,i=t.options.rect,o=i.width*i.height,a=4*o,r=a+1,s=a+2,l=a+3;o--;)e[a-=4]=255-e[a],e[r-=4]=255-e[r],e[s-=4]=255-e[s],n&&(e[l-=4]=255-e[l]);return!0}return oi.Client.isIE()?(t.image.style.filter+=" invert",!0):void 0},checkSupport:function(){return oi.Client.hasCanvasImageData()||oi.Client.isIE()}},oi.Actions.posterize={process:function(t){var e=256;if("undefined"!=typeof t.options.levels&&(e=parseInt(t.options.levels,10)||1),oi.Client.hasCanvasImageData()){var n=oi.prepareData(t);e=Math.max(2,Math.min(256,e));var i=256/e,o=256/(e-1),a=t.options.rect,r=a.width,s=a.height,l=4*r,c=s;do{var d=(c-1)*l,h=r;do{var u=d+4*(h-1),p=o*(n[u]/i>>0),f=o*(n[u+1]/i>>0),g=o*(n[u+2]/i>>0);p>255&&(p=255),f>255&&(f=255),g>255&&(g=255),n[u]=p,n[u+1]=f,n[u+2]=g}while(--h)}while(--c);return!0}},checkSupport:function(){return oi.Client.hasCanvasImageData()}},oi.Actions.removenoise={process:function(t){if(oi.Client.hasCanvasImageData()){var e=oi.prepareData(t),n=t.options.rect,i=n.width,o=n.height,a=4*i,r=o;do{var s=(r-1)*a,l=r==o?r-1:r,c=1==r?0:r-2,d=c*i*4,h=l*i*4,u=i;do{var p,f,g,m,v,b,y=s+(4*u-4),w=d+4*(1==u?0:u-2),C=h+4*(u==i?u-1:u);p=f=e[w];var x=e[y-4],_=e[y+4],T=e[C];p>x&&(p=x),p>_&&(p=_),p>T&&(p=T),x>f&&(f=x),_>f&&(f=_),T>f&&(f=T),g=m=e[w+1];var S=e[y-3],k=e[y+5],E=e[C+1];g>S&&(g=S),g>k&&(g=k),g>E&&(g=E),S>m&&(m=S),k>m&&(m=k),E>m&&(m=E),v=b=e[w+2];var R=e[y-2],N=e[y+6],D=e[C+2];v>R&&(v=R),v>N&&(v=N),v>D&&(v=D),R>b&&(b=R),N>b&&(b=N),D>b&&(b=D),e[y]>f?e[y]=f:e[y]<p&&(e[y]=p),e[y+1]>m?e[y+1]=m:e[y+1]<g&&(e[y+1]=g),e[y+2]>b?e[y+2]=b:e[y+2]<v&&(e[y+2]=v)}while(--u)}while(--r);return!0}},checkSupport:function(){return oi.Client.hasCanvasImageData()}},oi.Actions.sepia={process:function(t){var e=parseInt(t.options.mode,10)||0;if(0>e&&(e=0),e>1&&(e=1),oi.Client.hasCanvasImageData()){var n=oi.prepareData(t),i=t.options.rect,o=i.width,a=i.height,r=4*o,s=a;do{var l=(s-1)*r,c=o;do{var d=l+4*(c-1);if(e)var h=.299*n[d]+.587*n[d+1]+.114*n[d+2],u=h+39,p=h+14,f=h-36;else var g=n[d],m=n[d+1],v=n[d+2],u=.393*g+.769*m+.189*v,p=.349*g+.686*m+.168*v,f=.272*g+.534*m+.131*v;0>u&&(u=0),u>255&&(u=255),0>p&&(p=0),p>255&&(p=255),0>f&&(f=0),f>255&&(f=255),n[d]=u,n[d+1]=p,n[d+2]=f}while(--c)}while(--s);return!0}},checkSupport:function(){return oi.Client.hasCanvasImageData()}},oi.Actions.sharpen={process:function(t){var e=0;if("undefined"!=typeof t.options.amount&&(e=parseFloat(t.options.amount)||0),0>e&&(e=0),e>1&&(e=1),oi.Client.hasCanvasImageData()){for(var n=oi.prepareData(t),i=oi.prepareData(t,!0),o=15,a=1+3*e,r=[[0,-a,0],[-a,o,-a],[0,-a,0]],s=0,l=0;3>l;l++)for(var c=0;3>c;c++)s+=r[l][c];s=1/s;var d=t.options.rect,h=d.width,u=d.height;o*=s,a*=s;var p=4*h,f=u;do{var g=(f-1)*p,m=f==u?f-1:f,v=1==f?0:f-2,b=v*p,y=m*p,w=h;do{var C=g+(4*w-4),x=b+4*(1==w?0:w-2),_=y+4*(w==h?w-1:w),T=(-i[x]-i[C-4]-i[C+4]-i[_])*a+i[C]*o,S=(-i[x+1]-i[C-3]-i[C+5]-i[_+1])*a+i[C+1]*o,k=(-i[x+2]-i[C-2]-i[C+6]-i[_+2])*a+i[C+2]*o;0>T&&(T=0),0>S&&(S=0),0>k&&(k=0),T>255&&(T=255),S>255&&(S=255),k>255&&(k=255),n[C]=T,n[C+1]=S,n[C+2]=k}while(--w)}while(--f);return!0}},checkSupport:function(){return oi.Client.hasCanvasImageData()}},oi.Actions.solarize={process:function(t){!(!t.options.average||"false"==t.options.average);if(oi.Client.hasCanvasImageData()){var e=oi.prepareData(t),n=t.options.rect,i=n.width,o=n.height,a=4*i,r=o;do{var s=(r-1)*a,l=i;do{var c=s+4*(l-1),d=e[c],h=e[c+1],u=e[c+2];d>127&&(d=255-d),h>127&&(h=255-h),u>127&&(u=255-u),e[c]=d,e[c+1]=h,e[c+2]=u}while(--l)}while(--r);return!0}},checkSupport:function(){return oi.Client.hasCanvasImageData()}},function(t){function e(t,e){var n=typeof t[e];return n==w||!(n!=y||!t[e])||"unknown"==n}function n(t,e){return!(typeof t[e]!=y||!t[e])}function i(t,e){return typeof t[e]!=C}function o(t){return function(e,n){for(var i=n.length;i--;)if(!t(e,n[i]))return!1;return!0}}function a(t){return t&&k(t,S)&&R(t,T)}function r(t){return n(t,"body")?t.body:t.getElementsByTagName("body")[0]}function s(t){n(window,"console")&&e(window.console,"log")&&window.console.log(t)}function l(t,e){e?window.alert(t):s(t)}function c(t){D.initialized=!0,D.supported=!1,l("Rangy is not supported on this page in your browser. Reason: "+t,D.config.alertOnFail)}function d(t){l("Rangy warning: "+t,D.config.alertOnWarn)}function h(t){return t.message||t.description||String(t)}function u(){if(!D.initialized){var t,n=!1,i=!1;e(document,"createRange")&&(t=document.createRange(),k(t,_)&&R(t,x)&&(n=!0),t.detach());var o=r(document);if(!o||"body"!=o.nodeName.toLowerCase())return void c("No body element found");if(o&&e(o,"createTextRange")&&(t=o.createTextRange(),a(t)&&(i=!0)),!n&&!i)return void c("Neither Range nor TextRange are available");D.initialized=!0,D.features={implementsDomRange:n,implementsTextRange:i};var l,d;for(var u in N)(l=N[u])instanceof f&&l.init(l,D);for(var p=0,g=O.length;g>p;++p)try{O[p](D)}catch(m){d="Rangy init listener threw an exception. Continuing. Detail: "+h(m),s(d)}}}function p(t){t=t||window,u();for(var e=0,n=I.length;n>e;++e)I[e](t)}function f(t,e,n){this.name=t,this.dependencies=e,this.initialized=!1,this.supported=!1,this.initializer=n}function g(t,e,n,i){var o=new f(e,n,function(t){if(!t.initialized){t.initialized=!0;try{i(D,t),t.supported=!0}catch(n){var o="Module '"+e+"' failed to load: "+h(n);s(o)}}});N[e]=o}function m(){}function v(){}var b="function"==typeof t.define&&t.define.amd,y="object",w="function",C="undefined",x=["startContainer","startOffset","endContainer","endOffset","collapsed","commonAncestorContainer"],_=["setStart","setStartBefore","setStartAfter","setEnd","setEndBefore","setEndAfter","collapse","selectNode","selectNodeContents","compareBoundaryPoints","deleteContents","extractContents","cloneContents","insertNode","surroundContents","cloneRange","toString","detach"],T=["boundingHeight","boundingLeft","boundingTop","boundingWidth","htmlText","text"],S=["collapse","compareEndPoints","duplicate","moveToElementText","parentElement","select","setEndPoint","getBoundingClientRect"],k=o(e),E=o(n),R=o(i),N={},D={version:"1.3alpha.",initialized:!1,supported:!0,util:{isHostMethod:e,isHostObject:n,isHostProperty:i,areHostMethods:k,areHostObjects:E,areHostProperties:R,isTextRange:a,getBody:r},features:{},modules:N,config:{alertOnFail:!0,alertOnWarn:!1,preferTextRange:!1}};D.fail=c,D.warn=d,{}.hasOwnProperty?D.util.extend=function(t,e,n){var i,o;for(var a in e)e.hasOwnProperty(a)&&(i=t[a],o=e[a],n&&null!==i&&"object"==typeof i&&null!==o&&"object"==typeof o&&D.util.extend(i,o,!0),t[a]=o);return t}:c("hasOwnProperty not supported"),function(){var t=document.createElement("div");t.appendChild(document.createElement("span"));var e,n=[].slice;try{1==n.call(t.childNodes,0)[0].nodeType&&(e=function(t){return n.call(t,0)})}catch(i){}e||(e=function(t){for(var e=[],n=0,i=t.length;i>n;++n)e[n]=t[n];return e}),D.util.toArray=e}();var A;e(document,"addEventListener")?A=function(t,e,n){t.addEventListener(e,n,!1)}:e(document,"attachEvent")?A=function(t,e,n){t.attachEvent("on"+e,n)}:c("Document does not have required addEventListener or attachEvent method"),D.util.addListener=A;var O=[];D.init=u,D.addInitListener=function(t){D.initialized?t(D):O.push(t)};var I=[];D.addCreateMissingNativeApiListener=function(t){I.push(t)},D.createMissingNativeApi=p,f.prototype={init:function(){for(var t,e,n=this.dependencies||[],i=0,o=n.length;o>i;++i){if(e=n[i],t=N[e],!(t&&t instanceof f))throw new Error("required module '"+e+"' not found");if(t.init(),!t.supported)throw new Error("required module '"+e+"' not supported")}this.initializer(this)},fail:function(t){throw this.initialized=!0,this.supported=!1,new Error("Module '"+this.name+"' failed to load: "+t)},warn:function(t){D.warn("Module "+this.name+": "+t)},deprecationNotice:function(t,e){D.warn("DEPRECATED: "+t+" in module "+this.name+"is deprecated. Please use "+e+" instead")},createError:function(t){return new Error("Error in Rangy "+this.name+" module: "+t)}},D.createModule=function(t){var e,n;2==arguments.length?(e=arguments[1],n=[]):(e=arguments[2],n=arguments[1]),g(!1,t,n,e)},D.createCoreModule=function(t,e,n){g(!0,t,e,n)},D.RangePrototype=m,D.rangePrototype=new m,D.selectionPrototype=new v;var P=!1,M=function(){P||(P=!0,D.initialized||u())};return typeof window==C?void c("No window found"):typeof document==C?void c("No document found"):(e(document,"addEventListener")&&document.addEventListener("DOMContentLoaded",M,!1),A(window,"load",M),b&&t.define(function(){return D.amd=!0,D}),void(t.rangy=D))}(this),rangy.createCoreModule("DomUtil",[],function(t,e){function n(t){var e;return typeof t.namespaceURI==N||null===(e=t.namespaceURI)||"http://www.w3.org/1999/xhtml"==e}function i(t){var e=t.parentNode;return 1==e.nodeType?e:null}function o(t){for(var e=0;t=t.previousSibling;)++e;return e}function a(t){switch(t.nodeType){case 7:case 10:return 0;case 3:case 8:return t.length;default:return t.childNodes.length}}function r(t,e){var n,i=[];for(n=t;n;n=n.parentNode)i.push(n);for(n=e;n;n=n.parentNode)if(I(i,n))return n;return null}function s(t,e,n){for(var i=n?e:e.parentNode;i;){if(i===t)return!0;i=i.parentNode}return!1}function l(t,e){return s(t,e,!0)}function c(t,e,n){for(var i,o=n?t:t.parentNode;o;){if(i=o.parentNode,i===e)return o;o=i}return null}function d(t){var e=t.nodeType;return 3==e||4==e||8==e}function h(t){if(!t)return!1;var e=t.nodeType;return 3==e||8==e}function u(t,e){var n=e.nextSibling,i=e.parentNode;return n?i.insertBefore(t,n):i.appendChild(t),t}function p(t,e,n){var i=t.cloneNode(!1);if(i.deleteData(0,e),t.deleteData(e,t.length-e),u(i,t),n)for(var a,r=0;a=n[r++];)a.node==t&&a.offset>e?(a.node=i,a.offset-=e):a.node==t.parentNode&&a.offset>o(t)&&++a.offset;return i}function f(t){if(9==t.nodeType)return t;if(typeof t.ownerDocument!=N)return t.ownerDocument;if(typeof t.document!=N)return t.document;if(t.parentNode)return f(t.parentNode);throw e.createError("getDocument: no document found for node")}function g(t){var n=f(t);if(typeof n.defaultView!=N)return n.defaultView;if(typeof n.parentWindow!=N)return n.parentWindow;throw e.createError("Cannot get a window object for node")}function m(t){if(typeof t.contentDocument!=N)return t.contentDocument;if(typeof t.contentWindow!=N)return t.contentWindow.document;throw e.createError("getIframeDocument: No Document object found for iframe element")}function v(t){if(typeof t.contentWindow!=N)return t.contentWindow;if(typeof t.contentDocument!=N)return t.contentDocument.defaultView;throw e.createError("getIframeWindow: No Window object found for iframe element")}function b(t){return t&&D.isHostMethod(t,"setTimeout")&&D.isHostObject(t,"document")}function y(t,e,n){var i;if(t?D.isHostProperty(t,"nodeType")?i=1==t.nodeType&&"iframe"==t.tagName.toLowerCase()?m(t):f(t):b(t)&&(i=t.document):i=document,!i)throw e.createError(n+"(): Parameter must be a Window object or DOM node");return i}function w(t){for(var e;e=t.parentNode;)t=e;return t}function C(t,n,i,a){var s,l,d,h,u;if(t==i)return n===a?0:a>n?-1:1;if(s=c(i,t,!0))return n<=o(s)?-1:1;if(s=c(t,i,!0))return o(s)<a?-1:1;if(l=r(t,i),!l)throw new Error("comparePoints error: nodes have no common ancestor");if(d=t===l?l:c(t,l,!0),h=i===l?l:c(i,l,!0),d===h)throw e.createError("comparePoints got to case 4 and childA and childB are the same!");for(u=l.firstChild;u;){if(u===d)return-1;if(u===h)return 1;u=u.nextSibling}}function x(t){try{return t.parentNode,!1}catch(e){return!0}}function _(t){if(!t)return"[No node]";if(P&&x(t))return"[Broken node]";if(d(t))return'"'+t.data+'"';if(1==t.nodeType){var e=t.id?' id="'+t.id+'"':"";return"<"+t.nodeName+e+">["+o(t)+"]["+t.childNodes.length+"]["+(t.innerHTML||"[innerHTML not supported]").slice(0,25)+"]"}return t.nodeName}function T(t){for(var e,n=f(t).createDocumentFragment();e=t.firstChild;)n.appendChild(e);return n}function S(t){this.root=t,this._next=t}function k(t){return new S(t)}function E(t,e){this.node=t,this.offset=e}function R(t){this.code=this[t],this.codeName=t,this.message="DOMException: "+this.codeName}var N="undefined",D=t.util;D.areHostMethods(document,["createDocumentFragment","createElement","createTextNode"])||e.fail("document missing a Node creation method"),D.isHostMethod(document,"getElementsByTagName")||e.fail("document missing getElementsByTagName method");var A=document.createElement("div");D.areHostMethods(A,["insertBefore","appendChild","cloneNode"]||!D.areHostObjects(A,["previousSibling","nextSibling","childNodes","parentNode"]))||e.fail("Incomplete Element implementation"),D.isHostProperty(A,"innerHTML")||e.fail("Element is missing innerHTML property");var O=document.createTextNode("test");D.areHostMethods(O,["splitText","deleteData","insertData","appendData","cloneNode"]||!D.areHostObjects(A,["previousSibling","nextSibling","childNodes","parentNode"])||!D.areHostProperties(O,["data"]))||e.fail("Incomplete Text Node implementation");var I=function(t,e){for(var n=t.length;n--;)if(t[n]===e)return!0;return!1},P=!1;!function(){var e=document.createElement("b");e.innerHTML="1";var n=e.firstChild;e.innerHTML="<br>",P=x(n),t.features.crashyTextNodes=P}();var M;typeof window.getComputedStyle!=N?M=function(t,e){return g(t).getComputedStyle(t,null)[e]}:typeof document.documentElement.currentStyle!=N?M=function(t,e){return t.currentStyle[e]}:e.fail("No means of obtaining computed style properties found"),S.prototype={_current:null,hasNext:function(){return!!this._next},next:function(){var t,e,n=this._current=this._next;if(this._current)if(t=n.firstChild)this._next=t;else{for(e=null;n!==this.root&&!(e=n.nextSibling);)n=n.parentNode;this._next=e}return this._current},detach:function(){this._current=this._next=this.root=null}},E.prototype={equals:function(t){return!!t&&this.node===t.node&&this.offset==t.offset},inspect:function(){return"[DomPosition("+_(this.node)+":"+this.offset+")]"},toString:function(){return this.inspect()}},R.prototype={INDEX_SIZE_ERR:1,HIERARCHY_REQUEST_ERR:3,WRONG_DOCUMENT_ERR:4,NO_MODIFICATION_ALLOWED_ERR:7,NOT_FOUND_ERR:8,NOT_SUPPORTED_ERR:9,INVALID_STATE_ERR:11},R.prototype.toString=function(){return this.message},t.dom={arrayContains:I,isHtmlNamespace:n,parentElement:i,getNodeIndex:o,getNodeLength:a,getCommonAncestor:r,isAncestorOf:s,isOrIsAncestorOf:l,getClosestAncestorIn:c,isCharacterDataNode:d,isTextOrCommentNode:h,insertAfter:u,splitDataNode:p,getDocument:f,getWindow:g,getIframeWindow:v,getIframeDocument:m,getBody:D.getBody,isWindow:b,getContentDocument:y,getRootContainer:w,comparePoints:C,isBrokenNode:x,inspectNode:_,getComputedStyleProperty:M,fragmentFromNodeChildren:T,createIterator:k,DomPosition:E},t.DOMException=R}),rangy.createCoreModule("DomRange",["DomUtil"],function(t){function e(t,e){return 3!=t.nodeType&&(U(t,e.startContainer)||U(t,e.endContainer))}function n(t){return t.document||z(t.startContainer)}function i(t){return new B(t.parentNode,j(t))}function o(t){return new B(t.parentNode,j(t)+1)}function a(t,e,n){var i=11==t.nodeType?t.firstChild:t;return H(e)?n==e.length?L.insertAfter(t,e):e.parentNode.insertBefore(t,0==n?e:G(e,n)):n>=e.childNodes.length?e.appendChild(t):e.insertBefore(t,e.childNodes[n]),i}function r(t,e,i){if(k(t),k(e),n(e)!=n(t))throw new F("WRONG_DOCUMENT_ERR");var o=W(t.startContainer,t.startOffset,e.endContainer,e.endOffset),a=W(t.endContainer,t.endOffset,e.startContainer,e.startOffset);return i?0>=o&&a>=0:0>o&&a>0}function s(t){for(var e,i,o,a=n(t.range).createDocumentFragment();i=t.next();){if(e=t.isPartiallySelectedSubtree(),i=i.cloneNode(!e),e&&(o=t.getSubtreeIterator(),i.appendChild(s(o)),o.detach(!0)),10==i.nodeType)throw new F("HIERARCHY_REQUEST_ERR");a.appendChild(i)}return a}function l(t,e,n){var i,o;n=n||{stop:!1};for(var a,r;a=t.next();)if(t.isPartiallySelectedSubtree()){if(e(a)===!1)return void(n.stop=!0);if(r=t.getSubtreeIterator(),l(r,e,n),r.detach(!0),n.stop)return}else for(i=L.createIterator(a);o=i.next();)if(e(o)===!1)return void(n.stop=!0)}function c(t){for(var e;t.next();)t.isPartiallySelectedSubtree()?(e=t.getSubtreeIterator(),c(e),e.detach(!0)):t.remove()}function d(t){for(var e,i,o=n(t.range).createDocumentFragment();e=t.next();){if(t.isPartiallySelectedSubtree()?(e=e.cloneNode(!1),i=t.getSubtreeIterator(),e.appendChild(d(i)),i.detach(!0)):t.remove(),10==e.nodeType)throw new F("HIERARCHY_REQUEST_ERR");o.appendChild(e)}return o}function h(t,e,n){var i,o=!(!e||!e.length),a=!!n;o&&(i=new RegExp("^("+e.join("|")+")$"));var r=[];return l(new p(t,!1),function(e){if(!(o&&!i.test(e.nodeType)||a&&!n(e))){var s=t.startContainer;if(e!=s||!H(s)||t.startOffset!=s.length){var l=t.endContainer;e==l&&H(l)&&0==t.endOffset||r.push(e)}}}),r}function u(t){var e="undefined"==typeof t.getName?"Range":t.getName();return"["+e+"("+L.inspectNode(t.startContainer)+":"+t.startOffset+", "+L.inspectNode(t.endContainer)+":"+t.endOffset+")]"}function p(t,e){if(this.range=t,this.clonePartiallySelectedTextNodes=e,!t.collapsed){this.sc=t.startContainer,this.so=t.startOffset,this.ec=t.endContainer,this.eo=t.endOffset;var n=t.commonAncestorContainer;this.sc===this.ec&&H(this.sc)?(this.isSingleCharacterDataNode=!0,this._first=this._last=this._next=this.sc):(this._first=this._next=this.sc!==n||H(this.sc)?q(this.sc,n,!0):this.sc.childNodes[this.so],this._last=this.ec!==n||H(this.ec)?q(this.ec,n,!0):this.ec.childNodes[this.eo-1])}}function f(t){this.code=this[t],this.codeName=t,this.message="RangeException: "+this.codeName}function g(t){return function(e,n){for(var i,o=n?e:e.parentNode;o;){if(i=o.nodeType,Y(t,i))return o;o=o.parentNode}return null}}function m(t,e){if(oe(t,e))throw new f("INVALID_NODE_TYPE_ERR")}function v(t){if(!t.startContainer)throw new F("INVALID_STATE_ERR")}function b(t,e){if(!Y(e,t.nodeType))throw new f("INVALID_NODE_TYPE_ERR")}function y(t,e){if(0>e||e>(H(t)?t.length:t.childNodes.length))throw new F("INDEX_SIZE_ERR")}function w(t,e){if(ne(t,!0)!==ne(e,!0))throw new F("WRONG_DOCUMENT_ERR")}function C(t){if(ie(t,!0))throw new F("NO_MODIFICATION_ALLOWED_ERR")}function x(t,e){if(!t)throw new F(e)}function _(t){return Q&&L.isBrokenNode(t)||!Y(K,t.nodeType)&&!ne(t,!0)}function T(t,e){return e<=(H(t)?t.length:t.childNodes.length)}function S(t){return!!t.startContainer&&!!t.endContainer&&!_(t.startContainer)&&!_(t.endContainer)&&T(t.startContainer,t.startOffset)&&T(t.endContainer,t.endOffset)}function k(t){if(v(t),!S(t))throw new Error("Range error: Range is no longer valid after DOM mutation ("+t.inspect()+")")}function E(t,e){k(t);var n=t.startContainer,i=t.startOffset,o=t.endContainer,a=t.endOffset,r=n===o;H(o)&&a>0&&a<o.length&&G(o,a,e),H(n)&&i>0&&i<n.length&&(n=G(n,i,e),r?(a-=i,o=n):o==n.parentNode&&a>=j(n)&&a++,i=0),t.setStartAndEnd(n,i,o,a)}function R(t){t.START_TO_START=de,t.START_TO_END=he,t.END_TO_END=ue,t.END_TO_START=pe,t.NODE_BEFORE=fe,t.NODE_AFTER=ge,t.NODE_BEFORE_AND_AFTER=me,t.NODE_INSIDE=ve}function N(t){R(t),R(t.prototype)}function D(t,e){return function(){k(this);var n,i,a=this.startContainer,r=this.startOffset,s=this.commonAncestorContainer,c=new p(this,!0);a!==s&&(n=q(a,s,!0),i=o(n),a=i.node,r=i.offset),l(c,C),c.reset();var d=t(c);return c.detach(),e(this,a,r,a,r),d}}function A(n,a,r){function s(t,e){return function(n){v(this),b(n,X),b(J(n),K);var a=(t?i:o)(n);(e?l:h)(this,a.node,a.offset)}}function l(t,e,n){var i=t.endContainer,o=t.endOffset;(e!==t.startContainer||n!==t.startOffset)&&((J(e)!=J(i)||1==W(e,n,i,o))&&(i=e,o=n),a(t,e,n,i,o))}function h(t,e,n){var i=t.startContainer,o=t.startOffset;(e!==t.endContainer||n!==t.endOffset)&&((J(e)!=J(i)||-1==W(e,n,i,o))&&(i=e,o=n),a(t,i,o,e,n))}var u=function(){};u.prototype=t.rangePrototype,n.prototype=new u,$.extend(n.prototype,{setStart:function(t,e){v(this),m(t,!0),y(t,e),l(this,t,e)},setEnd:function(t,e){v(this),m(t,!0),y(t,e),h(this,t,e)
},setStartAndEnd:function(){v(this);var t=arguments,e=t[0],n=t[1],i=e,o=n;switch(t.length){case 3:o=t[2];break;case 4:i=t[2],o=t[3]}a(this,e,n,i,o)},setBoundary:function(t,e,n){this["set"+(n?"Start":"End")](t,e)},setStartBefore:s(!0,!0),setStartAfter:s(!1,!0),setEndBefore:s(!0,!1),setEndAfter:s(!1,!1),collapse:function(t){k(this),t?a(this,this.startContainer,this.startOffset,this.startContainer,this.startOffset):a(this,this.endContainer,this.endOffset,this.endContainer,this.endOffset)},selectNodeContents:function(t){v(this),m(t,!0),a(this,t,0,t,V(t))},selectNode:function(t){v(this),m(t,!1),b(t,X);var e=i(t),n=o(t);a(this,e.node,e.offset,n.node,n.offset)},extractContents:D(d,a),deleteContents:D(c,a),canSurroundContents:function(){k(this),C(this.startContainer),C(this.endContainer);var t=new p(this,!0),n=t._first&&e(t._first,this)||t._last&&e(t._last,this);return t.detach(),!n},detach:function(){r(this)},splitBoundaries:function(){E(this)},splitBoundariesPreservingPositions:function(t){E(this,t)},normalizeBoundaries:function(){k(this);var t=this.startContainer,e=this.startOffset,n=this.endContainer,i=this.endOffset,o=function(t){var e=t.nextSibling;e&&e.nodeType==t.nodeType&&(n=t,i=t.length,t.appendData(e.data),e.parentNode.removeChild(e))},r=function(o){var a=o.previousSibling;if(a&&a.nodeType==o.nodeType){t=o;var r=o.length;if(e=a.length,o.insertData(0,a.data),a.parentNode.removeChild(a),t==n)i+=e,n=t;else if(n==o.parentNode){var s=j(o);i==s?(n=o,i=r):i>s&&i--}}},s=!0;if(H(n))n.length==i&&o(n);else{if(i>0){var l=n.childNodes[i-1];l&&H(l)&&o(l)}s=!this.collapsed}if(s){if(H(t))0==e&&r(t);else if(e<t.childNodes.length){var c=t.childNodes[e];c&&H(c)&&r(c)}}else t=n,e=i;a(this,t,e,n,i)},collapseToPoint:function(t,e){v(this),m(t,!0),y(t,e),this.setStartAndEnd(t,e)}}),N(n)}function O(t){t.collapsed=t.startContainer===t.endContainer&&t.startOffset===t.endOffset,t.commonAncestorContainer=t.collapsed?t.startContainer:L.getCommonAncestor(t.startContainer,t.endContainer)}function I(t,e,n,i,o){t.startContainer=e,t.startOffset=n,t.endContainer=i,t.endOffset=o,t.document=L.getDocument(e),O(t)}function P(t){v(t),t.startContainer=t.startOffset=t.endContainer=t.endOffset=t.document=null,t.collapsed=t.commonAncestorContainer=null}function M(t){this.startContainer=t,this.startOffset=0,this.endContainer=t,this.endOffset=0,this.document=t,O(this)}var L=t.dom,$=t.util,B=L.DomPosition,F=t.DOMException,H=L.isCharacterDataNode,j=L.getNodeIndex,U=L.isOrIsAncestorOf,z=L.getDocument,W=L.comparePoints,G=L.splitDataNode,q=L.getClosestAncestorIn,V=L.getNodeLength,Y=L.arrayContains,J=L.getRootContainer,Q=t.features.crashyTextNodes;p.prototype={_current:null,_next:null,_first:null,_last:null,isSingleCharacterDataNode:!1,reset:function(){this._current=null,this._next=this._first},hasNext:function(){return!!this._next},next:function(){var t=this._current=this._next;return t&&(this._next=t!==this._last?t.nextSibling:null,H(t)&&this.clonePartiallySelectedTextNodes&&(t===this.ec&&(t=t.cloneNode(!0)).deleteData(this.eo,t.length-this.eo),this._current===this.sc&&(t=t.cloneNode(!0)).deleteData(0,this.so))),t},remove:function(){var t,e,n=this._current;!H(n)||n!==this.sc&&n!==this.ec?n.parentNode&&n.parentNode.removeChild(n):(t=n===this.sc?this.so:0,e=n===this.ec?this.eo:n.length,t!=e&&n.deleteData(t,e-t))},isPartiallySelectedSubtree:function(){var t=this._current;return e(t,this.range)},getSubtreeIterator:function(){var t;if(this.isSingleCharacterDataNode)t=this.range.cloneRange(),t.collapse(!1);else{t=new M(n(this.range));var e=this._current,i=e,o=0,a=e,r=V(e);U(e,this.sc)&&(i=this.sc,o=this.so),U(e,this.ec)&&(a=this.ec,r=this.eo),I(t,i,o,a,r)}return new p(t,this.clonePartiallySelectedTextNodes)},detach:function(t){t&&this.range.detach(),this.range=this._current=this._next=this._first=this._last=this.sc=this.so=this.ec=this.eo=null}},f.prototype={BAD_BOUNDARYPOINTS_ERR:1,INVALID_NODE_TYPE_ERR:2},f.prototype.toString=function(){return this.message};var X=[1,3,4,5,7,8,10],K=[2,9,11],Z=[5,6,10,12],te=[1,3,4,5,7,8,10,11],ee=[1,3,4,5,7,8],ne=g([9,11]),ie=g(Z),oe=g([6,10,12]),ae=document.createElement("style"),re=!1;try{ae.innerHTML="<b>x</b>",re=3==ae.firstChild.nodeType}catch(se){}t.features.htmlParsingConforms=re;var le=re?function(t){var e=this.startContainer,n=z(e);if(!e)throw new F("INVALID_STATE_ERR");var i=null;return 1==e.nodeType?i=e:H(e)&&(i=L.parentElement(e)),i=null===i||"HTML"==i.nodeName&&L.isHtmlNamespace(z(i).documentElement)&&L.isHtmlNamespace(i)?n.createElement("body"):i.cloneNode(!1),i.innerHTML=t,L.fragmentFromNodeChildren(i)}:function(t){v(this);var e=n(this),i=e.createElement("body");return i.innerHTML=t,L.fragmentFromNodeChildren(i)},ce=["startContainer","startOffset","endContainer","endOffset","collapsed","commonAncestorContainer"],de=0,he=1,ue=2,pe=3,fe=0,ge=1,me=2,ve=3;$.extend(t.rangePrototype,{compareBoundaryPoints:function(t,e){k(this),w(this.startContainer,e.startContainer);var n,i,o,a,r=t==pe||t==de?"start":"end",s=t==he||t==de?"start":"end";return n=this[r+"Container"],i=this[r+"Offset"],o=e[s+"Container"],a=e[s+"Offset"],W(n,i,o,a)},insertNode:function(t){if(k(this),b(t,te),C(this.startContainer),U(t,this.startContainer))throw new F("HIERARCHY_REQUEST_ERR");var e=a(t,this.startContainer,this.startOffset);this.setStartBefore(e)},cloneContents:function(){k(this);var t,e;if(this.collapsed)return n(this).createDocumentFragment();if(this.startContainer===this.endContainer&&H(this.startContainer))return t=this.startContainer.cloneNode(!0),t.data=t.data.slice(this.startOffset,this.endOffset),e=n(this).createDocumentFragment(),e.appendChild(t),e;var i=new p(this,!0);return t=s(i),i.detach(),t},canSurroundContents:function(){k(this),C(this.startContainer),C(this.endContainer);var t=new p(this,!0),n=t._first&&e(t._first,this)||t._last&&e(t._last,this);return t.detach(),!n},surroundContents:function(t){if(b(t,ee),!this.canSurroundContents())throw new f("BAD_BOUNDARYPOINTS_ERR");var e=this.extractContents();if(t.hasChildNodes())for(;t.lastChild;)t.removeChild(t.lastChild);a(t,this.startContainer,this.startOffset),t.appendChild(e),this.selectNode(t)},cloneRange:function(){k(this);for(var t,e=new M(n(this)),i=ce.length;i--;)t=ce[i],e[t]=this[t];return e},toString:function(){k(this);var t=this.startContainer;if(t===this.endContainer&&H(t))return 3==t.nodeType||4==t.nodeType?t.data.slice(this.startOffset,this.endOffset):"";var e=[],n=new p(this,!0);return l(n,function(t){(3==t.nodeType||4==t.nodeType)&&e.push(t.data)}),n.detach(),e.join("")},compareNode:function(t){k(this);var e=t.parentNode,n=j(t);if(!e)throw new F("NOT_FOUND_ERR");var i=this.comparePoint(e,n),o=this.comparePoint(e,n+1);return 0>i?o>0?me:fe:o>0?ge:ve},comparePoint:function(t,e){return k(this),x(t,"HIERARCHY_REQUEST_ERR"),w(t,this.startContainer),W(t,e,this.startContainer,this.startOffset)<0?-1:W(t,e,this.endContainer,this.endOffset)>0?1:0},createContextualFragment:le,toHtml:function(){k(this);var t=this.commonAncestorContainer.parentNode.cloneNode(!1);return t.appendChild(this.cloneContents()),t.innerHTML},intersectsNode:function(t,e){if(k(this),x(t,"NOT_FOUND_ERR"),z(t)!==n(this))return!1;var i=t.parentNode,o=j(t);x(i,"NOT_FOUND_ERR");var a=W(i,o,this.endContainer,this.endOffset),r=W(i,o+1,this.startContainer,this.startOffset);return e?0>=a&&r>=0:0>a&&r>0},isPointInRange:function(t,e){return k(this),x(t,"HIERARCHY_REQUEST_ERR"),w(t,this.startContainer),W(t,e,this.startContainer,this.startOffset)>=0&&W(t,e,this.endContainer,this.endOffset)<=0},intersectsRange:function(t){return r(this,t,!1)},intersectsOrTouchesRange:function(t){return r(this,t,!0)},intersection:function(t){if(this.intersectsRange(t)){var e=W(this.startContainer,this.startOffset,t.startContainer,t.startOffset),n=W(this.endContainer,this.endOffset,t.endContainer,t.endOffset),i=this.cloneRange();return-1==e&&i.setStart(t.startContainer,t.startOffset),1==n&&i.setEnd(t.endContainer,t.endOffset),i}return null},union:function(t){if(this.intersectsOrTouchesRange(t)){var e=this.cloneRange();return-1==W(t.startContainer,t.startOffset,this.startContainer,this.startOffset)&&e.setStart(t.startContainer,t.startOffset),1==W(t.endContainer,t.endOffset,this.endContainer,this.endOffset)&&e.setEnd(t.endContainer,t.endOffset),e}throw new f("Ranges do not intersect")},containsNode:function(t,e){return e?this.intersectsNode(t,!1):this.compareNode(t)==ve},containsNodeContents:function(t){return this.comparePoint(t,0)>=0&&this.comparePoint(t,V(t))<=0},containsRange:function(t){var e=this.intersection(t);return null!==e&&t.equals(e)},containsNodeText:function(t){var e=this.cloneRange();e.selectNode(t);var n=e.getNodes([3]);if(n.length>0){e.setStart(n[0],0);var i=n.pop();e.setEnd(i,i.length);var o=this.containsRange(e);return e.detach(),o}return this.containsNodeContents(t)},getNodes:function(t,e){return k(this),h(this,t,e)},getDocument:function(){return n(this)},collapseBefore:function(t){v(this),this.setEndBefore(t),this.collapse(!1)},collapseAfter:function(t){v(this),this.setStartAfter(t),this.collapse(!0)},getBookmark:function(e){var i=n(this),o=t.createRange(i);e=e||L.getBody(i),o.selectNodeContents(e);var a=this.intersection(o),r=0,s=0;return a&&(o.setEnd(a.startContainer,a.startOffset),r=o.toString().length,s=r+a.toString().length,o.detach()),{start:r,end:s,containerNode:e}},moveToBookmark:function(t){var e=t.containerNode,n=0;this.setStart(e,0),this.collapse(!0);for(var i,o,a,r,s=[e],l=!1,c=!1;!c&&(i=s.pop());)if(3==i.nodeType)o=n+i.length,!l&&t.start>=n&&t.start<=o&&(this.setStart(i,t.start-n),l=!0),l&&t.end>=n&&t.end<=o&&(this.setEnd(i,t.end-n),c=!0),n=o;else for(r=i.childNodes,a=r.length;a--;)s.push(r[a])},getName:function(){return"DomRange"},equals:function(t){return M.rangesEqual(this,t)},isValid:function(){return S(this)},inspect:function(){return u(this)}}),A(M,I,P),$.extend(M,{rangeProperties:ce,RangeIterator:p,copyComparisonConstants:N,createPrototypeRange:A,inspect:u,getRangeDocument:n,rangesEqual:function(t,e){return t.startContainer===e.startContainer&&t.startOffset===e.startOffset&&t.endContainer===e.endContainer&&t.endOffset===e.endOffset}}),t.DomRange=M,t.RangeException=f}),rangy.createCoreModule("WrappedRange",["DomRange"],function(t,e){var n,i,o=t.dom,a=t.util,r=o.DomPosition,s=t.DomRange,l=o.getBody,c=o.getContentDocument,d=o.isCharacterDataNode;if(t.features.implementsDomRange&&!function(){function i(t){for(var e,n=p.length;n--;)e=p[n],t[e]=t.nativeRange[e];t.collapsed=t.startContainer===t.endContainer&&t.startOffset===t.endOffset}function r(t,e,n,i,o){var a=t.startContainer!==e||t.startOffset!=n,r=t.endContainer!==i||t.endOffset!=o,s=!t.equals(t.nativeRange);(a||r||s)&&(t.setEnd(i,o),t.setStart(e,n))}function d(t){t.nativeRange.detach(),t.detached=!0;for(var e=p.length;e--;)t[p[e]]=null}var h,u,p=s.rangeProperties;n=function(t){if(!t)throw e.createError("WrappedRange: Range must be specified");this.nativeRange=t,i(this)},s.createPrototypeRange(n,r,d),h=n.prototype,h.selectNode=function(t){this.nativeRange.selectNode(t),i(this)},h.cloneContents=function(){return this.nativeRange.cloneContents()},h.surroundContents=function(t){this.nativeRange.surroundContents(t),i(this)},h.collapse=function(t){this.nativeRange.collapse(t),i(this)},h.cloneRange=function(){return new n(this.nativeRange.cloneRange())},h.refresh=function(){i(this)},h.toString=function(){return this.nativeRange.toString()};var f=document.createTextNode("test");l(document).appendChild(f);var g=document.createRange();g.setStart(f,0),g.setEnd(f,0);try{g.setStart(f,1),h.setStart=function(t,e){this.nativeRange.setStart(t,e),i(this)},h.setEnd=function(t,e){this.nativeRange.setEnd(t,e),i(this)},u=function(t){return function(e){this.nativeRange[t](e),i(this)}}}catch(m){h.setStart=function(t,e){try{this.nativeRange.setStart(t,e)}catch(n){this.nativeRange.setEnd(t,e),this.nativeRange.setStart(t,e)}i(this)},h.setEnd=function(t,e){try{this.nativeRange.setEnd(t,e)}catch(n){this.nativeRange.setStart(t,e),this.nativeRange.setEnd(t,e)}i(this)},u=function(t,e){return function(n){try{this.nativeRange[t](n)}catch(o){this.nativeRange[e](n),this.nativeRange[t](n)}i(this)}}}h.setStartBefore=u("setStartBefore","setEndBefore"),h.setStartAfter=u("setStartAfter","setEndAfter"),h.setEndBefore=u("setEndBefore","setStartBefore"),h.setEndAfter=u("setEndAfter","setStartAfter"),h.selectNodeContents=function(t){this.setStartAndEnd(t,0,o.getNodeLength(t))},g.selectNodeContents(f),g.setEnd(f,3);var v=document.createRange();v.selectNodeContents(f),v.setEnd(f,4),v.setStart(f,2),h.compareBoundaryPoints=-1==g.compareBoundaryPoints(g.START_TO_END,v)&&1==g.compareBoundaryPoints(g.END_TO_START,v)?function(t,e){return e=e.nativeRange||e,t==e.START_TO_END?t=e.END_TO_START:t==e.END_TO_START&&(t=e.START_TO_END),this.nativeRange.compareBoundaryPoints(t,e)}:function(t,e){return this.nativeRange.compareBoundaryPoints(t,e.nativeRange||e)};var b=document.createElement("div");b.innerHTML="123";var y=b.firstChild,w=l(document);w.appendChild(b),g.setStart(y,1),g.setEnd(y,2),g.deleteContents(),"13"==y.data&&(h.deleteContents=function(){this.nativeRange.deleteContents(),i(this)},h.extractContents=function(){var t=this.nativeRange.extractContents();return i(this),t}),w.removeChild(b),w=null,a.isHostMethod(g,"createContextualFragment")&&(h.createContextualFragment=function(t){return this.nativeRange.createContextualFragment(t)}),l(document).removeChild(f),g.detach(),v.detach(),h.getName=function(){return"WrappedRange"},t.WrappedRange=n,t.createNativeRange=function(t){return t=c(t,e,"createNativeRange"),t.createRange()}}(),t.features.implementsTextRange){var h=function(t){var e=t.parentElement(),n=t.duplicate();n.collapse(!0);var i=n.parentElement();n=t.duplicate(),n.collapse(!1);var a=n.parentElement(),r=i==a?i:o.getCommonAncestor(i,a);return r==e?r:o.getCommonAncestor(e,r)},u=function(t){return 0==t.compareEndPoints("StartToEnd",t)},p=function(t,e,n,i,a){var s=t.duplicate();s.collapse(n);var l=s.parentElement();if(o.isOrIsAncestorOf(e,l)||(l=e),!l.canHaveHTML){var c=new r(l.parentNode,o.getNodeIndex(l));return{boundaryPosition:c,nodeInfo:{nodeIndex:c.offset,containerElement:c.node}}}var h=o.getDocument(l).createElement("span");h.parentNode&&h.parentNode.removeChild(h);for(var u,p,f,g,m,v=n?"StartToStart":"StartToEnd",b=a&&a.containerElement==l?a.nodeIndex:0,y=l.childNodes.length,w=y,C=w;;){if(C==y?l.appendChild(h):l.insertBefore(h,l.childNodes[C]),s.moveToElementText(h),u=s.compareEndPoints(v,t),0==u||b==w)break;if(-1==u){if(w==b+1)break;b=C}else w=w==b+1?b:C;C=Math.floor((b+w)/2),l.removeChild(h)}if(m=h.nextSibling,-1==u&&m&&d(m)){s.setEndPoint(n?"EndToStart":"EndToEnd",t);var x;if(/[\r\n]/.test(m.data)){var _=s.duplicate(),T=_.text.replace(/\r\n/g,"\r").length;for(x=_.moveStart("character",T);-1==(u=_.compareEndPoints("StartToEnd",_));)x++,_.moveStart("character",1)}else x=s.text.length;g=new r(m,x)}else p=(i||!n)&&h.previousSibling,f=(i||n)&&h.nextSibling,g=f&&d(f)?new r(f,0):p&&d(p)?new r(p,p.data.length):new r(l,o.getNodeIndex(h));return h.parentNode.removeChild(h),{boundaryPosition:g,nodeInfo:{nodeIndex:C,containerElement:l}}},f=function(t,e){var n,i,a,r,s=t.offset,c=o.getDocument(t.node),h=l(c).createTextRange(),u=d(t.node);return u?(n=t.node,i=n.parentNode):(r=t.node.childNodes,n=s<r.length?r[s]:null,i=t.node),a=c.createElement("span"),a.innerHTML="&#feff;",n?i.insertBefore(a,n):i.appendChild(a),h.moveToElementText(a),h.collapse(!e),i.removeChild(a),u&&h[e?"moveStart":"moveEnd"]("character",s),h};if(i=function(t){this.textRange=t,this.refresh()},i.prototype=new s(document),i.prototype.refresh=function(){var t,e,n,i=h(this.textRange);u(this.textRange)?e=t=p(this.textRange,i,!0,!0).boundaryPosition:(n=p(this.textRange,i,!0,!1),t=n.boundaryPosition,e=p(this.textRange,i,!1,!1,n.nodeInfo).boundaryPosition),this.setStart(t.node,t.offset),this.setEnd(e.node,e.offset)},i.prototype.getName=function(){return"WrappedTextRange"},s.copyComparisonConstants(i),i.rangeToTextRange=function(t){if(t.collapsed)return f(new r(t.startContainer,t.startOffset),!0);var e=f(new r(t.startContainer,t.startOffset),!0),n=f(new r(t.endContainer,t.endOffset),!1),i=l(s.getRangeDocument(t)).createTextRange();return i.setEndPoint("StartToStart",e),i.setEndPoint("EndToEnd",n),i},t.WrappedTextRange=i,!t.features.implementsDomRange||t.config.preferTextRange){var g=function(){return this}();"undefined"==typeof g.Range&&(g.Range=i),t.createNativeRange=function(t){return t=c(t,e,"createNativeRange"),l(t).createTextRange()},t.WrappedRange=i}}t.createRange=function(n){return n=c(n,e,"createRange"),new t.WrappedRange(t.createNativeRange(n))},t.createRangyRange=function(t){return t=c(t,e,"createRangyRange"),new s(t)},t.createIframeRange=function(n){return e.deprecationNotice("createIframeRange()","createRange(iframeEl)"),t.createRange(n)},t.createIframeRangyRange=function(n){return e.deprecationNotice("createIframeRangyRange()","createRangyRange(iframeEl)"),t.createRangyRange(n)},t.addCreateMissingNativeApiListener(function(e){var n=e.document;"undefined"==typeof n.createRange&&(n.createRange=function(){return t.createRange(n)}),n=e=null})}),rangy.createCoreModule("WrappedSelection",["DomRange","WrappedRange"],function(t,e){function n(t){return"string"==typeof t?/^backward(s)?$/i.test(t):!!t}function i(t,n){if(t){if(R.isWindow(t))return t;if(t instanceof v)return t.win;var i=R.getContentDocument(t,e,n);return R.getWindow(i)}return window}function o(t){return i(t,"getWinSelection").getSelection()}function a(t){return i(t,"getDocSelection").document.selection}function r(t){var e=!1;return t.anchorNode&&(e=1==R.comparePoints(t.anchorNode,t.anchorOffset,t.focusNode,t.focusOffset)),e}function s(t,e,n){var i=n?"end":"start",o=n?"start":"end";t.anchorNode=e[i+"Container"],t.anchorOffset=e[i+"Offset"],t.focusNode=e[o+"Container"],t.focusOffset=e[o+"Offset"]}function l(t){var e=t.nativeSelection;t.anchorNode=e.anchorNode,t.anchorOffset=e.anchorOffset,t.focusNode=e.focusNode,t.focusOffset=e.focusOffset}function c(t){t.anchorNode=t.focusNode=null,t.anchorOffset=t.focusOffset=0,t.rangeCount=0,t.isCollapsed=!0,t._ranges.length=0}function d(e){var n;return e instanceof A?(n=t.createNativeRange(e.getDocument()),n.setEnd(e.endContainer,e.endOffset),n.setStart(e.startContainer,e.startOffset)):e instanceof O?n=e.nativeRange:M.implementsDomRange&&e instanceof R.getWindow(e.startContainer).Range&&(n=e),n}function h(t){if(!t.length||1!=t[0].nodeType)return!1;for(var e=1,n=t.length;n>e;++e)if(!R.isAncestorOf(t[0],t[e]))return!1;return!0}function u(t){var n=t.getNodes();if(!h(n))throw e.createError("getSingleElementFromRange: range "+t.inspect()+" did not consist of a single element");return n[0]}function p(t){return!!t&&"undefined"!=typeof t.text}function f(t,e){var n=new O(e);t._ranges=[n],s(t,n,!1),t.rangeCount=1,t.isCollapsed=n.collapsed}function g(e){if(e._ranges.length=0,"None"==e.docSelection.type)c(e);else{var n=e.docSelection.createRange();if(p(n))f(e,n);else{e.rangeCount=n.length;for(var i,o=$(n.item(0)),a=0;a<e.rangeCount;++a)i=t.createRange(o),i.selectNode(n.item(a)),e._ranges.push(i);e.isCollapsed=1==e.rangeCount&&e._ranges[0].collapsed,s(e,e._ranges[e.rangeCount-1],!1)}}}function m(t,n){for(var i=t.docSelection.createRange(),o=u(n),a=$(i.item(0)),r=B(a).createControlRange(),s=0,l=i.length;l>s;++s)r.add(i.item(s));try{r.add(o)}catch(c){throw e.createError("addRange(): Element within the specified Range could not be added to control selection (does it have layout?)")}r.select(),g(t)}function v(t,e,n){this.nativeSelection=t,this.docSelection=e,this._ranges=[],this.win=n,this.refresh()}function b(t){t.win=t.anchorNode=t.focusNode=t._ranges=null,t.rangeCount=t.anchorOffset=t.focusOffset=0,t.detached=!0}function y(t,e){for(var n,i,o=ee.length;o--;)if(n=ee[o],i=n.selection,"deleteAll"==e)b(i);else if(n.win==t)return"delete"==e?(ee.splice(o,1),!0):i;return"deleteAll"==e&&(ee.length=0),null}function w(t,n){for(var i,o=$(n[0].startContainer),a=B(o).createControlRange(),r=0,s=n.length;s>r;++r){i=u(n[r]);try{a.add(i)}catch(l){throw e.createError("setRanges(): Element within one of the specified Ranges could not be added to control selection (does it have layout?)")}}a.select(),g(t)}function C(t,e){if(t.win.document!=$(e))throw new I("WRONG_DOCUMENT_ERR")}function x(e){return function(n,i){var o;this.rangeCount?(o=this.getRangeAt(0),o["set"+(e?"Start":"End")](n,i)):(o=t.createRange(this.win.document),o.setStartAndEnd(n,i)),this.setSingleRange(o,this.isBackward())}}function _(t){var e=[],n=new P(t.anchorNode,t.anchorOffset),i=new P(t.focusNode,t.focusOffset),o="function"==typeof t.getName?t.getName():"Selection";if("undefined"!=typeof t.rangeCount)for(var a=0,r=t.rangeCount;r>a;++a)e[a]=A.inspect(t.getRangeAt(a));return"["+o+"(Ranges: "+e.join(", ")+")(anchor: "+n.inspect()+", focus: "+i.inspect()+"]"}t.config.checkSelectionRanges=!0;var T,S,k="boolean",E="number",R=t.dom,N=t.util,D=N.isHostMethod,A=t.DomRange,O=t.WrappedRange,I=t.DOMException,P=R.DomPosition,M=t.features,L="Control",$=R.getDocument,B=R.getBody,F=A.rangesEqual,H=D(window,"getSelection"),j=N.isHostObject(document,"selection");M.implementsWinGetSelection=H,M.implementsDocSelection=j;var U=j&&(!H||t.config.preferTextRange);U?(T=a,t.isSelectionValid=function(t){var e=i(t,"isSelectionValid").document,n=e.selection;return"None"!=n.type||$(n.createRange().parentElement())==e}):H?(T=o,t.isSelectionValid=function(){return!0}):e.fail("Neither document.selection or window.getSelection() detected."),t.getNativeSelection=T;var z=T(),W=t.createNativeRange(document),G=B(document),q=N.areHostProperties(z,["anchorNode","focusNode","anchorOffset","focusOffset"]);M.selectionHasAnchorAndFocus=q;var V=D(z,"extend");M.selectionHasExtend=V;var Y=typeof z.rangeCount==E;M.selectionHasRangeCount=Y;var J=!1,Q=!0,X=V?function(e,n){var i=A.getRangeDocument(n),o=t.createRange(i);o.collapseToPoint(n.endContainer,n.endOffset),e.addRange(d(o)),e.extend(n.startContainer,n.startOffset)}:null;N.areHostMethods(z,["addRange","getRangeAt","removeAllRanges"])&&typeof z.rangeCount==E&&M.implementsDomRange&&!function(){var e=window.getSelection();if(e){for(var n=e.rangeCount,i=n>1,o=[],a=r(e),s=0;n>s;++s)o[s]=e.getRangeAt(s);var l=B(document),c=l.appendChild(document.createElement("div"));c.contentEditable="false";var d=c.appendChild(document.createTextNode("   ")),h=document.createRange();if(h.setStart(d,1),h.collapse(!0),e.addRange(h),Q=1==e.rangeCount,e.removeAllRanges(),!i){var u=h.cloneRange();h.setStart(d,0),u.setEnd(d,3),u.setStart(d,2),e.addRange(h),e.addRange(u),J=2==e.rangeCount,u.detach()}for(l.removeChild(c),e.removeAllRanges(),h.detach(),s=0;n>s;++s)0==s&&a?X?X(e,o[s]):(t.warn("Rangy initialization: original selection was backwards but selection has been restored forwards because browser does not support Selection.extend"),e.addRange(o[s])):e.addRange(o[s])}}(),M.selectionSupportsMultipleRanges=J,M.collapsedNonEditableSelectionsSupported=Q;var K,Z=!1;G&&D(G,"createControlRange")&&(K=G.createControlRange(),N.areHostProperties(K,["item","add"])&&(Z=!0)),M.implementsControlRange=Z,S=q?function(t){return t.anchorNode===t.focusNode&&t.anchorOffset===t.focusOffset}:function(t){return t.rangeCount?t.getRangeAt(t.rangeCount-1).collapsed:!1};var te;D(z,"getRangeAt")?te=function(t,e){try{return t.getRangeAt(e)}catch(n){return null}}:q&&(te=function(e){var n=$(e.anchorNode),i=t.createRange(n);return i.setStartAndEnd(e.anchorNode,e.anchorOffset,e.focusNode,e.focusOffset),i.collapsed!==this.isCollapsed&&i.setStartAndEnd(e.focusNode,e.focusOffset,e.anchorNode,e.anchorOffset),i}),v.prototype=t.selectionPrototype;var ee=[],ne=function(t){if(t&&t instanceof v)return t.refresh(),t;t=i(t,"getNativeSelection");var e=y(t),n=T(t),o=j?a(t):null;return e?(e.nativeSelection=n,e.docSelection=o,e.refresh()):(e=new v(n,o,t),ee.push({win:t,selection:e})),e};t.getSelection=ne,t.getIframeSelection=function(n){return e.deprecationNotice("getIframeSelection()","getSelection(iframeEl)"),t.getSelection(R.getIframeWindow(n))};var ie=v.prototype;if(!U&&q&&N.areHostMethods(z,["removeAllRanges","addRange"])){ie.removeAllRanges=function(){this.nativeSelection.removeAllRanges(),c(this)};var oe=function(t,e){X(t.nativeSelection,e),t.refresh()};ie.addRange=Y?function(e,i){if(Z&&j&&this.docSelection.type==L)m(this,e);else if(n(i)&&V)oe(this,e);else{var o;if(J?o=this.rangeCount:(this.removeAllRanges(),o=0),this.nativeSelection.addRange(d(e).cloneRange()),this.rangeCount=this.nativeSelection.rangeCount,this.rangeCount==o+1){if(t.config.checkSelectionRanges){var a=te(this.nativeSelection,this.rangeCount-1);a&&!F(a,e)&&(e=new O(a))}this._ranges[this.rangeCount-1]=e,s(this,e,se(this.nativeSelection)),this.isCollapsed=S(this)}else this.refresh()}}:function(t,e){n(e)&&V?oe(this,t):(this.nativeSelection.addRange(d(t)),this.refresh())},ie.setRanges=function(t){if(Z&&t.length>1)w(this,t);else{this.removeAllRanges();for(var e=0,n=t.length;n>e;++e)this.addRange(t[e])}}}else{if(!(D(z,"empty")&&D(W,"select")&&Z&&U))return e.fail("No means of selecting a Range or TextRange was found"),!1;ie.removeAllRanges=function(){try{if(this.docSelection.empty(),"None"!=this.docSelection.type){var t;if(this.anchorNode)t=$(this.anchorNode);else if(this.docSelection.type==L){var e=this.docSelection.createRange();e.length&&(t=$(e.item(0)))}if(t){var n=B(t).createTextRange();n.select(),this.docSelection.empty()}}}catch(i){}c(this)},ie.addRange=function(e){this.docSelection.type==L?m(this,e):(t.WrappedTextRange.rangeToTextRange(e).select(),this._ranges[0]=e,this.rangeCount=1,this.isCollapsed=this._ranges[0].collapsed,s(this,e,!1))},ie.setRanges=function(t){this.removeAllRanges();var e=t.length;e>1?w(this,t):e&&this.addRange(t[0])}}ie.getRangeAt=function(t){if(0>t||t>=this.rangeCount)throw new I("INDEX_SIZE_ERR");return this._ranges[t].cloneRange()};var ae;if(U)ae=function(e){var n;t.isSelectionValid(e.win)?n=e.docSelection.createRange():(n=B(e.win.document).createTextRange(),n.collapse(!0)),e.docSelection.type==L?g(e):p(n)?f(e,n):c(e)};else if(D(z,"getRangeAt")&&typeof z.rangeCount==E)ae=function(e){if(Z&&j&&e.docSelection.type==L)g(e);else if(e._ranges.length=e.rangeCount=e.nativeSelection.rangeCount,e.rangeCount){for(var n=0,i=e.rangeCount;i>n;++n)e._ranges[n]=new t.WrappedRange(e.nativeSelection.getRangeAt(n));s(e,e._ranges[e.rangeCount-1],se(e.nativeSelection)),e.isCollapsed=S(e)}else c(e)};else{if(!q||typeof z.isCollapsed!=k||typeof W.collapsed!=k||!M.implementsDomRange)return e.fail("No means of obtaining a Range or TextRange from the user's selection was found"),!1;ae=function(t){var e,n=t.nativeSelection;n.anchorNode?(e=te(n,0),t._ranges=[e],t.rangeCount=1,l(t),t.isCollapsed=S(t)):c(t)}}ie.refresh=function(t){var e=t?this._ranges.slice(0):null,n=this.anchorNode,i=this.anchorOffset;if(ae(this),t){var o=e.length;if(o!=this._ranges.length)return!0;if(this.anchorNode!=n||this.anchorOffset!=i)return!0;for(;o--;)if(!F(e[o],this._ranges[o]))return!0;return!1}};var re=function(t,e){var n=t.getAllRanges();t.removeAllRanges();for(var i=0,o=n.length;o>i;++i)F(e,n[i])||t.addRange(n[i]);t.rangeCount||c(t)};ie.removeRange=Z?function(t){if(this.docSelection.type==L){for(var e,n=this.docSelection.createRange(),i=u(t),o=$(n.item(0)),a=B(o).createControlRange(),r=!1,s=0,l=n.length;l>s;++s)e=n.item(s),e!==i||r?a.add(n.item(s)):r=!0;a.select(),g(this)}else re(this,t)}:function(t){re(this,t)};var se;!U&&q&&M.implementsDomRange?(se=r,ie.isBackward=function(){return se(this)}):se=ie.isBackward=function(){return!1},ie.isBackwards=ie.isBackward,ie.toString=function(){for(var t=[],e=0,n=this.rangeCount;n>e;++e)t[e]=""+this._ranges[e];return t.join("")},ie.collapse=function(e,n){C(this,e);var i=t.createRange(e);i.collapseToPoint(e,n),this.setSingleRange(i),this.isCollapsed=!0},ie.collapseToStart=function(){if(!this.rangeCount)throw new I("INVALID_STATE_ERR");var t=this._ranges[0];this.collapse(t.startContainer,t.startOffset)},ie.collapseToEnd=function(){if(!this.rangeCount)throw new I("INVALID_STATE_ERR");var t=this._ranges[this.rangeCount-1];this.collapse(t.endContainer,t.endOffset)},ie.selectAllChildren=function(e){C(this,e);var n=t.createRange(e);n.selectNodeContents(e),this.setSingleRange(n)},ie.deleteFromDocument=function(){if(Z&&j&&this.docSelection.type==L){for(var t,e=this.docSelection.createRange();e.length;)t=e.item(0),e.remove(t),t.parentNode.removeChild(t);this.refresh()}else if(this.rangeCount){var n=this.getAllRanges();if(n.length){this.removeAllRanges();for(var i=0,o=n.length;o>i;++i)n[i].deleteContents();this.addRange(n[o-1])}}},ie.eachRange=function(t,e){for(var n=0,i=this._ranges.length;i>n;++n)if(t(this.getRangeAt(n)))return e},ie.getAllRanges=function(){var t=[];return this.eachRange(function(e){t.push(e)}),t},ie.setSingleRange=function(t,e){this.removeAllRanges(),this.addRange(t,e)},ie.callMethodOnEachRange=function(t,e){var n=[];return this.eachRange(function(i){n.push(i[t].apply(i,e))}),n},ie.setStart=x(!0),ie.setEnd=x(!1),t.rangePrototype.select=function(t){ne(this.getDocument()).setSingleRange(this,t)},ie.changeEachRange=function(t){var e=[],n=this.isBackward();this.eachRange(function(n){t(n),e.push(n)}),this.removeAllRanges(),n&&1==e.length?this.addRange(e[0],"backward"):this.setRanges(e)},ie.containsNode=function(t,e){return this.eachRange(function(n){return n.containsNode(t,e)},!0)},ie.getBookmark=function(t){return{backward:this.isBackward(),rangeBookmarks:this.callMethodOnEachRange("getBookmark",[t])}},ie.moveToBookmark=function(e){for(var n,i,o=[],a=0;n=e.rangeBookmarks[a++];)i=t.createRange(this.win),i.moveToBookmark(n),o.push(i);e.backward?this.setSingleRange(o[0],"backward"):this.setRanges(o)},ie.toHtml=function(){return this.callMethodOnEachRange("toHtml").join("")},ie.getName=function(){return"WrappedSelection"},ie.inspect=function(){return _(this)},ie.detach=function(){y(this.win,"delete"),b(this)},v.detachAll=function(){y(null,"deleteAll")},v.inspect=_,v.isDirectionBackward=n,t.Selection=v,t.selectionPrototype=ie,t.addCreateMissingNativeApiListener(function(t){"undefined"==typeof t.getSelection&&(t.getSelection=function(){return ne(t)}),t=null})}),rangy.createModule("Applier",["WrappedSelection"],function(t,e){function n(t){return t.replace(/^\s\s*/,"").replace(/\s\s*$/,"")}function i(t,e){return t.className&&new RegExp("(?:^|\\s)"+e+"(?:\\s|$)").test(t.className)}function o(t,e){t.className?i(t,e)||(t.className+=" "+e):t.className=e}function a(t){return t.split(/\s+/).sort().join(" ")}function r(t){return a(t.className)}function s(t,e){return r(t)==r(e)}function l(t,e,n,i,o){var a=t.node,r=t.offset,s=a,l=r;a==i&&r>o&&l++,a!=e||r!=n&&r!=n+1||(s=i,l+=o-n),a==e&&r>n+1&&l--,t.node=s,t.offset=l}function c(t,e,n,i){-1==n&&(n=e.childNodes.length);for(var o,a=t.parentNode,r=O.getNodeIndex(t),s=0;o=i[s++];)l(o,a,r,e,n);e.childNodes.length==n?e.appendChild(t):e.insertBefore(t,e.childNodes[n])}function d(t,e,n,i,o){for(var a,r=[];a=t.firstChild;)c(a,e,n++,o),r.push(a);return i&&t.parentNode.removeChild(t),r}function h(t,e){return d(t,t.parentNode,O.getNodeIndex(t),!0,e)}function u(t,e){var n=t.cloneRange();n.selectNodeContents(e);var i=n.intersection(t),o=i?i.toString():"";return n.detach(),""!=o}function p(t){var e=t.cloneRange();return/<img/.test(v(e.cloneContents()))}function f(t){return t.getNodes([],function(e){return 3===e.nodeType&&u(t,e)?e:1===e.nodeType&&"IMG"===e.tagName?e:void 0})}function g(t,e){if(t.attributes.length!=e.attributes.length)return!1;for(var n,i,o,a=0,r=t.attributes.length;r>a;++a)if(n=t.attributes[a],o=n.name,"class"!=o){if(i=e.attributes.getNamedItem(o),n.specified!=i.specified)return!1;if(n.specified&&n.nodeValue!==i.nodeValue)return!1}return!0}function m(t){return t.clone().wrap("<div/>").parent().html()}function v(t,e){for(var n="",i=0,o=t.childNodes.length;o>i;i++){var a=t.childNodes.item(i),r=a.nodeType===Node.TEXT_NODE?a.nodeValue:m(jQuery(a));r&&(n+=r)}return e&&(n=jQuery("<"+e+">"+n+"</"+e+">"),n.find("p").wrapInner("<"+e+"/>"),n.find("p > *").unwrap(),n=jQuery("<div/>").html(n).html()),n
}function b(t){var e;return t&&1==t.nodeType&&((e=t.parentNode)&&9==e.nodeType&&"on"==e.designMode||M(t)&&!M(t.parentNode))}function y(t){return(M(t)||1!=t.nodeType&&M(t.parentNode))&&!b(t)}function w(t){return t&&1==t.nodeType&&!L.test(A(t,"display"))}function C(t){if(0==t.data.length)return!0;if($.test(t.data))return!1;var e=A(t.parentNode,"whiteSpace");switch(e){case"pre":case"pre-wrap":case"-moz-pre-wrap":return!1;case"pre-line":if(/[\r\n]/.test(t.data))return!1}return w(t.previousSibling)||w(t.nextSibling)}function x(t){var e,n,i=[];for(e=0;n=t[e++];)i.push(new I(n.startContainer,n.startOffset),new I(n.endContainer,n.endOffset));return i}function _(t,e){for(var n,i,o,a=0,r=t.length;r>a;++a)n=t[a],i=e[2*a],o=e[2*a+1],n.setStartAndEnd(i.node,i.offset,o.node,o.offset)}function T(t,e){return O.isCharacterDataNode(t)?0==e?!!t.previousSibling:e==t.length?!!t.nextSibling:!0:e>0&&e<t.childNodes.length}function S(t,n,i,o){var a,r,s=0==i;if(O.isAncestorOf(n,t))return t;if(O.isCharacterDataNode(n)){var l=O.getNodeIndex(n);if(0==i)i=l;else{if(i!=n.length)throw e.createError("splitNodeAt() should not be called with offset in the middle of a data node ("+i+" in "+n.data);i=l+1}n=n.parentNode}if(T(n,i)){a=n.cloneNode(!1),r=n.parentNode,a.id&&a.removeAttribute("id");for(var d,h=0;d=n.childNodes[i];)c(d,a,h++,o);return c(a,r,O.getNodeIndex(n)+1,o),n==t?a:S(t,r,O.getNodeIndex(a),o)}if(t!=n){a=n.parentNode;var u=O.getNodeIndex(n);return s||u++,S(t,a,u,o)}return t}function k(t,e){return t.tagName==e.tagName&&s(t,e)&&g(t,e)&&"inline"==A(t,"display")&&"inline"==A(e,"display")}function E(t){var e=t?"nextSibling":"previousSibling";return function(n,i){var o=n.parentNode,a=n[e];if(a){if(a&&3==a.nodeType)return a}else if(i&&(a=o[e],a&&1==a.nodeType&&k(o,a)))return a[t?"firstChild":"lastChild"];return null}}function R(t){this.isElementMerge=1==t.nodeType,this.firstTextNode=this.isElementMerge?t.lastChild:t,this.textNodes=[this.firstTextNode]}function N(t){this.tag=null,this.tags=[],this.classes=[],this.attributes=[],this.ignoreWhiteSpace=!0,this.applyToEditableOnly=!1,this.useExistingElements=!0,this.ignoreClasses=!1,this.ignoreAttributes=!1;for(var e in t)this[e]=t[e];for(var n=0,i=this.tags.length;i>n;n++)this.tags[n]=this.tags[n].toUpperCase();this.tag&&(this.tag=this.tag.toUpperCase(),this.tags.push(this.tag))}function D(t){return new N(t)}var A,O=t.dom,I=O.DomPosition,P=function(){function t(t,e,n){return e&&n?" ":""}return function(e,n){e.className&&(e.className=e.className.replace(new RegExp("(^|\\s)"+n+"(\\s|$)"),t))}}();"undefined"!=typeof window.getComputedStyle?A=function(t,e){return O.getWindow(t).getComputedStyle(t,null)[e]}:"undefined"!=typeof document.documentElement.currentStyle?A=function(t,e){return t.currentStyle[e]}:e.fail("No means of obtaining computed style properties found");var M;!function(){var t=document.createElement("div");M="boolean"==typeof t.isContentEditable?function(t){return t&&1==t.nodeType&&t.isContentEditable}:function(t){return t&&1==t.nodeType&&"false"!=t.contentEditable?"true"==t.contentEditable||M(t.parentNode):!1}}();var L=/^inline(-block|-table)?$/i,$=/[^\r\n\t\f \u200B]/,B=E(!1),F=E(!0);R.prototype={doMerge:function(t){for(var e,n,i,o,a,r=[],s=0,l=0,c=this.textNodes.length;c>l;++l){if(e=this.textNodes[l],n=e.parentNode,l>0&&(n.removeChild(e),n.hasChildNodes()||n.parentNode.removeChild(n),t))for(o=0;a=t[o++];)a.node==e&&(a.node=this.firstTextNode,a.offset+=s);r[l]=e.data,s+=e.data.length}return this.firstTextNode.data=i=r.join(""),i},getLength:function(){for(var t=this.textNodes.length,e=0;t--;)e+=this.textNodes[t].length;return e},toString:function(){for(var t=[],e=0,n=this.textNodes.length;n>e;++e)t[e]="'"+this.textNodes[e].data+"'";return"[Merge("+t.join(",")+")]"}};var H={};N.prototype={copyPropertiesToElement:function(t,e,n){var i,r,s,l,c,d,h={};for(var u in t)if(t.hasOwnProperty(u))if(l=t[u],c=e[u],"className"==u)o(e,l),o(e,this.cssClass),e[u]=a(e[u]),n&&(h[u]=e[u]);else if("style"==u){r=c,n&&(h[u]=s={});for(i in t[u])r[i]=l[i],n&&(s[i]=r[i]);this.attrExceptions.push(u)}else e[u]=l,n&&(h[u]=e[u],d=H.hasOwnProperty(u)?H[u]:u,this.attrExceptions.push(d));return n?h:""},isValid:function(t){return this.isValidTag(t)&&this.hasClasses(t)&&this.hasAttributes(t)},isValidTag:function(t){if(1!==t.nodeType)return!1;if(0===this.tags.length)return!0;for(var e=0,n=this.tags.length;n>e;e++)if(t.tagName===this.tags[e])return!0;return!1},hasClasses:function(t){if(this.ignoreClasses)return!0;for(var e=0,n=this.classes.length;n>e;e++)if(!i(t,this.classes[e]))return!1;return!0},hasAttributes:function(t){if(this.ignoreAttributes)return!0;for(var e in this.attributes)if(!t.hasAttribute(e))return!1;return!0},getSelfOrAncestor:function(t){for(;t;){if(this.isValid(t))return t;t=t.parentNode}return null},isModifiable:function(t){return!this.applyToEditableOnly||y(t)},isIgnorableWhiteSpaceNode:function(t){return this.ignoreWhiteSpace&&t&&3==t.nodeType&&C(t)},postApply:function(t,e,n,i){for(var o,a,r,s=t[0],l=t[t.length-1],c=[],d=s,h=l,u=0,p=l.length,f=0,g=t.length;g>f;++f)a=t[f],r=B(a,!i),r?(o||(o=new R(r),c.push(o)),o.textNodes.push(a),a===s&&(d=o.firstTextNode,u=d.length),a===l&&(h=o.firstTextNode,p=o.getLength())):o=null;var m=F(l,!i);if(m&&(o||(o=new R(l),c.push(o)),o.textNodes.push(m)),c.length){for(f=0,g=c.length;g>f;++f)c[f].doMerge(n);e.setStartAndEnd(d,u,h,p)}},createContainer:function(t){var e=t.createElement(this.tag);return this.addClasses(e),this.addAttributes(e),e},addClasses:function(t){for(var e=0,n=this.classes.length;n>e;e++)o(t,this.classes[e])},addAttributes:function(t){for(var e in this.attributes)t.setAttribute(e,this.attributes[e])},removeClasses:function(t){for(var e=0,n=this.classes.length;n>e;e++)P(t,this.classes[e])},removeAttributes:function(t){for(var e in this.attributes)t.removeAttribute(e)},applyToTextNode:function(t){var e=t.parentNode;if(1==e.childNodes.length&&O.arrayContains(this.tags,e.tagName)&&this.useExistingElements)this.addClasses(e),this.addAttributes(e);else{var n=this.createContainer(O.getDocument(t));t.parentNode.insertBefore(n,t),n.appendChild(t)}},isRemovable:function(t){return this.tags.length>0&&this.isValidTag(t)&&this.hasClasses(t)&&this.hasAttributes(t)&&this.isModifiable(t)},undoToTextNode:function(t,e,n,i){if(!e.containsNode(n)){var o=e.cloneRange();o.selectNode(n),o.isPointInRange(e.endContainer,e.endOffset)&&(S(n,e.endContainer,e.endOffset,i),e.setEndAfter(n)),o.isPointInRange(e.startContainer,e.startOffset)&&(n=S(n,e.startContainer,e.startOffset,i))}this.isRemovable(n)?h(n,i):(this.removeClasses(n),this.removeAttributes(n))},applyToRange:function(t,e){e=e||[];var n=x(e||[]);t.splitBoundariesPreservingPositions(n);var i=f(t);if(i.length){for(var o,a=0;o=i[a++];)!this.isIgnorableWhiteSpaceNode(o)&&this.isModifiable(o)&&this.applyToTextNode(o,n);t.setStart(i[0],0),o=i[i.length-1],t.setEnd(o,o.length),this.normalize&&this.postApply(i,t,n,!1),_(e,n)}},applyToRanges:function(t){for(var e=t.length;e--;)this.applyToRange(t[e],t);return t},applyToSelection:function(e){var n=t.getSelection(e);n.setRanges(this.applyToRanges(n.getAllRanges()))},undoToRange:function(t,e){e=e||[];var n=x(e);t.splitBoundariesPreservingPositions(n);var i,o,a=f(t),r=a[a.length-1];if(a.length){for(var s=0,l=a.length;l>s;++s)i=a[s],o=this.getSelfOrAncestor(i),o&&this.isModifiable(i)&&this.undoToTextNode(i,t,o,n),t.setStart(a[0],0),t.setEnd(r,r.length);this.normalize&&this.postApply(a,t,n,!0),_(e,n)}},undoToRanges:function(t){for(var e=t.length;e--;)this.undoToRange(t[e],t);return t},undoToSelection:function(e){var n=t.getSelection(e),i=t.getSelection(e).getAllRanges();this.undoToRanges(i),n.setRanges(i)},getTextSelectedByRange:function(t,e){var n=e.cloneRange();n.selectNodeContents(t);var i=n.intersection(e),o=i?i.toString():"";return n.detach(),o},isAppliedToRange:function(t){if(t.collapsed)return!!this.getSelfOrAncestor(t.commonAncestorContainer);for(var e,i=t.getNodes([3]),o=0;e=i[o++];)if(!this.isIgnorableWhiteSpaceNode(e)){if(u(t,e)&&this.isModifiable(e)&&!this.getSelfOrAncestor(e))return!1;if(p(t))return!1}var a=v(t.cloneContents());return a.match(/^<(img)/)||""===n(a.replace(/<.*?>/g,""))?!1:!0},isAppliedToRanges:function(t){var e=t.length;if(0===e)return!1;for(;e--;)if(!this.isAppliedToRange(t[e]))return!1;return!0},isAppliedToSelection:function(e){var n=t.getSelection(e);return this.isAppliedToRanges(n.getAllRanges())},toggleRange:function(t){this.isAppliedToRange(t)?this.undoToRange(t):this.applyToRange(t)},toggleRanges:function(t){this.isAppliedToRanges(t)?this.undoToRanges(t):this.applyToRanges(t)},toggleSelection:function(t){this.isAppliedToSelection(t)?this.undoToSelection(t):this.applyToSelection(t)},detach:function(){}},N.util={},t.Applier=N,t.createApplier=D}),rangy.createModule("ClassApplier",["WrappedSelection"],function(t,e){function n(t,e){for(var n in t)if(t.hasOwnProperty(n)&&e(n,t[n])===!1)return!1;return!0}function i(t){return t.replace(/^\s\s*/,"").replace(/\s\s*$/,"")}function o(t,e){return t.className&&new RegExp("(?:^|\\s)"+e+"(?:\\s|$)").test(t.className)}function a(t,e){t.className?o(t,e)||(t.className+=" "+e):t.className=e}function r(t){return t.split(/\s+/).sort().join(" ")}function s(t){return r(t.className)}function l(t,e){return s(t)==s(e)}function c(t,e,n,i,o){var a=t.node,r=t.offset,s=a,l=r;a==i&&r>o&&++l,a!=e||r!=n&&r!=n+1||(s=i,l+=o-n),a==e&&r>n+1&&--l,t.node=s,t.offset=l}function d(t,e,n){t.node==e&&t.offset>n&&--t.offset}function h(t,e,n,i){-1==n&&(n=e.childNodes.length);for(var o,a=t.parentNode,r=I.getNodeIndex(t),s=0;o=i[s++];)c(o,a,r,e,n);e.childNodes.length==n?e.appendChild(t):e.insertBefore(t,e.childNodes[n])}function u(t,e){for(var n,i=t.parentNode,o=I.getNodeIndex(t),a=0;n=e[a++];)d(n,i,o);t.parentNode.removeChild(t)}function p(t,e,n,i,o){for(var a,r=[];a=t.firstChild;)h(a,e,n++,o),r.push(a);return i&&t.parentNode.removeChild(t),r}function f(t,e){return p(t,t.parentNode,I.getNodeIndex(t),!0,e)}function g(t,e){var n=t.cloneRange();n.selectNodeContents(e);var i=n.intersection(t),o=i?i.toString():"";return n.detach(),""!=o}function m(t){for(var e,n=t.getNodes([3]),i=0;(e=n[i])&&!g(t,e);)++i;for(var o=n.length-1;(e=n[o])&&!g(t,e);)--o;return n.slice(i,o+1)}function v(t,e){if(t.attributes.length!=e.attributes.length)return!1;for(var n,i,o,a=0,r=t.attributes.length;r>a;++a)if(n=t.attributes[a],o=n.name,"class"!=o){if(i=e.attributes.getNamedItem(o),null===n!=(null===i))return!1;if(n.specified!=i.specified)return!1;if(n.specified&&n.nodeValue!==i.nodeValue)return!1}return!0}function b(t,e){for(var n,i=0,o=t.attributes.length;o>i;++i)if(n=t.attributes[i].name,(!e||!M(e,n))&&t.attributes[i].specified&&"class"!=n)return!0;return!1}function y(t,e){return n(e,function(e,n){if("object"==typeof n){if(!y(t[e],n))return!1}else if(t[e]!==n)return!1}),!0}function w(t){var e;return t&&1==t.nodeType&&((e=t.parentNode)&&9==e.nodeType&&"on"==e.designMode||F(t)&&!F(t.parentNode))}function C(t){return(F(t)||1!=t.nodeType&&F(t.parentNode))&&!w(t)}function x(t){return t&&1==t.nodeType&&!H.test(B(t,"display"))}function _(t){if(0==t.data.length)return!0;if(j.test(t.data))return!1;var e=B(t.parentNode,"whiteSpace");switch(e){case"pre":case"pre-wrap":case"-moz-pre-wrap":return!1;case"pre-line":if(/[\r\n]/.test(t.data))return!1}return x(t.previousSibling)||x(t.nextSibling)}function T(t){var e,n,i=[];for(e=0;n=t[e++];)i.push(new P(n.startContainer,n.startOffset),new P(n.endContainer,n.endOffset));return i}function S(t,e){for(var n,i,o,a=0,r=t.length;r>a;++a)n=t[a],i=e[2*a],o=e[2*a+1],n.setStartAndEnd(i.node,i.offset,o.node,o.offset)}function k(t,e){return I.isCharacterDataNode(t)?0==e?!!t.previousSibling:e==t.length?!!t.nextSibling:!0:e>0&&e<t.childNodes.length}function E(t,n,i,o){var a,r,s=0==i;if(I.isAncestorOf(n,t))return t;if(I.isCharacterDataNode(n)){var l=I.getNodeIndex(n);if(0==i)i=l;else{if(i!=n.length)throw e.createError("splitNodeAt() should not be called with offset in the middle of a data node ("+i+" in "+n.data);i=l+1}n=n.parentNode}if(k(n,i)){a=n.cloneNode(!1),r=n.parentNode,a.id&&a.removeAttribute("id");for(var c,d=0;c=n.childNodes[i];)h(c,a,d++,o);return h(a,r,I.getNodeIndex(n)+1,o),n==t?a:E(t,r,I.getNodeIndex(a),o)}if(t!=n){a=n.parentNode;var u=I.getNodeIndex(n);return s||u++,E(t,a,u,o)}return t}function R(t,e){return t.tagName==e.tagName&&l(t,e)&&v(t,e)&&"inline"==B(t,"display")&&"inline"==B(e,"display")}function N(t){var e=t?"nextSibling":"previousSibling";return function(n,i){var o=n.parentNode,a=n[e];if(a){if(a&&3==a.nodeType)return a}else if(i&&(a=o[e],a&&1==a.nodeType&&R(o,a))){var r=a[t?"firstChild":"lastChild"];if(r&&3==r.nodeType)return r}return null}}function D(t){this.isElementMerge=1==t.nodeType,this.textNodes=[];var e=this.isElementMerge?t.lastChild:t;e&&(this.textNodes[0]=e)}function A(t,e,o){var a,r,s,l,c=this;c.cssClass=t;var d=null,h={};if("object"==typeof e&&null!==e){for(o=e.tagNames,d=e.elementProperties,h=e.elementAttributes,r=0;l=W[r++];)e.hasOwnProperty(l)&&(c[l]=e[l]);a=e.normalize}else a=e;c.normalize="undefined"==typeof a?!0:a,c.attrExceptions=[];var u=document.createElement(c.elementTagName);c.elementProperties=c.copyPropertiesToElement(d,u,!0),n(h,function(t){c.attrExceptions.push(t)}),c.elementAttributes=h,c.elementSortedClassName=c.elementProperties.hasOwnProperty("className")?c.elementProperties.className:t,c.applyToAnyTagName=!1;var p=typeof o;if("string"==p)"*"==o?c.applyToAnyTagName=!0:c.tagNames=i(o.toLowerCase()).split(/\s*,\s*/);else if("object"==p&&"number"==typeof o.length)for(c.tagNames=[],r=0,s=o.length;s>r;++r)"*"==o[r]?c.applyToAnyTagName=!0:c.tagNames.push(o[r].toLowerCase());else c.tagNames=[c.elementTagName]}function O(t,e,n){return new A(t,e,n)}var I=t.dom,P=I.DomPosition,M=I.arrayContains,L="span",$=function(){function t(t,e,n){return e&&n?" ":""}return function(e,n){e.className&&(e.className=e.className.replace(new RegExp("(^|\\s)"+n+"(\\s|$)"),t))}}(),B=I.getComputedStyleProperty,F=function(){var t=document.createElement("div");return"boolean"==typeof t.isContentEditable?function(t){return t&&1==t.nodeType&&t.isContentEditable}:function(t){return t&&1==t.nodeType&&"false"!=t.contentEditable?"true"==t.contentEditable||F(t.parentNode):!1}}(),H=/^inline(-block|-table)?$/i,j=/[^\r\n\t\f \u200B]/,U=N(!1),z=N(!0);D.prototype={doMerge:function(t){var e=this.textNodes,n=e[0];if(e.length>1){for(var i,o,a,r,s=[],l=0,c=0,d=e.length;d>c;++c){if(i=e[c],o=i.parentNode,c>0&&(o.removeChild(i),o.hasChildNodes()||o.parentNode.removeChild(o),t))for(a=0;r=t[a++];)r.node==i&&(r.node=n,r.offset+=l);s[c]=i.data,l+=i.data.length}n.data=s.join("")}return n.data},getLength:function(){for(var t=this.textNodes.length,e=0;t--;)e+=this.textNodes[t].length;return e},toString:function(){for(var t=[],e=0,n=this.textNodes.length;n>e;++e)t[e]="'"+this.textNodes[e].data+"'";return"[Merge("+t.join(",")+")]"}};var W=["elementTagName","ignoreWhiteSpace","applyToEditableOnly","useExistingElements","removeEmptyElements","onElementCreate"],G={};A.prototype={elementTagName:L,elementProperties:{},elementAttributes:{},ignoreWhiteSpace:!0,applyToEditableOnly:!1,useExistingElements:!0,removeEmptyElements:!0,onElementCreate:null,copyPropertiesToElement:function(t,e,n){var i,o,s,l,c,d,h={};for(var u in t)if(t.hasOwnProperty(u))if(l=t[u],c=e[u],"className"==u)a(e,l),a(e,this.cssClass),e[u]=r(e[u]),n&&(h[u]=e[u]);else if("style"==u){o=c,n&&(h[u]=s={});for(i in t[u])o[i]=l[i],n&&(s[i]=o[i]);this.attrExceptions.push(u)}else e[u]=l,n&&(h[u]=e[u],d=G.hasOwnProperty(u)?G[u]:u,this.attrExceptions.push(d));return n?h:""},copyAttributesToElement:function(t,e){for(var n in t)t.hasOwnProperty(n)&&e.setAttribute(n,t[n])},hasClass:function(t){return 1==t.nodeType&&M(this.tagNames,t.tagName.toLowerCase())&&o(t,this.cssClass)},getSelfOrAncestorWithClass:function(t){for(;t;){if(this.hasClass(t))return t;t=t.parentNode}return null},isModifiable:function(t){return!this.applyToEditableOnly||C(t)},isIgnorableWhiteSpaceNode:function(t){return this.ignoreWhiteSpace&&t&&3==t.nodeType&&_(t)},postApply:function(t,e,n,i){for(var o,a,r,s=t[0],l=t[t.length-1],c=[],d=s,h=l,u=0,p=l.length,f=0,g=t.length;g>f;++f)a=t[f],r=U(a,!i),r?(o||(o=new D(r),c.push(o)),o.textNodes.push(a),a===s&&(d=o.textNodes[0],u=d.length),a===l&&(h=o.textNodes[0],p=o.getLength())):o=null;var m=z(l,!i);if(m&&(o||(o=new D(l),c.push(o)),o.textNodes.push(m)),c.length){for(f=0,g=c.length;g>f;++f)c[f].doMerge(n);e.setStartAndEnd(d,u,h,p)}},createContainer:function(t){var e=t.createElement(this.elementTagName);return this.copyPropertiesToElement(this.elementProperties,e,!1),this.copyAttributesToElement(this.elementAttributes,e),a(e,this.cssClass),this.onElementCreate&&this.onElementCreate(e,this),e},applyToTextNode:function(t){var e=t.parentNode;if(1==e.childNodes.length&&this.useExistingElements&&M(this.tagNames,e.tagName.toLowerCase())&&y(e,this.elementProperties))a(e,this.cssClass);else{var n=this.createContainer(I.getDocument(t));t.parentNode.insertBefore(n,t),n.appendChild(t)}},isRemovable:function(t){return t.tagName.toLowerCase()==this.elementTagName&&s(t)==this.elementSortedClassName&&y(t,this.elementProperties)&&!b(t,this.attrExceptions)&&this.isModifiable(t)},isEmptyContainer:function(t){var e=t.childNodes.length;return 1==t.nodeType&&this.isRemovable(t)&&(0==e||1==e&&this.isEmptyContainer(t.firstChild))},removeEmptyContainers:function(t){for(var e,n=this,i=t.getNodes([1],function(t){return n.isEmptyContainer(t)}),o=[t],a=T(o),r=0;e=i[r++];)u(e,a);S(o,a)},undoToTextNode:function(t,e,n,i){if(!e.containsNode(n)){var o=e.cloneRange();o.selectNode(n),o.isPointInRange(e.endContainer,e.endOffset)&&(E(n,e.endContainer,e.endOffset,i),e.setEndAfter(n)),o.isPointInRange(e.startContainer,e.startOffset)&&(n=E(n,e.startContainer,e.startOffset,i))}this.isRemovable(n)?f(n,i):$(n,this.cssClass)},applyToRange:function(t,e){e=e||[];var n=T(e||[]);t.splitBoundariesPreservingPositions(n),this.removeEmptyElements&&this.removeEmptyContainers(t);var i=m(t);if(i.length){for(var o,a=0;o=i[a++];)this.isIgnorableWhiteSpaceNode(o)||this.getSelfOrAncestorWithClass(o)||!this.isModifiable(o)||this.applyToTextNode(o,n);o=i[i.length-1],t.setStartAndEnd(i[0],0,o,o.length),this.normalize&&this.postApply(i,t,n,!1),S(e,n)}},applyToRanges:function(t){for(var e=t.length;e--;)this.applyToRange(t[e],t);return t},applyToSelection:function(e){var n=t.getSelection(e);n.setRanges(this.applyToRanges(n.getAllRanges()))},undoToRange:function(t,e){e=e||[];var n=T(e);t.splitBoundariesPreservingPositions(n),this.removeEmptyElements&&this.removeEmptyContainers(t,n);var i,o,a=m(t),r=a[a.length-1];if(a.length){for(var s=0,l=a.length;l>s;++s)i=a[s],o=this.getSelfOrAncestorWithClass(i),o&&this.isModifiable(i)&&this.undoToTextNode(i,t,o,n),t.setStartAndEnd(a[0],0,r,r.length);this.normalize&&this.postApply(a,t,n,!0),S(e,n)}},undoToRanges:function(t){for(var e=t.length;e--;)this.undoToRange(t[e],t);return t},undoToSelection:function(e){var n=t.getSelection(e),i=t.getSelection(e).getAllRanges();this.undoToRanges(i),n.setRanges(i)},isAppliedToRange:function(t){if(t.collapsed||""==t.toString())return!!this.getSelfOrAncestorWithClass(t.commonAncestorContainer);var e=t.getNodes([3]);if(e.length)for(var n,i=0;n=e[i++];)if(!this.isIgnorableWhiteSpaceNode(n)&&g(t,n)&&this.isModifiable(n)&&!this.getSelfOrAncestorWithClass(n))return!1;return!0},isAppliedToRanges:function(t){var e=t.length;if(0==e)return!1;for(;e--;)if(!this.isAppliedToRange(t[e]))return!1;return!0},isAppliedToSelection:function(e){var n=t.getSelection(e);return this.isAppliedToRanges(n.getAllRanges())},toggleRange:function(t){this.isAppliedToRange(t)?this.undoToRange(t):this.applyToRange(t)},toggleSelection:function(t){this.isAppliedToSelection(t)?this.undoToSelection(t):this.applyToSelection(t)},getElementsWithClassIntersectingRange:function(t){var e=[],n=this;return t.getNodes([3],function(t){var i=n.getSelfOrAncestorWithClass(t);i&&!M(e,i)&&e.push(i)}),e},detach:function(){}},A.util={hasClass:o,addClass:a,removeClass:$,hasSameClasses:l,replaceWithOwnChildren:f,elementsHaveSameNonClassAttributes:v,elementHasNonClassAttributes:b,splitNodeAt:E,isEditableElement:F,isEditingHost:w,isEditable:C},t.CssClassApplier=t.ClassApplier=A,t.createCssClassApplier=t.createClassApplier=O}),rangy.createModule("SaveRestore",["WrappedRange"],function(t,e){function n(t,e){return(e||document).getElementById(t)}function i(t,e){var n,i="selectionBoundary_"+ +new Date+"_"+(""+Math.random()).slice(2),o=f.getDocument(t.startContainer),a=t.cloneRange();return a.collapse(e),n=o.createElement("span"),n.id=i,n.style.lineHeight="0",n.style.display="none",n.className="rangySelectionBoundary",n.appendChild(o.createTextNode(g)),a.insertNode(n),a.detach(),n}function o(t,i,o,a){var r=n(o,t);r?(i[a?"setStartBefore":"setEndBefore"](r),r.parentNode.removeChild(r)):e.warn("Marker element has been removed. Cannot restore selection.")}function a(t,e){return e.compareBoundaryPoints(t.START_TO_START,t)}function r(e,n){var o,a,r=t.DomRange.getRangeDocument(e),s=e.toString();return e.collapsed?(a=i(e,!1),{document:r,markerId:a.id,collapsed:!0}):(a=i(e,!1),o=i(e,!0),{document:r,startMarkerId:o.id,endMarkerId:a.id,collapsed:!1,backward:n,toString:function(){return"original text: '"+s+"', new text: '"+e.toString()+"'"}})}function s(i,a){var r=i.document;"undefined"==typeof a&&(a=!0);var s=t.createRange(r);if(i.collapsed){var l=n(i.markerId,r);if(l){l.style.display="inline";var c=l.previousSibling;c&&3==c.nodeType?(l.parentNode.removeChild(l),s.collapseToPoint(c,c.length)):(s.collapseBefore(l),l.parentNode.removeChild(l))}else e.warn("Marker element has been removed. Cannot restore selection.")}else o(r,s,i.startMarkerId,!0),o(r,s,i.endMarkerId,!1);return a&&s.normalizeBoundaries(),s}function l(e,i){var o,s,l=[];e=e.slice(0),e.sort(a);for(var c=0,d=e.length;d>c;++c)l[c]=r(e[c],i);for(c=d-1;c>=0;--c)o=e[c],s=t.DomRange.getRangeDocument(o),o.collapsed?o.collapseAfter(n(l[c].markerId,s)):(o.setEndBefore(n(l[c].endMarkerId,s)),o.setStartAfter(n(l[c].startMarkerId,s)));return l}function c(n){if(!t.isSelectionValid(n))return e.warn("Cannot save selection. This usually happens when the selection is collapsed and the selection document has lost focus."),null;var i=t.getSelection(n),o=i.getAllRanges(),a=1==o.length&&i.isBackward(),r=l(o,a);return a?i.setSingleRange(o[0],"backward"):i.setRanges(o),{win:n,rangeInfos:r,restored:!1}}function d(t){for(var e=[],n=t.length,i=n-1;i>=0;i--)e[i]=s(t[i],!0);return e}function h(e,n){if(!e.restored){var i=e.rangeInfos,o=t.getSelection(e.win),a=d(i),r=i.length;1==r&&n&&t.features.selectionHasExtend&&i[0].backward?(o.removeAllRanges(),o.addRange(a[0],!0)):o.setRanges(a),e.restored=!0}}function u(t,e){var i=n(e,t);i&&i.parentNode.removeChild(i)}function p(t){for(var e,n=t.rangeInfos,i=0,o=n.length;o>i;++i)e=n[i],e.collapsed?u(t.doc,e.markerId):(u(t.doc,e.startMarkerId),u(t.doc,e.endMarkerId))}var f=t.dom,g="﻿";t.util.extend(t,{saveRange:r,restoreRange:s,saveRanges:l,restoreRanges:d,saveSelection:c,restoreSelection:h,removeMarkerElement:u,removeMarkers:p})}),rangy.createModule("Serializer",["WrappedSelection"],function(t,e){function n(t){return t.replace(/</g,"&lt;").replace(/>/g,"&gt;")}function i(t,e){e=e||[];var o=t.nodeType,a=t.childNodes,r=a.length,s=[o,t.nodeName,r].join(":"),l="",c="";switch(o){case 3:l=n(t.nodeValue);break;case 8:l="<!--"+n(t.nodeValue)+"-->";break;default:l="<"+s+">",c="</>"}l&&e.push(l);for(var d=0;r>d;++d)i(a[d],e);return c&&e.push(c),e}function o(t){var e=i(t).join("");return v(e).toString(16)}function a(t,e,n){var i=[],o=t;for(n=n||b.getDocument(t).documentElement;o&&o!=n;)i.push(b.getNodeIndex(o,!0)),o=o.parentNode;return i.join("/")+":"+e}function r(t,n,i){n||(n=(i||document).documentElement);for(var o,a=t.split(":"),r=n,s=a[0]?a[0].split("/"):[],l=s.length;l--;){if(o=parseInt(s[l],10),!(o<r.childNodes.length))throw e.createError("deserializePosition() failed: node "+b.inspectNode(r)+" has no child with index "+o+", "+l);r=r.childNodes[o]}return new b.DomPosition(r,parseInt(a[1],10))}function s(n,i,r){if(r=r||t.DomRange.getRangeDocument(n).documentElement,!b.isOrIsAncestorOf(r,n.commonAncestorContainer))throw e.createError("serializeRange(): range "+n.inspect()+" is not wholly contained within specified root node "+b.inspectNode(r));var s=a(n.startContainer,n.startOffset,r)+","+a(n.endContainer,n.endOffset,r);return i||(s+="{"+o(r)+"}"),s}function l(n,i,a){i?a=a||b.getDocument(i):(a=a||document,i=a.documentElement);var s=y.exec(n),l=s[4],c=o(i);if(l&&l!==o(i))throw e.createError("deserializeRange(): checksums of serialized range root node ("+l+") and target root node ("+c+") do not match");var d=r(s[1],i,a),h=r(s[2],i,a),u=t.createRange(a);return u.setStartAndEnd(d.node,d.offset,h.node,h.offset),u}function c(t,e,n){e||(e=(n||document).documentElement);var i=y.exec(t),a=i[3];return!a||a===o(e)}function d(e,n,i){e=t.getSelection(e);for(var o=e.getAllRanges(),a=[],r=0,l=o.length;l>r;++r)a[r]=s(o[r],n,i);return a.join("|")}function h(e,n,i){n?i=i||b.getWindow(n):(i=i||window,n=i.document.documentElement);for(var o=e.split("|"),a=t.getSelection(i),r=[],s=0,c=o.length;c>s;++s)r[s]=l(o[s],n,i.document);return a.setRanges(r),a}function u(t,e,n){var i;e?i=n?n.document:b.getDocument(e):(n=n||window,e=n.document.documentElement);for(var o=t.split("|"),a=0,r=o.length;r>a;++a)if(!c(o[a],e,i))return!1;return!0}function p(t){for(var e,n,i=t.split(/[;,]/),o=0,a=i.length;a>o;++o)if(e=i[o].split("="),e[0].replace(/^\s+/,"")==w&&(n=e[1]))return decodeURIComponent(n.replace(/\s+$/,""));return null}function f(t){t=t||window;var e=p(t.document.cookie);e&&h(e,t.doc)}function g(e,n){e=e||window,n="object"==typeof n?n:{};var i=n.expires?";expires="+n.expires.toUTCString():"",o=n.path?";path="+n.path:"",a=n.domain?";domain="+n.domain:"",r=n.secure?";secure":"",s=d(t.getSelection(e));e.document.cookie=encodeURIComponent(w)+"="+encodeURIComponent(s)+i+o+a+r}var m="undefined";(typeof encodeURIComponent==m||typeof decodeURIComponent==m)&&e.fail("Global object is missing encodeURIComponent and/or decodeURIComponent method");var v=function(){function t(t){for(var e,n=[],i=0,o=t.length;o>i;++i)e=t.charCodeAt(i),128>e?n.push(e):2048>e?n.push(e>>6|192,63&e|128):n.push(e>>12|224,e>>6&63|128,63&e|128);return n}function e(){for(var t,e,n=[],i=0;256>i;++i){for(e=i,t=8;t--;)1==(1&e)?e=e>>>1^3988292384:e>>>=1;n[i]=e>>>0}return n}function n(){return i||(i=e()),i}var i=null;return function(e){for(var i,o=t(e),a=-1,r=n(),s=0,l=o.length;l>s;++s)i=255&(a^o[s]),a=a>>>8^r[i];return(-1^a)>>>0}}(),b=t.dom,y=/^([^,]+),([^,\{]+)(\{([^}]+)\})?$/,w="rangySerializedSelection";t.serializePosition=a,t.deserializePosition=r,t.serializeRange=s,t.deserializeRange=l,t.canDeserializeRange=c,t.serializeSelection=d,t.deserializeSelection=h,t.canDeserializeSelection=u,t.restoreSelectionFromCookie=f,t.saveSelectionCookie=g,t.getElementChecksum=o,t.nodeToInfoString=i}),rangy.createModule("TextRange",["WrappedSelection"],function(t,e){function n(t,e){function n(e,n,i){for(var o=t.slice(e,n),a={isWord:i,chars:o,toString:function(){return o.join("")}},r=0,l=o.length;l>r;++r)o[r].token=a;s.push(a)}for(var i,o,a,r=t.join(""),s=[],l=0;i=e.wordRegex.exec(r);){if(o=i.index,a=o+i[0].length,o>l&&n(l,o,!1),e.includeTrailingSpace)for(;J.test(t[a]);)++a;n(o,a,!0),l=a}return l<t.length&&n(l,t.length,!1),s}function i(t,e){if(t){var n={};return W(n,e),W(n,t),n}return e}function o(t){var e,n;return t?(e=t.language||Q,n={},W(n,ae[e]||ae[Q]),W(n,t),n):ae[Q]}function a(t){return i(t,ie)}function r(t){return i(t,oe)}function s(t,e){var n=de(t,"display",e),i=t.tagName.toLowerCase();return"block"==n&&ne&&he.hasOwnProperty(i)?he[i]:n}function l(t){for(var e=p(t),n=0,i=e.length;i>n;++n)if(1==e[n].nodeType&&"none"==s(e[n]))return!0;return!1}function c(t){var e;return 3==t.nodeType&&(e=t.parentNode)&&"hidden"==de(e,"visibility")}function d(t){return t&&(1==t.nodeType&&!/^(inline(-block|-table)?|none)$/.test(s(t))||9==t.nodeType||11==t.nodeType)}function h(t){return U.isCharacterDataNode(t)||!/^(area|base|basefont|br|col|frame|hr|img|input|isindex|link|meta|param)$/i.test(t.nodeName)}function u(t){for(var e=[];t.parentNode;)e.unshift(t.parentNode),t=t.parentNode;return e}function p(t){return u(t).concat([t])}function f(t){for(;t&&!t.nextSibling;)t=t.parentNode;return t?t.nextSibling:null}function g(t,e){return!e&&t.hasChildNodes()?t.firstChild:f(t)}function m(t){var e=t.previousSibling;if(e){for(t=e;t.hasChildNodes();)t=t.lastChild;return t}var n=t.parentNode;return n&&1==n.nodeType?n:null}function v(t){if(!t||3!=t.nodeType)return!1;var e=t.data;if(""===e)return!0;var n=t.parentNode;if(!n||1!=n.nodeType)return!1;var i=de(t.parentNode,"whiteSpace");return/^[\t\n\r ]+$/.test(e)&&/^(normal|nowrap)$/.test(i)||/^[\t\r ]+$/.test(e)&&"pre-line"==i}function b(t){if(""===t.data)return!0;if(!v(t))return!1;var e=t.parentNode;return e?l(t)?!0:!1:!0}function y(t){var e=t.nodeType;return 7==e||8==e||l(t)||/^(script|style)$/i.test(t.nodeName)||c(t)||b(t)}function w(t,e){var n=t.nodeType;return 7==n||8==n||1==n&&"none"==s(t,e)}function C(){this.store={}}function x(t,e,n){return function(i){var o=this.cache;if(o.hasOwnProperty(t))return ue++,o[t];pe++;var a=e.call(this,n?this[n]:this,i);return o[t]=a,a}}function _(t,e){this.node=t,this.session=e,this.cache=new C,this.positions=new C}function T(t,e){this.offset=e,this.nodeWrapper=t,this.node=t.node,this.session=t.session,this.cache=new C}function S(){return"[Position("+U.inspectNode(this.node)+":"+this.offset+")]"}function k(){return R(),Se=new ke}function E(){return Se||k()}function R(){Se&&Se.detach(),Se=null}function N(t,n,i,o){function a(){var t=null;return n?(t=s,l||(s=s.previousVisible(),l=!s||i&&s.equals(i))):l||(t=s=s.nextVisible(),l=!s||i&&s.equals(i)),l&&(s=null),t}i&&(n?y(i.node)&&(i=t.previousVisible()):y(i.node)&&(i=i.nextVisible()));var r,s=t,l=!1,c=!1;return{next:function(){if(c)return c=!1,r;for(var t,e;t=a();)if(e=t.getCharacter(o))return r=t,t;return null},rewind:function(){if(!r)throw e.createError("createCharacterIterator: cannot rewind. Only one position can be rewound.");c=!0},dispose:function(){t=i=null}}}function D(t,e,n){function i(t){for(var e,n,i=[],r=t?o:a,s=!1,l=!1;e=r.next();){if(n=e.character,Y.test(n))l&&(l=!1,s=!0);else{if(s){r.rewind();break}l=!0}i.push(e)}return i}var o=N(t,!1,null,e),a=N(t,!0,null,e),r=n.tokenizer,s=i(!0),l=i(!1).reverse(),c=r(l.concat(s),n),d=s.length?c.slice(Ee(c,s[0].token)):[],h=l.length?c.slice(0,Ee(c,l.pop().token)+1):[];return{nextEndToken:function(){for(var t,e;1==d.length&&!(t=d[0]).isWord&&(e=i(!0)).length>0;)d=r(t.chars.concat(e),n);return d.shift()},previousStartToken:function(){for(var t,e;1==h.length&&!(t=h[0]).isWord&&(e=i(!1)).length>0;)h=r(e.reverse().concat(t.chars),n);return h.pop()},dispose:function(){o.dispose(),a.dispose(),d=h=null}}}function A(t,e,n,i,o){var a,r,s,l,c=0,d=t,h=Math.abs(n);if(0!==n){var u=0>n;switch(e){case H:for(r=N(t,u,null,i);(a=r.next())&&h>c;)++c,d=a;s=a,r.dispose();break;case j:for(var p=D(t,i,o),f=u?p.previousStartToken:p.nextEndToken;(l=f())&&h>c;)l.isWord&&(++c,d=u?l.chars[0]:l.chars[l.chars.length-1]);break;default:throw new Error("movePositionBy: unit '"+e+"' not implemented")}u?(d=d.previousVisible(),c=-c):d&&d.isLeadingSpace&&(e==j&&(r=N(t,!1,null,i),s=r.next(),r.dispose()),s&&(d=s.previousVisible()))}return{position:d,unitsMoved:c}}function O(t,e,n,i){var o=t.getRangeBoundaryPosition(e,!0),a=t.getRangeBoundaryPosition(e,!1),r=i?a:o,s=i?o:a;return N(r,!!i,s,n)}function I(t,e,n){for(var i,o=[],a=O(t,e,n);i=a.next();)o.push(i);return a.dispose(),o}function P(e,n,i){var o=t.createRange(e.node);o.setStartAndEnd(e.node,e.offset,n.node,n.offset);var a=!o.expand("word",i);return o.detach(),a}function M(t,e,n,i,o){function a(t,e){var n=g[t].previousVisible(),i=g[e-1],a=!o.wholeWordsOnly||P(n,i,o.wordOptions);return{startPos:n,endPos:i,valid:a}}for(var r,s,l,c,d,h,u=X(o.direction),p=N(t,u,t.session.getRangeBoundaryPosition(i,u),o),f="",g=[],m=null;r=p.next();)if(s=r.character,n||o.caseSensitive||(s=s.toLowerCase()),u?(g.unshift(r),f=s+f):(g.push(r),f+=s),n){if(d=e.exec(f))if(h){if(l=d.index,c=l+d[0].length,!u&&c<f.length||u&&l>0){m=a(l,c);
break}}else h=!0}else if(-1!=(l=f.indexOf(e))){m=a(l,l+e.length);break}return h&&(m=a(l,c)),p.dispose(),m}function L(t){return function(){var e=!!Se,n=E(),i=[n].concat(z.toArray(arguments)),o=t.apply(this,i);return e||R(),o}}function $(t,e){return L(function(n,r,s,l){"undefined"==typeof s&&(s=r,r=H),l=i(l,se);var c=a(l.characterOptions),d=o(l.wordOptions),h=t;e&&(h=s>=0,this.collapse(!h));var u=A(n.getRangeBoundaryPosition(this,h),r,s,c,d),p=u.position;return this[h?"setStart":"setEnd"](p.node,p.offset),u.unitsMoved})}function B(t){return L(function(e,n){n=a(n);for(var i,o=O(e,this,n,!t),r=0;(i=o.next())&&Y.test(i.character);)++r;o.dispose();var s=r>0;return s&&this[t?"moveStart":"moveEnd"]("character",t?r:-r,{characterOptions:n}),s})}function F(t){return L(function(e,n){var i=!1;return this.changeEachRange(function(e){i=e[t](n)||i}),i})}var H="character",j="word",U=t.dom,z=t.util,W=z.extend,G=U.getBody,q=/^[ \t\f\r\n]+$/,V=/^[ \t\f\r]+$/,Y=/^[\t-\r \u0085\u00A0\u1680\u180E\u2000-\u200B\u2028\u2029\u202F\u205F\u3000]+$/,J=/^[\t \u00A0\u1680\u180E\u2000-\u200B\u202F\u205F\u3000]+$/,Q="en",X=t.Selection.isDirectionBackward,K=!1,Z=!1,te=!1,ee=!0;!function(){var e=document.createElement("div");e.contentEditable="true",e.innerHTML="<p>1 </p><p></p>";var n=G(document),i=e.firstChild,o=t.getSelection();n.appendChild(e),o.collapse(i.lastChild,2),o.setStart(i.firstChild,0),K=1==(""+o).length,e.innerHTML="1 <br>",o.collapse(e,2),o.setStart(e.firstChild,0),Z=1==(""+o).length,e.innerHTML="1 <p>1</p>",o.collapse(e,2),o.setStart(e.firstChild,0),te=1==(""+o).length,n.removeChild(e),o.removeAllRanges()}();var ne,ie={includeBlockContentTrailingSpace:!0,includeSpaceBeforeBr:!0,includeSpaceBeforeBlock:!0,includePreLineTrailingSpace:!0},oe={includeBlockContentTrailingSpace:!ee,includeSpaceBeforeBr:!Z,includeSpaceBeforeBlock:!te,includePreLineTrailingSpace:!0},ae={en:{wordRegex:/[a-z0-9]+('[a-z0-9]+)*/gi,includeTrailingSpace:!1,tokenizer:n}},re={caseSensitive:!1,withinRange:null,wholeWordsOnly:!1,wrap:!1,direction:"forward",wordOptions:null,characterOptions:null},se={wordOptions:null,characterOptions:null},le={wordOptions:null,characterOptions:null,trim:!1,trimStart:!0,trimEnd:!0},ce={wordOptions:null,characterOptions:null,direction:"forward"},de=U.getComputedStyleProperty;!function(){var t=document.createElement("table"),e=G(document);e.appendChild(t),ne="block"==de(t,"display"),e.removeChild(t)}(),t.features.tableCssDisplayBlock=ne;var he={table:"table",caption:"table-caption",colgroup:"table-column-group",col:"table-column",thead:"table-header-group",tbody:"table-row-group",tfoot:"table-footer-group",tr:"table-row",td:"table-cell",th:"table-cell"};C.prototype={get:function(t){return this.store.hasOwnProperty(t)?this.store[t]:null},set:function(t,e){return this.store[t]=e}};var ue=0,pe=0,fe={getPosition:function(t){var e=this.positions;return e.get(t)||e.set(t,new T(this,t))},toString:function(){return"[NodeWrapper("+U.inspectNode(this.node)+")]"}};_.prototype=fe;var ge="EMPTY",me="NON_SPACE",ve="UNCOLLAPSIBLE_SPACE",be="COLLAPSIBLE_SPACE",ye="TRAILING_SPACE_BEFORE_BLOCK",we="TRAILING_SPACE_IN_BLOCK",Ce="TRAILING_SPACE_BEFORE_BR",xe="PRE_LINE_TRAILING_SPACE_BEFORE_LINE_BREAK",_e="TRAILING_LINE_BREAK_AFTER_BR";W(fe,{isCharacterDataNode:x("isCharacterDataNode",U.isCharacterDataNode,"node"),getNodeIndex:x("nodeIndex",U.getNodeIndex,"node"),getLength:x("nodeLength",U.getNodeLength,"node"),containsPositions:x("containsPositions",h,"node"),isWhitespace:x("isWhitespace",v,"node"),isCollapsedWhitespace:x("isCollapsedWhitespace",b,"node"),getComputedDisplay:x("computedDisplay",s,"node"),isCollapsed:x("collapsed",y,"node"),isIgnored:x("ignored",w,"node"),next:x("nextPos",g,"node"),previous:x("previous",m,"node"),getTextNodeInfo:x("textNodeInfo",function(t){var e=null,n=!1,i=de(t.parentNode,"whiteSpace"),o="pre-line"==i;return o?(e=V,n=!0):("normal"==i||"nowrap"==i)&&(e=q,n=!0),{node:t,text:t.data,spaceRegex:e,collapseSpaces:n,preLine:o}},"node"),hasInnerText:x("hasInnerText",function(t,e){for(var n=this.session,i=n.getPosition(t.parentNode,this.getNodeIndex()+1),o=n.getPosition(t,0),a=e?i:o,r=e?o:i;a!==r;){if(a.prepopulateChar(),a.isDefinitelyNonEmpty())return!0;a=e?a.previousVisible():a.nextVisible()}return!1},"node"),isRenderedBlock:x("isRenderedBlock",function(t){for(var e=t.getElementsByTagName("br"),n=0,i=e.length;i>n;++n)if(!y(e[n]))return!0;return this.hasInnerText()},"node"),getTrailingSpace:x("trailingSpace",function(t){if("br"==t.tagName.toLowerCase())return"";switch(this.getComputedDisplay()){case"inline":for(var e=t.lastChild;e;){if(!w(e))return 1==e.nodeType?this.session.getNodeWrapper(e).getTrailingSpace():"";e=e.previousSibling}break;case"inline-block":case"inline-table":case"none":case"table-column":case"table-column-group":break;case"table-cell":return"	";default:return this.isRenderedBlock(!0)?"\n":""}return""},"node"),getLeadingSpace:x("leadingSpace",function(){switch(this.getComputedDisplay()){case"inline":case"inline-block":case"inline-table":case"none":case"table-column":case"table-column-group":case"table-cell":break;default:return this.isRenderedBlock(!1)?"\n":""}return""},"node")});var Te={character:"",characterType:ge,isBr:!1,prepopulateChar:function(){var t=this;if(!t.prepopulatedChar){var e=t.node,n=t.offset,i="",o=ge,a=!1;if(n>0)if(3==e.nodeType){var r=e.data,s=r.charAt(n-1),l=t.nodeWrapper.getTextNodeInfo(),c=l.spaceRegex;l.collapseSpaces?c.test(s)?n>1&&c.test(r.charAt(n-2))||(l.preLine&&"\n"===r.charAt(n)?(i=" ",o=xe):(i=" ",o=be)):(i=s,o=me,a=!0):(i=s,o=ve,a=!0)}else{var d=e.childNodes[n-1];if(d&&1==d.nodeType&&!y(d)&&("br"==d.tagName.toLowerCase()?(i="\n",t.isBr=!0,o=be,a=!1):t.checkForTrailingSpace=!0),!i){var h=e.childNodes[n];h&&1==h.nodeType&&!y(h)&&(t.checkForLeadingSpace=!0)}}t.prepopulatedChar=!0,t.character=i,t.characterType=o,t.isCharInvariant=a}},isDefinitelyNonEmpty:function(){var t=this.characterType;return t==me||t==ve},resolveLeadingAndTrailingSpaces:function(){if(this.prepopulatedChar||this.prepopulateChar(),this.checkForTrailingSpace){var t=this.session.getNodeWrapper(this.node.childNodes[this.offset-1]).getTrailingSpace();t&&(this.isTrailingSpace=!0,this.character=t,this.characterType=be),this.checkForTrailingSpace=!1}if(this.checkForLeadingSpace){var e=this.session.getNodeWrapper(this.node.childNodes[this.offset]).getLeadingSpace();e&&(this.isLeadingSpace=!0,this.character=e,this.characterType=be),this.checkForLeadingSpace=!1}},getPrecedingUncollapsedPosition:function(t){for(var e,n=this;n=n.previousVisible();)if(e=n.getCharacter(t),""!==e)return n;return null},getCharacter:function(t){function e(){return l||(a=c.getPrecedingUncollapsedPosition(t),l=!0),a}if(this.resolveLeadingAndTrailingSpaces(),this.isCharInvariant)return this.character;var n=["character",t.includeSpaceBeforeBr,t.includeBlockContentTrailingSpace,t.includePreLineTrailingSpace].join("_"),i=this.cache.get(n);if(null!==i)return i;var o,a,r="",s=this.characterType==be,l=!1,c=this;return s?(" "!=this.character||e()&&!a.isTrailingSpace&&"\n"!=a.character)&&("\n"==this.character&&this.isLeadingSpace?e()&&"\n"!=a.character&&(r="\n"):(o=this.nextUncollapsed(),o&&(o.isBr?this.type=Ce:o.isTrailingSpace&&"\n"==o.character?this.type=we:o.isLeadingSpace&&"\n"==o.character&&(this.type=ye),"\n"===o.character?(this.type!=Ce||t.includeSpaceBeforeBr)&&(this.type!=ye||t.includeSpaceBeforeBlock)&&(this.type==we&&o.isTrailingSpace&&!t.includeBlockContentTrailingSpace||(this.type!=xe||o.type!=me||t.includePreLineTrailingSpace)&&("\n"===this.character?o.isTrailingSpace?this.isTrailingSpace||this.isBr&&(o.type=_e,e()&&a.isLeadingSpace&&"\n"==a.character&&(o.character="")):r="\n":" "===this.character&&(r=" "))):r=this.character))):"\n"===this.character&&(!(o=this.nextUncollapsed())||o.isTrailingSpace),this.cache.set(n,r),r},equals:function(t){return!!t&&this.node===t.node&&this.offset===t.offset},inspect:S,toString:function(){return this.character}};T.prototype=Te,W(Te,{next:x("nextPos",function(t){var e=t.nodeWrapper,n=t.node,i=t.offset,o=e.session;if(!n)return null;var a,r,s;return i==e.getLength()?(a=n.parentNode,r=a?e.getNodeIndex()+1:0):e.isCharacterDataNode()?(a=n,r=i+1):(s=n.childNodes[i],o.getNodeWrapper(s).containsPositions()?(a=s,r=0):(a=n,r=i+1)),a?o.getPosition(a,r):null}),previous:x("previous",function(t){var e,n,i,o=t.nodeWrapper,a=t.node,r=t.offset,s=o.session;return 0==r?(e=a.parentNode,n=e?o.getNodeIndex():0):o.isCharacterDataNode()?(e=a,n=r-1):(i=a.childNodes[r-1],s.getNodeWrapper(i).containsPositions()?(e=i,n=U.getNodeLength(i)):(e=a,n=r-1)),e?s.getPosition(e,n):null}),nextVisible:x("nextVisible",function(t){var e=t.next();if(!e)return null;var n=e.nodeWrapper,i=e.node,o=e;return n.isCollapsed()&&(o=n.session.getPosition(i.parentNode,n.getNodeIndex()+1)),o}),nextUncollapsed:x("nextUncollapsed",function(t){for(var e=t;e=e.nextVisible();)if(e.resolveLeadingAndTrailingSpaces(),""!==e.character)return e;return null}),previousVisible:x("previousVisible",function(t){var e=t.previous();if(!e)return null;var n=e.nodeWrapper,i=e.node,o=e;return n.isCollapsed()&&(o=n.session.getPosition(i.parentNode,n.getNodeIndex())),o})});var Se=null,ke=function(){function t(t){var e=new C;return{get:function(n){var i=e.get(n[t]);if(i)for(var o,a=0;o=i[a++];)if(o.node===n)return o;return null},set:function(n){var i=n.node[t],o=e.get(i)||e.set(i,[]);o.push(n)}}}function e(){this.initCaches()}var n=z.isHostProperty(document.documentElement,"uniqueID");return e.prototype={initCaches:function(){this.elementCache=n?function(){var t=new C;return{get:function(e){return t.get(e.uniqueID)},set:function(e){t.set(e.node.uniqueID,e)}}}():t("tagName"),this.textNodeCache=t("data"),this.otherNodeCache=t("nodeName")},getNodeWrapper:function(t){var e;switch(t.nodeType){case 1:e=this.elementCache;break;case 3:e=this.textNodeCache;break;default:e=this.otherNodeCache}var n=e.get(t);return n||(n=new _(t,this),e.set(n)),n},getPosition:function(t,e){return this.getNodeWrapper(t).getPosition(e)},getRangeBoundaryPosition:function(t,e){var n=e?"start":"end";return this.getPosition(t[n+"Container"],t[n+"Offset"])},detach:function(){this.elementCache=this.textNodeCache=this.otherNodeCache=null}},e}();W(U,{nextNode:g,previousNode:m});var Ee=Array.prototype.indexOf?function(t,e){return t.indexOf(e)}:function(t,e){for(var n=0,i=t.length;i>n;++n)if(t[n]===e)return n;return-1};W(t.rangePrototype,{moveStart:$(!0,!1),moveEnd:$(!1,!1),move:$(!0,!0),trimStart:B(!0),trimEnd:B(!1),trim:L(function(t,e){var n=this.trimStart(e),i=this.trimEnd(e);return n||i}),expand:L(function(t,e,n){var r=!1;n=i(n,le);var s=a(n.characterOptions);if(e||(e=H),e==j){var l,c,d=o(n.wordOptions),h=t.getRangeBoundaryPosition(this,!0),u=t.getRangeBoundaryPosition(this,!1),p=D(h,s,d),f=p.nextEndToken(),g=f.chars[0].previousVisible();if(this.collapsed)l=f;else{var m=D(u,s,d);l=m.previousStartToken()}return c=l.chars[l.chars.length-1],g.equals(h)||(this.setStart(g.node,g.offset),r=!0),c&&!c.equals(u)&&(this.setEnd(c.node,c.offset),r=!0),n.trim&&(n.trimStart&&(r=this.trimStart(s)||r),n.trimEnd&&(r=this.trimEnd(s)||r)),r}return this.moveEnd(H,1,n)}),text:L(function(t,e){return this.collapsed?"":I(t,this,a(e)).join("")}),selectCharacters:L(function(t,e,n,i,o){var a={characterOptions:o};e||(e=G(this.getDocument())),this.selectNodeContents(e),this.collapse(!0),this.moveStart("character",n,a),this.collapse(!0),this.moveEnd("character",i-n,a)}),toCharacterRange:L(function(t,e,n){e||(e=G(this.getDocument()));var i,o,a=e.parentNode,r=U.getNodeIndex(e),s=-1==U.comparePoints(this.startContainer,this.endContainer,a,r),l=this.cloneRange();return s?(l.setStartAndEnd(this.startContainer,this.startOffset,a,r),i=-l.text(n).length):(l.setStartAndEnd(a,r,this.startContainer,this.startOffset),i=l.text(n).length),o=i+this.text(n).length,{start:i,end:o}}),findText:L(function(e,n,a){a=i(a,re),a.wholeWordsOnly&&(a.wordOptions=o(a.wordOptions),a.wordOptions.includeTrailingSpace=!1);var r=X(a.direction),s=a.withinRange;s||(s=t.createRange(),s.selectNodeContents(this.getDocument()));var l=n,c=!1;"string"==typeof l?a.caseSensitive||(l=l.toLowerCase()):c=!0;var d=e.getRangeBoundaryPosition(this,!r),h=s.comparePoint(d.node,d.offset);-1===h?d=e.getRangeBoundaryPosition(s,!0):1===h&&(d=e.getRangeBoundaryPosition(s,!1));for(var u,p=d,f=!1;;)if(u=M(p,l,c,s,a)){if(u.valid)return this.setStartAndEnd(u.startPos.node,u.startPos.offset,u.endPos.node,u.endPos.offset),!0;p=r?u.startPos:u.endPos}else{if(!a.wrap||f)return!1;s=s.cloneRange(),p=e.getRangeBoundaryPosition(s,!r),s.setBoundary(d.node,d.offset,r),f=!0}}),pasteHtml:function(t){if(this.deleteContents(),t){var e=this.createContextualFragment(t),n=e.lastChild;this.insertNode(e),this.collapseAfter(n)}}}),W(t.selectionPrototype,{expand:L(function(t,e,n){this.changeEachRange(function(t){t.expand(e,n)})}),move:L(function(t,e,n,i){var o=0;if(this.focusNode){this.collapse(this.focusNode,this.focusOffset);var a=this.getRangeAt(0);i||(i={}),i.characterOptions=r(i.characterOptions),o=a.move(e,n,i),this.setSingleRange(a)}return o}),trimStart:F("trimStart"),trimEnd:F("trimEnd"),trim:F("trim"),selectCharacters:L(function(e,n,i,o,a,r){var s=t.createRange(n);s.selectCharacters(n,i,o,r),this.setSingleRange(s,a)}),saveCharacterRanges:L(function(t,e,n){for(var i=this.getAllRanges(),o=i.length,a=[],r=1==o&&this.isBackward(),s=0,l=i.length;l>s;++s)a[s]={characterRange:i[s].toCharacterRange(e,n),backward:r,characterOptions:n};return a}),restoreCharacterRanges:L(function(e,n,i){this.removeAllRanges();for(var o,a,r,s=0,l=i.length;l>s;++s)a=i[s],r=a.characterRange,o=t.createRange(n),o.selectCharacters(n,r.start,r.end,a.characterOptions),this.addRange(o,a.backward)}),text:L(function(t,e){for(var n=[],i=0,o=this.rangeCount;o>i;++i)n[i]=this.getRangeAt(i).text(e);return n.join("")})}),t.innerText=function(e,n){var i=t.createRange(e);i.selectNodeContents(e);var o=i.text(n);return i.detach(),o},t.createWordIterator=function(t,e,n){var r=E();n=i(n,ce);var s=a(n.characterOptions),l=o(n.wordOptions),c=r.getPosition(t,e),d=D(c,s,l),h=X(n.direction);return{next:function(){return h?d.previousStartToken():d.nextEndToken()},dispose:function(){d.dispose(),this.next=function(){}}}},t.noMutation=function(t){var e=E();t(e),R()},t.noMutation.createEntryPointFunction=L,t.textRange={isBlockNode:d,isCollapsedWhitespaceNode:b,createPosition:L(function(t,e,n){return t.getPosition(e,n)})}});var ai=function(t){var e=t.url;t.data&&"POST"!==t.method||t.queryString?(e+="?"+ai.prepare(t.data),t.data=void 0):"undefined"!=typeof t.data&&(t.data=ai.prepare(t.data)),ai.send(e,t.success,t.method||"GET",t.data,t.async,t.headers||{})};ai.prepare=function(t){var e=[];for(var n in t)e.push(encodeURIComponent(n)+"="+encodeURIComponent(t[n]));return e.join("&")},ai.send=function(t,e,n,i,o,a){var r=new XMLHttpRequest;r.open(n,t,o),r.onreadystatechange=function(){4==r.readyState&&e(r.responseText,r)},r.setRequestHeader("X-Requested-With","XMLHttpRequest"),"POST"==n&&r.setRequestHeader("Content-type","application/x-www-form-urlencoded");for(var s in a)r.setRequestHeader(s,a[s]);r.send(i)},ai.get=function(t,e,n,i,o,a){ai({url:t,data:e,success:n,async:i,headers:o,method:a||"GET"})},ai.post=function(t,e,n,i,o,a){ai({url:t,data:e,success:n,async:i,headers:o,method:a||"POST"})};var ri=null,si="en",li={},ci={};p.prototype.init=function(){};var di={};jQuery(window).on("beforeunload",f);var hi={unsupported:'<div class="{{baseClass}}-unsupported-overlay"></div> <div class="{{baseClass}}-unsupported-content"> It has been detected that you a using a browser that is not supported by Raptor, please use one of the following browsers: <ul> <li><a href="http://www.google.com/chrome">Google Chrome</a></li> <li><a href="http://www.firefox.com">Mozilla Firefox</a></li> <li><a href="http://www.google.com/chromeframe">Internet Explorer with Chrome Frame</a></li> </ul> <div class="{{baseClass}}-unsupported-input"> <button class="{{baseClass}}-unsupported-close">Close</button> <input name="{{baseClass}}-unsupported-show" type="checkbox" /> <label>Don\'t show this message again</label> </div> <div>',"class-menu.item":'<li><a data-value="{{value}}">{{label}}</a></li>',"click-button-to-edit.button":"<button class=\"{{baseClass}}-button\">tr('clickButtonToEditPluginButton')</button>","color-menu-basic.automatic":'<li><a data-color="automatic"><div class="{{baseClass}}-swatch" style="display: none"></div> <span>tr(\'colorMenuBasicAutomatic\')</span></a></li>',"color-menu-basic.item":'<li><a data-color="{{className}}"><div class="{{baseClass}}-swatch" style="background-color: {{color}}"></div> <span>{{label}}</span></a></li>',"embed.dialog":'<div class="{{baseClass}}-panel-tabs ui-tabs ui-widget ui-widget-content ui-corner-all"> <ul class="ui-tabs-nav ui-helper-reset ui-helper-clearfix ui-widget-header ui-corner-all"> <li class="ui-state-default ui-corner-top ui-tabs-selected ui-state-active"><a>tr(\'embedDialogTabCode\')</a></li> <li class="ui-state-default ui-corner-top"><a>tr(\'embedDialogTabPreview\')</a></li> </ul> <div class="{{baseClass}}-code-tab"> <p>tr(\'embedDialogTabCodeContent\')</p> <textarea></textarea> </div> <div class="{{baseClass}}-preview-tab" style="display: none"> <p>tr(\'embedDialogTabPreviewContent\')</p> <div class="{{baseClass}}-preview"></div> </div> </div>',"font-family.menu-item":'<li><a data-font="{{fontName}}"><span>{{fontTitle}}</span></a></li>',"image-resize.dialog":'<div class="raptor-resize-image"> <div> <label for="{{baseClass}}-width">tr(\'imageResizeDialogWidth\')</label> <input class="form-text" id="{{baseClass}}-width" name="width" type="text" placeholder="tr(\'imageResizeDialogWidthPlaceHolder\')"/> </div> <div> <label for="{{baseClass}}-height">tr(\'imageResizeDialogHeight\')</label> <input class="form-text" id="{{baseClass}}-height" name="height" type="text" placeholder="tr(\'imageResizeDialogHeightPlaceHolder\')"/> </div> <div class="{{baseClass}}-lock-proportions-container"> <span class="{{baseClass}}-lock-proportions"> <span class="ui-button-text">Constrain proportions</span> <span class="ui-icon ui-icon-locked"></span> </span> </div> </div>',"insert-file.dialog":'<div> <div> <label class="form-label">tr(\'insertFileURLLabel\')</label> <input type="text" name="location" class="form-text" placeholder="tr(\'insertFileURLPlaceHolder\')"/> </div> <div> <label class="form-label">tr(\'insertFileNameLabel\')</label> <input type="text" name="name" class="form-text" placeholder="tr(\'insertFileNamePlaceHolder\')"/> </div> </div>',"language-menu.item":'<li><a data-value="{{value}}"><span class="ui-icon ui-icon-flag-{{icon}}"></span>{{label}}</a></li>',"link.dialog":'<div style="display:none" class="{{baseClass}}-panel"> <div class="{{baseClass}}-menu"> <p>tr(\'linkCreateDialogMenuHeader\')</p> <fieldset data-menu=""></fieldset> </div> <div class="{{baseClass}}-wrap"> <div class="{{baseClass}}-content" data-content=""></div> </div> </div>',"link.document":'<h2>tr(\'linkTypeDocumentHeader\')</h2> <fieldset> <label for="{{baseClass}}-document-href">tr(\'linkTypeDocumentLocationLabel\')</label> <input id="{{baseClass}}-document-href" value="http://" name="location" class="{{baseClass}}-document-href" type="text" placeholder="tr(\'linkTypeDocumentLocationPlaceHolder\')" /> </fieldset> <h2>tr(\'linkTypeDocumentNewWindowHeader\')</h2> <fieldset> <label for="{{baseClass}}-document-target"> <input id="{{baseClass}}-document-target" name="blank" type="checkbox" /> <span>tr(\'linkTypeDocumentNewWindowLabel\')</span> </label> </fieldset> tr(\'linkTypeDocumentInfo\')',"link.email":'<h2>tr(\'linkTypeEmailHeader\')</h2> <fieldset class="{{baseClass}}-email"> <label for="{{baseClass}}-email">tr(\'linkTypeEmailToLabel\')</label> <input id="{{baseClass}}-email" name="email" type="text" placeholder="tr(\'linkTypeEmailToPlaceHolder\')"/> </fieldset> <fieldset class="{{baseClass}}-email"> <label for="{{baseClass}}-email-subject">tr(\'linkTypeEmailSubjectLabel\')</label> <input id="{{baseClass}}-email-subject" name="subject" type="text" placeholder="tr(\'linkTypeEmailSubjectPlaceHolder\')"/> </fieldset>',"link.error":'<div style="display:none" class="ui-widget {{baseClass}}-error-message {{messageClass}}"> <div class="ui-state-error ui-corner-all"> <p> <span class="ui-icon ui-icon-alert"></span> {{message}} </p> </div> </div>',"link.external":'<h2>tr(\'linkTypeExternalHeader\')</h2> <fieldset> <label for="{{baseClass}}-external-href">tr(\'linkTypeExternalLocationLabel\')</label> <input id="{{baseClass}}-external-href" value="http://" name="location" class="{{baseClass}}-external-href" type="text" placeholder="tr(\'linkTypeExternalLocationPlaceHolder\')" /> </fieldset> <h2>tr(\'linkTypeExternalNewWindowHeader\')</h2> <fieldset> <label for="{{baseClass}}-external-target"> <input id="{{baseClass}}-external-target" name="blank" type="checkbox" /> <span>tr(\'linkTypeExternalNewWindowLabel\')</span> </label> </fieldset> tr(\'linkTypeExternalInfo\')',"link.file-url":'<h2>tr(\'Link to a document or other file\')</h2> <fieldset> <label for="{{baseClass}}-external-href">tr(\'Location\')</label> <input id="{{baseClass}}-external-href" value="http://" name="location" class="{{baseClass}}-external-href" type="text" placeholder="tr(\'Enter your URL\')" /> </fieldset> <h2>tr(\'New window\')</h2> <fieldset> <label for="{{baseClass}}-external-target"> <input id="{{baseClass}}-external-target" name="blank" type="checkbox" /> <span>tr(\'Check this box to have the file open in a new browser window\')</span> </label> </fieldset> <h2>tr(\'Not sure what to put in the box above?\')</h2> <ol> <li>tr(\'Ensure the file has been uploaded to your website\')</li> <li>tr(\'Open the uploaded file in your browser\')</li> <li>tr("Copy the file\'s URL from your browser\'s address bar and paste it into the box above")</li> </ol>',"link.internal":'<h2>tr(\'linkTypeInternalHeader\')</h2> <fieldset> <label for="{{baseClass}}-internal-href">tr(\'linkTypeInternalLocationLabel\') {{domain}}</label> <input id="{{baseClass}}-internal-href" value="" name="location" class="{{baseClass}}-internal-href" type="text" placeholder="tr(\'linkTypeInternalLocationPlaceHolder\')" /> </fieldset> <h2>tr(\'linkTypeInternalNewWindowHeader\')</h2> <fieldset> <label for="{{baseClass}}-internal-target"> <input id="{{baseClass}}-internal-target" name="blank" type="checkbox" /> <span>tr(\'linkTypeInternalNewWindowLabel\')</span> </label> </fieldset> tr(\'linkTypeInternalInfo\')',"link.label":'<label> <input type="radio" name="link-type" autocomplete="off"/> <span>{{label}}</span> </label>',"paste.dialog":'<div class="{{baseClass}}-panel ui-dialog-content ui-widget-content"> <div class="{{baseClass}}-panel-tabs ui-tabs ui-widget ui-widget-content ui-corner-all"> <ul class="ui-tabs-nav ui-helper-reset ui-helper-clearfix ui-widget-header ui-corner-all"> <li class="{{baseClass}}-tab-formatted-clean ui-state-default ui-corner-top ui-state-active ui-tabs-selected" style="display: none"><a>tr(\'pasteDialogFormattedCleaned\')</a></li> <li class="{{baseClass}}-tab-plain-text ui-state-default ui-corner-top" style="display: none"><a>tr(\'pasteDialogPlain\')</a></li> <li class="{{baseClass}}-tab-formatted-unclean ui-state-default ui-corner-top" style="display: none"><a>tr(\'pasteDialogFormattedUnclean\')</a></li> <li class="{{baseClass}}-tab-source ui-state-default ui-corner-top" style="display: none"><a>tr(\'pasteDialogSource\')</a></li> </ul> <div class="{{baseClass}}-content-formatted-clean" style="display: none"> <div contenteditable="true" class="{{baseClass}}-area {{baseClass}}-markup"></div> </div> <div class="{{baseClass}}-content-plain-text" style="display: none"> <textarea class="{{baseClass}}-area {{baseClass}}-plain"></textarea> </div> <div class="{{baseClass}}-content-formatted-unclean" style="display: none"> <div contenteditable="true" class="{{baseClass}}-area {{baseClass}}-rich"></div> </div> <div class="{{baseClass}}-content-source" style="display: none"> <textarea class="{{baseClass}}-area {{baseClass}}-source"></textarea> </div> </div> </div>',"snippet-menu.item":'<li><a data-name="{{name}}">{{name}}</a></li>',"special-characters.dialog":"<div> tr('specialCharactersHelp') <br/> <ul></ul> </div>","special-characters.tab-button":'<button data-setKey="{{setKey}}" data-charactersIndex="{{charactersIndex}}" title="{{description}}">{{htmlEntity}}</button>',"special-characters.tab-content":'<div id="{{baseClass}}-{{key}}"></div>',"special-characters.tab-li":'<li><a href="#{{baseClass}}-{{key}}">{{name}}</a></li>',"statistics.dialog":'<div> <ul> <li data-name="characters"></li> <li data-name="words"></li> <li data-name="sentences"></li> <li data-name="truncation"></li> </ul> </div>',"table.create-menu":'<table class="{{baseClass}}-menu"> <tr> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> </tr> <tr> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> </tr> <tr> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> </tr> <tr> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> </tr> <tr> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> </tr> <tr> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> </tr> <tr> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> </tr> <tr> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> </tr> </table>',"tag-menu.menu":"<li><a data-value=\"na\">tr('tagMenuTagNA')</a></li> <li><a data-value=\"p\">tr('tagMenuTagP')</a></li> <li><a data-value=\"h1\">tr('tagMenuTagH1')</a></li> <li><a data-value=\"h2\">tr('tagMenuTagH2')</a></li> <li><a data-value=\"h3\">tr('tagMenuTagH3')</a></li> <li><a data-value=\"h4\">tr('tagMenuTagH4')</a></li> <li><a data-value=\"div\">tr('tagMenuTagDiv')</a></li> <li><a data-value=\"pre\">tr('tagMenuTagPre')</a></li> <li><a data-value=\"address\">tr('tagMenuTagAddress')</a></li>","unsaved-edit-warning.warning":'<div class="{{baseClass}} ui-corner-tl"> <span class="ui-icon ui-icon-alert"></span> <span>tr(\'unsavedEditWarningText\')</span> </div>',"view-source.dialog":'<div class="{{baseClass}}-inner-wrapper"> <textarea></textarea> </div>'};r("en","English",{alignCenterTitle:"Align text center",alignJustifyTitle:"Align text justify",alignLeftTitle:"Align text left",alignRightTitle:"Align text right",cancelDialogCancelButton:"Continue Editing",cancelDialogContent:"Are you sure you want to cancel editing? All changes will be lost!",cancelDialogOKButton:"Cancel Editing",cancelDialogTitle:"Cancel Editing",cancelTitle:"Cancel editing",classMenuTitle:"Style picker",clearFormattingTitle:"Clear formatting",clickButtonToEditText:"Edit",clickButtonToEditTitle:null,closeTitle:"Close this toolbar",colorMenuBasicAutomatic:"Automatic",colorMenuBasicBlack:"Black",colorMenuBasicBlue:"Blue",colorMenuBasicGreen:"Green",colorMenuBasicGrey:"Grey",colorMenuBasicOrange:"Orange",colorMenuBasicPurple:"Purple",colorMenuBasicRed:"Red",colorMenuBasicTitle:"Change text color",colorMenuBasicWhite:"White",dockToElementTitle:"Dock/undock editor to element",dockToScreenTitle:"Dock/undock editor to screen",embedTitle:"Embed object",embedDialogTitle:"Embed Object",embedDialogTabCode:"Embed Code",embedDialogTabCodeContent:"Paste your embed code into the text area below:",embedDialogTabPreview:"Preview",embedDialogTabPreviewContent:"A preview of your embedded object is displayed below:",embedDialogOKButton:"Embed Object",embedDialogCancelButton:"Cancel",errorUINoName:'UI "{{ui}}" is invalid (must have a name property)',errorUINotObject:'UI "{{ui}}" is invalid (must be an object)',errorUIOverride:'UI "{{name}}" has already been registered, and will be overwritten',floatLeftTitle:"Align image to the left",floatNoneTitle:"Remove image align",floatRightTitle:"Align image to the right",fontFamilyMenuTitle:"Choose your font",fontFamilyMenuFontDefault:"Default Font",fontFamilyMenuFontArial:"Arial",fontFamilyMenuFontPalatino:"Palatino",fontFamilyMenuFontGeorgia:"Georgia",fontFamilyMenuFontTimes:"Times New Roman",fontFamilyMenuFontComicSans:"Comic Sans",fontFamilyMenuFontImpact:"Impact",fontFamilyMenuFontCourier:"Courier New",guidesTitle:"Show element guides",historyRedoTitle:"Redo",historyUndoTitle:"Undo",hrCreateTitle:"Insert Horizontal Rule",imageResizeDialogWidth:"Image width",imageResizeDialogHeight:"Image height",imageResizeDialogWidthPlaceHolder:"Width",imageResizeDialogHeightPlaceHolder:"Height",imageResizeDialogTitle:"Resize Image",imageResizeDialogOKButton:"Resize",imageResizeDialogCancelButton:"Cancel",imageResizeTitle:"Resize this image",insertFileTitle:"Insert file",insertFileDialogTitle:"Insert file",insertFileDialogOKButton:"Insert file",insertFileDialogCancelButton:"Cancel",insertFileURLLabel:"File URL",insertFileNameLabel:"File Name",insertFileURLPlaceHolder:"File URL...",insertFileNamePlaceHolder:"File Name...",languageMenuTitle:"Change Language",loremIpsumTitle:"Insert dummy text for testing",listOrderedTitle:"Ordered list",listUnorderedTitle:"Unordered list",linkCreateTitle:"Insert Link",linkRemoveTitle:"Remove Link",linkCreateDialogTitle:"Insert Link",linkCreateDialogOKButton:"Insert Link",linkCreateDialogCancelButton:"Cancel",linkCreateDialogMenuHeader:"Choose a link type",linkTypeEmailLabel:"Email address",linkTypeEmailHeader:"Link to an email address",linkTypeEmailToLabel:"Email:",linkTypeEmailToPlaceHolder:"Enter email address",linkTypeEmailSubjectLabel:"Subject (optional):",linkTypeEmailSubjectPlaceHolder:"Enter subject",linkTypeExternalLabel:"Page on another website",linkTypeExternalHeader:"Link to a page on another website",linkTypeExternalLocationLabel:"Location:",linkTypeExternalLocationPlaceHolder:"Enter a URL",linkTypeExternalNewWindowHeader:"New window",linkTypeExternalNewWindowLabel:"Check this box to have the link open in a new browser window/tab.",linkTypeExternalInfo:"<h2>Not sure what to put in the box above?</h2><ol>    <li>Find the page on the web you want to link to.</li>    <li>Copy the web address from your browser's address bar and paste it into the box above.</li></ol>",linkTypeDocumentLabel:"Document or other file",linkTypeDocumentHeader:"Link to a document or other file",linkTypeDocumentLocationLabel:"Location:",linkTypeDocumentLocationPlaceHolder:"Enter a URL",linkTypeDocumentNewWindowHeader:"New window",linkTypeDocumentNewWindowLabel:"Check this box to have the file open in a new browser window/tab.",linkTypeDocumentInfo:"<h2>Not sure what to put in the box above?</h2><ol>    <li>Ensure the file has been uploaded to your website.</li>    <li>Open the uploaded file in your browser.</li>    <li>Copy the file's URL from your browser's address bar and paste it into the box above.</li></ol>",linkTypeInternalLabel:"Page on this website",linkTypeInternalHeader:"Link to a page on this website",linkTypeInternalLocationLabel:"",linkTypeInternalLocationPlaceHolder:"Enter a URI",linkTypeInternalNewWindowHeader:"New window",linkTypeInternalNewWindowLabel:"Check this box to have the link open in a new browser window/tab.",linkTypeInternalInfo:'<h2>Not sure what to put in the box above?</h2><ol>    <li>Find the page on this site link to.</li>    <li>Copy the web address from your browser\'s address bar, excluding "{{domain}}" and paste it into the box above.</li></ol>',logoTitle:"Learn More About the Raptor WYSIWYG Editor",navigateAway:"\nThere are unsaved changes on this page. \nIf you navigate away from this page you will lose your unsaved changes",pasteDialogTitle:"Paste",pasteDialogOKButton:"Insert",pasteDialogCancelButton:"Cancel",pasteDialogPlain:"Plain Text",pasteDialogFormattedCleaned:"Formatted &amp; Cleaned",pasteDialogFormattedUnclean:"Formatted Unclean",pasteDialogSource:"Source Code",placeholderPluginDefaultContent:"<br/>",saveTitle:"Save content",saveNotConfigured:"Save has not been configured, or is disabled.",saveJsonFail:"Failed to save {{failed}} content block(s)",saveJsonSaved:"Successfully saved {{saved}} content block(s).",saveRestFail:"Failed to save {{failed}} content block(s).",saveRestPartial:"Saved {{saved}} out of {{failed}} content blocks.",saveRestSaved:"Successfully saved {{saved}} content block(s).",snippetMenuTitle:"Snippets",specialCharactersArrows:"Arrows",specialCharactersDialogOKButton:"OK",specialCharactersDialogTitle:"Insert Special Characters",specialCharactersGreekAlphabet:"Greek Alphabet",specialCharactersHelp:'Click a special character to add it. Click "OK" when done to close this dialog',specialCharactersMathematics:"Mathematics",specialCharactersSymbols:"Symbols",specialCharactersTitle:"Insert a special character",statisticsButtonCharacterOverLimit:"{{charactersRemaining}} characters over limit",statisticsButtonCharacterRemaining:"{{charactersRemaining}} characters remaining",statisticsButtonCharacters:"{{characters}} characters",statisticsDialogCharactersOverLimit:"{{characters}} characters, {{charactersRemaining}} over the recommended limit",statisticsDialogCharactersRemaining:"{{characters}} characters, {{charactersRemaining}} remaining",statisticsDialogNotTruncated:"Content will not be truncated",statisticsDialogOKButton:"Ok",statisticsDialogSentence:"{{sentences}} sentence",statisticsDialogSentences:"{{sentences}} sentences",statisticsDialogTitle:"Content Statistics",statisticsDialogTruncated:"Content contains more than {{limit}} characters and may be truncated",statisticsDialogWord:"{{words}} word",statisticsDialogWords:"{{words}} words",statisticsTitle:"Click to view statistics",imageSwapTitle:"Swap this image",tableCreateTitle:"Create table",tableDeleteColumnTitle:"Delete table column",tableDeleteRowTitle:"Delete table row",tableInsertColumnTitle:"Insert table column",tableInsertRowTitle:"Insert table row",tableMergeCellsTitle:"Merge table cells",tableSplitCellsTitle:"Split table cells",tagMenuTagH1:"Heading&nbsp;1",tagMenuTagH2:"Heading&nbsp;2",tagMenuTagH3:"Heading&nbsp;3",tagMenuTagH4:"Heading&nbsp;4",tagMenuTagNA:"N/A",tagMenuTagP:"Paragraph",tagMenuTagDiv:"Div",tagMenuTagPre:"Pre-formatted",tagMenuTagAddress:"Address",tagMenuTitle:"Change element style",tagTreeElementLink:"Select {{element}} element",tagTreeElementTitle:'Click to select the contents of the "{{element}}" element',tagTreeRoot:"root",tagTreeRootLink:"Select all editable content",tagTreeRootTitle:"Click to select all editable content",textBlockQuoteTitle:"Block quote",textBoldTitle:"Bold",textItalicTitle:"Italic",textStrikeTitle:"Strike through",textSubTitle:"Sub-script",textSuperTitle:"Super-script",textUnderlineTitle:"Underline",textSizeDecreaseTitle:"Decrease text size",textSizeIncreaseTitle:"Increase text size",unsavedEditWarningText:"There are unsaved changes on this page",revisionsText:"Revisions",revisionsTextEmpty:"No Revisions",revisionsTitle:null,revisionsCreated:"Created",revisionsApplyButtonTitle:"Rollback",revisionsApplyButtonText:"Rollback",revisionsAJAXFailed:"Failed to retrieve revisions",revisionsApplyButtonDialogCancelButton:"Cancel",revisionsApplyButtonDialogOKButton:"Rollback",revisionsApplyButtonDialogTitle:"Rollback Confirmation",revisionsApplyDialogContent:"This will replace the current content with the selected revision.<br/>The current content will be added as a revision, and will be visible in the revisions list for this block.",revisionsDialogCancelButton:"Cancel",revisionsDialogTitle:"View content revisions",revisionsButtonCurrent:"Current",revisionsButtonViewDiffText:"Differences",revisionsButtonViewDiffTitle:null,revisionsDiffButtonDialogCancelButton:"Close",revisionsDiffButtonDialogTitle:"View differences",revisionsDiffButtonTitle:"View differences",revisionsDiffButtonText:"View differences",revisionsLoading:"Loading revisions...",revisionsNone:"No revisions for this element",revisionsPreviewButtonTitle:"Preview",revisionsPreviewButtonText:"Preview",fileManagerDialogTitle:"File Manager",fileManagerTitle:"File Manager",rfmClose:"Close",rfmContinue:"Continue",rfmDeleteTitle:"Delete",rfmDownloadTitle:"Download",rfmEditTitle:"Edit",rfmFileActions:"Actions",rfmFileModificationTime:"Modified",rfmFileName:"Name",rfmFileSize:"Size",rfmFileType:"Type",rfmFilteredTotal:"Showing {{start}} to {{end}} of {{filteredTotal}} files",rfmFirst:"First",rfmHeadingDirectories:"Directories",rfmHeadingSearch:"Search",rfmHeadingTags:"Tags",rfmHeadingUpload:"Upload",rfmInsertTitle:"Insert",rfmLast:"Last",rfmRenameTitle:"Rename",rfmSearch:"Go",rfmTagDocument:"Document",rfmTagImage:"Image",rfmTotal:", filtered from {{total}}",rfmUpload:"Upload",rfmUploadBrowse:"Browse",rfmUploadDrop:"Drop Files Here",rfmUploadFileRemove:"Remove",rfmUploadOr:"or",rfmViewTitle:"View",imageEditorDialogCancelButton:"Cancel",imageEditorDialogOKButton:"Save",imageEditorDialogTitle:"Image Editor",imageEditorTitle:"Edit Image",rieApply:"Apply",rieBlurTitle:"Blur",rieBrightnessTitle:"Brightness/Contrast",rieCancel:"Cancel",rieCancelTitle:"Cancel",rieColorAdjustTitle:"Adjsut Color",rieCropTitle:"Crop",rieDesaturateTitle:"Desaturate",rieFlipHTitle:"Flip Horizontally",rieFlipVTitle:"Flip Vertically",rieGlowTitle:"Glow",rieHslTitle:"Hue, Saturation, Lightness.",rieInvertTitle:"Invert",riePosterizeTitle:"Posterize",rieRedoTitle:"Redo",rieRemoveNoiseTitle:"Remove Noise",rieResizeTitle:"Resize",rieRevertTitle:"Revert",rieRotateLeftTitle:"Rotate Left",rieRotateRightTitle:"Rotate Right",rieSaveTitle:"Save",rieSaveTitle:"Save",rieSepiaTitle:"Sepia",rieSharpenTitle:"Sharpen",rieSolarizeTitle:"Solarize",rieUndoTitle:"Undo",rieUploadTitle:"Upload",rieActionColorAdjustRed:"Red",rieActionColorAdjustGreen:"Green",rieActionColorAdjustBlue:"Blue",rieActionBrightnessBrightness:"Brightness",rieActionBrightnessContrast:"Contrast",rieActionGlowAmount:"Glow Amount",rieActionGlowRadius:"Glow Radius",rieActionHsl:"Hue",rieActionHsl:"Saturation",rieActionHsl:"Lightness",rieActionPosterize:"Levels",viewSourceDialogCancelButton:"Close",viewSourceDialogOKButton:"Apply source code",viewSourceDialogTitle:"Content source code",viewSourceTitle:"View/edit source code"});
var ui=!1,pi=jQuery;pi(function(){rangy.initialized||rangy.init(),pi.isFunction(rangy.rangePrototype.insertNodeAtEnd)||(rangy.rangePrototype.insertNodeAtEnd=function(t){var e=this.cloneRange();e.collapse(!1),e.insertNode(t),e.detach(),this.setEndAfter(t)})}),pi("html").click(function(){pi(".ui-editor-selectmenu-visible").removeClass("ui-editor-selectmenu-visible")});var fi,gi,mi,vi,bi;Object.create||(Object.create=function(t){function e(){}if(arguments.length>1)throw new Error("Object.create implementation only accepts the first parameter.");return e.prototype=t,new e}),"undefined"==typeof Node&&(Node={TEXT_NODE:3}),"".trim||(String.prototype.trim=function(){return this.replace(/^[\s\uFEFF]+|[\s\uFEFF]+$/g,"")});var yi={globalDefaults:{},defaults:{},enableHotkeys:!0,hotkeys:{},plugins:{},ui:{},layouts:{},presets:{},hoverPanels:{},instances:[],getInstances:function(){return this.instances},eachInstance:function(t){for(var e=0;e<this.instances.length;e++)t.call(this.instances[e],this.instances[e])},urlPrefix:"/raptor/",getTemplate:function(t,e){var n;if(this.templates[t])n=this.templates[t];else{var i=e||this.urlPrefix,o=t.split(".");i+=1===o.length?"templates/"+o[0]+".html":"plugins/"+o[0]+"/templates/"+o.splice(1).join("/")+".html",pi.ajax({url:i,type:"GET",async:!1,timeout:15e3,error:function(){n=null},success:function(t){n=t}}),this.templates[t]=n}return n},isDirty:function(){for(var t=this.getInstances(),e=0;e<t.length;e++)if(t[e].isDirty())return!0;return!1},unloadWarning:function(){for(var t=this.getInstances(),e=0;e<t.length;e++)if(t[e].isDirty()&&t[e].isEditing()&&t[e].options.unloadWarning)return c("navigateAway")},registerUi:function(t){this.ui[t.name]=t},registerLayout:function(t){this.layouts[t.name]=t},registerPlugin:function(t){this.plugins[t.name]=t},registerPreset:function(t,e){this.presets[t.name]=t,e&&(this.defaults=t)},persist:function(t,e,n){return t=n?n+"."+t:t,void 0===e?u(t):h(t,e)}},wi=!1,Ci={_init:function(){if(!this.element.attr("data-raptor-initialised")){this.element.attr("data-raptor-initialised",!0),-1===pi.inArray(this,yi.instances)&&yi.instances.push(this);var t=this,e=this.persist("locale")||this.options.initialLocale;e&&(ri=e);var n=this.options;this.options=this.options.preset?pi.extend(!0,{},yi.globalDefaults,yi.presets[this.options.preset],this.options):pi.extend(!0,{},yi.globalDefaults,yi.defaults,this.options),n.layouts&&n.layouts.toolbar&&n.layouts.toolbar.uiOrder&&(this.options.layouts.toolbar.uiOrder=n.layouts.toolbar.uiOrder),this.element.attr("id")||this.element.attr("id",q()),this.ready=!1,this.events={},this.plugins={},this.layouts={},this.templates=pi.extend({},yi.templates),this.target=this.element,this.layout=null,this.previewState=null,this.pausedState=null,this.pausedScrollX=null,this.pausedScrollY=null,this.enabled=!1,this.initialised=!1,this.uiObjects={},this.hotkeys={},this.hotkeysSuspended=!1,this.options.enableHotkeys&&this.registerHotkey(this.hotkeys);for(var i in this.options.bind)this.bind(i,this.options.bind[i]);this.history=[],this.present=0,this.historyEnabled=!0,pn()&&(this.setOriginalHtml(this.element.is(":input")?this.element.val():this.element.html()),this.historyPush(this.getOriginalHtml()),this.element.is(":input")&&this.replaceOriginal(),this.loadPlugins(),this.dirty=!1,this.previousContent=null,this.previousSelection=null,this.getElement().addClass("raptor-editable-block"),this.loadLayouts(),this.ready=!0,this.fire("ready"),this.options.autoEnable&&pi(function(){t.enableEditing()}))}},attach:function(){this.bind("change",this.historyPush),this.getElement().on("click.raptor","img",function(t){ge(t.target),this.checkSelectionChange()}.bind(this)),this.getElement().on("focus.raptor",this.showLayout.bind(this)),this.target.on("mouseup.raptor",this.checkSelectionChange.bind(this)),this.target.on("input.raptor keyup.raptor mouseup.raptor",this.checkChangeDelayed.bind(this)),pi(window).bind("beforeunload",yi.unloadWarning.bind(yi));var t=this;pi(window).resize(function(){t.fire("resize")})},detach:function(){this.unbind("change"),this.getElement().off("click.raptor","img"),this.getElement().off("focus.raptor"),this.getElement().blur(),this.target.off("mouseup.raptor"),this.target.off("keyup.raptor")},localeChange:function(){if(!this.ready){var t;return t=function(){this.unbind("ready",t),this.localeChange()},void this.bind("ready",t)}this.actionPreviewRestore();var e=[];for(var n in this.layouts)this.layouts[n].isVisible()&&e.push(n);this.layoutsDestruct(),this.events={},this.plugins={},this.uiObjects={},this.hotkeys={},this.loadPlugins(),this.loadLayouts();for(var i=0;i<e.length;i++)this.layouts[e[i]].show();this.checkSelectionChange()},restoreFocus:function(){this.getElement().focus()},getElement:function(){return this.target},getNode:function(){return this.target[0]},getOriginalElement:function(){return this.element},replaceOriginal:function(){if(this.target.is(":input")){for(var t=pi("<div/>").html(this.element.val()).insertBefore(this.element).attr("id",q()).addClass(this.element.attr("class")).addClass(this.options.classes),e=H(this.element),n=0;n<this.options.replaceStyle.length;n++)t.css(this.options.replaceStyle[n],e[this.options.replaceStyle[n]]);this.element.hide(),this.bind("change",function(){this.getOriginalElement().is(":input")?this.getOriginalElement().val(this.getHtml()).trigger("input"):this.getOriginalElement().html(this.getHtml())}),this.target=t}},checkSelectionChange:function(){var t=rangy.serializeSelection(null,!1);this.previousSelection!==t&&this.fire("selectionChange"),this.previousSelection=t},checkChangeTimer:null,checkChangeCount:0,checkChangeDelayed:function(){null!==this.checkChangeTimer&&(clearTimeout(this.checkChangeTimer),this.checkChangeTimer=null),this.checkChangeCount++<10?this.checkChangeTimer=setTimeout(this.checkChange.bind(this),200):this.checkChange()},checkChange:function(){this.checkChangeCount=0;var t=this.getHtml(),e=this.dirty;this.dirty=this.originalHtml!==t,this.previousHtml!==t&&(this.previousHtml=t,this.fire("change",[t]),e!==this.dirty&&this.fire(this.dirty?"dirty":"cleaned"),this.checkSelectionChange())},change:function(){this.fire("change",[this.getHtml()])},destruct:function(){this.disableEditing(),this.fire("destroy"),this.events={},this.getElement().off(".raptor"),this.getOriginalElement().is(":input")&&(this.target.remove(),this.target=null,this.element.show()),this.layoutsDestruct()},actionPreview:function(t){this.actionPreviewRestore();try{var e=this.fire("selectionCustomise");e.length>0?this.previewState=T(this.previewState,this.target,function(){for(var n=0,i=e.length;i>n;n++)rangy.getSelection().setSingleRange(e[n]),this.selectionConstrain(),t()}.bind(this)):(this.selectionConstrain(),this.previewState=T(this.previewState,this.target,t)),this.checkSelectionChange()}catch(n){}},actionPreviewRestore:function(){this.previewState&&(this.target=S(this.previewState,this.target),this.previewState=null,this.checkSelectionChange())},actionApply:function(t){this.actionPreviewRestore();var e=this.stateSave();try{var n=this.fire("selectionCustomise");n.length>0?k(function(){for(var e=0,i=n.length;i>e;e++)rangy.getSelection().setSingleRange(n[e]),this.selectionConstrain(),k(t,this.history)}.bind(this),this.history):(this.selectionConstrain(),k(t,this.history)),this.checkChange()}catch(i){this.stateRestore(e)}},actionUndo:function(){},actionRedo:function(){},stateSave:function(){return this.selectionConstrain(),Le(this.target)},stateRestore:function(t){var e=$e(this.target,t),n=rangy.getSelection();this.target=e.element,null!==e.ranges&&(n.setRanges(e.ranges),n.refresh())},selectionConstrain:function(){Ee(this.target[0])},pause:function(){this.pausedState||(this.pausedState=this.stateSave(),this.suspendHotkeys(),this.pausedScrollX=window.scrollX,this.pausedScrollY=window.scrollY)},resume:function(){this.pausedState&&(this.stateRestore(this.pausedState),this.pausedState=null,this.resumeHotkeys(),this.restoreFocus(),window.scrollTo(this.pausedScrollX,this.pausedScrollY))},persist:function(t,e){return this.options.persistence?yi.persist(t,e,this.options.namespace):null},enableEditing:function(){if(!this.enabled){if(this.fire("enabling"),this.attach(),this.enabled=!0,this.getElement().addClass(this.options.baseClass+"-editing").addClass(this.options.classes),this.options.partialEdit?this.getElement().find(this.options.partialEdit).prop("contenteditable",!0):this.getElement().prop("contenteditable",!0),!this.initialised){this.initialised=!0;for(var t in this.plugins)this.plugins[t].enable();this.bindHotkeys(),this.getElement().closest("form").on("submit.raptor",function(){O(this.getElement()),this.fire("change",[this.getHtml()])}.bind(this))}O(this.getElement()),this.fire("enabled"),this.showLayout();var e=this.options.partialEdit?this.getElement().find("[contenteditable]")[0]:this.getNode();switch(this.options.autoSelect){case"all":fe(e);break;case"start":var n=pi(e).find("*:first")[0];if(!n){fe(e);break}var i=rangy.createRange();i.setStartBefore(n),i.setEndBefore(n),ue(i);break;case"end":var n=pi(e).find("*:last")[0];if(!n){fe(e);break}fe(n);var i=rangy.createRange();i.setStartAfter(n),i.setEndAfter(n),ue(i)}}},disableEditing:function(){this.enabled&&(this.detach(),this.enabled=!1,this.getElement().prop("contenteditable",!1).removeClass(this.options.baseClass+"-editing").removeClass(this.options.classes),rangy.getSelection().removeAllRanges(),this.fire("disabled"),this.options.reloadOnDisable&&!wi&&(wi=!0,window.location.reload()))},cancelEditing:function(){this.unify(function(t){t.stopEditing()})},stopEditing:function(){this.fire("cancel"),this.options.reloadOnDisable||this.resetHtml(),this.disableEditing(),this.dirty=!1,de()},isEditing:function(){return this.enabled},isRoot:function(t){return this.getElement()[0]===pi(t)[0]},unify:function(t,e){if(e!==!1&&t(this),this.options.unify){var n=this;yi.eachInstance(function(e){e!==n&&e.options.unify&&t(e)})}},getLayout:function(t){return this.layouts[t]},loadLayouts:function(){for(var t in this.options.layouts)"undefined"!=typeof yi.layouts[t]&&(this.layouts[t]=this.prepareComponent(yi.layouts[t],this.options.layouts[t],"layout").instance,this.layouts[t].hotkeys&&this.registerHotkey(this.layouts[t].hotkeys,null,this.layouts[t]))},layoutsDestruct:function(){for(var t in this.layouts)this.layouts[t].destruct()},prepareComponent:function(t,e,n){var i=pi.extend({},t),o=pi.extend({},this.options,{baseClass:this.options.baseClass+"-"+n+"-"+m(t.name)},i.options,e);i.raptor=this,i.options=o;var a=i.init();return{init:a,instance:i}},showLayout:function(){this.unify(function(t){t.fire("layoutHide")},!1),this.fire("layoutShow"),this.fire("resize"),"undefined"==typeof this.getElement().attr("tabindex")&&this.getElement().attr("tabindex",-1)},getTemplate:function(t,e){return this.templates[t]||(this.templates[t]=b(t,this.options.urlPrefix)),y(this.templates[t],e)},historyPush:function(){if(this.historyEnabled){var t=this.getHtml();t!==this.historyPeek()&&(this.present!==this.history.length-1&&(this.history=this.history.splice(0,this.present+1)),this.history.push(this.getHtml()),this.present=this.history.length-1,this.fire("historyChange"))}},historyPeek:function(){return this.history.length?this.history[this.present]:null},historyBack:function(){this.present>0&&(this.present--,this.setHtml(this.history[this.present]),this.historyEnabled=!1,this.change(),this.historyEnabled=!0,this.fire("historyChange"))},historyForward:function(){this.present<this.history.length-1&&(this.present++,this.setHtml(this.history[this.present]),this.historyEnabled=!1,this.change(),this.historyEnabled=!0,this.fire("historyChange"))},registerHotkey:function(t,e){this.hotkeys[t]=e},bindHotkeys:function(){for(var t in this.hotkeys)this.getElement().on("keydown.raptor",t,function(t){if(this.isEditing()&&!this.hotkeysSuspended){var e=this.hotkeys[t.data]();e!==!1&&t.preventDefault()}}.bind(this))},suspendHotkeys:function(){this.hotkeysSuspended=!0},resumeHotkeys:function(){this.hotkeysSuspended=!1},isUiEnabled:function(t){return this.options.enableUi===!1&&"undefined"==typeof this.options.plugins[t]||this.options.plugins[t]===!1?!1:-1!==pi.inArray(t,this.options.disabledUi)||-1!==pi.inArray(t,this.options.disabledPlugins)?!1:!0},getUi:function(t){return this.uiObjects[t]},getPlugin:function(t){return this.uiObjects[t]||this.plugins[t]},loadPlugins:function(){var t=this;this.options.plugins||(this.options.plugins={});for(var e in yi.plugins)this.options.enablePlugins===!1&&"undefined"==typeof this.options.plugins[e]||this.options.plugins[e]===!1||-1===pi.inArray(e,this.options.disabledUi)&&-1===pi.inArray(e,this.options.disabledPlugins)&&(t.plugins[e]=this.prepareComponent(yi.plugins[e],t.options.plugins[e],"plugin").instance)},isDirty:function(){return this.dirty},getHtml:function(){return this.getElement().html()},clean:function(){this.actionApply(function(){O(this.getElement())}.bind(this))},setHtml:function(t){this.getElement().html(t),this.fire("html"),this.checkChange()},resetHtml:function(){this.setHtml(this.getOriginalHtml()),this.fire("cleaned")},getOriginalHtml:function(){return this.originalHtml},saved:function(t){this.setOriginalHtml(this.getHtml()),this.dirty=!1,this.fire("saved",t),this.fire("cleaned")},setOriginalHtml:function(t){this.originalHtml=t},bind:function(t,e,n){if("undefined"!=typeof e&&pi.isFunction(e))for(var i=t.split(/,\s*/),o=0,a=i.length;a>o;o++)this.events[i[o]]||(this.events[i[o]]=[]),this.events[i[o]].push({context:n,callback:e})},unbind:function(t,e,n){for(var i=0,o=this.events[t].length;o>i;i++)this.events[t][i]&&this.events[t][i].callback===e&&this.events[t][i].context===n&&this.events[t].splice(i,1)},fire:function(t,e){var n=[];if(this.events[t])for(var i=0,o=this.events[t].length;o>i;i++){var a=this.events[t][i];if("undefined"!=typeof a&&"undefined"!=typeof a.callback){var r=a.callback.apply(a.context||this,e);"undefined"!=typeof r&&(n=n.concat(r))}}return n}};pi.widget("ui.raptor",Ci),pi.fn.raptor.Raptor=yi,fn.prototype.init=function(){},fn.prototype.destruct=function(){},fn.prototype.isVisible=function(){return!1},fn.prototype.show=function(){},fn.prototype.hide=function(){},gn.prototype.init=function(){},gn.prototype.enable=function(){},mn.prototype.appendTo=function(t,e){for(var n=0,i=this.uiOrder.length;i>n;n++){for(var o=pi("<div/>").addClass(this.raptor.options.baseClass+"-layout-toolbar-group"),a=this.uiOrder[n],r=0,s=a.length;s>r;r++)if(this.raptor.isUiEnabled(a[r])&&yi.ui[a[r]]){var l=this.raptor.options.plugins[a[r]];if(l===!1)continue;var c=this.raptor.prepareComponent(yi.ui[a[r]],l,"ui");c.instance.layout=t,this.raptor.uiObjects[a[r]]=c.instance,_(c.init)&&(c.init.removeClass("ui-corner-all"),o.append(c.init))}o.children().length>0&&o.appendTo(e)}e.find(".ui-button:first-child").addClass("ui-corner-left"),e.find(".ui-button:last-child").addClass("ui-corner-right")},vn.prototype=Object.create(fn.prototype),vn.prototype.init=function(){this.raptor.bind("enabled",this.show.bind(this)),this.raptor.bind("disabled",this.hide.bind(this)),this.raptor.bind("layoutShow",this.show.bind(this)),this.raptor.bind("layoutHide",this.hide.bind(this)),pi(window).resize(this.constrainPosition.bind(this))},vn.prototype.destruct=function(){this.wrapper&&(this.wrapper.remove(),this.wrapper=null),this.raptor.fire("toolbarDestroy")},vn.prototype.show=function(){this.isVisible()||(this.getElement().css("display",""),this.constrainPosition(),this.raptor.getElement().zIndex()>this.getElement().zIndex()?this.getElement().css("z-index",this.raptor.getElement().zIndex()+1):this.getElement().css("z-index",null),this.raptor.fire("toolbarShow"))},vn.prototype.hide=function(){this.isReady()&&(this.getElement().css("display","none"),this.raptor.fire("toolbarHide"))},vn.prototype.initDragging=function(){if(pi.fn.draggable&&this.options.draggable&&!this.getElement().data("ui-draggable")){this.getElement().draggable({cancel:"a, button",cursor:"move",stop:this.constrainPosition.bind(this)}),this.getElement().css("position","fixed");var t=this.raptor.persist("position")||this.options.dialogPosition;t||(t=[10,10]),parseInt(t[0],10)+this.getElement().outerHeight()>pi(window).height()&&(t[0]=pi(window).height()-this.getElement().outerHeight()),parseInt(t[1],10)+this.getElement().outerWidth()>pi(window).width()&&(t[1]=pi(window).width()-this.getElement().outerWidth()),this.getElement().css({top:Math.abs(parseInt(t[0],10)),left:Math.abs(parseInt(t[1],10))})}},vn.prototype.enableDragging=function(){pi.fn.draggable&&this.options.draggable&&this.getElement().data("ui-draggable")&&this.getElement().draggable("enable")},vn.prototype.disableDragging=function(){pi.fn.draggable&&this.options.draggable&&this.getElement().is(".ui-draggable")&&this.getElement().draggable("disable").removeClass("ui-state-disabled")},vn.prototype.isReady=function(){return null!==this.wrapper},vn.prototype.isVisible=function(){return this.isReady()&&this.getElement().is(":visible")},vn.prototype.constrainPosition=function(){if(this.isVisible()){var t=parseInt(this.wrapper.css("left"))||-999,e=parseInt(this.wrapper.css("top"))||-999,n=this.wrapper.outerWidth(),i=this.wrapper.outerHeight(),o=pi(window).width(),a=pi(window).height(),r=Math.max(0,Math.min(t,o-n)),s=Math.max(0,Math.min(e,a-i));(r!==t||s!==e)&&this.wrapper.css({left:r,top:s}),this.raptor.persist("position",[this.wrapper.css("top"),this.wrapper.css("left")])}},vn.prototype.getElement=function(){if(null===this.wrapper){if(!this.options.uiOrder){this.options.uiOrder=[[]];for(var t in yi.ui)this.options.uiOrder[0].push(t)}var e=this.toolbar=pi("<div/>").addClass(this.options.baseClass+"-toolbar"),n=this.toolbarWrapper=pi("<div/>").addClass(this.options.baseClass+"-inner").addClass("ui-widget-content").mousedown(function(t){t.preventDefault()}).append(e),i=this.path=pi("<div/>").addClass(this.options.baseClass+"-path").addClass("ui-widget-header"),o=this.wrapper=pi("<div/>").addClass(this.options.baseClass+"-outer "+this.raptor.options.baseClass+"-layout").css("display","none").append(i).append(n),a=new mn(this.raptor,this.options.uiOrder);a.appendTo(this,this.toolbar),pi("<div/>").css("clear","both").appendTo(this.toolbar),pi(function(){o.appendTo("body"),this.initDragging(),this.constrainPosition(!0),this.raptor.fire("layoutReady",[this.wrapper]),this.raptor.fire("toolbarReady",[this])}.bind(this))}return this.wrapper},yi.registerLayout(new vn),bn.prototype=Object.create(fn.prototype),bn.prototype.init=function(){this.raptor.bind("ready",this.ready.bind(this)),this.raptor.bind("enabled",this.enabled.bind(this))},bn.prototype.ready=function(){this.raptor.getElement().mouseenter(this.show.bind(this)).mouseleave(this.hide.bind(this))},bn.prototype.enabled=function(){this.getElement().hide()},bn.prototype.getElement=function(){if(null===this.hoverPanel){this.hoverPanel=pi("<div/>").addClass(this.raptor.options.baseClass+"-layout "+this.options.baseClass).mouseleave(this.hide.bind(this));var t=new mn(this.raptor,this.options.uiOrder);t.appendTo(this,this.hoverPanel),pi(window).bind("scroll",this.position.bind(this)),this.hoverPanel.appendTo("body"),this.raptor.fire("layoutReady",[this.hoverPanel])}return this.hoverPanel},bn.prototype.show=function(){this.raptor.isEditing()||(this.visible=!0,this.getElement().show(),this.raptor.getElement().zIndex()>this.getElement().zIndex()?this.getElement().css("z-index",this.raptor.getElement().zIndex()+1):this.getElement().css("z-index",null),this.position(),this.raptor.getElement().addClass(this.raptor.options.baseClass+"-editable-block-hover"))},bn.prototype.hide=function(t){this.visible&&t&&(pi.contains(this.getElement().get(0),t.relatedTarget)||t.relatedTarget!==this.getElement().get(0)&&this.getElement().get(0)!==pi(t.relatedTarget).parent().get(0)&&(pi.contains(this.raptor.getElement().get(0),t.relatedTarget)||t.relatedTarget!==this.raptor.getElement().get(0)&&(this.visible=!1,this.getElement().hide(),this.raptor.getElement().removeClass(this.raptor.options.baseClass+"-editable-block-hover"))))},bn.prototype.position=function(){if(this.visible){var t=F(this.raptor.getElement());this.getElement().css({top:t.top+(t.height/2-this.getElement().outerHeight()/2),left:t.left+(t.width/2-this.getElement().outerWidth()/2)})}},bn.prototype.destruct=function(){this.hoverPanel&&(this.hoverPanel.remove(),this.hoverPanel=null),this.visible=!1},yi.registerLayout(new bn),yn.prototype=Object.create(fn.prototype),yn.prototype.init=function(){this.raptor.bind("ready",this.ready.bind(this))},yn.prototype.ready=function(){this.raptor.getElement().on("mouseenter",this.options.elements,this.show.bind(this)).on("mouseleave",this.options.elements,this.hide.bind(this))},yn.prototype.getElement=function(){if(null===this.hoverPanel){this.hoverPanel=pi("<div/>").addClass(this.raptor.options.baseClass+"-layout raptor-layout-hover-panel "+this.options.baseClass).mouseleave(this.hide.bind(this));var t=new mn(this.raptor,this.options.uiOrder);t.appendTo(this,this.hoverPanel),pi(window).bind("scroll",this.position.bind(this)),this.hoverPanel.appendTo("body"),this.raptor.fire("layoutReady",[this.hoverPanel])}return this.hoverPanel},yn.prototype.show=function(t){this.enabled&&this.raptor.isEditing()&&(this.target=t.target,this.visible=!0,Y(this.getElement().show(),pi(this.target)))},yn.prototype.hide=function(t){if(this.visible){if(t){if(pi.contains(this.getElement().get(0),t.relatedTarget))return;if(t.relatedTarget===this.getElement().get(0))return;if(this.getElement().get(0)===pi(t.relatedTarget).parent().get(0))return;if(pi.contains(this.raptor.getElement().get(0),t.relatedTarget))return;if(t.relatedTarget===this.raptor.getElement().get(0))return}this.visible=!1,this.getElement().hide()}},yn.prototype.close=function(){this.visible&&(this.enabled=!1,this.visible=!1,this.getElement().hide(),setTimeout(function(){this.enabled=!0}.bind(this),1e3))},yn.prototype.position=function(){this.visible&&Y(this.getElement(),pi(this.target))},yn.prototype.destruct=function(){this.hoverPanel&&(this.hoverPanel.remove(),this.hoverPanel=null),this.visible=!1},yi.registerLayout(new yn),wn.prototype.init=function(){if("string"==typeof this.hotkey)this.raptor.registerHotkey(this.hotkey,this.action.bind(this));else if(x(this.hotkey))for(var t=0,e=this.hotkey.length;e>t;t++)this.raptor.registerHotkey(this.hotkey[t],this.action.bind(this));return this.getButton()},wn.prototype.getButton=function(){if(!this.button){var t=this.text||this.translate("Text",!1);this.button=pi("<div>").html(t).addClass(this.options.baseClass).attr("title",this.getTitle()).click(this.click.bind(this)),Ke(this.button,{icons:{primary:this.getIcon()},text:t,label:this.label})}return this.button},wn.prototype.getTitle=function(){return this.title||this.translate("Title")},wn.prototype.getIcon=function(){return null===this.icon?"ui-icon-"+m(this.name):this.icon},wn.prototype.click=function(){nn(this.button)&&this.raptor.actionApply(this.action.bind(this))},wn.prototype.translate=function(t,e){return c(this.name+t,e)},Cn.prototype=Object.create(wn.prototype),Cn.prototype.init=function(){return this.preview="undefined"==typeof this.options.preview?!0:!1,wn.prototype.init.apply(this,arguments)},Cn.prototype.getButton=function(){return this.button||(this.button=wn.prototype.getButton.call(this).mouseenter(this.mouseEnter.bind(this)).mouseleave(this.mouseLeave.bind(this))),this.button},Cn.prototype.mouseEnter=function(){this.canPreview()&&(this.endPreview(),this.previewTimer=setTimeout(this.applyPreview.bind(this),this.previewTimeout))},Cn.prototype.applyPreview=function(){this.canPreview()&&(this.previewing=!0,this.raptor.actionPreview(this.action.bind(this)))},Cn.prototype.endPreview=function(){null!==this.previewTimer&&(clearTimeout(this.previewTimer),this.previewTimer=null),this.previewing=!1},Cn.prototype.mouseLeave=function(){this.endPreview(),this.raptor.actionPreviewRestore()},Cn.prototype.click=function(){return this.endPreview(),wn.prototype.click.apply(this,arguments)},Cn.prototype.canPreview=function(){return this.preview},Cn.prototype.isPreviewing=function(){return this.previewing},xn.prototype=Object.create(wn.prototype),xn.prototype.init=function(){return this.raptor.bind("selectionChange",this.selectionChange.bind(this)),wn.prototype.init.apply(this,arguments)},xn.prototype.selectionChange=function(){this.selectionToggle()?(an(this.button),this.disable&&en(this.button)):(rn(this.button),this.disable&&on(this.button))},_n.prototype=Object.create(Cn.prototype),_n.prototype.init=function(){return this.raptor.bind("selectionChange",this.selectionChange.bind(this)),Cn.prototype.init.apply(this,arguments)},_n.prototype.selectionChange=function(){this.selectionToggle()?this.isPreviewing()||an(this.button):rn(this.button)},Tn.prototype=Object.create(Cn.prototype),Tn.prototype.init=function(){var t=Cn.prototype.init.apply(this,arguments);return this.raptor.bind("selectionChange",this.selectionChange.bind(this)),t},Tn.prototype.selectionChange=function(){this.isEnabled()?en(this.button):on(this.button)},Tn.prototype.canPreview=function(){return Cn.prototype.canPreview.call(this)&&this.isEnabled()},Tn.prototype.isEnabled=function(){var t=se();return t?!!this.getElement(t):!!this.previewing},Tn.prototype.action=function(){he(function(t){var e=this.getElement(t);e&&this.applyToElement(e)}.bind(this))},Sn.prototype=Object.create(_n.prototype),Sn.prototype.action=function(){De(),this.raptor.selectionConstrain();for(var t=0,e=this.classes.length;e>t;t++){var n=rangy.createCssClassApplier(this.options.cssPrefix+this.classes[t],{elementTagName:this.tag||"span"});n.toggleSelection()}},Sn.prototype.selectionToggle=function(){for(var t=0,e=this.classes.length;e>t;t++){var n=rangy.createCssClassApplier(this.options.cssPrefix+this.classes[t],{elementTagName:this.tag||"span"});if(!n.isAppliedToSelection())return!1}return!0};var xi={};kn.prototype=Object.create(wn.prototype),kn.prototype.action=function(){this.openDialog()},kn.prototype.validateDialog=function(){return!0},kn.prototype.openDialog=function(){this.raptor.pause(),cn(this.getDialog())},kn.prototype.onDialogClose=function(){xi[this.name].instance.raptor.resume()},kn.prototype.okButtonClick=function(){var t=xi[this.name].instance.validateDialog();t===!0&&(dn(xi[this.name].dialog),xi[this.name].instance.applyAction.call(xi[this.name].instance,xi[this.name].dialog))},kn.prototype.closeDialog=function(){dn(xi[this.name].dialog)},kn.prototype.cancelButtonClick=kn.prototype.closeDialog,kn.prototype.getOkButton=function(t){return{text:c(t+"DialogOKButton"),click:this.okButtonClick.bind(this),icons:{primary:"ui-icon-circle-check"}}},kn.prototype.getCancelButton=function(t){return{text:c(t+"DialogCancelButton"),click:this.cancelButtonClick.bind(this),icons:{primary:"ui-icon-circle-close"}}},kn.prototype.getDefaultDialogOptions=function(t){var e={modal:!0,resizable:!0,autoOpen:!1,title:c(t+"DialogTitle"),dialogClass:this.options.baseClass+"-dialog "+this.options.dialogClass,close:this.onDialogClose.bind(this),buttons:[]},n=this.getOkButton(t),i=this.getCancelButton(t);return"undefined"!=typeof n&&n!==!1&&e.buttons.push(n),"undefined"!=typeof i&&i!==!1&&e.buttons.push(i),e},kn.prototype.getDialog=function(){return"undefined"==typeof xi[this.name]&&(xi[this.name]={dialog:pi(this.getDialogTemplate())},ln(xi[this.name].dialog,pi.extend(this.getDefaultDialogOptions(this.name),this.dialogOptions))),xi[this.name].instance=this,xi[this.name].dialog},En.prototype=Object.create(kn.prototype),En.prototype.init=xn.prototype.init,En.prototype.selectionChange=xn.prototype.selectionChange,Rn.prototype=Object.create(wn.prototype),Rn.prototype.click=function(t){this.menu.getMenu().is(":visible")?pi(".raptor-menu").hide():this.menu.show(),t.preventDefault()},Nn.prototype.init=function(){this.setOptions();var t=this.getButton().init();return t.addClass("raptor-menu-button"),t},Nn.prototype.getButton=function(){return this.button||(this.button=new Rn(this)),this.button},Nn.prototype.setOptions=function(){this.options.title=c(this.name+"Title"),this.options.icon="ui-icon-"+this.name},Nn.prototype.getMenu=function(){return this.menu||(this.menu=pi("<div>").addClass("ui-menu ui-widget ui-widget-content ui-corner-all "+this.options.baseClass+"-menu "+this.raptor.options.baseClass+"-menu").html(this.menuContent).css("position","fixed").hide().mousedown(function(t){t.preventDefault()}).children().appendTo("body")),this.menu},Nn.prototype.show=function(){pi(".raptor-menu").hide(),W(this.getMenu().toggle(),this.getButton().getButton())},pi("html").click(function(t){pi(t.target).hasClass("raptor-menu-button")||0!==pi(t.target).closest(".raptor-menu-button").length||pi(".raptor-menu").hide()}),Nn.prototype.getMenu=function(){return this.menu||(this.menu=pi("<div>").addClass("ui-menu ui-widget ui-widget-content ui-corner-all "+this.options.baseClass+"-menu "+this.raptor.options.baseClass+"-menu").html(this.menuContent).css("position","fixed").hide().appendTo("body").mousedown(function(t){t.preventDefault()})),this.menu},Dn.prototype=Object.create(Nn.prototype),Dn.prototype.menuItemMouseDown=function(t){t.preventDefault()},Dn.prototype.menuItemClick=function(t){return Ze(this.button.button,pi(t.target).html()),pi(this.menu).closest("ul").hide(),!1},Dn.prototype.menuItemMouseEnter=function(){},Dn.prototype.menuItemMouseLeave=function(){},Dn.prototype.getMenu=function(){return this.menu||(this.menu=pi("<ul>").addClass(this.options.baseClass+"-menu "+this.raptor.options.baseClass+"-menu").html(this.getMenuItems()).css("position","fixed").hide().find("a").mousedown(this.menuItemMouseDown.bind(this)).mouseenter(this.menuItemMouseEnter.bind(this)).mouseleave(this.menuItemMouseLeave.bind(this)).click(this.menuItemClick.bind(this)).end().appendTo("body"),sn(this.menu)),this.menu},yi.registerUi(new kn({name:"cancel",hotkey:"esc",dialogOptions:{width:500},action:function(){this.raptor.isDirty()?kn.prototype.action.call(this):this.applyAction()},applyAction:function(){this.raptor.cancelEditing()},getDialogTemplate:function(){return pi("<div>").html(c("cancelDialogContent"))}})),An.prototype=Object.create(Dn.prototype),An.prototype.init=function(){var t=Dn.prototype.init.call(this);return"object"==typeof this.options.classes&&Object.keys(this.options.classes).length>0?(this.raptor.bind("selectionChange",this.updateButton.bind(this)),t):void 0},An.prototype.changeClass=function(t){ke(t,[],this.raptor.getElement())},An.prototype.menuItemClick=function(t){Dn.prototype.menuItemClick.apply(this,arguments),this.raptor.actionApply(function(){this.changeClass([pi(t.currentTarget).data("value")])}.bind(this))},An.prototype.menuItemMouseEnter=function(t){this.raptor.actionPreview(function(){this.changeClass([pi(t.currentTarget).data("value")])}.bind(this))},An.prototype.menuItemMouseLeave=function(){this.raptor.actionPreviewRestore()},An.prototype.updateButton=function(){},An.prototype.getMenuItems=function(){var t="";for(var e in this.options.classes)t+=this.raptor.getTemplate("class-menu.item",{label:e,value:this.options.classes[e]});return t},yi.registerUi(new An),yi.registerUi(new Cn({name:"cleanBlock",action:function(){var t=this.raptor.getElement();D(t,["style"]),A(t,["font","span:not([class])",".cms-color:has(.cms-color)",":header strong",":header b",":header strong"]),R(t,["b","big","em","i","small","span","strong",":not(:visible)"])}})),yi.registerUi(new Cn({name:"clearFormatting",action:function(){Re(this.raptor.getElement().get(0)),R(this.raptor.getElement(),["a","b","i","sub","sup","strong","em","big","small","p"]),N(this.raptor.getElement()[0],"p")}})),yi.registerUi(new wn({name:"clickButtonToEdit",action:function(){this.raptor.enableEditing()}})),yi.registerUi(new wn({name:"close",click:function(){this.layout.close()}})),On.prototype=Object.create(Dn.prototype),On.prototype.init=function(){return this.raptor.bind("selectionChange",this.updateButton.bind(this)),this.updateButton(),Dn.prototype.init.apply(this,arguments)
},On.prototype.updateButton=function(){var t=we()[0],e=this.getButton().getButton(),n=null,i=null;if(Ze(e,c("colorMenuBasicAutomatic")),tn(e,!1),t){t=pi(t);for(var o in this.options.colors)if(i=pi(t).closest("."+this.options.cssPrefix+o),i.length){n=o;break}return n?(Ze(e,c("colorMenuBasic"+v(n))),tn(e,"ui-icon-swatch"),void e.find(".ui-icon").css("background-color",i.css("color"))):void 0}},On.prototype.changeColor=function(t,e){e&&(this.currentColor=t),this.raptor.actionApply(function(){if(De(),"automatic"===t)we().parents("."+this.options.cssPrefix+"color").addBack().each(function(){var t=pi(this).attr("class");if(null!==t&&"undefined"!=typeof t&&(t=t.match(/(cms-(.*?))( |$)/gi),null!==t&&"undefined"!=typeof t))for(var e=0,n=t.length;n>e;e++)pi(this).removeClass(t[e].trim()),pi(this).attr("class").trim()||pi(this).contents().unwrap()});else{var e=q();xe("span",{classes:this.options.cssPrefix+"color "+this.options.cssPrefix+t,attributes:{id:e}});var n=pi("#"+e);if(n.length){fe(n.removeAttr("id").get(0));var i;do i=pi("#"+e),i.removeAttr("id");while(i.length)}}A(this.raptor.getElement(),[".cms-color:has(.cms-color)"])}.bind(this))},On.prototype.menuItemMouseEnter=function(t){this.raptor.actionPreview(function(){this.changeColor(pi(t.currentTarget).data("color"))}.bind(this))},On.prototype.menuItemMouseLeave=function(){this.raptor.actionPreviewRestore()},On.prototype.menuItemClick=function(t){Dn.prototype.menuItemClick.apply(this,arguments),this.raptor.actionApply(function(){this.changeColor(pi(t.currentTarget).data("color"),!0)}.bind(this))},On.prototype.getMenuItems=function(){var t=this.raptor.getTemplate("color-menu-basic.automatic",this.options);for(var e in this.options.colors)t+=this.raptor.getTemplate("color-menu-basic.item",{color:this.options.colors[e],label:c("colorMenuBasic"+v(e)),className:e,baseClass:this.options.baseClass});return t},yi.registerUi(new On),In.prototype=Object.create(gn.prototype),In.prototype.init=function(){var t;this.options.persist&&(t=this.raptor.persist("docked")),"undefined"==typeof t&&(t=this.options.docked),"undefined"==typeof t&&(t=!1),t&&(this.raptor.bind("toolbarReady",function(){t&&this.toggleState()}.bind(this)),this.raptor.bind("toolbarHide",function(){this.dockState&&this.dockState.spacer&&(this.dockState.spacer.addClass(this.options.baseClass+"-hidden"),this.dockState.spacer.removeClass(this.options.baseClass+"-visible"))}.bind(this)),this.raptor.bind("toolbarShow",function(){this.dockState&&this.dockState.spacer&&(this.dockState.spacer.removeClass(this.options.baseClass+"-hidden"),this.dockState.spacer.addClass(this.options.baseClass+"-visible"))}.bind(this)),this.raptor.bind("toolbarDestroy",function(){this.dockState&&this.dockState.spacer&&this.dockState.spacer.remove()}.bind(this)))},In.prototype.toggleState=function(){return this.options.dockToElement?this.toggleDockToElement():this.toggleDockToScreen()},In.prototype.toggleDockToElement=function(){this.dockState?"undefined"!=typeof this.dockState.dockedTo?this.undockFromElement():(this.undockFromScreen(),this.dockToElement()):this.dockToElement()},In.prototype.dockToElement=function(){var t=this.options.dockTo?pi(this.options.dockTo):this.raptor.getElement(),e=this.raptor.getLayout("toolbar").getElement();this.marker=pi("<marker>").addClass(this.options.baseClass+"-marker").insertAfter(e),e.addClass(this.options.baseClass+"-docked-to-element"),this.dockState=M(e,t,{position:this.options.position,spacer:!1,wrapperClass:this.options.baseClass+"-inline-wrapper"}),this.activateButton(this.raptor.getPlugin("dockToElement")),this.raptor.persist("docked",!0)},In.prototype.undockFromElement=function(){this.marker.replaceWith(L(this.dockState)),this.dockState=null,this.raptor.getLayout("toolbar").getElement().removeClass(this.options.baseClass+"-docked-to-element"),this.deactivateButton(this.raptor.getPlugin("dockToElement")),this.raptor.persist("docked",!1)},In.prototype.toggleDockToScreen=function(){this.dockState?"undefined"!=typeof this.dockState.dockedTo?(this.undockFromElement(),this.dockToScreen()):this.undockFromScreen():this.dockToScreen()},In.prototype.dockToScreen=function(){if(!this.dockState){var t=this.raptor.getLayout("toolbar");if(t.isReady()){var e=t.getElement();this.marker=pi("<marker>").addClass(this.options.baseClass+"-marker").insertAfter(e),e.addClass(this.options.baseClass+"-docked"),t.disableDragging(),this.dockState=I(e,{position:this.options.position,spacer:this.options.spacer,under:this.options.under}),t.isVisible()||(this.dockState.spacer.removeClass(this.options.baseClass+"-visible"),this.dockState.spacer.addClass(this.options.baseClass+"-hidden")),this.activateButton(this.raptor.getPlugin("dockToScreen")),this.raptor.persist("docked",!0)}}},In.prototype.undockFromScreen=function(){if(this.dockState){var t=this.raptor.getLayout("toolbar"),e=P(this.dockState);this.marker.replaceWith(e),t.enableDragging(),t.constrainPosition(),this.dockState=null,e.removeClass(this.options.baseClass+"-docked"),this.deactivateButton(this.raptor.getPlugin("dockToScreen")),this.raptor.persist("docked",!1)}},In.prototype.deactivateButton=function(t){"undefined"!=typeof t&&"undefined"!=typeof t.button&&rn(t.button)},In.prototype.activateButton=function(t){"undefined"!=typeof t&&"undefined"!=typeof t.button&&an(t.button)},yi.registerPlugin(new In),yi.registerUi(new wn({name:"dockToScreen",action:function(){this.raptor.unify(function(t){t.plugins.dock.toggleDockToScreen()})}})),yi.registerUi(new wn({name:"dockToElement",action:function(){this.raptor.unify(function(t){t.plugins.dock.toggleDockToElement()})}})),yi.registerUi(new kn({name:"embed",state:null,dialogOptions:{width:600,height:400},applyAction:function(t){this.raptor.actionApply(function(){pe(t.find("textarea").val())})},getDialogTemplate:function(){var t=pi("<div>").html(this.raptor.getTemplate("embed.dialog",this.options));t.find("textarea").change(function(e){t.find("."+this.options.baseClass+"-preview").html(pi(e.target).val())}.bind(this));var e=t.find("."+this.options.baseClass+"-panel-tabs");return e.find("li").click(function(){e.find("ul li").removeClass("ui-state-active").removeClass("ui-tabs-selected"),pi(this).addClass("ui-state-active").addClass("ui-tabs-selected"),e.children("div").hide().eq(pi(this).index()).show()}),t}})),yi.registerUi(new Tn({name:"floatLeft",applyToElement:function(t){t.removeClass(this.options.cssPrefix+"float-right"),t.toggleClass(this.options.cssPrefix+"float-left"),E(t,["class"])},getElement:function(t){var e=pi(t.commonAncestorContainer).find("img");return e.length?e:null}})),yi.registerUi(new Tn({name:"floatNone",applyToElement:function(t){t.removeClass(this.options.cssPrefix+"float-right"),t.removeClass(this.options.cssPrefix+"float-left"),E(t,["class"])},getElement:function(t){var e=pi(t.commonAncestorContainer).find("img");return e.length?e:null}})),yi.registerUi(new Tn({name:"floatRight",applyToElement:function(t){t.removeClass(this.options.cssPrefix+"float-left"),t.toggleClass(this.options.cssPrefix+"float-right"),E(t,["class"])},getElement:function(t){var e=pi(t.commonAncestorContainer).find("img");return e.length?e:null}})),Pn.prototype=Object.create(Dn.prototype),Pn.prototype.init=function(){return this.raptor.bind("selectionChange",this.updateButton.bind(this)),this.updateButton(),Dn.prototype.init.apply(this,arguments)},Pn.prototype.updateButton=function(){var t=we()[0],e=this.getButton().getButton(),n=null,i=null;if(Ze(e,c("fontFamilyMenuFontDefault")),tn(e,!1),t){for(var o=0;o<this.options.fonts.length;o++)if(i=pi(t).closest("."+this.options.cssPrefix+"font-"+this.options.fonts[o]),i.length){n=this.options.fonts[o];break}return n?void Ze(e,this.getMenu().find('[data-font="'+n+'"]').text()):void 0}},Pn.prototype.changeFont=function(t){if(De(),"default"===t)we().parents("."+this.options.cssPrefix+"font").addBack().each(function(){var t=pi(this).attr("class");if(null!==t&&"undefined"!=typeof t&&(t=t.match(/(cms-font-(.*?))( |$)/gi),null!==t&&"undefined"!=typeof t))for(var e=0,n=t.length;n>e;e++)pi(this).removeClass(pi.trim(t[e]))});else{var e=q();xe("span",{classes:this.options.classes||this.options.cssPrefix+"font "+this.options.cssPrefix+"font-"+t,attributes:{id:e}});var n=pi("#"+e);if(n.length){fe(n.removeAttr("id").get(0));var i;do i=pi("#"+e),i.removeAttr("id");while(i.length)}}},Pn.prototype.menuItemMouseEnter=function(t){this.raptor.actionPreview(function(){this.changeFont(pi(t.currentTarget).data("font"))}.bind(this))},Pn.prototype.menuItemMouseLeave=function(){this.raptor.actionPreviewRestore()},Pn.prototype.menuItemClick=function(t){Dn.prototype.menuItemClick.apply(this,arguments),this.raptor.actionApply(function(){this.changeFont(pi(t.currentTarget).data("font"))}.bind(this))},Pn.prototype.getMenuItems=function(){for(var t=this.raptor.getTemplate("font-family.menu-item",{fontName:"default",fontTitle:c("fontFamilyMenuFontDefault")}),e=0,n=this.options.fonts.length;n>e;e++)t+=this.raptor.getTemplate("font-family.menu-item",{fontName:this.options.fonts[e],fontTitle:c(("fontFamilyMenuFont-"+this.options.fonts[e]).replace(/-([a-z])/g,function(t){return t[1].toUpperCase()}))});return t},yi.registerUi(new Pn),yi.registerUi(new Cn({name:"guides",action:function(){this.raptor.getElement().toggleClass(this.getClassName()),this.updateButtonState()},updateButtonState:function(){this.raptor.getElement().hasClass(this.getClassName())?an(this.button):rn(this.button)},init:function(){return this.raptor.bind("cancel",this.removeClass.bind(this)),this.raptor.bind("saved",this.removeClass.bind(this)),Cn.prototype.init.call(this)},removeClass:function(){this.raptor.getElement().removeClass(this.getClassName())},getClassName:function(){return this.options.baseClass+"-visible"},mouseEnter:function(){Cn.prototype.mouseEnter.call(this),this.updateButtonState()},mouseLeave:function(){Cn.prototype.mouseLeave.call(this),this.updateButtonState()}})),yi.registerUi(new wn({name:"historyRedo",hotkey:["ctrl+y","ctrl+shift+z"],action:function(){this.raptor.historyForward()},init:function(){return this.raptor.bind("historyChange",this.historyChange.bind(this)),wn.prototype.init.apply(this,arguments),on(this.button),this.button},historyChange:function(){this.raptor.present<this.raptor.history.length-1?en(this.button):on(this.button)}})),yi.registerUi(new wn({name:"historyUndo",hotkey:"ctrl+z",action:function(){this.raptor.historyBack()},init:function(){return this.raptor.bind("historyChange",this.historyChange.bind(this)),wn.prototype.init.apply(this,arguments),on(this.button),this.button},historyChange:function(){0===this.raptor.present?on(this.button):en(this.button)}})),yi.registerUi(new Cn({name:"hrCreate",action:function(){pe("<hr/>")}})),yi.registerUi(new kn({name:"imageResize",proportional:!0,image:null,dialogOptions:{width:450},action:function(){var t=this.getDialog();this.image=d(this.layout.target),this.originalWidth=this.layout.target.width,this.originalHeight=this.layout.target.height,t.find("[name=width]").val(this.layout.target.width),t.find("[name=height]").val(this.layout.target.height),this.openDialog()},applyAction:function(){var t=this.getDialog(),e=t.find("[name=width]").val(),n=t.find("[name=height]").val();this.raptor.actionApply(function(){pi("#"+this.image).css({width:e,height:n}).attr("width",e).attr("height",n),ge(pi("#"+this.image)[0])}.bind(this))},getDialogTemplate:function(){var t=pi("<div>").html(this.raptor.getTemplate("image-resize.dialog",this.options)),e=this;t.find("."+this.options.baseClass+"-lock-proportions").hover(function(){pi(this).addClass("ui-state-hover")},function(){pi(this).removeClass("ui-state-hover")}).click(function(){xi[e.name].instance.proportional=!xi[e.name].instance.proportional,pi(this).find(".ui-icon").toggleClass("ui-icon-locked",e.proportional).toggleClass("ui-icon-unlocked",!e.proportional)});var n=t.find("[name=width]"),i=t.find("[name=height]");return n.on("input.raptor",function(){var t=parseInt(pi(this).val());isNaN(t)||xi[e.name].instance.proportional&&i.val(Math.round(Math.abs(xi[e.name].instance.originalHeight/xi[e.name].instance.originalWidth*t)))}),i.on("input.raptor",function(){var t=parseInt(pi(this).val());isNaN(t)||xi[e.name].instance.proportional&&n.val(Math.round(Math.abs(xi[e.name].instance.originalWidth/xi[e.name].instance.originalHeight*t)))}),t}})),yi.registerUi(new wn({name:"imageSwap",chooser:null,click:function(){ge(this.layout.target),this.raptor.getPlugin(this.options.chooser).action(this.layout.target)}})),yi.registerUi(new kn({name:"insertFile",state:!1,imageTypes:["jpeg","jpg","png","gif"],options:{customAction:!1},action:function(t){return this.options.customAction&&this.options.customAction.call(this,t)!==!1?void 0:("undefined"!=typeof t?(this.getDialog().find("[name=location]").val(t.getAttribute("src")||t.getAttribute("href")),this.getDialog().find("[name=name]").val(t.innerHTML)):(this.getDialog().find("[name=location]").val(""),this.getDialog().find("[name=name]").val("")),this.openDialog())},applyAction:function(){var t=this.getDialog(),e=t.find("[name=location]").val(),n=t.find("[name=name]").val();this.raptor.actionApply(function(){this.insertFiles([{location:e,name:n}])}.bind(this))},getDialogTemplate:function(){return pi(this.raptor.getTemplate("insert-file.dialog"))},getFileType:function(t){if("undefined"!=typeof t.extension)return t.extension.toLowerCase();var e=t.location.split(".");return e.length>0?e.pop().toLowerCase():"unknown"},isImage:function(t){return-1!==pi.inArray(this.getFileType(t),this.imageTypes)},insertFiles:function(t){this.raptor.resume(),t.length&&this.raptor.actionApply(function(){1===t.length&&(this.isImage(t[0])&&pi(be()).is("img")||Ce())?this.replaceFiles(t):this.linkFiles(t)}.bind(this))},linkFiles:function(t){Ae("a",this.raptor.getElement()),Oe();var e=rangy.createApplier({tag:"a",attributes:{href:t[0].location.replace(/([^:])\/\//g,"$1/"),title:t[0].name,"class":this.options.cssPrefix+"file "+this.options.cssPrefix+this.getFileType(t[0])}});e.applyToSelection()},replaceFiles:function(t){for(var e=[],n=0;n<t.length;n++)e.push(this.prepareElement(t[n]));pe(e.join(", "))},prepareElement:function(t,e){return this.isImage(t)?this.prepareImage(t,this.options.cssPrefix+this.getFileType(t),e):this.prepareAnchor(t,this.options.cssPrefix+"file "+this.options.cssPrefix+this.getFileType(t),e)},prepareImage:function(t,e,n){return pi("<div/>").html(pi("<img/>").attr({src:t.location.replace(/([^:])\/\//g,"$1/"),title:n||t.name,"class":e})).html()},prepareAnchor:function(t,e,n){return pi("<div/>").html(pi("<a/>").attr({href:t.location.replace(/([^:])\/\//g,"$1/"),title:t.name,"class":e}).html(n||t.name)).html()}})),Mn.prototype=Object.create(Dn.prototype),Mn.prototype.init=function(){var t=Nn.prototype.init.call(this);return Ze(this.button.button,ci[ri]),tn(this.button.button,"ui-icon-flag-"+ri.toLowerCase()),t},Mn.prototype.menuItemClick=function(t){var e=pi(t.currentTarget).data("value");this.options.persist&&yi.persist("locale",e),setTimeout(function(){s(e)},1)},Mn.prototype.getMenuItems=function(){var t="";for(var e in li)t+=this.raptor.getTemplate("language-menu.item",{label:ci[e],value:e,icon:e.toLowerCase()});return t},yi.registerUi(new Mn);var _i,Ti,Si,ki;yi.registerUi(new En({name:"linkCreate",dialogOptions:{width:850},applyAction:function(){this.raptor.actionApply(function(){if(ki&&""!==ki.href.trim()){var t=window.getSelection().getRangeAt(0);if("A"!==t.commonAncestorContainer.tagName){De(),Ae("a",this.raptor.getElement()),Oe();var e=rangy.createApplier({tag:"a",attributes:ki});e.applyToSelection(),R(this.raptor.getElement(),["a"])}else for(var n in ki)t.commonAncestorContainer.setAttribute(n,ki[n])}}.bind(this))},openDialog:function(){this.getDialog();var t=ye();if(t.is("a"))for(var e=0,n=Ti.length;n>e;e++){var i=Ti[e].updateInputs(t,Si.children("div:eq("+e+")"));i&&_i.find(":radio:eq("+e+")").trigger("click")}En.prototype.openDialog.call(this)},validateDialog:function(){var t=_i.find(":radio:checked").val();return ki=Ti[t].getAttributes(Si.children("div:eq("+t+")")),ki!==!1},selectionToggle:function(){var t=ye();return t&&t.closest("a").length?!0:!1},getDialogTemplate:function(){var t=pi(this.raptor.getTemplate("link.dialog",this.options));_i=t.find("[data-menu]"),Si=t.find("[data-content]"),Ti=[new Fn(this.raptor),new Bn(this.raptor),new Ln(this.raptor),new $n(this.raptor)];for(var e=0,n=Ti.length;n>e;e++)pi(this.raptor.getTemplate("link.label",Ti[e])).click(function(){Si.children("div").hide(),Si.children("div:eq("+pi(this).index()+")").show()}).find(":radio").val(e).end().appendTo(_i),pi("<div>").append(Ti[e].getContent()).hide().appendTo(Si);return _i.find(":radio:first").prop("checked",!0),Si.children("div:first").show(),t}})),yi.registerUi(new _n({name:"linkRemove",disable:!0,action:function(){this.raptor.actionApply(function(){document.execCommand("unlink")}.bind(this))},selectionToggle:function(){var t=ye();return t&&t.closest("a").length?!0:!1}})),Ln.prototype=Object.create(Bn.prototype),Ln.prototype.getContent=function(){return this.raptor.getTemplate("link.document",this.raptor.options)},$n.prototype.getContent=function(){return this.raptor.getTemplate("link.email",this.raptor.options)},$n.prototype.getAttributes=function(t){var e=t.find("[name=email]").val(),n=t.find("[name=subject]").val();return pi.trim(n)&&(n="?Subject="+encodeURIComponent(n)),""===pi.trim(e)?!1:{href:"mailto:"+e+n}},$n.prototype.updateInputs=function(t,e){var n=!1;if(email="",subject="",href=t.attr("href"),0===href.indexOf("mailto:")){var i=href.indexOf("?Subject=");i>0?(email=href.substring(7,i),subject=href.substring(i+9)):(email=href.substring(7),subject=""),n=!0}return e.find("[name=email]").val(email),e.find("[name=subject]").val(subject),n},Bn.prototype.getContent=function(){return this.raptor.getTemplate("link.external",this.raptor.options)},Bn.prototype.getAttributes=function(t){var e=t.find("[name=location]").val(),n=t.find("[name=blank]").is(":checked"),i={href:e};return n&&(i.target="_blank"),"http://"===pi.trim(i.href)?!1:i},Bn.prototype.updateInputs=function(t,e){var n=!1,i=t.attr("href");return 0===i.indexOf("http://")?(e.find("[name=location]").val(i),n=!0):e.find("[name=location]").val("http://"),"_blank"===t.attr("target")?e.find("[name=blank]").prop("checked",!0):e.find("[name=blank]").prop("checked",!1),n},Fn.prototype.getContent=function(){return this.raptor.getTemplate("link.internal",{baseClass:this.raptor.options.baseClass,domain:window.location.protocol+"//"+window.location.host})},Fn.prototype.getAttributes=function(t){var e=t.find("[name=location]").val(),n=t.find("[name=blank]").is(":checked"),i={href:e};return n&&(i.target="_blank"),i},Fn.prototype.updateInputs=function(t,e){var n=t.attr("href");return e.find("[name=location]").val(-1===n.indexOf("http://")&&-1===n.indexOf("mailto:")?n:""),"_blank"===t.attr("target")?e.find("[name=blank]").prop("checked",!0):e.find("[name=blank]").prop("checked",!1),!1},yi.registerUi(new wn({name:"listOrdered",action:function(){document.execCommand("insertOrderedList")}})),yi.registerUi(new wn({name:"listUnordered",action:function(){document.execCommand("insertUnorderedList")}})),yi.registerUi(new wn({name:"logo",action:function(){window.open("http://www.raptor-editor.com/about/VERSION","_blank")}})),Hn.prototype=Object.create(gn.prototype),Hn.prototype.init=function(){this.raptor.getElement().on("keypress.raptor",this.preventReturn.bind(this)),this.raptor.getElement().on("drop.raptor",this.preventDrop.bind(this))},Hn.prototype.preventReturn=function(t){return this.options.enabled&&13===t.which?!1:void 0},Hn.prototype.preventDrop=function(){return this.options.enabled},yi.registerPlugin(new Hn),jn.prototype=Object.create(gn.prototype),jn.prototype.init=function(){this.raptor.registerHotkey("return",this.returnPressed.bind(this)),this.raptor.registerHotkey("shift+return",this.shiftReturnPressed.bind(this))},jn.prototype.returnPressedList=function(t){var e=t.closest("li");if(!e.length)return!1;var n=e.closest("ul, ol"),i=n.get(0).tagName.toLowerCase(),o=!1;if(z(e)){var a=e.next();a.length&&a.is("li")?(o=listBreakByReplacingSelection(i,"li",this.raptor.getElement(),"<p>&nbsp;</p>"),o&&fe(o.get(0))):(e.remove(),fe(pi("<p>&nbsp;</p>").insertAfter(n).get(0)))}else o=listBreakAtSelection(i,"li",this.raptor.getElement()),o&&ve(o.get(0));return!0},jn.prototype.returnPressed=function(){var t=ye();return this.returnPressedList(t)?!0:!1},jn.prototype.shiftReturnPressedList=function(t){if(t.closest("li").length){var e=t.closest("ul, ol").get(0).tagName.toLowerCase(),n=listBreakByReplacingSelection(e,"li",this.raptor.getElement(),"<p>&nbsp;</p>");return n&&fe(n.get(0)),!0}return!1},jn.prototype.shiftReturnPressed=function(){var t=ye();return this.shiftReturnPressedList(t)?!0:!1},yi.registerPlugin(new jn);var Ei=!1,Ri=null,Ni=null,Di=null;Un.prototype=Object.create(gn.prototype),Un.prototype.enable=function(){this.raptor.getElement().on("paste.raptor",this.capturePaste.bind(this))},Un.prototype.capturePaste=function(t){if(!Di){if(Ei)return!1;le();var e=this.raptor.getNode(),n=e.innerHTML;return e&&e.clipboardData&&t.clipboardData.getData?(e.innerHTML=/text\/html/.test(t.clipboardData.types)?t.clipboardData.getData("text/html"):/text\/plain/.test(t.clipboardData.types)?t.clipboardData.getData("text/plain"):"",this.waitForPasteData(e,n),t.stopPropagation(),t.preventDefault(),!1):(e.innerHTML="",this.waitForPasteData(e,n),!0)}},Un.prototype.waitForPasteData=function(t,e){t.childNodes&&t.childNodes.length>0?this.processPaste(t,e):setTimeout(function(){this.waitForPasteData(t,e)}.bind(this),20)},Un.prototype.processPaste=function(t,e){var n=t.innerHTML;t.innerHTML=e,this.showPasteDialog(n)},Un.prototype.showPasteDialog=function(t){cn(this.getDialog(this,t))},Un.prototype.pasteContent=function(t){this.raptor.actionApply(function(){var e=q();ce(),t=this.filterAttributes(t),t=this.filterChars(t),pe(pi('<placeholder id="'+e+'">'+t+"</placeholder>"));var n=pi("#"+e);fe(n.get(0)),le(),n.contents().unwrap(),ce()}.bind(this))},Un.prototype.getDialog=function(t,e){if(Ni=t,!Ri){Ri=pi("<div>").html(this.raptor.getTemplate("paste.dialog",this.options));for(var n=0,i=this.options.panels.length;i>n;n++)Ri.find("."+this.options.baseClass+"-tab-"+this.options.panels[n]).css("display",""),0===n&&Ri.find("."+this.options.baseClass+"-content-"+this.options.panels[n]).css("display","");Ri.find("."+this.options.baseClass+"-panel-tabs > div:visible:not(:first)").hide(),ln(Ri,{modal:!0,resizable:!0,autoOpen:!1,width:800,height:500,title:c("pasteDialogTitle"),dialogClass:this.options.baseClass+"-dialog",close:function(){Ei=!1},buttons:[{text:c("pasteDialogOKButton"),click:function(){var t=null,e=Ri.find("."+this.options.baseClass+"-area:visible");t=e.hasClass(this.options.baseClass+"-plain")||e.hasClass(this.options.baseClass+"-source")?e.val():e.html(),dn(Ri),Ni.pasteContent(t)}.bind(this),icons:{primary:"ui-icon-circle-check"}},{text:c("pasteDialogCancelButton"),click:function(){de(),dn(Ri)},icons:{primary:"ui-icon-circle-close"}}]});var o=Ri.find("."+this.options.baseClass+"-panel-tabs");o.find("li").click(function(){o.find("ul li").removeClass("ui-state-active").removeClass("ui-tabs-selected"),pi(this).addClass("ui-state-active").addClass("ui-tabs-selected"),o.children("div").hide().eq(pi(this).index()).show()})}return this.updateAreas(e),Ri},Un.prototype.filterAttributes=function(t){var e=[{regexp:/(<meta\s*[^>]*\s*>)|(<\s*link\s* href="file:[^>]*\s*>)|(<\/?\s*\w+:[^>]*\s*>)/gi,handler:""},{regexp:/(class="Mso[^"]*")|(<!--(.|\s){1,}?-->)/gi,handler:""},{regexp:/(class="Apple-(style|converted)-[a-z]+\s?[^"]+")/,handle:""},{regexp:/id="internal-source-marker_[^"]+"|dir="[rtl]{3}"/,handle:""},{regexp:/(<p[^>]*>\s*(\&nbsp;|\u00A0)*\s*<\/p[^>]*>)|(<p[^>]*>\s*<font[^>]*>\s*(\&nbsp;|\u00A0)*\s*<\/\s*font\s*>\s<\/p[^>]*>)/gi,handler:""},{regexp:/(style="[^"]*mso-[^;][^"]*")|(style="margin:\s*[^;"]*;")/gi,handler:""},{regexp:/(?:<style([^>]*)>([\s\S]*?)<\/style>|<link\s+(?=[^>]*rel=['"]?stylesheet)([^>]*?href=(['"])([^>]*?)\4[^>\/]*)\/?>)/gi,handler:""},{regexp:/(<\s*script[^>]*>((.|\s)*?)<\\?\/\s*script\s*>)|(<\s*script\b([^<>]|\s)*>?)|(<[^>]*=(\s|)*[("|')]javascript:[^$1][(\s|.)]*[$1][^>]*>)/gi,handler:""}];return pi.each(e,function(e,n){t=t.replace(n.regexp,n.handler)}),t},Un.prototype.filterChars=function(t){var e=t;return e=e.replace(/[\u2018|\u2019|\u201A]/g,"'"),e=e.replace(/[\u201C|\u201D|\u201E]/g,'"'),e=e.replace(/\u2026/g,"..."),e=e.replace(/[\u2013|\u2014]/g,"-"),e=e.replace(/\u02C6/g,"^"),e=e.replace(/\u2039/g,"<"),e=e.replace(/\u203A/g,">"),e=e.replace(/[\u02DC|\u00A0]/g," ")},Un.prototype.stripAttributes=function(t){t=pi("<div/>").html(t);var e=this.options.allowedAttributes;return pi(t.find("*")).each(function(){var t=[];pi.each(this.attributes,function(n,i){-1===pi.inArray(i.nodeName,e)&&t.push(i.nodeName)});for(var n=0;n<t.length;n++)pi(this).attr(t[n],null)}),t.html()},Un.prototype.stripEmpty=function(t){var e=pi("<div/>").html(t),n=this.options.allowedEmptyTags;return e.find("*").filter(function(){return-1!==pi.inArray(this.tagName.toLowerCase(),n)?!1:pi(this).find(n.join(",")).length?!1:""===pi.trim(pi(this).text())}).remove(),e.html()},Un.prototype.stripSpans=function(t){var e=pi("<div/>").html(t);return e.find("span").each(function(){this.attributes.length||pi(this).replaceWith(pi(this).html())}),e.html()},Un.prototype.updateAreas=function(t){var e=t;e=this.filterAttributes(e),e=this.filterChars(e),e=this.stripEmpty(e),e=this.stripAttributes(e),e=this.stripSpans(e),e=Be(e,this.options.allowedTags);var n=pi("<div/>").html(t).text(),i=t;Ri.find("."+this.options.baseClass+"-plain").val(pi("<div/>").html(n).text()),Ri.find("."+this.options.baseClass+"-rich").html(e),Ri.find("."+this.options.baseClass+"-source").html(i),Ri.find("."+this.options.baseClass+"-markup").html(e)},pi(document).on("keyup.raptor keydown.raptor",function(t){Di=t.shiftKey}),yi.registerPlugin(new Un),zn.prototype=Object.create(gn.prototype),zn.prototype.init=function(){this.raptor.bind("enabled",this.enabled.bind(this)),this.raptor.bind("change",this.check.bind(this))},zn.prototype.enabled=function(){this.check(this.raptor.getHtml())},zn.prototype.check=function(t){if(t=t.trim(),!t||"<br>"===t||"<div><br></div>"===t){var e=this.raptor.getNode(),n=document.createElement(this.options.tag);n.innerHTML=this.options.content,e.innerHTML="",e.appendChild(n),this.options.select&&fe(e.childNodes[0]),this.raptor.checkChange()}},yi.registerPlugin(new zn),yi.registerUi(new wn({name:"save",action:function(){this.getPlugin()?this.getPlugin().save():un({text:c("saveNotConfigured"),type:"error"})},init:function(){if(null!==this.options.plugin){var t=wn.prototype.init.apply(this,arguments);return this.raptor.bind("dirty",this.dirty.bind(this)),this.raptor.bind("cleaned",this.clean.bind(this)),this.clean(),t}},getPlugin:function(){return this.raptor.getPlugin(this.options.plugin)},dirty:function(){en(this.button)},clean:function(){on(this.button)}})),Wn.prototype=Object.create(gn.prototype),yi.registerPlugin(new Wn),Wn.prototype.save=function(t){"undefined"!=typeof RaptorSection&&t!==!1&&RaptorSection.save(!1);var e={};this.raptor.unify(function(t){if(t.isDirty()){t.clean();var n=t.getPlugin("saveJson"),i=n.options.id.call(n),o=t.getHtml();e[i]=o}}.bind(this));var n={};this.size=Object.keys(e).length,n[this.options.postName]=JSON.stringify(e),pi.ajax({type:this.options.type||"post",dataType:this.options.dataType||"json",url:this.options.url,data:n}).done(this.done.bind(this)).fail(this.fail.bind(this))},Wn.prototype.done=function(t,e,n){this.raptor.unify(function(i){i.isDirty()&&i.saved([t,e,n])});var i=c("saveJsonSaved",{saved:this.size});pi.isFunction(this.options.formatResponse)&&(i=this.options.formatResponse(t)),un({text:i,type:"success"}),this.options.retain||this.raptor.unify(function(t){t.disableEditing()})},Wn.prototype.fail=function(){un({text:c("saveJsonFail",{failed:this.size}),type:"error"})},Gn.prototype=Object.create(gn.prototype),Gn.prototype.save=function(){this.requests=0,this.errors=[],this.messages=[],this.raptor.unify(function(t){if(t.isDirty()){this.requests++;var e=t.getPlugin("saveRest").sendRequest();e.raptor=t,e.done(this.done.bind(this)).fail(this.fail.bind(this)).always(this.always.bind(this))}}.bind(this))},Gn.prototype.done=function(t,e,n){n.raptor.saved(),this.messages.push(t)},Gn.prototype.fail=function(t){this.errors.push(t.responseText)},Gn.prototype.always=function(){this.requests--,0===this.requests&&(this.errors.length>0&&0===this.messages.length?un({text:c("saveRestFail",{failed:this.errors.length}),type:"error"}):this.errors.length>0?un({text:c("saveRestPartial",{saved:this.messages.length,failed:this.errors.length}),type:"error"}):(un({text:c("saveRestSaved",{saved:this.messages.length}),type:"success"}),this.options.retain||this.raptor.unify(function(t){t.disableEditing()})))},Gn.prototype.sendRequest=function(){var t=this.raptor.getPlugin("saveRest").getHeaders(),e=this.raptor.getPlugin("saveRest").getData(),n=this.raptor.getPlugin("saveRest").getURL();return pi.ajax({type:this.options.type||"post",dataType:this.options.dataType||"json",headers:t,data:e,url:n})},Gn.prototype.getHeaders=function(){return this.options.headers?this.options.headers.call(this):{}},Gn.prototype.getData=function(){this.raptor.clean();var t=this.raptor.getHtml(),e=this.options.data.call(this,t);return e._method=this.method,e},Gn.prototype.getURL=function(){return"string"==typeof this.options.url?this.options.url:this.options.url.call(this)},yi.registerPlugin(new Gn),qn.prototype=Object.create(Dn.prototype),qn.prototype.init=function(){var t=Dn.prototype.init.call(this);return"undefined"!=typeof this.options.snippets&&Object.keys(this.options.snippets).length>0?t:void 0},qn.prototype.insertSnippet=function(t){pe(this.options.snippets[t])},qn.prototype.menuItemMouseDown=function(t){this.raptor.actionApply(function(){this.insertSnippet(pi(t.currentTarget).data("name"))}.bind(this))},qn.prototype.menuItemMouseEnter=function(t){this.raptor.actionPreview(function(){this.insertSnippet(pi(t.currentTarget).data("name"))}.bind(this))},qn.prototype.menuItemMouseLeave=function(){this.raptor.actionPreviewRestore()},qn.prototype.getMenuItems=function(){var t="";for(var e in this.options.snippets)t+=this.raptor.getTemplate("snippet-menu.item",{name:e});return t},yi.registerUi(new qn);var Ai=!1;yi.registerUi(new kn({name:"specialCharacters",dialogOptions:{width:645},options:{setOrder:["symbols","mathematics","arrows","greekAlphabet"],characterSets:{symbols:{name:c("specialCharactersSymbols"),characters:[["<","&lt;","less than"],[">","&gt;","greater than"],["&","&amp;","ampersand"],['"',"&quot;","quotation mark"],["&nbsp;","non-breaking space: ' '"],["&emsp;","em space: '  '"],["&ensp;","en space: ' '"],["&thinsp;","thin space: ''"],["&mdash;","em dash"],["&ndash;","en dash"],["&minus;","minus"],["-","hyphen"],["&oline;","overbar space"],["&cent;","cent"],["&pound;","pound"],["&euro;","euro"],["&sect;","section"],["&dagger;","dagger"],["&Dagger;","double dagger"],["&lsquo;","left single quotes"],["&rsquo;","right single quotes"],["'","single quotes"],["&#x263a;","smiley face"],["&#x2605;","black star"],["&#x2606;","white star"],["&#x2610;","check box"],["&middot;","middle dot"],["&bull;","bullet"],["&copy;","copyright"],["&reg;","registered"],["&trade;","trade"],["&iquest;","inverted question mark"],["&iexcl;","inverted exclamation mark"],["&Aring;","AngstrÃ¶m"],["&hellip;","ellipsis"],["&#x2295;","earth"],["&#x2299;","sun"],["&#x2640;","female"],["&#x2642;","male"],["&clubs;","clubs or shamrock"],["&spades;","spades"],["&hearts;","hearts or valentine"],["&diams;","diamonds"],["&loz;","diamond"]]},mathematics:{name:c("specialCharactersMathematics"),characters:[["&lt;","less than"],["&le;","less than or equal to"],["&gt;","greater than"],["&ge;","greater than or equal to"],["&ne;","not equal"],["&asymp;","approximately equal to"],["&equiv;","identically equal to"],["&cong;","congruent to"],["&prop;","proportional"],["&there4;","therefore"],["&sum;","summation"],["&prod;","product"],["&prime;","prime or minutes"],["&Prime;","double prime or seconds"],["&Delta;","delta"],["&nabla;","del"],["&part;","partial"],["&int;","integral"],["&middot;","middle dot"],["&sdot;","dot operator"],["&bull;","bullet"],["&minus;","minus sign"],["&times;","multipllcation sign"],["&divide;","division sign"],["&frasl;","fraction slash, (ordinary / \\)"],["&plusmn;","plus or minus"],["&deg;","degree sign"],["&lfloor;","floor function"],["&rfloor;","floor function"],["&lceil;","ceiling function"],["&rceil;","ceiling function"],["&lowast;","asterisk operator, (ordinary *)"],["&oplus;","circled plus"],["&otimes;","circled times"],["&ordm;","masculine ordinal"],["&lang;","bra"],["&rang;","ket"],["&infin;","infinity"],["&pi;","pi"],["&frac12;","half"],["&alefsym;","aleph"],["&radic;","radical"],["&ang;","angle"],["&perp;","perpendicular"],["&real;","real"],["&isin;","is an element of"],["&notin;","not an element of"],["&empty;","null set"],["&sub;","subset of"],["&sube;","subset or or equal to"],["&nsub;","not a subset"],["&cap;","intersection"],["&cup;","union"],["&sim;","tilde operator (ordinary ~)"],["&Oslash;","slash O"],["&and;","logical and"],["&Lambda;","lambda (and)"],["&or;","logical or"],["&not;","not sign"],["&sim;","tilde operator (ordinary ~)"],["&rarr;","right arrow"],["&rArr;","double right arrow"],["&larr;","left arrow"],["&lArr;","left double arrow"],["&harr;","left right arrow"],["&hArr;","left right double arrow"]]},arrows:{name:c("specialCharactersArrows"),characters:[["&darr;","down arrow"],["&dArr;","down double arrow"],["&uarr;","up arrow"],["&uArr;","up double arrow"],["&crarr;","arriage return arrow"],["&rarr;","right arrow"],["&rArr;","double right arrow"],["&larr;","left arrow"],["&lArr;","left double arrow"],["&harr;","left right arrow"],["&hArr;","left right double arrow"]]},greekAlphabet:{name:c("specialCharactersGreekAlphabet"),characters:[["&alpha;","alpha"],["&beta;","beta"],["&gamma;","gamma"],["&delta;","delta"],["&epsilon;","epsilon"],["&zeta;","zeta"],["&eta;","eta"],["&theta;","theta"],["&iota;","iota"],["&kappa;","kappa"],["&lambda;","lambda"],["&mu;","mu"],["&nu;","nu"],["&xi;","xi"],["&omicron;","omicron"],["&pi;","pi"],["&rho;","rho"],["&sigma;","sigma"],["&tau;","tau"],["&upsilon;","upsilon"],["&phi;","phi"],["&chi;","chi"],["&psi;","psi"],["&omega;","omega"],["&Alpha;","alpha"],["&Beta;","beta"],["&Gamma;","gamma"],["&Delta;","delta"],["&Epsilon;","epsilon"],["&Zeta;","zeta"],["&Eta;","eta"],["&Theta;","theta"],["&Iota;","iota"],["&Kappa;","kappa"],["&Lambda;","lambda"],["&Mu;","mu"],["&Nu;","nu"],["&Xi;","xi"],["&Omicron;","omicron"],["&Pi;","pi"],["&Rho;","rho"],["&Sigma;","sigma"],["&Tau;","tau"],["&Upsilon;","upsilon"],["&Phi;","phi"],["&Chi;","chi"],["&Psi;","psi"],["&Omega;","omega"]]}}},applyAction:function(){this.raptor.actionApply(function(){Ai&&pe(Ai),Ai=!1
})},getDialogTemplate:function(){for(var t,e,n,i,o=pi(this.raptor.getTemplate("special-characters.dialog")).appendTo("body").hide(),a=0;a<this.options.setOrder.length;a++){t=this.options.setOrder[a],o.find("ul").append(this.raptor.getTemplate("special-characters.tab-li",{baseClass:this.options.baseClass,name:this.options.characterSets[t].name,key:t})),e=pi(this.raptor.getTemplate("special-characters.tab-content",{baseClass:this.options.baseClass,key:t}));for(var r=[],s=0;s<this.options.characterSets[t].characters.length;s++)n=this.options.characterSets[t].characters[s],i=this.raptor.getTemplate("special-characters.tab-button",{htmlEntity:n[0],description:n[1],setKey:t,charactersIndex:s}),r.push(i);e.append(r.join("")),o.find("ul").after(e)}o.show();var l=this;return o.find("button").each(function(){Ke(pi(this))}).click(function(){var t=pi(this).attr("data-setKey"),e=pi(this).attr("data-charactersIndex");Ai=l.options.characterSets[t].characters[e][0],l.getOkButton(l.name).click.call(this)}),hn(o),o},getCancelButton:function(){}}));yi.registerUi(new kn({name:"statistics",options:{maximum:100,showCountInButton:!0},dialogOptions:{width:350},init:function(){return this.options.showCountInButton&&this.raptor.bind("change",this.updateButton.bind(this)),kn.prototype.init.apply(this,arguments)},applyAction:function(){},getCancelButton:function(){},getCharacterCount:function(){return pi("<div>").html(this.raptor.getHtml()).text().trim().length},getContent:function(){return pi("<div>").html(this.raptor.getHtml()).text().trim()},updateButton:function(){var t=null,e=null,n=this.getCharacterCount();this.options.maximum?(t=this.options.maximum-n,e=t>=0?c("statisticsButtonCharacterRemaining",{charactersRemaining:t}):c("statisticsButtonCharacterOverLimit",{charactersRemaining:-1*t})):e=c("statisticsButtonCharacters",{characters:n}),Ze(this.button,e),this.options.maximum&&(0>t?this.button.addClass("ui-state-error").removeClass("ui-state-default"):t>=0&&15>=t?this.button.addClass("ui-state-highlight").removeClass("ui-state-error ui-state-default"):this.button.removeClass("ui-state-highlight ui-state-error").addClass("ui-state-default"))},getButton:function(){return this.button||(wn.prototype.getButton.call(this),Ke(this.button,{text:!0}),this.options.showCountInButton&&this.updateButton()),this.button},getDialogTemplate:function(){return pi(this.raptor.getTemplate("statistics.dialog",this.options))},openDialog:function(){var t=this.getDialog(),e=this.getContent(),n=this.options.maximum?this.options.maximum-e.length:"&infin;";t.find("[data-name=truncation]").html(C(n)&&0>n?c("statisticsDialogTruncated",{limit:this.options.maximum}):c("statisticsDialogNotTruncated"));var i=e.split(" ").length;t.find("[data-name=words]").html(1===i?c("statisticsDialogWord",{words:i}):c("statisticsDialogWords",{words:i}));var o=e.split(". ").length;t.find("[data-name=sentences]").html(1===o?c("statisticsDialogSentence",{sentences:o}):c("statisticsDialogSentences",{sentences:o}));t.find("[data-name=characters]").html(n>=0||!C(n)?c("statisticsDialogCharactersRemaining",{characters:e.length,charactersRemaining:n}):c("statisticsDialogCharactersOverLimit",{characters:e.length,charactersRemaining:-1*n})),kn.prototype.openDialog.call(this)}})),Vn.prototype=Object.create(Tn.prototype),Vn.prototype.getElement=function(t){var e=pi(t.commonAncestorContainer.parentNode).closest("td, th");return e.length&&!e.find(this.raptor.getElement()).length?e[0]:null},Yn.prototype=Object.create(Nn.prototype),Yn.prototype.createTable=function(t){this.raptor.actionApply(function(){pe(B(pi(ze(t.target.cellIndex+1,t.target.parentNode.rowIndex+1,{placeHolder:"&nbsp;"}))))})},Yn.prototype.highlight=function(t){var e=Qe(this.menuTable.get(0),{x:0,y:0},{x:t.target.cellIndex,y:t.target.parentNode.rowIndex});this.highlightRemove(t),pi(e).addClass(this.options.baseClass+"-menu-hover"),this.raptor.actionPreview(function(){pe(B(pi(ze(t.target.cellIndex+1,t.target.parentNode.rowIndex+1,{placeHolder:"&nbsp;"}))))})},Yn.prototype.highlightRemove=function(){this.menuTable.find("."+this.options.baseClass+"-menu-hover").removeClass(this.options.baseClass+"-menu-hover"),this.raptor.actionPreviewRestore()},Yn.prototype.getMenu=function(){return this.menu||(this.menuContent=this.raptor.getTemplate("table.create-menu",this.options),Nn.prototype.getMenu.call(this).on("click","td",this.createTable.bind(this)).on("mouseenter","td",this.highlight.bind(this)).mouseleave(this.highlightRemove.bind(this)),this.menuTable=this.menu.find("table:eq(0)")),this.menu},yi.registerUi(new Yn),yi.registerUi(new Vn({name:"tableDeleteColumn",applyToElement:function(t){var e,n=Ye(t),i=t.parentNode.parentNode.parentNode;return Ge(t.parentNode.parentNode.parentNode,n.x),Xe(i)?void i.parentNode.removeChild(i):(e=Je(i,n),!e&&n.x>0&&(e=Je(i,{x:n.x-1,y:n.y})),void fe(e))}})),yi.registerUi(new Vn({name:"tableDeleteRow",applyToElement:function(t){var e,n=Ye(t),i=t.parentNode.parentNode.parentNode;return Ve(t.parentNode.parentNode.parentNode,n.y),Xe(i)?void i.parentNode.removeChild(i):(e=Je(i,n),!e&&n.y>0&&(e=Je(i,{x:n.x,y:n.y-1})),void fe(e))}})),yi.registerUi(new Vn({name:"tableInsertColumn",applyToElement:function(t){We(t.parentNode.parentNode.parentNode,Ye(t).x+1,{placeHolder:"&nbsp;"})}})),yi.registerUi(new Vn({name:"tableInsertRow",applyToElement:function(t){qe(t.parentNode.parentNode.parentNode,Ye(t).y+1,{placeHolder:"&nbsp;"})}})),yi.registerUi(new wn({name:"tableMergeCells",action:function(){}})),yi.registerUi(new wn({name:"tableSplitCells",action:function(){}}));var Oi=!1,Ii=null;Jn.prototype=Object.create(gn.prototype),Jn.prototype.init=function(){this.raptor.bind("selectionCustomise",this.selectionCustomise.bind(this)),this.raptor.registerHotkey("tab",this.tabToNextCell.bind(this)),this.raptor.registerHotkey("shift+tab",this.tabToPrevCell.bind(this)),this.raptor.getElement().on("mousedown","tbody td",this.cellMouseDown.bind(this)).on("mouseover","tbody td",this.cellMouseOver.bind(this)).mouseup(this.cellMouseUp.bind(this))},Jn.prototype.selectionCustomise=function(){var t,e=[];return pi("."+this.options.baseClass+"-cell-selected").each(function(){t=rangy.createRange(),t.selectNodeContents(this),e.push(t)}),e},Jn.prototype.cellMouseDown=function(t){this.raptor.isEditing()&&(Ii=Ye(t.target),null!==Ii&&(Oi=!0,pi(t.target).closest("table").addClass(this.options.baseClass+"-selected")))},Jn.prototype.cellMouseUp=function(t){Oi=!1;var e=pi(t.target).closest("td"),n=!1;if(e.length>0&&null!==Ii){var i=Ye(e.get(0));(null===i||i.x==Ii.x&&i.y==Ii.y)&&(n=!0)}else n=!0;n&&(pi("."+this.options.baseClass+"-selected").removeClass(this.options.baseClass+"-selected"),pi("."+this.options.baseClass+"-cell-selected").removeClass(this.options.baseClass+"-cell-selected"))},Jn.prototype.cellMouseOver=function(t){if(Oi){var e=Qe(pi(t.target).closest("table").get(0),Ii,Ye(t.target));pi("."+this.options.baseClass+"-cell-selected").removeClass(this.options.baseClass+"-cell-selected"),pi(e).addClass(this.options.baseClass+"-cell-selected"),rangy.getSelection().removeAllRanges()}},Jn.prototype.tabToNextCell=function(){var t=rangy.getSelection().getRangeAt(0),e=ne(t),n=pi(e).closest("td");if(0===n.length)return!1;var i=n.next("td");0===i.length&&(i=n.closest("tr").next("tr").find("td:first"),0===i.length&&(i=n.closest("tbody").find("td:first"))),Z(t,i),rangy.getSelection().setSingleRange(t)},Jn.prototype.tabToPrevCell=function(){var t=rangy.getSelection().getRangeAt(0),e=ne(t),n=pi(e).closest("td");if(0===n.length)return!1;var i=n.prev("td");0===i.length&&(i=n.closest("tr").prev("tr").find("td:last"),0===i.length&&(i=n.closest("tbody").find("td:last"))),Z(t,i),rangy.getSelection().setSingleRange(t)},yi.registerPlugin(new Jn),Qn.prototype=Object.create(Dn.prototype),Qn.prototype.init=function(){return this.raptor.bind("selectionChange",this.updateButton.bind(this)),Dn.prototype.init.apply(this,arguments)},Qn.prototype.changeTag=function(t){if("undefined"!=typeof t&&"na"!==t){var e=ye(),n=this.raptor.getElement();if(e&&!e.is(n)){var i=e.closest("td, li, #"+n.attr("id"));0!==i.length&&(n=i)}Pe(t,["h1","h2","h3","h4","h5","h6","p","div","pre","address"],n)}},Qn.prototype.menuItemClick=function(t){Dn.prototype.menuItemClick.apply(this,arguments),this.raptor.actionApply(function(){this.changeTag(pi(t.currentTarget).data("value"))}.bind(this))},Qn.prototype.menuItemMouseEnter=function(t){this.raptor.actionPreview(function(){this.changeTag(pi(t.currentTarget).data("value"))}.bind(this))},Qn.prototype.menuItemMouseLeave=function(){this.raptor.actionPreviewRestore()},Qn.prototype.updateButton=function(){var t=we()[0],e=this.getButton().getButton();if(t){var n=t.tagName.toLowerCase(),i=this.getMenu().find("[data-value="+n+"]");i.length?Ze(e,i.html()):Ze(e,c("tagMenuTagNA"))}},Qn.prototype.getMenuItems=function(){return this.raptor.getTemplate("tag-menu.menu",this.options)},yi.registerUi(new Qn),Xn.prototype=Object.create(_n.prototype),Xn.prototype.action=function(){ke([this.getClass()],[this.options.cssPrefix+"center",this.options.cssPrefix+"left",this.options.cssPrefix+"right",this.options.cssPrefix+"justify"],this.raptor.getElement(),"span"),this.selectionChange()},Xn.prototype.selectionToggle=function(){return rangy.getSelection().getAllRanges().length>0&&Me("."+this.getClass(),this.raptor.getElement())},yi.registerUi(new Xn({name:"alignCenter",getClass:function(){return this.options.cssPrefix+"center"}})),yi.registerUi(new Xn({name:"alignJustify",getClass:function(){return this.options.cssPrefix+"justify"}})),yi.registerUi(new Xn({name:"alignLeft",getClass:function(){return this.options.cssPrefix+"left"}})),yi.registerUi(new Xn({name:"alignRight",getClass:function(){return this.options.cssPrefix+"right"}})),yi.registerUi(new Sn({name:"textBold",hotkey:"ctrl+b",tag:"strong",classes:["bold"]})),yi.registerUi(new Sn({name:"textItalic",hotkey:"ctrl+i",tag:"em",classes:["italic"]})),yi.registerUi(new Sn({name:"textStrike",tag:"del",classes:["strike"]})),yi.registerUi(new wn({name:"textBlockQuote",action:function(){document.execCommand("formatBlock",!1,"<blockquote>")}})),yi.registerUi(new Cn({name:"textSizeDecrease",action:function(){De(),this.raptor.selectionConstrain(),Ne("small",this.options.cssPrefix+"small","big",this.options.cssPrefix+"big"),this.raptor.getElement().find("small."+this.options.cssPrefix+"small:empty, big."+this.options.cssPrefix+"big:empty").remove()}})),yi.registerUi(new Cn({name:"textSizeIncrease",action:function(){De(),this.raptor.selectionConstrain(),Ne("big",this.options.cssPrefix+"big","small",this.options.cssPrefix+"small"),this.raptor.getElement().find("small."+this.options.cssPrefix+"small:empty, big."+this.options.cssPrefix+"big:empty").remove()}})),yi.registerUi(new Sn({name:"textUnderline",hotkey:"ctrl+u",tag:"u",classes:["underline"]})),yi.registerUi(new Sn({name:"textSub",tag:"sub",classes:["sub"]})),yi.registerUi(new Sn({name:"textSuper",tag:"sup",classes:["sup"]})),Kn.prototype=Object.create(gn.prototype),Kn.prototype.init=function(){this.raptor.bind("layoutReady",function(t){pi(t).on("mouseover","[title]",function(){pi(this).attr("data-title",pi(this).attr("title")).removeAttr("title")})})},yi.registerPlugin(new Kn);var Pi=0,Mi=null;Zn.prototype=Object.create(gn.prototype),Zn.prototype.enable=function(){this.raptor.bind("dirty",this.show.bind(this)),this.raptor.bind("cleaned",this.hide.bind(this))},Zn.prototype.show=function(){Pi++,$(this.getElement()),this.getElement().addClass(this.options.baseClass+"-visible")},Zn.prototype.hide=function(){0===--Pi&&this.getElement().removeClass(this.options.baseClass+"-visible")},Zn.prototype.getElement=function(){if(!Mi){var t="raptor-plugin-unsaved-edit-warning-dirty";Mi=pi(this.raptor.getTemplate("unsaved-edit-warning.warning",this.options)).mouseenter(function(){yi.eachInstance(function(e){e.isDirty()&&e.getElement().addClass(t)})}).mouseleave(function(){pi("."+t).removeClass(t)}).appendTo("body")}return Mi},yi.registerPlugin(new Zn),yi.registerUi(new kn({name:"viewSource",dialogOptions:{width:600,height:400},applyAction:function(t){var e=t.find("textarea").val();this.raptor.actionApply(function(){this.raptor.setHtml(e),ve(this.raptor.getElement().first()),this.raptor.checkSelectionChange()}.bind(this))},openDialog:function(){var t=this.getDialog().find("textarea");t.val(this.raptor.getHtml()),kn.prototype.openDialog.call(this),t.select()},getDialogTemplate:function(){return pi("<div>").html(this.raptor.getTemplate("view-source.dialog",this.options))}})),yi.globalDefaults={layouts:{},plugins:{},ui:{},bind:{},namespace:null,unify:!0,persistence:!0,persistenceName:"uiEditor",unloadWarning:!0,autoEnable:!1,partialEdit:!1,autoSelect:"end",enablePlugins:!0,disabledPlugins:[],enableUi:!0,disabledUi:[],replace:!1,replaceStyle:["display","position","float","width","padding-left","padding-right","padding-top","padding-bottom","margin-left","margin-right","margin-top","margin-bottom"],baseClass:"raptor",cssPrefix:"cms-",draggable:!0},yi.registerPreset({name:"full",plugins:{imageSwap:{chooser:"insertFile"}},layouts:{toolbar:{uiOrder:[["logo"],["save","cancel"],["dockToScreen","dockToElement","guides"],["viewSource"],["historyUndo","historyRedo"],["alignLeft","alignCenter","alignJustify","alignRight"],["textBold","textItalic","textUnderline","textStrike"],["textSuper","textSub"],["listUnordered","listOrdered"],["hrCreate","textBlockQuote"],["textSizeDecrease","textSizeIncrease","fontFamilyMenu"],["clearFormatting","cleanBlock"],["linkCreate","linkRemove"],["embed","insertFile"],["floatLeft","floatNone","floatRight"],["colorMenuBasic"],["tagMenu"],["classMenu"],["snippetMenu","specialCharacters"],["tableCreate","tableInsertRow","tableDeleteRow","tableInsertColumn","tableDeleteColumn"],["languageMenu"],["statistics"]]},hoverPanel:{uiOrder:[["clickButtonToEdit"]]},elementHoverPanel:{elements:"img",uiOrder:[["imageResize","imageSwap","close"]]}}},!0),yi.registerPreset({name:"micro",layouts:{toolbar:{uiOrder:[["logo"],["save","cancel"],["dockToScreen","dockToElement"],["historyUndo","historyRedo"],["specialCharacters"],["languageMenu"],["statistics"]]},hoverPanel:{uiOrder:[["clickButtonToEdit","revisions"]]}},plugins:{placeholder:!1,paste:{panels:["plain-text"]},noBreak:{enabled:!0}}}),yi.registerPreset({name:"inline",classes:"raptor-editing-inline",autoEnable:!0,draggable:!1,unify:!1,unloadWarning:!1,reloadOnDisable:!0,plugins:{unsavedEditWarning:!1,dock:{dockToElement:!0,docked:!0,persist:!1}},layouts:{toolbar:{uiOrder:[["textBold","textItalic","textUnderline","textStrike"],["colorMenuBasic"],["textBlockQuote"],["listOrdered","listUnordered"],["textSizeDecrease","textSizeIncrease"],["linkCreate","linkRemove"]]}}})}(),function(){!function(t,e,n){var i,o,a;return a="slidesjs",o={width:940,height:528,start:1,navigation:{active:!0,effect:"slide"},pagination:{active:!0,effect:"slide"},play:{active:!1,effect:"slide",interval:5e3,auto:!1,swap:!0,pauseOnHover:!1,restartDelay:2500},effect:{slide:{speed:500},fade:{speed:300,crossfade:!0}},callback:{loaded:function(){},start:function(){},complete:function(){}}},i=function(){function e(e,n){this.element=e,this.options=t.extend(!0,{},o,n),this._defaults=o,this._name=a,this.init()}return e}(),i.prototype.init=function(){var n,i,o,a,r,s,l=this;return n=t(this.element),this.data=t.data(this),t.data(this,"animating",!1),t.data(this,"total",n.children().not(".slidesjs-navigation",n).length),t.data(this,"current",this.options.start-1),t.data(this,"vendorPrefix",this._getVendorPrefix()),"undefined"!=typeof TouchEvent&&(t.data(this,"touch",!0),this.options.effect.slide.speed=this.options.effect.slide.speed/2),n.css({overflow:"hidden"}),n.slidesContainer=n.children().not(".slidesjs-navigation",n).wrapAll("<div class='slidesjs-container'>",n).parent().css({overflow:"hidden",position:"relative"}),t(".slidesjs-container",n).wrapInner("<div class='slidesjs-control'>",n).children(),t(".slidesjs-control",n).css({position:"relative",left:0}),t(".slidesjs-control",n).children().addClass("slidesjs-slide").css({position:"absolute",top:0,left:0,width:"100%",zIndex:0,display:"none",webkitBackfaceVisibility:"hidden"}),t.each(t(".slidesjs-control",n).children(),function(e){var n;return n=t(this),n.attr("slidesjs-index",e)}),this.data.touch&&(t(".slidesjs-control",n).on("touchstart",function(t){return l._touchstart(t)}),t(".slidesjs-control",n).on("touchmove",function(t){return l._touchmove(t)}),t(".slidesjs-control",n).on("touchend",function(t){return l._touchend(t)})),n.fadeIn(0),this.update(),this.data.touch&&this._setuptouch(),t(".slidesjs-control",n).children(":eq("+this.data.current+")").eq(0).fadeIn(0,function(){return t(this).css({zIndex:10})}),this.options.navigation.active&&(r=t("<a>",{"class":"slidesjs-previous slidesjs-navigation",href:"#",title:"Previous",text:"Previous"}).appendTo(n),i=t("<a>",{"class":"slidesjs-next slidesjs-navigation",href:"#",title:"Next",text:"Next"}).appendTo(n)),t(".slidesjs-next",n).click(function(t){return t.preventDefault(),l.stop(!0),l.next(l.options.navigation.effect)}),t(".slidesjs-previous",n).click(function(t){return t.preventDefault(),l.stop(!0),l.previous(l.options.navigation.effect)}),this.options.play.active&&(a=t("<a>",{"class":"slidesjs-play slidesjs-navigation",href:"#",title:"Play",text:"Play"}).appendTo(n),s=t("<a>",{"class":"slidesjs-stop slidesjs-navigation",href:"#",title:"Stop",text:"Stop"}).appendTo(n),a.click(function(t){return t.preventDefault(),l.play(!0)}),s.click(function(t){return t.preventDefault(),l.stop(!0)}),this.options.play.swap&&s.css({display:"none"})),this.options.pagination.active&&(o=t("<ul>",{"class":"slidesjs-pagination"}).appendTo(n),t.each(new Array(this.data.total),function(e){var n,i;return n=t("<li>",{"class":"slidesjs-pagination-item"}).appendTo(o),i=t("<a>",{href:"#","data-slidesjs-item":e,html:e+1}).appendTo(n),i.click(function(e){return e.preventDefault(),l.stop(!0),l.goto(1*t(e.currentTarget).attr("data-slidesjs-item")+1)})})),t(e).bind("resize",function(){return l.update()}),this._setActive(),this.options.play.auto&&this.play(),this.options.callback.loaded(this.options.start)},i.prototype._setActive=function(e){var n,i;return n=t(this.element),this.data=t.data(this),i=e>-1?e:this.data.current,t(".active",n).removeClass("active"),t(".slidesjs-pagination li:eq("+i+") a",n).addClass("active")},i.prototype.update=function(){var e,n,i;return e=t(this.element),this.data=t.data(this),t(".slidesjs-control",e).children(":not(:eq("+this.data.current+"))").css({display:"none",left:0,zIndex:0}),i=e.width(),n=this.options.height/this.options.width*i,this.options.width=i,this.options.height=n,t(".slidesjs-control, .slidesjs-container",e).css({width:i,height:n})},i.prototype.next=function(e){var n;return n=t(this.element),this.data=t.data(this),t.data(this,"direction","next"),void 0===e&&(e=this.options.navigation.effect),"fade"===e?this._fade():this._slide()},i.prototype.previous=function(e){var n;return n=t(this.element),this.data=t.data(this),t.data(this,"direction","previous"),void 0===e&&(e=this.options.navigation.effect),"fade"===e?this._fade():this._slide()},i.prototype.goto=function(e){var n,i;if(n=t(this.element),this.data=t.data(this),void 0===i&&(i=this.options.pagination.effect),e>this.data.total?e=this.data.total:1>e&&(e=1),"number"==typeof e)return"fade"===i?this._fade(e):this._slide(e);if("string"==typeof e){if("first"===e)return"fade"===i?this._fade(0):this._slide(0);if("last"===e)return"fade"===i?this._fade(this.data.total):this._slide(this.data.total)}},i.prototype._setuptouch=function(){var e,n,i,o;return e=t(this.element),this.data=t.data(this),o=t(".slidesjs-control",e),n=this.data.current+1,i=this.data.current-1,0>i&&(i=this.data.total-1),n>this.data.total-1&&(n=0),o.children(":eq("+n+")").css({display:"block",left:this.options.width}),o.children(":eq("+i+")").css({display:"block",left:-this.options.width})},i.prototype._touchstart=function(e){var n,i;return n=t(this.element),this.data=t.data(this),i=e.originalEvent.touches[0],this._setuptouch(),t.data(this,"touchtimer",Number(new Date)),t.data(this,"touchstartx",i.pageX),t.data(this,"touchstarty",i.pageY),e.stopPropagation()},i.prototype._touchend=function(e){var n,i,o,a,r,s,l,c=this;return n=t(this.element),this.data=t.data(this),s=e.originalEvent.touches[0],a=t(".slidesjs-control",n),a.position().left>.5*this.options.width||a.position().left>.1*this.options.width&&Number(new Date)-this.data.touchtimer<250?(t.data(this,"direction","previous"),this._slide()):a.position().left<-(.5*this.options.width)||a.position().left<-(.1*this.options.width)&&Number(new Date)-this.data.touchtimer<250?(t.data(this,"direction","next"),this._slide()):(o=this.data.vendorPrefix,l=o+"Transform",i=o+"TransitionDuration",r=o+"TransitionTimingFunction",a[0].style[l]="translateX(0px)",a[0].style[i]=.85*this.options.effect.slide.speed+"ms"),a.on("transitionend webkitTransitionEnd oTransitionEnd otransitionend MSTransitionEnd",function(){return o=c.data.vendorPrefix,l=o+"Transform",i=o+"TransitionDuration",r=o+"TransitionTimingFunction",a[0].style[l]="",a[0].style[i]="",a[0].style[r]=""}),e.stopPropagation()},i.prototype._touchmove=function(e){var n,i,o,a,r;return n=t(this.element),this.data=t.data(this),a=e.originalEvent.touches[0],i=this.data.vendorPrefix,o=t(".slidesjs-control",n),r=i+"Transform",t.data(this,"scrolling",Math.abs(a.pageX-this.data.touchstartx)<Math.abs(a.pageY-this.data.touchstarty)),this.data.animating||this.data.scrolling||(e.preventDefault(),this._setuptouch(),o[0].style[r]="translateX("+(a.pageX-this.data.touchstartx)+"px)"),e.stopPropagation()},i.prototype.play=function(e){var n,i,o,a=this;return n=t(this.element),this.data=t.data(this),!this.data.playInterval&&(e&&(i=this.data.current,this.data.direction="next","fade"===this.options.play.effect?this._fade():this._slide()),t.data(this,"playInterval",setInterval(function(){return i=a.data.current,a.data.direction="next","fade"===a.options.play.effect?a._fade():a._slide()},this.options.play.interval)),o=t(".slidesjs-container",n),this.options.play.pauseOnHover&&(o.unbind(),o.bind("mouseenter",function(){return a.stop()}),o.bind("mouseleave",function(){return a.options.play.restartDelay?t.data(a,"restartDelay",setTimeout(function(){return a.play(!0)},a.options.play.restartDelay)):a.play()})),t.data(this,"playing",!0),t(".slidesjs-play",n).addClass("slidesjs-playing"),this.options.play.swap)?(t(".slidesjs-play",n).hide(),t(".slidesjs-stop",n).show()):void 0},i.prototype.stop=function(e){var n;return n=t(this.element),this.data=t.data(this),clearInterval(this.data.playInterval),this.options.play.pauseOnHover&&e&&t(".slidesjs-container",n).unbind(),t.data(this,"playInterval",null),t.data(this,"playing",!1),t(".slidesjs-play",n).removeClass("slidesjs-playing"),this.options.play.swap?(t(".slidesjs-stop",n).hide(),t(".slidesjs-play",n).show()):void 0},i.prototype._slide=function(e){var n,i,o,a,r,s,l,c,d,h,u=this;return n=t(this.element),this.data=t.data(this),this.data.animating||e===this.data.current+1?void 0:(t.data(this,"animating",!0),i=this.data.current,e>-1?(e-=1,h=e>i?1:-1,o=e>i?-this.options.width:this.options.width,r=e):(h="next"===this.data.direction?1:-1,o="next"===this.data.direction?-this.options.width:this.options.width,r=i+h),-1===r&&(r=this.data.total-1),r===this.data.total&&(r=0),this._setActive(r),l=t(".slidesjs-control",n),e>-1&&l.children(":not(:eq("+i+"))").css({display:"none",left:0,zIndex:0}),l.children(":eq("+r+")").css({display:"block",left:h*this.options.width,zIndex:10}),this.options.callback.start(i+1),this.data.vendorPrefix?(s=this.data.vendorPrefix,d=s+"Transform",a=s+"TransitionDuration",c=s+"TransitionTimingFunction",l[0].style[d]="translateX("+o+"px)",l[0].style[a]=this.options.effect.slide.speed+"ms",l.on("transitionend webkitTransitionEnd oTransitionEnd otransitionend MSTransitionEnd",function(){return l[0].style[d]="",l[0].style[a]="",l.children(":eq("+r+")").css({left:0}),l.children(":eq("+i+")").css({display:"none",left:0,zIndex:0}),t.data(u,"current",r),t.data(u,"animating",!1),l.unbind("transitionend webkitTransitionEnd oTransitionEnd otransitionend MSTransitionEnd"),l.children(":not(:eq("+r+"))").css({display:"none",left:0,zIndex:0}),u.data.touch&&u._setuptouch(),u.options.callback.complete(r+1)})):l.stop().animate({left:o},this.options.effect.slide.speed,function(){return l.css({left:0}),l.children(":eq("+r+")").css({left:0}),l.children(":eq("+i+")").css({display:"none",left:0,zIndex:0},t.data(u,"current",r),t.data(u,"animating",!1),u.options.callback.complete(r+1))}))},i.prototype._fade=function(e){var n,i,o,a,r,s=this;return n=t(this.element),this.data=t.data(this),this.data.animating||e===this.data.current+1?void 0:(t.data(this,"animating",!0),i=this.data.current,e?(e-=1,r=e>i?1:-1,o=e):(r="next"===this.data.direction?1:-1,o=i+r),-1===o&&(o=this.data.total-1),o===this.data.total&&(o=0),this._setActive(o),a=t(".slidesjs-control",n),a.children(":eq("+o+")").css({display:"none",left:0,zIndex:10}),this.options.callback.start(i+1),this.options.effect.fade.crossfade?(a.children(":eq("+this.data.current+")").stop().fadeOut(this.options.effect.fade.speed),a.children(":eq("+o+")").stop().fadeIn(this.options.effect.fade.speed,function(){return a.children(":eq("+o+")").css({zIndex:0}),t.data(s,"animating",!1),t.data(s,"current",o),s.options.callback.complete(o+1)})):a.children(":eq("+i+")").stop().fadeOut(this.options.effect.fade.speed,function(){return a.children(":eq("+o+")").stop().fadeIn(s.options.effect.fade.speed,function(){return a.children(":eq("+o+")").css({zIndex:10})}),t.data(s,"animating",!1),t.data(s,"current",o),s.options.callback.complete(o+1)}))},i.prototype._getVendorPrefix=function(){var t,e,i,o,a;for(t=n.body||n.documentElement,i=t.style,o="transition",a=["Moz","Webkit","Khtml","O","ms"],o=o.charAt(0).toUpperCase()+o.substr(1),e=0;e<a.length;){if("string"==typeof i[a[e]+o])return a[e];e++}return!1},t.fn[a]=function(e){return this.each(function(){return t.data(this,"plugin_"+a)?void 0:t.data(this,"plugin_"+a,new i(this,e))})}}(jQuery,window,document)}.call(this),function(t){t.fn.bootstrapFileInput=function(){this.each(function(e,n){var i=t(n);if("undefined"==typeof i.attr("data-bfi-disabled")){var o="Browse";"undefined"!=typeof i.attr("title")&&(o=i.attr("title"));var a="";i.attr("class")&&(a=" "+i.attr("class")),i.wrap('<a class="file-input-wrapper btn btn-default '+a+'"></a>').parent().prepend(t("<span></span>").html(o))}}).promise().done(function(){t(".file-input-wrapper").mousemove(function(e){var n,i,o,a,r,s,l,c;i=t(this),n=i.find("input"),o=i.offset().left,a=i.offset().top,r=n.width(),s=n.height(),l=e.pageX,c=e.pageY,moveInputX=l-o-r+20,moveInputY=c-a-s/2,n.css({left:moveInputX,top:moveInputY})}),t("body").on("change",".file-input-wrapper input[type=file]",function(){var e;if(e=t(this).val(),t(this).parent().next(".file-input-name").remove(),e=t(this).prop("files")&&t(this).prop("files").length>1?t(this)[0].files.length+" files":e.substring(e.lastIndexOf("\\")+1,e.length)){var n=t(this).data("filename-placement");"inside"===n?(t(this).siblings("span").html(e),t(this).attr("title",e)):t(this).parent().after('<span class="file-input-name">'+e+"</span>")}})})};var e="<style>.file-input-wrapper { overflow: hidden; position: relative; cursor: pointer; z-index: 1; }.file-input-wrapper input[type=file], .file-input-wrapper input[type=file]:focus, .file-input-wrapper input[type=file]:hover { position: absolute; top: 0; left: 0; cursor: pointer; opacity: 0; filter: alpha(opacity=0); z-index: 99; outline: 0; }.file-input-name { margin-left: 8px; }</style>";t("link[rel=stylesheet]").eq(0).before(e)}(jQuery),$(function(){$(".axform").submit(function(t){submitAjax($(this)),t.preventDefault()}),$(".confirm").submit(function(){var t="Are you sure?\n"+$(this).data("warning");return window.confirm(t)}),$(".file-form").submit(function(t){t.preventDefault(),$(this).children("button").innerHTML="Uploading..."}),$("#request-training").submit(function(t){t.preventDefault();var e=new Date,n=e.getMonth(),i=e.getDate(),o=e.getFullYear(),a=e.getHours(),r=e.getMinutes(),s=$(".datepick:eq(0)").val();""==s&&(s=o+"-"+n+"-"+i+" "+a+":"+r+":00");var l=$(".datepick:eq(1)").val();""==l&&(l=o+"-"+n+"-"+i+" "+a+":"+r+":00"),$.ajax({url:"/t/request/new",type:"post",data:{start:s,end:l,user:document.getElementById("userid").value,cert:document.getElementById("examid").value}}).done(function(t){t=JSON.parse(t),$("#flash").prepend(t.success?t.message:t.message)})}),$("#pm-reply").submit(function(t){validateCC($(this))||t.preventDefault()})}),$(function(){if($(".file-control").bootstrapFileInput({"data-filename-placement":"inside"}),highlightCorrect(),$(".datepick").datetimepicker({language:"en",inline:!0,minDate:"0",maxDate:"+1970/01/30",onChangeDateTime:function(t,e){var n=$(this.prev()[0]).data("field");document.getElementById(n).value=e.val()}}),$("#slideshow").slidesjs({width:900,height:400,pagination:{active:!1},play:{active:!1,interval:4e3,auto:!0,swap:!1,pauseOnHover:!0,restartDelay:2500},effect:{slide:{speed:2e3},fade:{speed:2e3,crossfade:!0}}}),$("#training")){var t=$("#training .progress-bar").attr("aria-valuenow"),e=t/58*100;$("#training .progress-bar").css("width",e+"%")}$(".editor").redactor({buttons:["bold","italic","underline","unorderedlist","orderedlist","outdent","indent","image","link"]}),$(".raptor").raptor()});